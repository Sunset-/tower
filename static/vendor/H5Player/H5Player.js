!function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=0)}([function(e,t,i){i(1),e.exports=i(328)},function(e,t,i){"use strict";(function(e){if(i(3),i(324),i(325),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0;function t(e,t,i){e[t]||Object.defineProperty(e,t,{writable:!0,configurable:!0,value:i})}t(String.prototype,"padLeft","".padStart),t(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e){[][e]&&t(Array,e,Function.call.bind([][e]))})}).call(this,i(2))},function(H,I){var J;J=function(){return this}();try{J=J||Function("return this")()||eval("this")}catch(e){"object"==typeof window&&(J=window)}H.exports=J},function(e,t,i){i(4),i(52),i(53),i(54),i(55),i(57),i(60),i(61),i(62),i(63),i(64),i(65),i(66),i(67),i(68),i(70),i(72),i(74),i(76),i(79),i(80),i(81),i(85),i(87),i(89),i(92),i(93),i(94),i(95),i(97),i(98),i(99),i(100),i(101),i(102),i(103),i(105),i(106),i(107),i(109),i(110),i(111),i(113),i(115),i(116),i(117),i(118),i(119),i(120),i(121),i(122),i(123),i(124),i(125),i(126),i(127),i(132),i(133),i(137),i(138),i(139),i(140),i(142),i(143),i(144),i(145),i(146),i(147),i(148),i(149),i(150),i(151),i(152),i(153),i(154),i(155),i(156),i(158),i(159),i(161),i(162),i(168),i(169),i(171),i(172),i(173),i(177),i(178),i(179),i(180),i(181),i(183),i(184),i(185),i(186),i(189),i(191),i(192),i(193),i(195),i(197),i(199),i(200),i(201),i(203),i(204),i(205),i(206),i(217),i(221),i(222),i(224),i(225),i(229),i(230),i(232),i(233),i(234),i(235),i(236),i(237),i(238),i(239),i(240),i(241),i(242),i(243),i(244),i(245),i(246),i(247),i(248),i(249),i(250),i(252),i(253),i(254),i(255),i(256),i(258),i(259),i(260),i(262),i(263),i(264),i(265),i(266),i(267),i(268),i(269),i(271),i(272),i(274),i(275),i(276),i(277),i(280),i(281),i(283),i(284),i(285),i(286),i(288),i(289),i(290),i(291),i(292),i(293),i(294),i(295),i(296),i(297),i(299),i(300),i(301),i(302),i(303),i(304),i(305),i(306),i(307),i(308),i(309),i(311),i(312),i(313),i(314),i(315),i(316),i(317),i(318),i(319),i(320),i(321),i(322),i(323),e.exports=i(10)},function(e,t,i){"use strict";function r(e){var t=W[e]=x(B[j]);return t._k=e,t}function n(e,t){w(e);for(var i,r=E(t=R(t)),n=0,a=r.length;n<a;)$(e,i=r[n++],t[i]);return e}function a(e){var t=V.call(this,e=A(e,!0));return!(this===Y&&h(W,e)&&!h(K,e))&&(!(t||!h(this,e)||!h(W,e)||h(this,z)&&this[z][e])||t)}function s(e,t){if(e=R(e),t=A(t,!0),e!==Y||!h(W,t)||h(K,t)){var i=P(e,t);return!i||!h(W,t)||h(e,z)&&e[z][t]||(i.enumerable=!0),i}}function o(e){for(var t,i=F(R(e)),r=[],n=0;i.length>n;)h(W,t=i[n++])||t==z||t==p||r.push(t);return r}function l(e){for(var t,i=e===Y,r=F(i?K:R(e)),n=[],a=0;r.length>a;)!h(W,t=r[a++])||i&&!h(Y,t)||n.push(W[t]);return n}var u=i(5),h=i(6),d=i(7),c=i(9),f=i(19),p=i(23).KEY,v=i(8),m=i(24),g=i(26),_=i(20),y=i(27),b=i(28),S=i(29),E=i(30),k=i(45),w=i(13),T=i(14),R=i(33),A=i(17),C=i(18),x=i(46),I=i(49),O=i(51),L=i(12),D=i(31),P=O.f,M=L.f,F=I.f,B=u.Symbol,N=u.JSON,U=N&&N.stringify,j="prototype",z=y("_hidden"),G=y("toPrimitive"),V={}.propertyIsEnumerable,H=m("symbol-registry"),W=m("symbols"),K=m("op-symbols"),Y=Object[j],q="function"==typeof B,X=u.QObject,Z=!X||!X[j]||!X[j].findChild,J=d&&v(function(){return 7!=x(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(e,t,i){var r=P(Y,t);r&&delete Y[t],M(e,t,i),r&&e!==Y&&M(Y,t,r)}:M,Q=q&&"symbol"==typeof B.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof B},$=function(e,t,i){return e===Y&&$(K,t,i),w(e),t=A(t,!0),w(i),h(W,t)?(i.enumerable?(h(e,z)&&e[z][t]&&(e[z][t]=!1),i=x(i,{enumerable:C(0,!1)})):(h(e,z)||M(e,z,C(1,{})),e[z][t]=!0),J(e,t,i)):M(e,t,i)};q||(f((B=function(e){if(this instanceof B)throw TypeError("Symbol is not a constructor!");var t=_(0<arguments.length?e:void 0),i=function(e){this===Y&&i.call(K,e),h(this,z)&&h(this[z],t)&&(this[z][t]=!1),J(this,t,C(1,e))};return d&&Z&&J(Y,t,{configurable:!0,set:i}),r(t)})[j],"toString",function(){return this._k}),O.f=s,L.f=$,i(50).f=I.f=o,i(44).f=a,i(43).f=l,d&&!i(25)&&f(Y,"propertyIsEnumerable",a,!0),b.f=function(e){return r(y(e))}),c(c.G+c.W+c.F*!q,{Symbol:B});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)y(ee[te++]);for(var ie=D(y.store),re=0;ie.length>re;)S(ie[re++]);c(c.S+c.F*!q,"Symbol",{for:function(e){return h(H,e+="")?H[e]:H[e]=B(e)},keyFor:function(e){if(!Q(e))throw TypeError(e+" is not a symbol!");for(var t in H)if(H[t]===e)return t},useSetter:function(){Z=!0},useSimple:function(){Z=!1}}),c(c.S+c.F*!q,"Object",{create:function(e,t){return void 0===t?x(e):n(x(e),t)},defineProperty:$,defineProperties:n,getOwnPropertyDescriptor:s,getOwnPropertyNames:o,getOwnPropertySymbols:l}),N&&c(c.S+c.F*(!q||v(function(){var e=B();return"[null]"!=U([e])||"{}"!=U({a:e})||"{}"!=U(Object(e))})),"JSON",{stringify:function(e){for(var t,i,r=[e],n=1;n<arguments.length;)r.push(arguments[n++]);if(i=t=r[1],(T(t)||void 0!==e)&&!Q(e))return k(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!Q(t))return t}),r[1]=t,U.apply(N,r)}}),B[j][G]||i(11)(B[j],G,B[j].valueOf),g(B,"Symbol"),g(Math,"Math",!0),g(u.JSON,"JSON",!0)},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){e.exports=!i(8)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){var v=i(5),m=i(10),g=i(11),_=i(19),y=i(21),b="prototype",S=function(e,t,i){var r,n,a,s,o=e&S.F,l=e&S.G,u=e&S.S,h=e&S.P,d=e&S.B,c=l?v:u?v[t]||(v[t]={}):(v[t]||{})[b],f=l?m:m[t]||(m[t]={}),p=f[b]||(f[b]={});for(r in l&&(i=t),i)a=((n=!o&&c&&void 0!==c[r])?c:i)[r],s=d&&n?y(a,v):h&&"function"==typeof a?y(Function.call,a):a,c&&_(c,r,a,e&S.U),f[r]!=a&&g(f,r,s),h&&p[r]!=a&&(p[r]=a)};v.core=m,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,e.exports=S},function(e,t){var i=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=i)},function(e,t,i){var r=i(12),n=i(18);e.exports=i(7)?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var r=i(13),n=i(15),a=i(17),s=Object.defineProperty;t.f=i(7)?Object.defineProperty:function(e,t,i){if(r(e),t=a(t,!0),r(i),n)try{return s(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var r=i(14);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,i){e.exports=!i(7)&&!i(8)(function(){return 7!=Object.defineProperty(i(16)("div"),"a",{get:function(){return 7}}).a})},function(e,t,i){var r=i(14),n=i(5).document,a=r(n)&&r(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},function(e,t,i){var n=i(14);e.exports=function(e,t){if(!n(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!n(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){var a=i(5),s=i(11),o=i(6),l=i(20)("src"),r="toString",n=Function[r],u=(""+n).split(r);i(10).inspectSource=function(e){return n.call(e)},(e.exports=function(e,t,i,r){var n="function"==typeof i;n&&(o(i,"name")||s(i,"name",t)),e[t]!==i&&(n&&(o(i,l)||s(i,l,e[t]?""+e[t]:u.join(String(t)))),e===a?e[t]=i:r?e[t]?e[t]=i:s(e,t,i):(delete e[t],s(e,t,i)))})(Function.prototype,r,function(){return"function"==typeof this&&this[l]||n.call(this)})},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t,i){var a=i(22);e.exports=function(r,n,e){if(a(r),void 0===n)return r;switch(e){case 1:return function(e){return r.call(n,e)};case 2:return function(e,t){return r.call(n,e,t)};case 3:return function(e,t,i){return r.call(n,e,t,i)}}return function(){return r.apply(n,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){function r(e){o(e,n,{value:{i:"O"+ ++l,w:{}}})}var n=i(20)("meta"),a=i(14),s=i(6),o=i(12).f,l=0,u=Object.isExtensible||function(){return!0},h=!i(8)(function(){return u(Object.preventExtensions({}))}),d=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,n)){if(!u(e))return"F";if(!t)return"E";r(e)}return e[n].i},getWeak:function(e,t){if(!s(e,n)){if(!u(e))return!0;if(!t)return!1;r(e)}return e[n].w},onFreeze:function(e){return h&&d.NEED&&u(e)&&!s(e,n)&&r(e),e}}},function(e,t,i){var r=i(10),n=i(5),a="__core-js_shared__",s=n[a]||(n[a]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(25)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports=!1},function(e,t,i){var r=i(12).f,n=i(6),a=i(27)("toStringTag");e.exports=function(e,t,i){e&&!n(e=i?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,i){var r=i(24)("wks"),n=i(20),a=i(5).Symbol,s="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=s&&a[e]||(s?a:n)("Symbol."+e))}).store=r},function(e,t,i){t.f=i(27)},function(e,t,i){var r=i(5),n=i(10),a=i(25),s=i(28),o=i(12).f;e.exports=function(e){var t=n.Symbol||(n.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:s.f(e)})}},function(e,t,i){var o=i(31),l=i(43),u=i(44);e.exports=function(e){var t=o(e),i=l.f;if(i)for(var r,n=i(e),a=u.f,s=0;n.length>s;)a.call(e,r=n[s++])&&t.push(r);return t}},function(e,t,i){var r=i(32),n=i(42);e.exports=Object.keys||function(e){return r(e,n)}},function(e,t,i){var s=i(6),o=i(33),l=i(37)(!1),u=i(41)("IE_PROTO");e.exports=function(e,t){var i,r=o(e),n=0,a=[];for(i in r)i!=u&&s(r,i)&&a.push(i);for(;t.length>n;)s(r,i=t[n++])&&(~l(a,i)||a.push(i));return a}},function(e,t,i){var r=i(34),n=i(36);e.exports=function(e){return r(n(e))}},function(e,t,i){var r=i(35);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var l=i(33),u=i(38),h=i(40);e.exports=function(o){return function(e,t,i){var r,n=l(e),a=u(n.length),s=h(i,a);if(o&&t!=t){for(;s<a;)if((r=n[s++])!=r)return!0}else for(;s<a;s++)if((o||s in n)&&n[s]===t)return o||s||0;return!o&&-1}}},function(e,t,i){var r=i(39),n=Math.min;e.exports=function(e){return 0<e?n(r(e),9007199254740991):0}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?r:i)(e)}},function(e,t,i){var r=i(39),n=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?n(e+t,0):a(e,t)}},function(e,t,i){var r=i(24)("keys"),n=i(20);e.exports=function(e){return r[e]||(r[e]=n(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){var r=i(35);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,r){function n(){}var a=r(13),s=r(47),o=r(42),l=r(41)("IE_PROTO"),u="prototype",h=function(){var e,t=r(16)("iframe"),i=o.length;for(t.style.display="none",r(48).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),h=e.F;i--;)delete h[u][o[i]];return h()};e.exports=Object.create||function(e,t){var i;return null!==e?(n[u]=a(e),i=new n,n[u]=null,i[l]=e):i=h(),void 0===t?i:s(i,t)}},function(e,t,i){var s=i(12),o=i(13),l=i(31);e.exports=i(7)?Object.defineProperties:function(e,t){o(e);for(var i,r=l(t),n=r.length,a=0;a<n;)s.f(e,i=r[a++],t[i]);return e}},function(e,t,i){var r=i(5).document;e.exports=r&&r.documentElement},function(e,t,i){var r=i(33),n=i(50).f,a={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==a.call(e)?function(e){try{return n(e)}catch(e){return s.slice()}}(e):n(r(e))}},function(e,t,i){var r=i(32),n=i(42).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,n)}},function(e,t,i){var r=i(44),n=i(18),a=i(33),s=i(17),o=i(6),l=i(15),u=Object.getOwnPropertyDescriptor;t.f=i(7)?u:function(e,t){if(e=a(e),t=s(t,!0),l)try{return u(e,t)}catch(e){}if(o(e,t))return n(!r.f.call(e,t),e[t])}},function(e,t,i){var r=i(9);r(r.S,"Object",{create:i(46)})},function(e,t,i){var r=i(9);r(r.S+r.F*!i(7),"Object",{defineProperty:i(12).f})},function(e,t,i){var r=i(9);r(r.S+r.F*!i(7),"Object",{defineProperties:i(47)})},function(e,t,i){var r=i(33),n=i(51).f;i(56)("getOwnPropertyDescriptor",function(){return function(e,t){return n(r(e),t)}})},function(e,t,i){var n=i(9),a=i(10),s=i(8);e.exports=function(e,t){var i=(a.Object||{})[e]||Object[e],r={};r[e]=t(i),n(n.S+n.F*s(function(){i(1)}),"Object",r)}},function(e,t,i){var r=i(58),n=i(59);i(56)("getPrototypeOf",function(){return function(e){return n(r(e))}})},function(e,t,i){var r=i(36);e.exports=function(e){return Object(r(e))}},function(e,t,i){var r=i(6),n=i(58),a=i(41)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=n(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,i){var r=i(58),n=i(31);i(56)("keys",function(){return function(e){return n(r(e))}})},function(e,t,i){i(56)("getOwnPropertyNames",function(){return i(49).f})},function(e,t,i){var r=i(14),n=i(23).onFreeze;i(56)("freeze",function(t){return function(e){return t&&r(e)?t(n(e)):e}})},function(e,t,i){var r=i(14),n=i(23).onFreeze;i(56)("seal",function(t){return function(e){return t&&r(e)?t(n(e)):e}})},function(e,t,i){var r=i(14),n=i(23).onFreeze;i(56)("preventExtensions",function(t){return function(e){return t&&r(e)?t(n(e)):e}})},function(e,t,i){var r=i(14);i(56)("isFrozen",function(t){return function(e){return!r(e)||!!t&&t(e)}})},function(e,t,i){var r=i(14);i(56)("isSealed",function(t){return function(e){return!r(e)||!!t&&t(e)}})},function(e,t,i){var r=i(14);i(56)("isExtensible",function(t){return function(e){return!!r(e)&&(!t||t(e))}})},function(e,t,i){var r=i(9);r(r.S+r.F,"Object",{assign:i(69)})},function(e,t,i){"use strict";var c=i(31),f=i(43),p=i(44),v=i(58),m=i(34),n=Object.assign;e.exports=!n||i(8)(function(){var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(e){t[e]=e}),7!=n({},e)[i]||Object.keys(n({},t)).join("")!=r})?function(e,t){for(var i=v(e),r=arguments.length,n=1,a=f.f,s=p.f;n<r;)for(var o,l=m(arguments[n++]),u=a?c(l).concat(a(l)):c(l),h=u.length,d=0;d<h;)s.call(l,o=u[d++])&&(i[o]=l[o]);return i}:n},function(e,t,i){var r=i(9);r(r.S,"Object",{is:i(71)})},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,i){var r=i(9);r(r.S,"Object",{setPrototypeOf:i(73).set})},function(e,t,n){function a(e,t){if(r(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")}var i=n(14),r=n(13);e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,i,r){try{(r=n(21)(Function.call,n(51).f(Object.prototype,"__proto__").set,2))(e,[]),i=!(e instanceof Array)}catch(e){i=!0}return function(e,t){return a(e,t),i?e.__proto__=t:r(e,t),e}}({},!1):void 0),check:a}},function(e,t,i){"use strict";var r=i(75),n={};n[i(27)("toStringTag")]="z",n+""!="[object z]"&&i(19)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,i){var n=i(35),a=i(27)("toStringTag"),s="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?i:s?n(t):"Object"==(r=n(t))&&"function"==typeof t.callee?"Arguments":r}},function(e,t,i){var r=i(9);r(r.P,"Function",{bind:i(77)})},function(e,t,i){"use strict";var a=i(22),s=i(14),o=i(78),l=[].slice,u={};e.exports=Function.bind||function(t){var i=a(this),r=l.call(arguments,1),n=function(){var e=r.concat(l.call(arguments));return this instanceof n?function(e,t,i){if(!(t in u)){for(var r=[],n=0;n<t;n++)r[n]="a["+n+"]";u[t]=Function("F,a","return new F("+r.join(",")+")")}return u[t](e,i)}(i,e.length,e):o(i,e,t)};return s(i.prototype)&&(n.prototype=i.prototype),n}},function(e,t){e.exports=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},function(e,t,i){var r=i(12).f,n=Function.prototype,a=/^\s*function ([^ (]*)/;"name"in n||i(7)&&r(n,"name",{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},function(e,t,i){"use strict";var r=i(14),n=i(59),a=i(27)("hasInstance"),s=Function.prototype;a in s||i(12).f(s,a,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=n(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,i){var r=i(9),n=i(82);r(r.G+r.F*(parseInt!=n),{parseInt:n})},function(e,t,i){var r=i(5).parseInt,n=i(83).trim,a=i(84),s=/^[-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var i=n(String(e),3);return r(i,t>>>0||(s.test(i)?16:10))}:r},function(e,t,i){function r(e,t,i){var r={},n=o(function(){return!!l[e]()||"​"!="​"[e]()}),a=r[e]=n?t(d):l[e];i&&(r[i]=a),s(s.P+s.F*n,"String",r)}var s=i(9),n=i(36),o=i(8),l=i(84),a="["+l+"]",u=RegExp("^"+a+a+"*"),h=RegExp(a+a+"*$"),d=r.trim=function(e,t){return e=String(n(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(h,"")),e};e.exports=r},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,i){var r=i(9),n=i(86);r(r.G+r.F*(parseFloat!=n),{parseFloat:n})},function(e,t,i){var r=i(5).parseFloat,n=i(83).trim;e.exports=1/r(i(84)+"-0")!=-1/0?function(e){var t=n(String(e),3),i=r(t);return 0===i&&"-"==t.charAt(0)?-0:i}:r},function(e,t,i){"use strict";function r(e){var t=h(e,!1);if("string"==typeof t&&2<t.length){var i,r,n,a=(t=y?t.trim():f(t,3)).charCodeAt(0);if(43===a||45===a){if(88===(i=t.charCodeAt(2))||120===i)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+t}for(var s,o=t.slice(2),l=0,u=o.length;l<u;l++)if((s=o.charCodeAt(l))<48||n<s)return NaN;return parseInt(o,r)}}return+t}var n=i(5),a=i(6),s=i(35),o=i(88),h=i(17),l=i(8),u=i(50).f,d=i(51).f,c=i(12).f,f=i(83).trim,p="Number",v=n[p],m=v,g=v.prototype,_=s(i(46)(g))==p,y="trim"in String.prototype;if(!v(" 0o1")||!v("0b1")||v("+0x1")){v=function(e){var t=arguments.length<1?0:e,i=this;return i instanceof v&&(_?l(function(){g.valueOf.call(i)}):s(i)!=p)?o(new m(r(t)),i,v):r(t)};for(var b,S=i(7)?u(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),E=0;S.length>E;E++)a(m,b=S[E])&&!a(v,b)&&c(v,b,d(m,b));(v.prototype=g).constructor=v,i(19)(n,p,v)}},function(e,t,i){var a=i(14),s=i(73).set;e.exports=function(e,t,i){var r,n=t.constructor;return n!==i&&"function"==typeof n&&(r=n.prototype)!==i.prototype&&a(r)&&s&&s(e,r),e}},function(e,t,i){"use strict";function u(e,t){for(var i=-1,r=t;++i<6;)r+=e*s[i],s[i]=r%1e7,r=a(r/1e7)}function h(e){for(var t=6,i=0;0<=--t;)i+=s[t],s[t]=a(i/e),i=i%e*1e7}function d(){for(var e=6,t="";0<=--e;)if(""!==t||0===e||0!==s[e]){var i=String(s[e]);t=""===t?i:t+p.call("0",7-i.length)+i}return t}var r=i(9),c=i(39),f=i(90),p=i(91),n=1..toFixed,a=Math.floor,s=[0,0,0,0,0,0],v="Number.toFixed: incorrect invocation!",m=function(e,t,i){return 0===t?i:t%2==1?m(e,t-1,i*e):m(e*e,t/2,i)};r(r.P+r.F*(!!n&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(8)(function(){n.call({})})),"Number",{toFixed:function(e){var t,i,r,n,a=f(this,v),s=c(e),o="",l="0";if(s<0||20<s)throw RangeError(v);if(a!=a)return"NaN";if(a<=-1e21||1e21<=a)return String(a);if(a<0&&(o="-",a=-a),1e-21<a)if(i=(t=function(e){for(var t=0,i=e;4096<=i;)t+=12,i/=4096;for(;2<=i;)t+=1,i/=2;return t}(a*m(2,69,1))-69)<0?a*m(2,-t,1):a/m(2,t,1),i*=4503599627370496,0<(t=52-t)){for(u(0,i),r=s;7<=r;)u(1e7,0),r-=7;for(u(m(10,r,1),0),r=t-1;23<=r;)h(1<<23),r-=23;h(1<<r),u(1,1),h(2),l=d()}else u(0,i),u(1<<-t,0),l=d()+p.call("0",s);return l=0<s?o+((n=l.length)<=s?"0."+p.call("0",s-n)+l:l.slice(0,n-s)+"."+l.slice(n-s)):o+l}})},function(e,t,i){var r=i(35);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,i){"use strict";var n=i(39),a=i(36);e.exports=function(e){var t=String(a(this)),i="",r=n(e);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i}},function(e,t,i){"use strict";var r=i(9),n=i(8),a=i(90),s=1..toPrecision;r(r.P+r.F*(n(function(){return"1"!==s.call(1,void 0)})||!n(function(){s.call({})})),"Number",{toPrecision:function(e){var t=a(this,"Number#toPrecision: incorrect invocation!");return void 0===e?s.call(t):s.call(t,e)}})},function(e,t,i){var r=i(9);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,i){var r=i(9),n=i(5).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&n(e)}})},function(e,t,i){var r=i(9);r(r.S,"Number",{isInteger:i(96)})},function(e,t,i){var r=i(14),n=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&n(e)===e}},function(e,t,i){var r=i(9);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,i){var r=i(9),n=i(96),a=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return n(e)&&a(e)<=9007199254740991}})},function(e,t,i){var r=i(9);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,i){var r=i(9);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,i){var r=i(9),n=i(86);r(r.S+r.F*(Number.parseFloat!=n),"Number",{parseFloat:n})},function(e,t,i){var r=i(9),n=i(82);r(r.S+r.F*(Number.parseInt!=n),"Number",{parseInt:n})},function(e,t,i){var r=i(9),n=i(104),a=Math.sqrt,s=Math.acosh;r(r.S+r.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:94906265.62425156<e?Math.log(e)+Math.LN2:n(e-1+a(e-1)*a(e+1))}})},function(e,t){e.exports=Math.log1p||function(e){return-1e-8<(e=+e)&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,i){var r=i(9),n=Math.asinh;r(r.S+r.F*!(n&&0<1/n(0)),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},function(e,t,i){var r=i(9),n=Math.atanh;r(r.S+r.F*!(n&&1/n(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,i){var r=i(9),n=i(108);r(r.S,"Math",{cbrt:function(e){return n(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t,i){var r=i(9);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,i){var r=i(9),n=Math.exp;r(r.S,"Math",{cosh:function(e){return(n(e=+e)+n(-e))/2}})},function(e,t,i){var r=i(9),n=i(112);r(r.S+r.F*(n!=Math.expm1),"Math",{expm1:n})},function(e,t){var i=Math.expm1;e.exports=!i||22025.465794806718<i(10)||i(10)<22025.465794806718||-2e-17!=i(-2e-17)?function(e){return 0==(e=+e)?e:-1e-6<e&&e<1e-6?e+e*e/2:Math.exp(e)-1}:i},function(e,t,i){var r=i(9);r(r.S,"Math",{fround:i(114)})},function(e,t,i){var a=i(108),r=Math.pow,s=r(2,-52),o=r(2,-23),l=r(2,127)*(2-o),u=r(2,-126);e.exports=Math.fround||function(e){var t,i,r=Math.abs(e),n=a(e);return r<u?n*function(e){return e+1/s-1/s}(r/u/o)*u*o:l<(i=(t=(1+o/s)*r)-(t-r))||i!=i?n*(1/0):n*i}},function(e,t,i){var r=i(9),l=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var i,r,n=0,a=0,s=arguments.length,o=0;a<s;)o<(i=l(arguments[a++]))?(n=n*(r=o/i)*r+1,o=i):n+=0<i?(r=i/o)*r:i;return o===1/0?1/0:o*Math.sqrt(n)}})},function(e,t,i){var r=i(9),n=Math.imul;r(r.S+r.F*i(8)(function(){return-5!=n(4294967295,5)||2!=n.length}),"Math",{imul:function(e,t){var i=65535,r=+e,n=+t,a=i&r,s=i&n;return 0|a*s+((i&r>>>16)*s+a*(i&n>>>16)<<16>>>0)}})},function(e,t,i){var r=i(9);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,i){var r=i(9);r(r.S,"Math",{log1p:i(104)})},function(e,t,i){var r=i(9);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,i){var r=i(9);r(r.S,"Math",{sign:i(108)})},function(e,t,i){var r=i(9),n=i(112),a=Math.exp;r(r.S+r.F*i(8)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(n(e)-n(-e))/2:(a(e-1)-a(-e-1))*(Math.E/2)}})},function(e,t,i){var r=i(9),n=i(112),a=Math.exp;r(r.S,"Math",{tanh:function(e){var t=n(e=+e),i=n(-e);return t==1/0?1:i==1/0?-1:(t-i)/(a(e)+a(-e))}})},function(e,t,i){var r=i(9);r(r.S,"Math",{trunc:function(e){return(0<e?Math.floor:Math.ceil)(e)}})},function(e,t,i){var r=i(9),a=i(40),s=String.fromCharCode,n=String.fromCodePoint;r(r.S+r.F*(!!n&&1!=n.length),"String",{fromCodePoint:function(e){for(var t,i=[],r=arguments.length,n=0;n<r;){if(t=+arguments[n++],a(t,1114111)!==t)throw RangeError(t+" is not a valid code point");i.push(t<65536?s(t):s(55296+((t-=65536)>>10),t%1024+56320))}return i.join("")}})},function(e,t,i){var r=i(9),s=i(33),o=i(38);r(r.S,"String",{raw:function(e){for(var t=s(e.raw),i=o(t.length),r=arguments.length,n=[],a=0;a<i;)n.push(String(t[a++])),a<r&&n.push(String(arguments[a]));return n.join("")}})},function(e,t,i){"use strict";i(83)("trim",function(e){return function(){return e(this,3)}})},function(e,t,i){"use strict";var r=i(128)(!0);i(129)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})})},function(e,t,i){var l=i(39),u=i(36);e.exports=function(o){return function(e,t){var i,r,n=String(u(e)),a=l(t),s=n.length;return a<0||s<=a?o?"":void 0:(i=n.charCodeAt(a))<55296||56319<i||a+1===s||(r=n.charCodeAt(a+1))<56320||57343<r?o?n.charAt(a):i:o?n.slice(a,a+2):r-56320+(i-55296<<10)+65536}}},function(e,t,i){"use strict";function y(){return this}var b=i(25),S=i(9),E=i(19),k=i(11),w=i(130),T=i(131),R=i(26),A=i(59),C=i(27)("iterator"),x=!([].keys&&"next"in[].keys()),I="values";e.exports=function(e,t,i,r,n,a,s){T(i,t,r);function o(e){if(!x&&e in p)return p[e];switch(e){case"keys":case I:return function(){return new i(this,e)}}return function(){return new i(this,e)}}var l,u,h,d=t+" Iterator",c=n==I,f=!1,p=e.prototype,v=p[C]||p["@@iterator"]||n&&p[n],m=v||o(n),g=n?c?o("entries"):m:void 0,_="Array"==t&&p.entries||v;if(_&&(h=A(_.call(new e)))!==Object.prototype&&h.next&&(R(h,d,!0),b||"function"==typeof h[C]||k(h,C,y)),c&&v&&v.name!==I&&(f=!0,m=function(){return v.call(this)}),b&&!s||!x&&!f&&p[C]||k(p,C,m),w[t]=m,w[d]=y,n)if(l={values:c?m:o(I),keys:a?m:o("keys"),entries:g},s)for(u in l)u in p||E(p,u,l[u]);else S(S.P+S.F*(x||f),t,l);return l}},function(e,t){e.exports={}},function(e,t,i){"use strict";var r=i(46),n=i(18),a=i(26),s={};i(11)(s,i(27)("iterator"),function(){return this}),e.exports=function(e,t,i){e.prototype=r(s,{next:n(1,i)}),a(e,t+" Iterator")}},function(e,t,i){"use strict";var r=i(9),n=i(128)(!1);r(r.P,"String",{codePointAt:function(e){return n(this,e)}})},function(e,t,i){"use strict";var r=i(9),o=i(38),l=i(134),u="endsWith",h=""[u];r(r.P+r.F*i(136)(u),"String",{endsWith:function(e,t){var i=l(this,e,u),r=1<arguments.length?t:void 0,n=o(i.length),a=void 0===r?n:Math.min(o(r),n),s=String(e);return h?h.call(i,s,a):i.slice(a-s.length,a)===s}})},function(e,t,i){var r=i(135),n=i(36);e.exports=function(e,t,i){if(r(t))throw TypeError("String#"+i+" doesn't accept regex!");return String(n(e))}},function(e,t,i){var r=i(14),n=i(35),a=i(27)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==n(e))}},function(e,t,i){var r=i(27)("match");e.exports=function(t){var i=/./;try{"/./"[t](i)}catch(e){try{return i[r]=!1,!"/./"[t](i)}catch(e){}}return!0}},function(e,t,i){"use strict";var r=i(9),n=i(134),a="includes";r(r.P+r.F*i(136)(a),"String",{includes:function(e,t){return!!~n(this,e,a).indexOf(e,1<arguments.length?t:void 0)}})},function(e,t,i){var r=i(9);r(r.P,"String",{repeat:i(91)})},function(e,t,i){"use strict";var r=i(9),a=i(38),s=i(134),o="startsWith",l=""[o];r(r.P+r.F*i(136)(o),"String",{startsWith:function(e,t){var i=s(this,e,o),r=a(Math.min(1<arguments.length?t:void 0,i.length)),n=String(e);return l?l.call(i,n,r):i.slice(r,r+n.length)===n}})},function(e,t,i){"use strict";i(141)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},function(e,t,i){function r(e,t,i,r){var n=String(s(e)),a="<"+t;return""!==i&&(a+=" "+i+'="'+String(r).replace(o,"&quot;")+'"'),a+">"+n+"</"+t+">"}var n=i(9),a=i(8),s=i(36),o=/"/g;e.exports=function(t,e){var i={};i[t]=e(r),n(n.P+n.F*a(function(){var e=""[t]('"');return e!==e.toLowerCase()||3<e.split('"').length}),"String",i)}},function(e,t,i){"use strict";i(141)("big",function(e){return function(){return e(this,"big","","")}})},function(e,t,i){"use strict";i(141)("blink",function(e){return function(){return e(this,"blink","","")}})},function(e,t,i){"use strict";i(141)("bold",function(e){return function(){return e(this,"b","","")}})},function(e,t,i){"use strict";i(141)("fixed",function(e){return function(){return e(this,"tt","","")}})},function(e,t,i){"use strict";i(141)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},function(e,t,i){"use strict";i(141)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},function(e,t,i){"use strict";i(141)("italics",function(e){return function(){return e(this,"i","","")}})},function(e,t,i){"use strict";i(141)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(e,t,i){"use strict";i(141)("small",function(e){return function(){return e(this,"small","","")}})},function(e,t,i){"use strict";i(141)("strike",function(e){return function(){return e(this,"strike","","")}})},function(e,t,i){"use strict";i(141)("sub",function(e){return function(){return e(this,"sub","","")}})},function(e,t,i){"use strict";i(141)("sup",function(e){return function(){return e(this,"sup","","")}})},function(e,t,i){var r=i(9);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,i){"use strict";var r=i(9),n=i(58),a=i(17);r(r.P+r.F*i(8)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(e){var t=n(this),i=a(t);return"number"!=typeof i||isFinite(i)?t.toISOString():null}})},function(e,t,i){var r=i(9),n=i(157);r(r.P+r.F*(Date.prototype.toISOString!==n),"Date",{toISOString:n})},function(e,t,i){"use strict";function n(e){return 9<e?e:"0"+e}var r=i(8),a=Date.prototype.getTime,s=Date.prototype.toISOString;e.exports=r(function(){return"0385-07-25T07:06:39.999Z"!=s.call(new Date(-5e13-1))})||!r(function(){s.call(new Date(NaN))})?function(){if(!isFinite(a.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),i=e.getUTCMilliseconds(),r=t<0?"-":9999<t?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())+"T"+n(e.getUTCHours())+":"+n(e.getUTCMinutes())+":"+n(e.getUTCSeconds())+"."+(99<i?i:"0"+n(i))+"Z"}:s},function(e,t,i){var r=Date.prototype,n="Invalid Date",a="toString",s=r[a],o=r.getTime;new Date(NaN)+""!=n&&i(19)(r,a,function(){var e=o.call(this);return e==e?s.call(this):n})},function(e,t,i){var r=i(27)("toPrimitive"),n=Date.prototype;r in n||i(11)(n,r,i(160))},function(e,t,i){"use strict";var r=i(13),n=i(17);e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return n(r(this),"number"!=e)}},function(e,t,i){var r=i(9);r(r.S,"Array",{isArray:i(45)})},function(e,t,i){"use strict";var p=i(21),r=i(9),v=i(58),m=i(163),g=i(164),_=i(38),y=i(165),b=i(166);r(r.S+r.F*!i(167)(function(e){Array.from(e)}),"Array",{from:function(e,t,i){var r,n,a,s,o=v(e),l="function"==typeof this?this:Array,u=arguments.length,h=1<u?t:void 0,d=void 0!==h,c=0,f=b(o);if(d&&(h=p(h,2<u?i:void 0,2)),null==f||l==Array&&g(f))for(n=new l(r=_(o.length));c<r;c++)y(n,c,d?h(o[c],c):o[c]);else for(s=f.call(o),n=new l;!(a=s.next()).done;c++)y(n,c,d?m(s,h,[a.value,c],!0):a.value);return n.length=c,n}})},function(e,t,i){var a=i(13);e.exports=function(t,e,i,r){try{return r?e(a(i)[0],i[1]):e(i)}catch(e){var n=t.return;throw void 0!==n&&a(n.call(t)),e}}},function(e,t,i){var r=i(130),n=i(27)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[n]===e)}},function(e,t,i){"use strict";var r=i(12),n=i(18);e.exports=function(e,t,i){t in e?r.f(e,t,n(0,i)):e[t]=i}},function(e,t,i){var r=i(75),n=i(27)("iterator"),a=i(130);e.exports=i(10).getIteratorMethod=function(e){if(null!=e)return e[n]||e["@@iterator"]||a[r(e)]}},function(e,t,i){var a=i(27)("iterator"),s=!1;try{var r=[7][a]();r.return=function(){s=!0},Array.from(r,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!s)return!1;var i=!1;try{var r=[7],n=r[a]();n.next=function(){return{done:i=!0}},r[a]=function(){return n},e(r)}catch(e){}return i}},function(e,t,i){"use strict";var r=i(9),n=i(165);r(r.S+r.F*i(8)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,i=new("function"==typeof this?this:Array)(t);e<t;)n(i,e,arguments[e++]);return i.length=t,i}})},function(e,t,i){"use strict";var r=i(9),n=i(33),a=[].join;r(r.P+r.F*(i(34)!=Object||!i(170)(a)),"Array",{join:function(e){return a.call(n(this),void 0===e?",":e)}})},function(e,t,i){"use strict";var r=i(8);e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,i){"use strict";var r=i(9),n=i(48),u=i(35),h=i(40),d=i(38),c=[].slice;r(r.P+r.F*i(8)(function(){n&&c.call(n)}),"Array",{slice:function(e,t){var i=d(this.length),r=u(this);if(t=void 0===t?i:t,"Array"==r)return c.call(this,e,t);for(var n=h(e,i),a=h(t,i),s=d(a-n),o=new Array(s),l=0;l<s;l++)o[l]="String"==r?this.charAt(n+l):this[n+l];return o}})},function(e,t,i){"use strict";var r=i(9),n=i(22),a=i(58),s=i(8),o=[].sort,l=[1,2,3];r(r.P+r.F*(s(function(){l.sort(void 0)})||!s(function(){l.sort(null)})||!i(170)(o)),"Array",{sort:function(e){return void 0===e?o.call(a(this)):o.call(a(this),n(e))}})},function(e,t,i){"use strict";var r=i(9),n=i(174)(0),a=i(170)([].forEach,!0);r(r.P+r.F*!a,"Array",{forEach:function(e,t){return n(this,e,t)}})},function(e,t,i){var y=i(21),b=i(34),S=i(58),E=i(38),r=i(175);e.exports=function(d,e){var c=1==d,f=2==d,p=3==d,v=4==d,m=6==d,g=5==d||m,_=e||r;return function(e,t,i){for(var r,n,a=S(e),s=b(a),o=y(t,i,3),l=E(s.length),u=0,h=c?_(e,l):f?_(e,0):void 0;u<l;u++)if((g||u in s)&&(n=o(r=s[u],u,a),d))if(c)h[u]=n;else if(n)switch(d){case 3:return!0;case 5:return r;case 6:return u;case 2:h.push(r)}else if(v)return!1;return m?-1:p||v?v:h}}},function(e,t,i){var r=i(176);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,i){var r=i(14),n=i(45),a=i(27)("species");e.exports=function(e){var t;return n(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!n(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,i){"use strict";var r=i(9),n=i(174)(1);r(r.P+r.F*!i(170)([].map,!0),"Array",{map:function(e,t){return n(this,e,t)}})},function(e,t,i){"use strict";var r=i(9),n=i(174)(2);r(r.P+r.F*!i(170)([].filter,!0),"Array",{filter:function(e,t){return n(this,e,t)}})},function(e,t,i){"use strict";var r=i(9),n=i(174)(3);r(r.P+r.F*!i(170)([].some,!0),"Array",{some:function(e,t){return n(this,e,t)}})},function(e,t,i){"use strict";var r=i(9),n=i(174)(4);r(r.P+r.F*!i(170)([].every,!0),"Array",{every:function(e,t){return n(this,e,t)}})},function(e,t,i){"use strict";var r=i(9),n=i(182);r(r.P+r.F*!i(170)([].reduce,!0),"Array",{reduce:function(e,t){return n(this,e,arguments.length,t,!1)}})},function(e,t,i){var h=i(22),d=i(58),c=i(34),f=i(38);e.exports=function(e,t,i,r,n){h(t);var a=d(e),s=c(a),o=f(a.length),l=n?o-1:0,u=n?-1:1;if(i<2)for(;;){if(l in s){r=s[l],l+=u;break}if(l+=u,n?l<0:o<=l)throw TypeError("Reduce of empty array with no initial value")}for(;n?0<=l:l<o;l+=u)l in s&&(r=t(r,s[l],l,a));return r}},function(e,t,i){"use strict";var r=i(9),n=i(182);r(r.P+r.F*!i(170)([].reduceRight,!0),"Array",{reduceRight:function(e,t){return n(this,e,arguments.length,t,!0)}})},function(e,t,i){"use strict";var r=i(9),n=i(37)(!1),a=[].indexOf,s=!!a&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(s||!i(170)(a)),"Array",{indexOf:function(e,t){return s?a.apply(this,arguments)||0:n(this,e,t)}})},function(e,t,i){"use strict";var r=i(9),a=i(33),s=i(39),o=i(38),l=[].lastIndexOf,u=!!l&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!i(170)(l)),"Array",{lastIndexOf:function(e,t){if(u)return l.apply(this,arguments)||0;var i=a(this),r=o(i.length),n=r-1;for(1<arguments.length&&(n=Math.min(n,s(t))),n<0&&(n=r+n);0<=n;n--)if(n in i&&i[n]===e)return n||0;return-1}})},function(e,t,i){var r=i(9);r(r.P,"Array",{copyWithin:i(187)}),i(188)("copyWithin")},function(e,t,i){"use strict";var h=i(58),d=i(40),c=i(38);e.exports=[].copyWithin||function(e,t,i){var r=h(this),n=c(r.length),a=d(e,n),s=d(t,n),o=2<arguments.length?i:void 0,l=Math.min((void 0===o?n:d(o,n))-s,n-a),u=1;for(s<a&&a<s+l&&(u=-1,s+=l-1,a+=l-1);0<l--;)s in r?r[a]=r[s]:delete r[a],a+=u,s+=u;return r}},function(e,t,i){var r=i(27)("unscopables"),n=Array.prototype;null==n[r]&&i(11)(n,r,{}),e.exports=function(e){n[r][e]=!0}},function(e,t,i){var r=i(9);r(r.P,"Array",{fill:i(190)}),i(188)("fill")},function(e,t,i){"use strict";var u=i(58),h=i(40),d=i(38);e.exports=function(e,t,i){for(var r=u(this),n=d(r.length),a=arguments.length,s=h(1<a?t:void 0,n),o=2<a?i:void 0,l=void 0===o?n:h(o,n);s<l;)r[s++]=e;return r}},function(e,t,i){"use strict";var r=i(9),n=i(174)(5),a="find",s=!0;a in[]&&Array(1)[a](function(){s=!1}),r(r.P+r.F*s,"Array",{find:function(e,t){return n(this,e,1<arguments.length?t:void 0)}}),i(188)(a)},function(e,t,i){"use strict";var r=i(9),n=i(174)(6),a="findIndex",s=!0;a in[]&&Array(1)[a](function(){s=!1}),r(r.P+r.F*s,"Array",{findIndex:function(e,t){return n(this,e,1<arguments.length?t:void 0)}}),i(188)(a)},function(e,t,i){i(194)("Array")},function(e,t,i){"use strict";var r=i(5),n=i(12),a=i(7),s=i(27)("species");e.exports=function(e){var t=r[e];a&&t&&!t[s]&&n.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,i){"use strict";var r=i(188),n=i(196),a=i(130),s=i(33);e.exports=i(129)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,n(1)):n(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){var r=i(5),a=i(88),n=i(12).f,s=i(50).f,o=i(135),l=i(198),u=r.RegExp,h=u,d=u.prototype,c=/a/g,f=/a/g,p=new u(c)!==c;if(i(7)&&(!p||i(8)(function(){return f[i(27)("match")]=!1,u(c)!=c||u(f)==f||"/a/i"!=u(c,"i")}))){u=function(e,t){var i=this instanceof u,r=o(e),n=void 0===t;return!i&&r&&e.constructor===u&&n?e:a(p?new h(r&&!n?e.source:e,t):h((r=e instanceof u)?e.source:e,r&&n?l.call(e):t),i?this:d,u)};function v(t){t in u||n(u,t,{configurable:!0,get:function(){return h[t]},set:function(e){h[t]=e}})}for(var m=s(h),g=0;m.length>g;)v(m[g++]);(d.constructor=u).prototype=d,i(19)(r,"RegExp",u)}i(194)("RegExp")},function(e,t,i){"use strict";var r=i(13);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,i){"use strict";i(200);function r(e){i(19)(RegExp.prototype,o,e,!0)}var n=i(13),a=i(198),s=i(7),o="toString",l=/./[o];i(8)(function(){return"/a/b"!=l.call({source:"a",flags:"b"})})?r(function(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!s&&e instanceof RegExp?a.call(e):void 0)}):l.name!=o&&r(function(){return l.call(this)})},function(e,t,i){i(7)&&"g"!=/./g.flags&&i(12).f(RegExp.prototype,"flags",{configurable:!0,get:i(198)})},function(e,t,i){i(202)("match",1,function(r,n,e){return[function(e){"use strict";var t=r(this),i=null==e?void 0:e[n];return void 0!==i?i.call(e,t):new RegExp(e)[n](String(t))},e]})},function(e,t,i){"use strict";var o=i(11),l=i(19),u=i(8),h=i(36),d=i(27);e.exports=function(t,e,i){var r=d(t),n=i(h,r,""[t]),a=n[0],s=n[1];u(function(){var e={};return e[r]=function(){return 7},7!=""[t](e)})&&(l(String.prototype,t,a),o(RegExp.prototype,r,2==e?function(e,t){return s.call(e,this,t)}:function(e){return s.call(e,this)}))}},function(e,t,i){i(202)("replace",2,function(n,a,s){return[function(e,t){"use strict";var i=n(this),r=null==e?void 0:e[a];return void 0!==r?r.call(e,i,t):s.call(String(i),e,t)},s]})},function(e,t,i){i(202)("search",1,function(r,n,e){return[function(e){"use strict";var t=r(this),i=null==e?void 0:e[n];return void 0!==i?i.call(e,t):new RegExp(e)[n](String(t))},e]})},function(e,t,i){i(202)("split",2,function(n,a,s){"use strict";var f=i(135),p=s,v=[].push,e="split",m="length",g="lastIndex";if("c"=="abbc"[e](/(b)*/)[1]||4!="test"[e](/(?:)/,-1)[m]||2!="ab"[e](/(?:ab)*/)[m]||4!="."[e](/(.?)(.?)/)[m]||1<"."[e](/()()/)[m]||""[e](/.?/)[m]){var _=void 0===/()??/.exec("")[1];s=function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!f(e))return p.call(i,e,t);var r,n,a,s,o,l=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,d=void 0===t?4294967295:t>>>0,c=new RegExp(e.source,u+"g");for(_||(r=new RegExp("^"+c.source+"$(?!\\s)",u));(n=c.exec(i))&&!(h<(a=n.index+n[0][m])&&(l.push(i.slice(h,n.index)),!_&&1<n[m]&&n[0].replace(r,function(){for(o=1;o<arguments[m]-2;o++)void 0===arguments[o]&&(n[o]=void 0)}),1<n[m]&&n.index<i[m]&&v.apply(l,n.slice(1)),s=n[0][m],h=a,l[m]>=d));)c[g]===n.index&&c[g]++;return h===i[m]?!s&&c.test("")||l.push(""):l.push(i.slice(h)),l[m]>d?l.slice(0,d):l}}else"0"[e](void 0,0)[m]&&(s=function(e,t){return void 0===e&&0===t?[]:p.call(this,e,t)});return[function(e,t){var i=n(this),r=null==e?void 0:e[a];return void 0!==r?r.call(e,i,t):s.call(String(i),e,t)},s]})},function(e,t,i){"use strict";function r(){}function d(e){var t;return!(!m(e)||"function"!=typeof(t=e.then))&&t}function n(h,i){if(!h._n){h._n=!0;var r=h._c;E(function(){for(var l=h._v,u=1==h._s,e=0,t=function(e){var t,i,r,n=u?e.ok:e.fail,a=e.resolve,s=e.reject,o=e.domain;try{n?(u||(2==h._h&&N(h),h._h=1),!0===n?t=l:(o&&o.enter(),t=n(l),o&&(o.exit(),r=!0)),t===e.promise?s(C("Promise-chain cycle")):(i=d(t))?i.call(t,a,s):a(t)):s(l)}catch(e){o&&!r&&o.exit(),s(e)}};r.length>e;)t(r[e++]);h._c=[],h._n=!1,i&&!h._h&&F(h)})}}function a(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),n(t,!0))}var s,o,l,u,h=i(25),c=i(5),f=i(21),p=i(75),v=i(9),m=i(14),g=i(22),_=i(207),y=i(208),b=i(209),S=i(210).set,E=i(211)(),k=i(212),w=i(213),T=i(214),R=i(215),A="Promise",C=c.TypeError,x=c.process,I=x&&x.versions,O=I&&I.v8||"",L=c[A],D="process"==p(x),P=o=k.f,M=!!function(){try{var e=L.resolve(1),t=(e.constructor={})[i(27)("species")]=function(e){e(r,r)};return(D||"function"==typeof PromiseRejectionEvent)&&e.then(r)instanceof t&&0!==O.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),F=function(a){S.call(c,function(){var e,t,i,r=a._v,n=B(a);if(n&&(e=w(function(){D?x.emit("unhandledRejection",r,a):(t=c.onunhandledrejection)?t({promise:a,reason:r}):(i=c.console)&&i.error&&i.error("Unhandled promise rejection",r)}),a._h=D||B(a)?2:1),a._a=void 0,n&&e.e)throw e.v})},B=function(e){return 1!==e._h&&0===(e._a||e._c).length},N=function(t){S.call(c,function(){var e;D?x.emit("rejectionHandled",t):(e=c.onrejectionhandled)&&e({promise:t,reason:t._v})})},U=function(e){var i,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw C("Promise can't be resolved itself");(i=d(e))?E(function(){var t={_w:r,_d:!1};try{i.call(e,f(U,t,1),f(a,t,1))}catch(e){a.call(t,e)}}):(r._v=e,r._s=1,n(r,!1))}catch(e){a.call({_w:r,_d:!1},e)}}};M||(L=function(e){_(this,L,A,"_h"),g(e),s.call(this);try{e(f(U,this,1),f(a,this,1))}catch(e){a.call(this,e)}},(s=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(216)(L.prototype,{then:function(e,t){var i=P(b(this,L));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=D?x.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&n(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),l=function(){var e=new s;this.promise=e,this.resolve=f(U,e,1),this.reject=f(a,e,1)},k.f=P=function(e){return e===L||e===u?new l(e):o(e)}),v(v.G+v.W+v.F*!M,{Promise:L}),i(26)(L,A),i(194)(A),u=i(10)[A],v(v.S+v.F*!M,A,{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),v(v.S+v.F*(h||!M),A,{resolve:function(e){return R(h&&this===u?L:this,e)}}),v(v.S+v.F*!(M&&i(167)(function(e){L.all(e).catch(r)})),A,{all:function(e){var s=this,t=P(s),o=t.resolve,l=t.reject,i=w(function(){var r=[],n=0,a=1;y(e,!1,function(e){var t=n++,i=!1;r.push(void 0),a++,s.resolve(e).then(function(e){i||(i=!0,r[t]=e,--a||o(r))},l)}),--a||o(r)});return i.e&&l(i.v),t.promise},race:function(e){var t=this,i=P(t),r=i.reject,n=w(function(){y(e,!1,function(e){t.resolve(e).then(i.resolve,r)})});return n.e&&r(n.v),i.promise}})},function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var c=i(21),f=i(163),p=i(164),v=i(13),m=i(38),g=i(166),_={},y={};(t=e.exports=function(e,t,i,r,n){var a,s,o,l,u=n?function(){return e}:g(e),h=c(i,r,t?2:1),d=0;if("function"!=typeof u)throw TypeError(e+" is not iterable!");if(p(u)){for(a=m(e.length);d<a;d++)if((l=t?h(v(s=e[d])[0],s[1]):h(e[d]))===_||l===y)return l}else for(o=u.call(e);!(s=o.next()).done;)if((l=f(o,h,s.value,t))===_||l===y)return l}).BREAK=_,t.RETURN=y},function(e,t,i){var n=i(13),a=i(22),s=i(27)("species");e.exports=function(e,t){var i,r=n(e).constructor;return void 0===r||null==(i=n(r)[s])?t:a(i)}},function(e,t,i){function r(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}}function n(e){r.call(e.data)}var a,s,o,l=i(21),u=i(78),h=i(48),d=i(16),c=i(5),f=c.process,p=c.setImmediate,v=c.clearImmediate,m=c.MessageChannel,g=c.Dispatch,_=0,y={},b="onreadystatechange";p&&v||(p=function(e){for(var t=[],i=1;i<arguments.length;)t.push(arguments[i++]);return y[++_]=function(){u("function"==typeof e?e:Function(e),t)},a(_),_},v=function(e){delete y[e]},"process"==i(35)(f)?a=function(e){f.nextTick(l(r,e,1))}:g&&g.now?a=function(e){g.now(l(r,e,1))}:m?(o=(s=new m).port2,s.port1.onmessage=n,a=l(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(a=function(e){c.postMessage(e+"","*")},c.addEventListener("message",n,!1)):a=b in d("script")?function(e){h.appendChild(d("script"))[b]=function(){h.removeChild(this),r.call(e)}}:function(e){setTimeout(l(r,e,1),0)}),e.exports={set:p,clear:v}},function(e,t,i){var o=i(5),l=i(210).set,u=o.MutationObserver||o.WebKitMutationObserver,h=o.process,d=o.Promise,c="process"==i(35)(h);e.exports=function(){function e(){var e,t;for(c&&(e=h.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?n():r=void 0,e}}r=void 0,e&&e.enter()}var i,r,n;if(c)n=function(){h.nextTick(e)};else if(!u||o.navigator&&o.navigator.standalone)if(d&&d.resolve){var t=d.resolve(void 0);n=function(){t.then(e)}}else n=function(){l.call(o,e)};else{var a=!0,s=document.createTextNode("");new u(e).observe(s,{characterData:!0}),n=function(){s.data=a=!a}}return function(e){var t={fn:e,next:void 0};r&&(r.next=t),i||(i=t,n()),r=t}}},function(e,t,i){"use strict";var n=i(22);function r(e){var i,r;this.promise=new e(function(e,t){if(void 0!==i||void 0!==r)throw TypeError("Bad Promise constructor");i=e,r=t}),this.resolve=n(i),this.reject=n(r)}e.exports.f=function(e){return new r(e)}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,i){var r=i(5).navigator;e.exports=r&&r.userAgent||""},function(e,t,i){var r=i(13),n=i(14),a=i(212);e.exports=function(e,t){if(r(e),n(t)&&t.constructor===e)return t;var i=a.f(e);return(0,i.resolve)(t),i.promise}},function(e,t,i){var n=i(19);e.exports=function(e,t,i){for(var r in t)n(e,r,t[r],i);return e}},function(e,t,i){"use strict";var r=i(218),n=i(219);e.exports=i(220)("Map",function(t){return function(e){return t(this,0<arguments.length?e:void 0)}},{get:function(e){var t=r.getEntry(n(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(n(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,i){"use strict";function s(e,t){var i,r=p(t);if("F"!==r)return e._i[r];for(i=e._f;i;i=i.n)if(i.k==t)return i}var o=i(12).f,l=i(46),u=i(216),h=i(21),d=i(207),c=i(208),r=i(129),n=i(196),a=i(194),f=i(7),p=i(23).fastKey,v=i(219),m=f?"_s":"size";e.exports={getConstructor:function(e,a,i,r){var n=e(function(e,t){d(e,n,a,"_i"),e._t=a,e._i=l(null),e._f=void 0,e._l=void 0,e[m]=0,null!=t&&c(t,i,e[r],e)});return u(n.prototype,{clear:function(){for(var e=v(this,a),t=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete t[i.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var t=v(this,a),i=s(t,e);if(i){var r=i.n,n=i.p;delete t._i[i.i],i.r=!0,n&&(n.n=r),r&&(r.p=n),t._f==i&&(t._f=r),t._l==i&&(t._l=n),t[m]--}return!!i},forEach:function(e,t){v(this,a);for(var i,r=h(e,1<arguments.length?t:void 0,3);i=i?i.n:this._f;)for(r(i.v,i.k,this);i&&i.r;)i=i.p},has:function(e){return!!s(v(this,a),e)}}),f&&o(n.prototype,"size",{get:function(){return v(this,a)[m]}}),n},def:function(e,t,i){var r,n,a=s(e,t);return a?a.v=i:(e._l=a={i:n=p(t,!0),k:t,v:i,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[m]++,"F"!==n&&(e._i[n]=a)),e},getEntry:s,setStrong:function(e,i,t){r(e,i,function(e,t){this._t=v(e,i),this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,i=e._l;i&&i.r;)i=i.p;return e._t&&(e._l=i=i?i.n:e._t._f)?n(0,"keys"==t?i.k:"values"==t?i.v:[i.k,i.v]):(e._t=void 0,n(1))},t?"entries":"values",!t,!0),a(i)}}},function(e,t,i){var r=i(14);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,i){"use strict";var g=i(5),_=i(9),y=i(19),b=i(216),S=i(23),E=i(208),k=i(207),w=i(14),T=i(8),R=i(167),A=i(26),C=i(88);e.exports=function(r,e,t,i,n,a){function s(e){var i=h[e];y(h,e,"delete"==e?function(e){return!(a&&!w(e))&&i.call(this,0===e?0:e)}:"has"==e?function(e){return!(a&&!w(e))&&i.call(this,0===e?0:e)}:"get"==e?function(e){return a&&!w(e)?void 0:i.call(this,0===e?0:e)}:"add"==e?function(e){return i.call(this,0===e?0:e),this}:function(e,t){return i.call(this,0===e?0:e,t),this})}var o=g[r],l=o,u=n?"set":"add",h=l&&l.prototype,d={};if("function"==typeof l&&(a||h.forEach&&!T(function(){(new l).entries().next()}))){var c=new l,f=c[u](a?{}:-0,1)!=c,p=T(function(){c.has(1)}),v=R(function(e){new l(e)}),m=!a&&T(function(){for(var e=new l,t=5;t--;)e[u](t,t);return!e.has(-0)});v||(((l=e(function(e,t){k(e,l,r);var i=C(new o,e,l);return null!=t&&E(t,n,i[u],i),i})).prototype=h).constructor=l),(p||m)&&(s("delete"),s("has"),n&&s("get")),(m||f)&&s(u),a&&h.clear&&delete h.clear}else l=i.getConstructor(e,r,n,u),b(l.prototype,t),S.NEED=!0;return A(l,r),d[r]=l,_(_.G+_.W+_.F*(l!=o),d),a||i.setStrong(l,r,n),l}},function(e,t,i){"use strict";var r=i(218),n=i(219);e.exports=i(220)("Set",function(t){return function(e){return t(this,0<arguments.length?e:void 0)}},{add:function(e){return r.def(n(this,"Set"),e=0===e?0:e,e)}},r)},function(e,t,i){"use strict";function r(t){return function(e){return t(this,0<arguments.length?e:void 0)}}var a,n=i(174)(0),s=i(19),o=i(23),l=i(69),u=i(223),h=i(14),d=i(8),c=i(219),f="WeakMap",p=o.getWeak,v=Object.isExtensible,m=u.ufstore,g={},_={get:function(e){if(h(e)){var t=p(e);return!0===t?m(c(this,f)).get(e):t?t[this._i]:void 0}},set:function(e,t){return u.def(c(this,f),e,t)}},y=e.exports=i(220)(f,r,_,u,!0,!0);d(function(){return 7!=(new y).set((Object.freeze||Object)(g),7).get(g)})&&(l((a=u.getConstructor(r,f)).prototype,_),o.NEED=!0,n(["delete","has","get","set"],function(r){var e=y.prototype,n=e[r];s(e,r,function(e,t){if(!h(e)||v(e))return n.call(this,e,t);this._f||(this._f=new a);var i=this._f[r](e,t);return"set"==r?this:i})}))},function(e,t,i){"use strict";function s(e){return e._l||(e._l=new g)}function r(e,t){return p(e.a,function(e){return e[0]===t})}var o=i(216),l=i(23).getWeak,n=i(13),u=i(14),h=i(207),d=i(208),a=i(174),c=i(6),f=i(219),p=a(5),v=a(6),m=0,g=function(){this.a=[]};g.prototype={get:function(e){var t=r(this,e);if(t)return t[1]},has:function(e){return!!r(this,e)},set:function(e,t){var i=r(this,e);i?i[1]=t:this.a.push([e,t])},delete:function(t){var e=v(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},e.exports={getConstructor:function(e,i,r,n){var a=e(function(e,t){h(e,a,i,"_i"),e._t=i,e._i=m++,e._l=void 0,null!=t&&d(t,r,e[n],e)});return o(a.prototype,{delete:function(e){if(!u(e))return!1;var t=l(e);return!0===t?s(f(this,i)).delete(e):t&&c(t,this._i)&&delete t[this._i]},has:function(e){if(!u(e))return!1;var t=l(e);return!0===t?s(f(this,i)).has(e):t&&c(t,this._i)}}),a},def:function(e,t,i){var r=l(n(t),!0);return!0===r?s(e).set(t,i):r[e._i]=i,e},ufstore:s}},function(e,t,i){"use strict";var r=i(223),n=i(219),a="WeakSet";i(220)(a,function(t){return function(e){return t(this,0<arguments.length?e:void 0)}},{add:function(e){return r.def(n(this,a),e,!0)}},r,!1,!0)},function(e,t,i){"use strict";var r=i(9),n=i(226),a=i(227),u=i(13),h=i(40),d=i(38),s=i(14),o=i(5).ArrayBuffer,c=i(209),f=a.ArrayBuffer,p=a.DataView,l=n.ABV&&o.isView,v=f.prototype.slice,m=n.VIEW,g="ArrayBuffer";r(r.G+r.W+r.F*(o!==f),{ArrayBuffer:f}),r(r.S+r.F*!n.CONSTR,g,{isView:function(e){return l&&l(e)||s(e)&&m in e}}),r(r.P+r.U+r.F*i(8)(function(){return!new f(2).slice(1,void 0).byteLength}),g,{slice:function(e,t){if(void 0!==v&&void 0===t)return v.call(u(this),e);for(var i=u(this).byteLength,r=h(e,i),n=h(void 0===t?i:t,i),a=new(c(this,f))(d(n-r)),s=new p(this),o=new p(a),l=0;r<n;)o.setUint8(l++,s.getUint8(r++));return a}}),i(194)(g)},function(e,t,i){for(var r,n=i(5),a=i(11),s=i(20),o=s("typed_array"),l=s("view"),u=!(!n.ArrayBuffer||!n.DataView),h=u,d=0,c="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");d<9;)(r=n[c[d++]])?(a(r.prototype,o,!0),a(r.prototype,l,!0)):h=!1;e.exports={ABV:u,CONSTR:h,TYPED:o,VIEW:l}},function(e,t,i){"use strict";var r=i(5),n=i(7),a=i(25),s=i(226),o=i(11),l=i(216),u=i(8),h=i(207),d=i(39),c=i(38),f=i(228),p=i(50).f,v=i(12).f,m=i(190),g=i(26),_="ArrayBuffer",y="DataView",b="prototype",S="Wrong index!",E=r[_],k=r[y],w=r.Math,T=r.RangeError,R=r.Infinity,A=E,C=w.abs,x=w.pow,I=w.floor,O=w.log,L=w.LN2,D="byteLength",P="byteOffset",M=n?"_b":"buffer",F=n?"_l":D,B=n?"_o":P;function N(e,t,i){var r,n,a,s=new Array(i),o=8*i-t-1,l=(1<<o)-1,u=l>>1,h=23===t?x(2,-24)-x(2,-77):0,d=0,c=e<0||0===e&&1/e<0?1:0;for((e=C(e))!=e||e===R?(n=e!=e?1:0,r=l):(r=I(O(e)/L),e*(a=x(2,-r))<1&&(r--,a*=2),2<=(e+=1<=r+u?h/a:h*x(2,1-u))*a&&(r++,a/=2),l<=r+u?(n=0,r=l):1<=r+u?(n=(e*a-1)*x(2,t),r+=u):(n=e*x(2,u-1)*x(2,t),r=0));8<=t;s[d++]=255&n,n/=256,t-=8);for(r=r<<t|n,o+=t;0<o;s[d++]=255&r,r/=256,o-=8);return s[--d]|=128*c,s}function U(e,t,i){var r,n=8*i-t-1,a=(1<<n)-1,s=a>>1,o=n-7,l=i-1,u=e[l--],h=127&u;for(u>>=7;0<o;h=256*h+e[l],l--,o-=8);for(r=h&(1<<-o)-1,h>>=-o,o+=t;0<o;r=256*r+e[l],l--,o-=8);if(0===h)h=1-s;else{if(h===a)return r?NaN:u?-R:R;r+=x(2,t),h-=s}return(u?-1:1)*r*x(2,h-t)}function j(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function z(e){return[255&e]}function G(e){return[255&e,e>>8&255]}function V(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function H(e){return N(e,52,8)}function W(e){return N(e,23,4)}function K(e,t,i){v(e[b],t,{get:function(){return this[i]}})}function Y(e,t,i,r){var n=f(+i);if(n+t>e[F])throw T(S);var a=e[M]._b,s=n+e[B],o=a.slice(s,s+t);return r?o:o.reverse()}function q(e,t,i,r,n,a){var s=f(+i);if(s+t>e[F])throw T(S);for(var o=e[M]._b,l=s+e[B],u=r(+n),h=0;h<t;h++)o[l+h]=u[a?h:t-h-1]}if(s.ABV){if(!u(function(){E(1)})||!u(function(){new E(-1)})||u(function(){return new E,new E(1.5),new E(NaN),E.name!=_})){for(var X,Z=(E=function(e){return h(this,E),new A(f(e))})[b]=A[b],J=p(A),Q=0;J.length>Q;)(X=J[Q++])in E||o(E,X,A[X]);a||(Z.constructor=E)}var $=new k(new E(2)),ee=k[b].setInt8;$.setInt8(0,2147483648),$.setInt8(1,2147483649),!$.getInt8(0)&&$.getInt8(1)||l(k[b],{setInt8:function(e,t){ee.call(this,e,t<<24>>24)},setUint8:function(e,t){ee.call(this,e,t<<24>>24)}},!0)}else E=function(e){h(this,E,_);var t=f(e);this._b=m.call(new Array(t),0),this[F]=t},k=function(e,t,i){h(this,k,y),h(e,E,y);var r=e[F],n=d(t);if(n<0||r<n)throw T("Wrong offset!");if(r<n+(i=void 0===i?r-n:c(i)))throw T("Wrong length!");this[M]=e,this[B]=n,this[F]=i},n&&(K(E,D,"_l"),K(k,"buffer","_b"),K(k,D,"_l"),K(k,P,"_o")),l(k[b],{getInt8:function(e){return Y(this,1,e)[0]<<24>>24},getUint8:function(e){return Y(this,1,e)[0]},getInt16:function(e,t){var i=Y(this,2,e,t);return(i[1]<<8|i[0])<<16>>16},getUint16:function(e,t){var i=Y(this,2,e,t);return i[1]<<8|i[0]},getInt32:function(e,t){return j(Y(this,4,e,t))},getUint32:function(e,t){return j(Y(this,4,e,t))>>>0},getFloat32:function(e,t){return U(Y(this,4,e,t),23,4)},getFloat64:function(e,t){return U(Y(this,8,e,t),52,8)},setInt8:function(e,t){q(this,1,e,z,t)},setUint8:function(e,t){q(this,1,e,z,t)},setInt16:function(e,t,i){q(this,2,e,G,t,i)},setUint16:function(e,t,i){q(this,2,e,G,t,i)},setInt32:function(e,t,i){q(this,4,e,V,t,i)},setUint32:function(e,t,i){q(this,4,e,V,t,i)},setFloat32:function(e,t,i){q(this,4,e,W,t,i)},setFloat64:function(e,t,i){q(this,8,e,H,t,i)}});g(E,_),g(k,y),o(k[b],s.VIEW,!0),t[_]=E,t[y]=k},function(e,t,i){var r=i(39),n=i(38);e.exports=function(e){if(void 0===e)return 0;var t=r(e),i=n(t);if(t!==i)throw RangeError("Wrong length!");return i}},function(e,t,i){var r=i(9);r(r.G+r.W+r.F*!i(226).ABV,{DataView:i(227).DataView})},function(e,t,i){i(231)("Int8",1,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){"use strict";if(i(7)){var g=i(25),_=i(5),y=i(8),b=i(9),S=i(226),r=i(227),p=i(21),E=i(207),n=i(18),k=i(11),a=i(216),s=i(39),w=i(38),T=i(228),o=i(40),l=i(17),u=i(6),R=i(75),A=i(14),v=i(58),m=i(164),C=i(46),x=i(59),I=i(50).f,O=i(166),h=i(20),d=i(27),c=i(174),f=i(37),L=i(209),D=i(195),P=i(130),M=i(167),F=i(194),B=i(190),N=i(187),U=i(12),j=i(51),z=U.f,G=j.f,V=_.RangeError,H=_.TypeError,W=_.Uint8Array,K="ArrayBuffer",Y="Shared"+K,q="BYTES_PER_ELEMENT",X="prototype",Z=Array[X],J=r.ArrayBuffer,Q=r.DataView,$=c(0),ee=c(2),te=c(3),ie=c(4),re=c(5),ne=c(6),ae=f(!0),se=f(!1),oe=D.values,le=D.keys,ue=D.entries,he=Z.lastIndexOf,de=Z.reduce,ce=Z.reduceRight,fe=Z.join,pe=Z.sort,ve=Z.slice,me=Z.toString,ge=Z.toLocaleString,_e=d("iterator"),ye=d("toStringTag"),be=h("typed_constructor"),Se=h("def_constructor"),Ee=S.CONSTR,ke=S.TYPED,we=S.VIEW,Te="Wrong length!",Re=c(1,function(e,t){return Oe(L(e,e[Se]),t)}),Ae=y(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),Ce=!!W&&!!W[X].set&&y(function(){new W(1).set({})}),xe=function(e,t){var i=s(e);if(i<0||i%t)throw V("Wrong offset!");return i},Ie=function(e){if(A(e)&&ke in e)return e;throw H(e+" is not a typed array!")},Oe=function(e,t){if(!(A(e)&&be in e))throw H("It is not a typed array constructor!");return new e(t)},Le=function(e,t){return De(L(e,e[Se]),t)},De=function(e,t){for(var i=0,r=t.length,n=Oe(e,r);i<r;)n[i]=t[i++];return n},Pe=function(e,t,i){z(e,t,{get:function(){return this._d[i]}})},Me=function(e,t,i){var r,n,a,s,o,l,u=v(e),h=arguments.length,d=1<h?t:void 0,c=void 0!==d,f=O(u);if(null!=f&&!m(f)){for(l=f.call(u),a=[],r=0;!(o=l.next()).done;r++)a.push(o.value);u=a}for(c&&2<h&&(d=p(d,i,2)),r=0,n=w(u.length),s=Oe(this,n);r<n;r++)s[r]=c?d(u[r],r):u[r];return s},Fe=function(){for(var e=0,t=arguments.length,i=Oe(this,t);e<t;)i[e]=arguments[e++];return i},Be=!!W&&y(function(){ge.call(new W(1))}),Ne=function(){return ge.apply(Be?ve.call(Ie(this)):Ie(this),arguments)},Ue={copyWithin:function(e,t,i){return N.call(Ie(this),e,t,2<arguments.length?i:void 0)},every:function(e,t){return ie(Ie(this),e,1<arguments.length?t:void 0)},fill:function(e){return B.apply(Ie(this),arguments)},filter:function(e,t){return Le(this,ee(Ie(this),e,1<arguments.length?t:void 0))},find:function(e,t){return re(Ie(this),e,1<arguments.length?t:void 0)},findIndex:function(e,t){return ne(Ie(this),e,1<arguments.length?t:void 0)},forEach:function(e,t){$(Ie(this),e,1<arguments.length?t:void 0)},indexOf:function(e,t){return se(Ie(this),e,1<arguments.length?t:void 0)},includes:function(e,t){return ae(Ie(this),e,1<arguments.length?t:void 0)},join:function(e){return fe.apply(Ie(this),arguments)},lastIndexOf:function(e){return he.apply(Ie(this),arguments)},map:function(e,t){return Re(Ie(this),e,1<arguments.length?t:void 0)},reduce:function(e){return de.apply(Ie(this),arguments)},reduceRight:function(e){return ce.apply(Ie(this),arguments)},reverse:function(){for(var e,t=this,i=Ie(t).length,r=Math.floor(i/2),n=0;n<r;)e=t[n],t[n++]=t[--i],t[i]=e;return t},some:function(e,t){return te(Ie(this),e,1<arguments.length?t:void 0)},sort:function(e){return pe.call(Ie(this),e)},subarray:function(e,t){var i=Ie(this),r=i.length,n=o(e,r);return new(L(i,i[Se]))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,w((void 0===t?r:o(t,r))-n))}},je=function(e,t){return Le(this,ve.call(Ie(this),e,t))},ze=function(e,t){Ie(this);var i=xe(t,1),r=this.length,n=v(e),a=w(n.length),s=0;if(r<a+i)throw V(Te);for(;s<a;)this[i+s]=n[s++]},Ge={entries:function(){return ue.call(Ie(this))},keys:function(){return le.call(Ie(this))},values:function(){return oe.call(Ie(this))}},Ve=function(e,t){return A(e)&&e[ke]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},He=function(e,t){return Ve(e,t=l(t,!0))?n(2,e[t]):G(e,t)},We=function(e,t,i){return!(Ve(e,t=l(t,!0))&&A(i)&&u(i,"value"))||u(i,"get")||u(i,"set")||i.configurable||u(i,"writable")&&!i.writable||u(i,"enumerable")&&!i.enumerable?z(e,t,i):(e[t]=i.value,e)};Ee||(j.f=He,U.f=We),b(b.S+b.F*!Ee,"Object",{getOwnPropertyDescriptor:He,defineProperty:We}),y(function(){me.call({})})&&(me=ge=function(){return fe.call(this)});var Ke=a({},Ue);a(Ke,Ge),k(Ke,_e,Ge.values),a(Ke,{slice:je,set:ze,constructor:function(){},toString:me,toLocaleString:Ne}),Pe(Ke,"buffer","b"),Pe(Ke,"byteOffset","o"),Pe(Ke,"byteLength","l"),Pe(Ke,"length","e"),z(Ke,ye,{get:function(){return this[ke]}}),e.exports=function(e,d,t,n){function c(e,t){z(e,t,{get:function(){return function(e,t){var i=e._d;return i.v[r](t*d+i.o,Ae)}(this,t)},set:function(e){return function(e,t,i){var r=e._d;n&&(i=(i=Math.round(i))<0?0:255<i?255:255&i),r.v[a](t*d+r.o,i,Ae)}(this,t,e)},enumerable:!0})}var f=e+((n=!!n)?"Clamped":"")+"Array",r="get"+e,a="set"+e,p=_[f],s=p||{},i=p&&x(p),o=!p||!S.ABV,l={},u=p&&p[X];o?(p=t(function(e,t,i,r){E(e,p,f,"_d");var n,a,s,o,l=0,u=0;if(A(t)){if(!(t instanceof J||(o=R(t))==K||o==Y))return ke in t?De(p,t):Me.call(p,t);n=t,u=xe(i,d);var h=t.byteLength;if(void 0===r){if(h%d)throw V(Te);if((a=h-u)<0)throw V(Te)}else if(h<(a=w(r)*d)+u)throw V(Te);s=a/d}else s=T(t),n=new J(a=s*d);for(k(e,"_d",{b:n,o:u,l:a,e:s,v:new Q(n)});l<s;)c(e,l++)}),u=p[X]=C(Ke),k(u,"constructor",p)):y(function(){p(1)})&&y(function(){new p(-1)})&&M(function(e){new p,new p(null),new p(1.5),new p(e)},!0)||(p=t(function(e,t,i,r){var n;return E(e,p,f),A(t)?t instanceof J||(n=R(t))==K||n==Y?void 0!==r?new s(t,xe(i,d),r):void 0!==i?new s(t,xe(i,d)):new s(t):ke in t?De(p,t):Me.call(p,t):new s(T(t))}),$(i!==Function.prototype?I(s).concat(I(i)):I(s),function(e){e in p||k(p,e,s[e])}),p[X]=u,g||(u.constructor=p));var h=u[_e],v=!!h&&("values"==h.name||null==h.name),m=Ge.values;k(p,be,!0),k(u,ke,f),k(u,we,!0),k(u,Se,p),(n?new p(1)[ye]==f:ye in u)||z(u,ye,{get:function(){return f}}),l[f]=p,b(b.G+b.W+b.F*(p!=s),l),b(b.S,f,{BYTES_PER_ELEMENT:d}),b(b.S+b.F*y(function(){s.of.call(p,1)}),f,{from:Me,of:Fe}),q in u||k(u,q,d),b(b.P,f,Ue),F(f),b(b.P+b.F*Ce,f,{set:ze}),b(b.P+b.F*!v,f,Ge),g||u.toString==me||(u.toString=me),b(b.P+b.F*y(function(){new p(1).slice()}),f,{slice:je}),b(b.P+b.F*(y(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!y(function(){u.toLocaleString.call([1,2])})),f,{toLocaleString:Ne}),P[f]=v?h:m,g||v||k(u,_e,m)}}else e.exports=function(){}},function(e,t,i){i(231)("Uint8",1,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){i(231)("Uint8",1,function(r){return function(e,t,i){return r(this,e,t,i)}},!0)},function(e,t,i){i(231)("Int16",2,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){i(231)("Uint16",2,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){i(231)("Int32",4,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){i(231)("Uint32",4,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){i(231)("Float32",4,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){i(231)("Float64",8,function(r){return function(e,t,i){return r(this,e,t,i)}})},function(e,t,i){var r=i(9),a=i(22),s=i(13),o=(i(5).Reflect||{}).apply,l=Function.apply;r(r.S+r.F*!i(8)(function(){o(function(){})}),"Reflect",{apply:function(e,t,i){var r=a(e),n=s(i);return o?o(r,t,n):l.call(r,t,n)}})},function(e,t,i){var r=i(9),l=i(46),u=i(22),h=i(13),d=i(14),n=i(8),c=i(77),f=(i(5).Reflect||{}).construct,p=n(function(){function e(){}return!(f(function(){},[],e)instanceof e)}),v=!n(function(){f(function(){})});r(r.S+r.F*(p||v),"Reflect",{construct:function(e,t,i){u(e),h(t);var r=arguments.length<3?e:u(i);if(v&&!p)return f(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(c.apply(e,n))}var a=r.prototype,s=l(d(a)?a:Object.prototype),o=Function.apply.call(e,s,t);return d(o)?o:s}})},function(e,t,i){var r=i(12),n=i(9),a=i(13),s=i(17);n(n.S+n.F*i(8)(function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,i){a(e),t=s(t,!0),a(i);try{return r.f(e,t,i),!0}catch(e){return!1}}})},function(e,t,i){var r=i(9),n=i(51).f,a=i(13);r(r.S,"Reflect",{deleteProperty:function(e,t){var i=n(a(e),t);return!(i&&!i.configurable)&&delete e[t]}})},function(e,t,i){"use strict";function r(e){this._t=a(e),this._i=0;var t,i=this._k=[];for(t in e)i.push(t)}var n=i(9),a=i(13);i(131)(r,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),n(n.S,"Reflect",{enumerate:function(e){return new r(e)}})},function(e,t,i){var s=i(51),o=i(59),l=i(6),r=i(9),u=i(14),h=i(13);r(r.S,"Reflect",{get:function e(t,i){var r,n,a=arguments.length<3?t:arguments[2];return h(t)===a?t[i]:(r=s.f(t,i))?l(r,"value")?r.value:void 0!==r.get?r.get.call(a):void 0:u(n=o(t))?e(n,i,a):void 0}})},function(e,t,i){var r=i(51),n=i(9),a=i(13);n(n.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(a(e),t)}})},function(e,t,i){var r=i(9),n=i(59),a=i(13);r(r.S,"Reflect",{getPrototypeOf:function(e){return n(a(e))}})},function(e,t,i){var r=i(9);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,i){var r=i(9),n=i(13),a=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return n(e),!a||a(e)}})},function(e,t,i){var r=i(9);r(r.S,"Reflect",{ownKeys:i(251)})},function(e,t,i){var r=i(50),n=i(43),a=i(13),s=i(5).Reflect;e.exports=s&&s.ownKeys||function(e){var t=r.f(a(e)),i=n.f;return i?t.concat(i(e)):t}},function(e,t,i){var r=i(9),n=i(13),a=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){n(e);try{return a&&a(e),!0}catch(e){return!1}}})},function(e,t,i){var l=i(12),u=i(51),h=i(59),d=i(6),r=i(9),c=i(18),f=i(13),p=i(14);r(r.S,"Reflect",{set:function e(t,i,r){var n,a,s=arguments.length<4?t:arguments[3],o=u.f(f(t),i);if(!o){if(p(a=h(t)))return e(a,i,r,s);o=c(0)}if(d(o,"value")){if(!1===o.writable||!p(s))return!1;if(n=u.f(s,i)){if(n.get||n.set||!1===n.writable)return!1;n.value=r,l.f(s,i,n)}else l.f(s,i,c(0,r));return!0}return void 0!==o.set&&(o.set.call(s,r),!0)}})},function(e,t,i){var r=i(9),n=i(73);n&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){n.check(e,t);try{return n.set(e,t),!0}catch(e){return!1}}})},function(e,t,i){"use strict";var r=i(9),n=i(37)(!0);r(r.P,"Array",{includes:function(e,t){return n(this,e,1<arguments.length?t:void 0)}}),i(188)("includes")},function(e,t,i){"use strict";var r=i(9),a=i(257),s=i(58),o=i(38),l=i(22),u=i(175);r(r.P,"Array",{flatMap:function(e,t){var i,r,n=s(this);return l(e),i=o(n.length),r=u(n,0),a(r,n,n,i,0,1,e,t),r}}),i(188)("flatMap")},function(e,t,i){"use strict";var p=i(45),v=i(14),m=i(38),g=i(21),_=i(27)("isConcatSpreadable");e.exports=function e(t,i,r,n,a,s,o,l){for(var u,h,d=a,c=0,f=!!o&&g(o,l,3);c<n;){if(c in r){if(u=f?f(r[c],c,i):r[c],h=!1,v(u)&&(h=void 0!==(h=u[_])?!!h:p(u)),h&&0<s)d=e(t,i,u,m(u.length),d,s-1)-1;else{if(9007199254740991<=d)throw TypeError();t[d]=u}d++}c++}return d}},function(e,t,i){"use strict";var r=i(9),a=i(257),s=i(58),o=i(38),l=i(39),u=i(175);r(r.P,"Array",{flatten:function(e){var t=e,i=s(this),r=o(i.length),n=u(i,0);return a(n,i,i,r,0,void 0===t?1:l(t)),n}}),i(188)("flatten")},function(e,t,i){"use strict";var r=i(9),n=i(128)(!0);r(r.P,"String",{at:function(e){return n(this,e)}})},function(e,t,i){"use strict";var r=i(9),n=i(261),a=i(214);r(r.P+r.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padStart:function(e,t){return n(this,e,1<arguments.length?t:void 0,!0)}})},function(e,t,i){var h=i(38),d=i(91),c=i(36);e.exports=function(e,t,i,r){var n=String(c(e)),a=n.length,s=void 0===i?" ":String(i),o=h(t);if(o<=a||""==s)return n;var l=o-a,u=d.call(s,Math.ceil(l/s.length));return u.length>l&&(u=u.slice(0,l)),r?u+n:n+u}},function(e,t,i){"use strict";var r=i(9),n=i(261),a=i(214);r(r.P+r.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padEnd:function(e,t){return n(this,e,1<arguments.length?t:void 0,!1)}})},function(e,t,i){"use strict";i(83)("trimLeft",function(e){return function(){return e(this,1)}},"trimStart")},function(e,t,i){"use strict";i(83)("trimRight",function(e){return function(){return e(this,2)}},"trimEnd")},function(e,t,i){"use strict";function n(e,t){this._r=e,this._s=t}var r=i(9),a=i(36),s=i(38),o=i(135),l=i(198),u=RegExp.prototype;i(131)(n,"RegExp String",function(){var e=this._r.exec(this._s);return{value:e,done:null===e}}),r(r.P,"String",{matchAll:function(e){if(a(this),!o(e))throw TypeError(e+" is not a regexp!");var t=String(this),i="flags"in u?String(e.flags):l.call(e),r=new RegExp(e.source,~i.indexOf("g")?i:"g"+i);return r.lastIndex=s(e.lastIndex),new n(r,t)}})},function(e,t,i){i(29)("asyncIterator")},function(e,t,i){i(29)("observable")},function(e,t,i){var r=i(9),l=i(251),u=i(33),h=i(51),d=i(165);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,i,r=u(e),n=h.f,a=l(r),s={},o=0;a.length>o;)void 0!==(i=n(r,t=a[o++]))&&d(s,t,i);return s}})},function(e,t,i){var r=i(9),n=i(270)(!1);r(r.S,"Object",{values:function(e){return n(e)}})},function(e,t,i){var l=i(31),u=i(33),h=i(44).f;e.exports=function(o){return function(e){for(var t,i=u(e),r=l(i),n=r.length,a=0,s=[];a<n;)h.call(i,t=r[a++])&&s.push(o?[t,i[t]]:i[t]);return s}}},function(e,t,i){var r=i(9),n=i(270)(!0);r(r.S,"Object",{entries:function(e){return n(e)}})},function(e,t,i){"use strict";var r=i(9),n=i(58),a=i(22),s=i(12);i(7)&&r(r.P+i(273),"Object",{__defineGetter__:function(e,t){s.f(n(this),e,{get:a(t),enumerable:!0,configurable:!0})}})},function(e,t,i){"use strict";e.exports=i(25)||!i(8)(function(){var e=Math.random();__defineSetter__.call(null,e,function(){}),delete i(5)[e]})},function(e,t,i){"use strict";var r=i(9),n=i(58),a=i(22),s=i(12);i(7)&&r(r.P+i(273),"Object",{__defineSetter__:function(e,t){s.f(n(this),e,{set:a(t),enumerable:!0,configurable:!0})}})},function(e,t,i){"use strict";var r=i(9),n=i(58),a=i(17),s=i(59),o=i(51).f;i(7)&&r(r.P+i(273),"Object",{__lookupGetter__:function(e){var t,i=n(this),r=a(e,!0);do{if(t=o(i,r))return t.get}while(i=s(i))}})},function(e,t,i){"use strict";var r=i(9),n=i(58),a=i(17),s=i(59),o=i(51).f;i(7)&&r(r.P+i(273),"Object",{__lookupSetter__:function(e){var t,i=n(this),r=a(e,!0);do{if(t=o(i,r))return t.set}while(i=s(i))}})},function(e,t,i){var r=i(9);r(r.P+r.R,"Map",{toJSON:i(278)("Map")})},function(e,t,i){var r=i(75),n=i(279);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return n(this)}}},function(e,t,i){var r=i(208);e.exports=function(e,t){var i=[];return r(e,!1,i.push,i,t),i}},function(e,t,i){var r=i(9);r(r.P+r.R,"Set",{toJSON:i(278)("Set")})},function(e,t,i){i(282)("Map")},function(e,t,i){"use strict";var r=i(9);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,i){i(282)("Set")},function(e,t,i){i(282)("WeakMap")},function(e,t,i){i(282)("WeakSet")},function(e,t,i){i(287)("Map")},function(e,t,i){"use strict";var r=i(9),l=i(22),u=i(21),h=i(208);e.exports=function(e){r(r.S,e,{from:function(e,t,i){var r,n,a,s,o=t;return l(this),(r=void 0!==o)&&l(o),null==e?new this:(n=[],r?(a=0,s=u(o,i,2),h(e,!1,function(e){n.push(s(e,a++))})):h(e,!1,n.push,n),new this(n))}})}},function(e,t,i){i(287)("Set")},function(e,t,i){i(287)("WeakMap")},function(e,t,i){i(287)("WeakSet")},function(e,t,i){var r=i(9);r(r.G,{global:i(5)})},function(e,t,i){var r=i(9);r(r.S,"System",{global:i(5)})},function(e,t,i){var r=i(9),n=i(35);r(r.S,"Error",{isError:function(e){return"Error"===n(e)}})},function(e,t,i){var r=i(9);r(r.S,"Math",{clamp:function(e,t,i){return Math.min(i,Math.max(t,e))}})},function(e,t,i){var r=i(9);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(e,t,i){var r=i(9),n=180/Math.PI;r(r.S,"Math",{degrees:function(e){return e*n}})},function(e,t,i){var r=i(9),a=i(298),s=i(114);r(r.S,"Math",{fscale:function(e,t,i,r,n){return s(a(e,t,i,r,n))}})},function(e,t){e.exports=Math.scale||function(e,t,i,r,n){return 0===arguments.length||e!=e||t!=t||i!=i||r!=r||n!=n?NaN:e===1/0||e===-1/0?e:(e-t)*(n-r)/(i-t)+r}},function(e,t,i){var r=i(9);r(r.S,"Math",{iaddh:function(e,t,i,r){var n=e>>>0,a=i>>>0;return(t>>>0)+(r>>>0)+((n&a|(n|a)&~(n+a>>>0))>>>31)|0}})},function(e,t,i){var r=i(9);r(r.S,"Math",{isubh:function(e,t,i,r){var n=e>>>0,a=i>>>0;return(t>>>0)-(r>>>0)-((~n&a|~(n^a)&n-a>>>0)>>>31)|0}})},function(e,t,i){var r=i(9);r(r.S,"Math",{imulh:function(e,t){var i=+e,r=+t,n=65535&i,a=65535&r,s=i>>16,o=r>>16,l=(s*a>>>0)+(n*a>>>16);return s*o+(l>>16)+((n*o>>>0)+(65535&l)>>16)}})},function(e,t,i){var r=i(9);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(e,t,i){var r=i(9),n=Math.PI/180;r(r.S,"Math",{radians:function(e){return e*n}})},function(e,t,i){var r=i(9);r(r.S,"Math",{scale:i(298)})},function(e,t,i){var r=i(9);r(r.S,"Math",{umulh:function(e,t){var i=+e,r=+t,n=65535&i,a=65535&r,s=i>>>16,o=r>>>16,l=(s*a>>>0)+(n*a>>>16);return s*o+(l>>>16)+((n*o>>>0)+(65535&l)>>>16)}})},function(e,t,i){var r=i(9);r(r.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:0<e}})},function(e,t,i){"use strict";var r=i(9),n=i(10),a=i(5),s=i(209),o=i(215);r(r.P+r.R,"Promise",{finally:function(t){var i=s(this,n.Promise||a.Promise),e="function"==typeof t;return this.then(e?function(e){return o(i,t()).then(function(){return e})}:t,e?function(e){return o(i,t()).then(function(){throw e})}:t)}})},function(e,t,i){"use strict";var r=i(9),n=i(212),a=i(213);r(r.S,"Promise",{try:function(e){var t=n.f(this),i=a(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},function(e,t,i){var r=i(310),n=i(13),a=r.key,s=r.set;r.exp({defineMetadata:function(e,t,i,r){s(e,t,n(i),a(r))}})},function(e,t,i){function n(e,t,i){var r=o.get(e);if(!r){if(!i)return;o.set(e,r=new a)}var n=r.get(t);if(!n){if(!i)return;r.set(t,n=new a)}return n}var a=i(217),r=i(9),s=i(24)("metadata"),o=s.store||(s.store=new(i(222)));e.exports={store:o,map:n,has:function(e,t,i){var r=n(t,i,!1);return void 0!==r&&r.has(e)},get:function(e,t,i){var r=n(t,i,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,i,r){n(i,r,!0).set(e,t)},keys:function(e,t){var i=n(e,t,!1),r=[];return i&&i.forEach(function(e,t){r.push(t)}),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){r(r.S,"Reflect",e)}}},function(e,t,i){var r=i(310),s=i(13),o=r.key,l=r.map,u=r.store;r.exp({deleteMetadata:function(e,t,i){var r=arguments.length<3?void 0:o(i),n=l(s(t),r,!1);if(void 0===n||!n.delete(e))return!1;if(n.size)return!0;var a=u.get(t);return a.delete(r),!!a.size||u.delete(t)}})},function(e,t,i){var r=i(310),n=i(13),a=i(59),s=r.has,o=r.get,l=r.key,u=function(e,t,i){if(s(e,t,i))return o(e,t,i);var r=a(t);return null!==r?u(e,r,i):void 0};r.exp({getMetadata:function(e,t,i){return u(e,n(t),arguments.length<3?void 0:l(i))}})},function(e,t,i){var a=i(221),s=i(279),r=i(310),n=i(13),o=i(59),l=r.keys,u=r.key,h=function(e,t){var i=l(e,t),r=o(e);if(null===r)return i;var n=h(r,t);return n.length?i.length?s(new a(i.concat(n))):n:i};r.exp({getMetadataKeys:function(e,t){return h(n(e),arguments.length<2?void 0:u(t))}})},function(e,t,i){var r=i(310),n=i(13),a=r.get,s=r.key;r.exp({getOwnMetadata:function(e,t,i){return a(e,n(t),arguments.length<3?void 0:s(i))}})},function(e,t,i){var r=i(310),n=i(13),a=r.keys,s=r.key;r.exp({getOwnMetadataKeys:function(e,t){return a(n(e),arguments.length<2?void 0:s(t))}})},function(e,t,i){var r=i(310),n=i(13),a=i(59),s=r.has,o=r.key,l=function(e,t,i){if(s(e,t,i))return!0;var r=a(t);return null!==r&&l(e,r,i)};r.exp({hasMetadata:function(e,t,i){return l(e,n(t),arguments.length<3?void 0:o(i))}})},function(e,t,i){var r=i(310),n=i(13),a=r.has,s=r.key;r.exp({hasOwnMetadata:function(e,t,i){return a(e,n(t),arguments.length<3?void 0:s(i))}})},function(e,t,i){var r=i(310),n=i(13),a=i(22),s=r.key,o=r.set;r.exp({metadata:function(i,r){return function(e,t){o(i,r,(void 0!==t?n:a)(e),s(t))}}})},function(e,t,i){var r=i(9),n=i(211)(),a=i(5).process,s="process"==i(35)(a);r(r.G,{asap:function(e){var t=s&&a.domain;n(t?t.bind(e):e)}})},function(e,t,i){"use strict";function n(e){return null==e?void 0:f(e)}function a(e){var t=e._c;t&&(e._c=void 0,t())}function s(e){return void 0===e._o}function o(e){s(e)||(e._o=void 0,a(e))}function r(t,e){p(t),this._c=void 0,this._o=t,t=new b(this);try{var i=e(t),r=i;null!=i&&("function"==typeof i.unsubscribe?i=function(){r.unsubscribe()}:f(i),this._c=i)}catch(e){return void t.error(e)}s(this)&&a(this)}var l=i(9),u=i(5),h=i(10),d=i(211)(),c=i(27)("observable"),f=i(22),p=i(13),v=i(207),m=i(216),g=i(11),_=i(208),y=_.RETURN;r.prototype=m({},{unsubscribe:function(){o(this)}});var b=function(e){this._s=e};b.prototype=m({},{next:function(e){var t=this._s;if(!s(t)){var i=t._o;try{var r=n(i.next);if(r)return r.call(i,e)}catch(e){try{o(t)}finally{throw e}}}},error:function(e){var t=this._s;if(s(t))throw e;var i=t._o;t._o=void 0;try{var r=n(i.error);if(!r)throw e;e=r.call(i,e)}catch(e){try{a(t)}finally{throw e}}return a(t),e},complete:function(e){var t=this._s;if(!s(t)){var i=t._o;t._o=void 0;try{var r=n(i.complete);e=r?r.call(i,e):void 0}catch(e){try{a(t)}finally{throw e}}return a(t),e}}});var S=function(e){v(this,S,"Observable","_f")._f=f(e)};m(S.prototype,{subscribe:function(e){return new r(e,this._f)},forEach:function(r){var n=this;return new(h.Promise||u.Promise)(function(e,t){f(r);var i=n.subscribe({next:function(e){try{return r(e)}catch(e){t(e),i.unsubscribe()}},error:t,complete:e})})}}),m(S,{from:function(e){var t="function"==typeof this?this:S,i=n(p(e)[c]);if(i){var r=p(i.call(e));return r.constructor===t?r:new t(function(e){return r.subscribe(e)})}return new t(function(t){var i=!1;return d(function(){if(!i){try{if(_(e,!1,function(e){if(t.next(e),i)return y})===y)return}catch(e){if(i)throw e;return void t.error(e)}t.complete()}}),function(){i=!0}})},of:function(){for(var e=0,t=arguments.length,r=new Array(t);e<t;)r[e]=arguments[e++];return new("function"==typeof this?this:S)(function(t){var i=!1;return d(function(){if(!i){for(var e=0;e<r.length;++e)if(t.next(r[e]),i)return;t.complete()}}),function(){i=!0}})}}),g(S.prototype,c,function(){return this}),l(l.G,{Observable:S}),i(194)("Observable")},function(e,t,i){function r(n){return function(e,t){var i=2<arguments.length,r=i&&o.call(arguments,2);return n(i?function(){("function"==typeof e?e:Function(e)).apply(this,r)}:e,t)}}var n=i(5),a=i(9),s=i(214),o=[].slice,l=/MSIE .\./.test(s);a(a.G+a.B+a.F*l,{setTimeout:r(n.setTimeout),setInterval:r(n.setInterval)})},function(e,t,i){var r=i(9),n=i(210);r(r.G+r.B,{setImmediate:n.set,clearImmediate:n.clear})},function(e,t,i){for(var r=i(195),n=i(31),a=i(19),s=i(5),o=i(11),l=i(130),u=i(27),h=u("iterator"),d=u("toStringTag"),c=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=n(f),v=0;v<p.length;v++){var m,g=p[v],_=f[g],y=s[g],b=y&&y.prototype;if(b&&(b[h]||o(b,h,c),b[d]||o(b,d,g),l[g]=c,_))for(m in r)b[m]||a(b,m,r[m],!0)}},function(L,e){!function(e){"use strict";var l,t=Object.prototype,u=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag",s="object"==typeof L,o=e.regeneratorRuntime;if(o)s&&(L.exports=o);else{(o=e.regeneratorRuntime=s?L.exports:{}).wrap=y;var h="suspendedStart",d="suspendedYield",c="executing",f="completed",p={},v={};v[n]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(I([])));g&&g!==t&&u.call(g,n)&&(v=g);var _=k.prototype=S.prototype=Object.create(v);E.prototype=_.constructor=k,k.constructor=E,k[a]=E.displayName="GeneratorFunction",o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(_),e},o.awrap=function(e){return{__await:e}},w(T.prototype),T.prototype[r]=function(){return this},o.AsyncIterator=T,o.async=function(e,t,i,r){var n=new T(y(e,t,i,r));return o.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},w(_),_[a]="Generator",_[n]=function(){return this},_.toString=function(){return"[object Generator]"},o.keys=function(i){var r=[];for(var e in i)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in i)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=I,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var r=this;function e(e,t){return a.type="throw",a.arg=i,r.next=e,t&&(r.method="next",r.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t],a=n.completion;if("root"===n.tryLoc)return e("end");if(n.tryLoc<=this.prev){var s=u.call(n,"catchLoc"),o=u.call(n,"finallyLoc");if(s&&o){if(this.prev<n.catchLoc)return e(n.catchLoc,!0);if(this.prev<n.finallyLoc)return e(n.finallyLoc)}else if(s){if(this.prev<n.catchLoc)return e(n.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return e(n.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;0<=i;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&u.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var a=n?n.completion:{};return a.type=e,a.arg=t,n?(this.method="next",this.next=n.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),p}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;C(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:I(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=l),p}}}function y(e,t,i,r){var n=t&&t.prototype instanceof S?t:S,a=Object.create(n.prototype),s=new x(r||[]);return a._invoke=function(a,s,o){var l=h;return function(e,t){if(l===c)throw new Error("Generator is already running");if(l===f){if("throw"===e)throw t;return O()}for(o.method=e,o.arg=t;;){var i=o.delegate;if(i){var r=R(i,o);if(r){if(r===p)continue;return r}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(l===h)throw l=f,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);l=c;var n=b(a,s,o);if("normal"===n.type){if(l=o.done?f:d,n.arg===p)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(l=f,o.method="throw",o.arg=n.arg)}}}(e,i,s),a}function b(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function S(){}function E(){}function k(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(l){var t;this._invoke=function(i,r){function e(){return new Promise(function(e,t){!function t(e,i,r,n){var a=b(l[e],l,i);if("throw"!==a.type){var s=a.arg,o=s.value;return o&&"object"==typeof o&&u.call(o,"__await")?Promise.resolve(o.__await).then(function(e){t("next",e,r,n)},function(e){t("throw",e,r,n)}):Promise.resolve(o).then(function(e){s.value=e,r(s)},n)}n(a.arg)}(i,r,e,t)})}return t=t?t.then(e,e):e()}}function R(e,t){var i=e.iterator[t.method];if(i===l){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=l,R(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=b(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var n=r.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=l),t.delegate=null,p):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function I(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(u.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=l,e.done=!0,e};return r.next=r}}return{next:O}}function O(){return{value:l,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,i){i(326),e.exports=i(10).RegExp.escape},function(e,t,i){var r=i(9),n=i(327)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(e){return n(e)}})},function(e,t){e.exports=function(t,i){var r=i===Object(i)?function(e){return i[e]}:i;return function(e){return String(e).replace(t,r)}}},function(e,t,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=i(329),l=i(330),a=i(331),o=k(i(332)),u=k(i(333)),h=k(i(334)),d=k(i(335)),c=k(i(336)),f=k(i(338)),v=k(i(339)),m=k(i(340)),g=k(i(343)),_=k(i(391)),y=k(i(397)),b=(k(i(399)),k(i(400))),S=k(i(401)),E=i(382);function k(e){return e&&e.__esModule?e:{default:e}}i(402);var w="ws://127.0.0.1:9122",T=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(R,l.EventUtil.aggregation(o.default,u.default,h.default,d.default,c.default,f.default,b.default,v.default)),r(R,null,[{key:"setDefWsurl",value:function(e){R._defWsurl=e||w}},{key:"isSupported",value:function(){return S.default.getFeatureList()}},{key:"playerversion",value:function(){return"1.2.0"}},{key:"setupversion",value:function(e,t){return R._extendClass||(R._extendClass=new b.default(t||R._defWsurl)),R._extendClass&&R._extendClass.setupversion(e)}},{key:"getMacString",value:function(e,t){return R._extendClass||(R._extendClass=new b.default(t||R._defWsurl)),R._extendClass&&R._extendClass.getMacString(e)}},{key:"getCpuMemory",value:function(e,t){return R._extendClass||(R._extendClass=new b.default(t||R._defWsurl)),R._extendClass&&R._extendClass.getCpuMemory(e)}},{key:"getExpandScreenInfo",value:function(e,t){return R._extendClass||(R._extendClass=new b.default(t||R._defWsurl)),R._extendClass&&R._extendClass.getExpandScreenInfo(e)}},{key:"getRegistryInfo",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.getRegistryInfo(e,t)}},{key:"runProcess",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.runProcess(e,t)}},{key:"openFileDirectory",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.openFileDirectory(e,t)}},{key:"moveProcessWindow",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.moveProcessWindow(e,t)}},{key:"savePicture",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.savePicture(e,t)}},{key:"copyToClipboard",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.copyToClipboard(e,t)}},{key:"isFileExist",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.isFileExist(e,t)}},{key:"removeFile",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.removeFile(e,t)}},{key:"openSaveFileDlg",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.openSaveFileDlg(e,t)}},{key:"openLocalSelectFolderDlg",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.openLocalSelectFolderDlg(e,t)}},{key:"isUpdateSetup",value:function(e,t,i){return R._extendClass||(R._extendClass=new b.default(i||R._defWsurl)),R._extendClass&&R._extendClass.isUpdateSetup(e,t)}}]),r(R,[{key:"setH5msInfo",value:function(e){return(!this._h5msClient||this._h5msClient.status!=E.HttpStatus.kConnecting&&this._h5msClient.status!=E.HttpStatus.kSuccess)&&e&&"string"==typeof e&&"string"==typeof e.h5msUrl?(this.opt.h5msUrl="string"==typeof e?e:e.h5msUrl,this._h5msClient=this._initH5msClient(e,!0),!0):(this._showDebuggInfo("H5MS URL has exist!"),!1)}},{key:"_getH5msClient",value:function(e){for(var t=this._h5msClientList,i=0,r=t.length;i<r;i++)if(t[i].url===h5msUrl)return t[i];var n=this._initH5msClient(e);return this._h5msClientList.push(n),n}},{key:"_initH5msClient",value:function(e,t){var i={};if("string"==typeof e?i.h5msUrl=e:i=e,"string"!=typeof i.h5msUrl)return null;var r=new E.HttpRequest({h5msUrl:this.opt.h5msUrl,h5msUser:this.opt.h5msUser||"admin",h5msPassward:this.opt.h5msPassward||"admin"});return t&&(r.onError=this._onH5msError.bind(this),r.onInit=this._onH5msInit.bind(this)),r.init(),r}},{key:"_onH5msError",value:function(e,t){e==E.HttpEvents.OnInitFail?(this._reconnectCount++,this._reconnectCount>this.opt.reconnectCount?this._h5msClient=null:this._h5msClient.init()):E.HttpEvents.OnKeepAliveFail,this._emitter.emit(_.default.OnH5msError,e)}},{key:"_onH5msInit",value:function(e){this._reconnectCount=0,this._emitter.emit(_.default.OnH5msInit,e)}},{key:"_videoContainerResize",value:function(){if(!this._isFullScreen){var e=this.playerC,t=this.opt.width,i=this.opt.height;if(this.opt.width=e.offsetWidth+"px",this.opt.height=e.offsetHeight+"px",t!==this.opt.width||i!==this.opt.height){this.styleArr=this._getAllVideoStyleByLayout();for(var r=0,n=this.layoutcount;r<n;r++){var a=this._getVideoStyleByLayout(r);if(!a)return;this.maxScreenIndex===r?this.videos[r].setPosition(0,0,this.opt.width,this.opt.height):this.videos[r].setPosition(a.top,a.left,a.width,a.height)}this._historyTimeAxisSizeChange(),this._emitter.emit(_.default.OnSizeChange,t,i,this.opt.width,this.opt.height)}}}},{key:"_windowResizeEvent",value:function(){var t=this;window.addEventListener("resize",function(){var e=p.Toolkit.getBrowserZoomRatio();t.WinScreenWidth=window.screen.width/(e/100),t.WinScreenHeight=window.screen.height/(e/100)})}},{key:"destroy",value:function(){this._httpctrl&&(this._httpctrl.destroy(),this._httpctrl=null),this._websocketctrl&&(this._websocketctrl.destroy(),this._websocketctrl=null);for(var e=0;e<this.videos.length;e++)this.videos[e].destroy();this._h5msClient&&(this._h5msClient.destroy(),this._h5msClient=null)}},{key:"_showDebuggInfo",value:function(e){this._showDebugInfo&&console.warn(e)}},{key:"_parselayout",value:function(e){if("0"===e.layout||""===e.layout||"null"===e.layout)return e.layout="0",e.row=0,!(e.column=0);var t=e.layout.split("*");if(2===t.length){if(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),0<t[0]&&0<t[1]&&t[0]*t[1]<=64)return e.row=t[0],e.column=t[1],!0;if(0===t[0]||0===t[1])return e.layout="0",e.row=0,!(e.column=0)}return!1}},{key:"_initDom",value:function(){this._createPlayerC(),this.opt.width=(this.opt.ele.offsetWidth||this.opt.videoSize.width)+"px",this.opt.height=(this.opt.ele.offsetHeight||this.opt.videoSize.height)+"px","string"==typeof this.opt.layout&&(this.opt.layout={layout:this.opt.layout}),this._parselayout(this.opt.layout)||(this.opt.layout={layout:"2*2",row:2,column:2}),this.opt.layoutmargin=this._getLayoutmargin(this.opt.layoutmargin),null===this.opt.layoutmargin&&(this.opt.layoutmargin={marginX:0,marginY:0}),this.styleArr=this._getAllVideoStyleByLayout(),0<this.layoutcount&&this._createVideoEle()}},{key:"_createPlayerC",value:function(){this.playerC=document.createElement("div"),this.playerC.className="h5vp-content h5vp-content-style",this.opt.border&&this.opt.border.borderColor&&(this.playerC.style.background=this.opt.border.borderColor),this.opt.ele.appendChild(this.playerC)}},{key:"_createVideoEle",value:function(){this.videos=[];var e={};p.Toolkit.deepMerge(e,this.opt);var t=e.ele,i={};p.Toolkit.deepMerge(i,e),delete i.ele;for(var r=0,n=this.layoutcount;r<n;r++){var a=p.Toolkit.getUuid(),s=this._getVideoStyleByLayout(r);if(!s)return;var o=new m.default(p.Toolkit.deepMerge(i,{ele:"npvideo-"+a,uuid:a,index:r,fatherEle:t,playerC:this.playerC,width:s.width,height:s.height,left:s.left,top:s.top}));this.listenAndEmitEvent(o),this.videos.push(o)}this._setFocusIndex(this.nFocusIndex)}},{key:"_getLayoutWindows",value:function(e,t,i,r){var n=e%i,a=i-n,s=t%r,o=r-s;return{cw1:Math.ceil(e/i),cw1_c:n,cw2:Math.floor(e/i),cw2_c:a,ch1:Math.ceil(t/r),ch1_c:s,ch2:Math.floor(t/r),ch2_c:o}}},{key:"_get1ANlayoutArr",value:function(e,t,i,r){var n=[],a=this.opt.layoutmargin.marginX,s=this.opt.layoutmargin.marginY,o=this._getLayoutWindows(e-a*(i-1),t-s*(r-1),i,r),l=void 0,u=void 0,h=0,d=0;n.push([e-o.cw2-a,t-o.ch2-s,0,0]);for(var c=0;c<r;c++){u=c<o.ch1_c?o.ch1:o.ch2;for(var f=h=0;f<i;f++)l=f<o.cw1_c?o.cw1:o.cw2,f!==i-1&&c!==r-1||n.push([l,u,h,d]),h+=l+a;d+=u+s}return n}},{key:"_getAllVideoStyleByLayout",value:function(){var e=this._isFullScreen?this.WinScreenHeight:parseFloat(this.opt.height),t=this._isFullScreen?this.WinScreenWidth:parseFloat(this.opt.width),i=[],r=this.opt.layout;switch(r.layout){case"0":this.layoutcount=0;break;case"1A5":i=this._get1ANlayoutArr(t,e,3,3),this.layoutcount=6;break;case"1A7":i=this._get1ANlayoutArr(t,e,4,4),this.layoutcount=8;break;case"1A9":i=this._get1ANlayoutArr(t,e,5,5),this.layoutcount=10;break;default:for(var n=r.row,a=r.column,s=this.opt.layoutmargin.marginX,o=this.opt.layoutmargin.marginY,l=this._getLayoutWindows(t-s*(a-1),e-o*(n-1),a,n),u=void 0,h=void 0,d=0,c=0,f=0;f<n;f++){h=f<l.ch1_c?l.ch1:l.ch2;for(var p=d=0;p<a;p++)u=p<l.cw1_c?l.cw1:l.cw2,i.push([u,h,d,c]),d+=u+s;c+=h+o}this.layoutcount=a*n}return i||[]}},{key:"_getVideoStyleByLayout",value:function(e){if(e>=this.layoutcount)return console.log("窗口索引大于窗口总数"),null;var t=this.styleArr[e];return{width:t[0]+"px",height:t[1]+"px",left:t[2]+"px",top:t[3]+"px"}}},{key:"_initEvent",value:function(){this.screenChangeEvent(),this._addEvent()}},{key:"_onWsComplete",value:function(){this._websocketctrl=null}},{key:"_onWsError",value:function(e,t){this._websocketctrl=null,this._onerror&&this._onerror(-1,e,t)}},{key:"_onWsCmdResponse",value:function(e){this._onresponse&&this._onresponse(-1,e.name,e.param,e.rederved)}},{key:"_createWebsocketctrl",value:function(e){return!!y.default.isSupported()&&(this._websocketctrl&&(this._websocketctrl.destroy(),this._websocketctrl=null),e=e||this.opt.wsurl,this._websocketctrl=new y.default(e),this._websocketctrl.onComplete=this._onWsComplete.bind(this),this._websocketctrl.onError=this._onWsError.bind(this),this._websocketctrl.onCommand=this._onWsCmdResponse.bind(this),this._websocketctrl.open())}},{key:"startTalkback",value:function(e,t){this._websocketctrl||this._createWebsocketctrl(e.wsurl),this._websocketctrl?this._websocketctrl.startTalkback(e,t):t&&t({error:-1,msg:"createWebsocketctrl error"})}},{key:"stopTalkback",value:function(e,t){this._websocketctrl||this._createWebsocketctrl(e.wsurl),this._websocketctrl?this._websocketctrl.stopTalkback(e,t):t&&t({error:-1,msg:"createWebsocketctrl error"})}},{key:"getTalkbackMode",value:function(e,t){this._websocketctrl||this._createWebsocketctrl(e.wsurl),this._websocketctrl?this._websocketctrl.getTalkbackMode(e,t):t&&t({error:-1,msg:"createWebsocketctrl error"})}},{key:"listObject",value:function(e,t){return this.opt.desEncodeType&&void 0===e.desencode&&(e.desencode=1),this._h5msClient?this._h5msClient.listObject(e,t):(this._websocketctrl||this._createWebsocketctrl(e.wsurl),!!this._websocketctrl&&this._websocketctrl.listObject(e,t))}},{key:"queryRecord",value:function(e,t){return this.opt.desEncodeType&&void 0===e.desencode&&(e.desencode=1),this._h5msClient?this._h5msClient.queryRecord(e,t):(this._websocketctrl||this._createWebsocketctrl(e.wsurl),!!this._websocketctrl&&this._websocketctrl.queryRecord(e,t))}},{key:"startServerRecord",value:function(e,t){return this._websocketctrl||this._createWebsocketctrl(e.wsurl),!!this._websocketctrl&&this._websocketctrl.startServerRecord(e,t)}},{key:"stopServerRecord",value:function(e,t){return this._websocketctrl||this._createWebsocketctrl(e.wsurl),!!this._websocketctrl&&this._websocketctrl.stopServerRecord(e,t)}},{key:"play",value:function(e,t,i){(parseInt(this.opt.width)<=0||parseInt(this.opt.height)<=0)&&this._videoContainerResize();var r=parseInt(e);if(!t||r<0||r>=this.videos.length||!this.videos[r])return this._showDebuggInfo("play() param error!"),!1;this.opt.desEncodeType&&void 0===t.desencode&&(t.desencode=1);var n=t.wsurl||this.opt.wsurl;console.log("h5vp:",t);var a=this._h5msClient;return t.h5ms&&"string"==typeof t.h5ms.h5msUrl&&(a=this._getH5msClient(t.h5ms)),this.videos[r].startVideo(t,i,n,a)}},{key:"pause",value:function(e,t){var i=parseInt(e);return i<0||i>=this.videos.length||!this.videos[i]||"boolean"!=typeof t?(this._showDebuggInfo("pause() param error!"),!1):t?this.videos[i].pause():this.videos[i].play()}},{key:"stepPlay",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("stepPlay() param error!"),!1):this.videos[t].singleFramePlay()}},{key:"segmentPlay",value:function(e,t,i,r){var n=parseInt(e);return n<0||n>=this.videos.length||!this.videos[n]?(this._showDebuggInfo("segmentPlay() param error!"),!1):this.videos[n].segmentPlay(t,i,r)}},{key:"cancelSegmentPlay",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("cancelSegmentPlay() param error!"),!1):this.videos[t].segmentPlay(-1,-1)}},{key:"getPlayTime",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("getPlayTime() param error!"),0):this.videos[t].getPlayTime()}},{key:"getPlayPts",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("getPlayPts() param error!"),0):this.videos[t].getPlayPts()}},{key:"stop",value:function(e){var t=parseInt(e);return!(t<0||t>=this.videos.length||!this.videos[t])&&this.videos[t].stopVideo()}},{key:"capturePicture",value:function(e,t,i,r){var n=parseInt(e);return n<0||n>=this.videos.length||!this.videos[n]?(this._showDebuggInfo("capturePicture() param error!"),""):this.videos[n].capturePicture(t,i,r)}},{key:"continuousShooting",value:function(e,t,i,r,n,a){var s=parseInt(e),o=parseInt(i);return o<=0||s<0||s>=this.videos.length||!this.videos[s]||"function"!=typeof r?(this._showDebuggInfo("continuousShooting() param error!"),!1):this.videos[s].continuousShooting(t,o,r,n,a)}},{key:"setFilter",value:function(e,t){var i=parseInt(e);if(i<0||i>=this.videos.length||!this.videos[i])return this._showDebuggInfo("setFilter() param error!"),"";this.videos[i].setFilter(t)}},{key:"getFilter",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("getFilter() param error!"),""):this.videos[t].getFilter()}},{key:"_getLayoutmargin",value:function(e){var t=null;if("number"==typeof e||"string"==typeof e){var i=parseInt(t);t={marginX:i=0<=i?i:0,marginY:i}}else if(null==e)t={marginX:0,marginY:0};else if("object"===(void 0===e?"undefined":s(e))){if(e.margin){var r=parseInt(e.margin);t={marginX:r=0<=r?r:0,marginY:r}}if(e.marginX){var n=parseInt(e.marginX);t={marginX:n=0<=n?n:0,marginY:this.layoutmargin.marginY}}if(e.marginY){var a=parseInt(e.marginY);a=0<=a?a:0,t={marginX:this.layoutmargin.marginX,marginY:a}}}return t}},{key:"_setLayoutmargin",value:function(e){this.opt.layoutmargin=e,this.styleArr=this._getAllVideoStyleByLayout();for(var t=0,i=this.layoutcount;t<i;t++){var r=this._getVideoStyleByLayout(t);if(!r)return;this.maxScreenIndex===t?this.videos[t].setPosition(0,0,this.opt.width,this.opt.height):this.videos[t].setPosition(r.top,r.left,r.width,r.height)}}},{key:"_setLayout",value:function(e){var t=this.layoutcount;if(this.opt.layout,this.opt.layout=e,this.styleArr=this._getAllVideoStyleByLayout(),this.layoutcount<t){for(var i=t-1;-1<i;i--)if(i>this.layoutcount-1){var r=this.videos[i].vOpt.videoC;r.parentNode.removeChild(r),this.videos[i].destroy(),this.videos.splice(i,1)}else{var n=this._getVideoStyleByLayout(i);this.videos[i].setPosition(n.top,n.left,n.width,n.height),this.videos[i].setMax("origin"),this.maxScreenIndex=-1}this.nFocusIndex>=this.layoutcount&&this._setFocusIndex(0),this._emitter.emit(_.default.OnLayoutChange,t,this.layoutcount)}else if(this.layoutcount>t){var a={};p.Toolkit.deepMerge(a,this.opt);var s=a.ele,o={};p.Toolkit.deepMerge(o,a),delete o.ele;for(var l=0;l<this.layoutcount;l++){var u=this._getVideoStyleByLayout(l);if(!u)return void console.warn("should not be here!");if(t<=l){var h=p.Toolkit.getUuid(),d=new m.default(p.Toolkit.deepMerge(o,{ele:"npvideo-"+h,uuid:h,index:l,fatherEle:s,playerC:this.playerC,width:u.width,height:u.height,left:u.left,top:u.top}));this.listenAndEmitEvent(d),this.videos.push(d)}else this.videos[l].setPosition(u.top,u.left,u.width,u.height),this.videos[l].setMax("origin"),this.maxScreenIndex=-1}this._emitter.emit(_.default.OnLayoutChange,t,this.layoutcount)}else for(var c=0;c<this.layoutcount;c++){var f=this._getVideoStyleByLayout(c);if(!f)return void console.warn("should not be here!");this.videos[c].setPosition(f.top,f.left,f.width,f.height),this.videos[c].setMax("origin"),this.maxScreenIndex=-1}}},{key:"moveLayoutWindow",value:function(e){var t=0;t="object"===(void 0===e?"undefined":s(e))?parseInt(e.step):parseInt(e);var i=this.videos?this.videos.length:0;if(0===t||0===i)return!0;if(t<=0-i||i<=t)return!1;if(0<t)for(;0<t--;)this.videos.push(this.videos.shift());else for(;t++<0;)this.videos.unshift(this.videos.pop());this._setLayout(this.opt.layout);for(var r=0;r<i;r++)this.videos[r].setAttributeIndex(r);return!0}},{key:"_setFocusIndex",value:function(e){for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setFocusIndex(t===e);var r=this.nFocusIndex;return this.nFocusIndex=e,r!=this.nFocusIndex&&(this._historyTimeAxisFocusChange(r,this.nFocusIndex),this._emitter.emit(_.default.OnFocusChange,r,this.nFocusIndex)),!0}},{key:"isFocusIndex",value:function(e){var t=parseInt(e);return!(t<0||t>this.videos.length||!this.videos[t])&&t==this.nFocusIndex}},{key:"setWindowMaximum",value:function(e){var t=parseInt(e);if(t<0||t>this.videos.length||!this.videos[t])return!1;for(var i=0,r=this.videos.length;i<r;i++)if(t===i)this.videos[i].vOpt.videoC.classList.add("max-screen"),this.videos[i].setMax("big"),this.maxScreenIndex=t,this._isFullScreen?this.videos[i].setPosition(0,0,this.WinScreenWidth+"px",this.WinScreenHeight+"px"):this.videos[i].setPosition(0,0,this.opt.width,this.opt.height);else{this.videos[i].vOpt.videoC.classList.remove("max-screen");var n=this._getVideoStyleByLayout(i);this.videos[i].setPosition(n.top,n.left,n.width,n.height),this.videos[i].setMax("hide")}return this.maxScreenIndex!=this.nFocusIndex&&this._setFocusIndex(this.maxScreenIndex),!0}},{key:"setWindowRestore",value:function(e){var t=parseInt(e);if(t<0||t>this.videos.length||!this.videos[t])return!1;if(t===this.maxScreenIndex){for(var i=0,r=this.videos.length;i<r;i++){if(t===i){var n=this._getVideoStyleByLayout(i);this.videos[i].setPosition(n.top,n.left,n.width,n.height)}this.videos[i].setMax("origin"),this.videos[i].vOpt.videoC.classList.remove("max-screen")}this.maxScreenIndex=-1}return!0}},{key:"_toggleMaxScreen",value:function(e){e===this.maxScreenIndex?this.setWindowRestore(e):this.setWindowMaximum(e)}},{key:"setBackgroundImage",value:function(e,t){var i=parseInt(e);return!(i<0||i>this.videos.length||!this.videos[i])&&this.videos[i].setBgImg(t)}},{key:"isBusyIndex",value:function(e){var t=parseInt(e);return!(t<0||t>this.videos.length||!this.videos[t])&&(this.videos[t].getIdleOrBusy()||!1)}},{key:"getWindowRect",value:function(e){var t=parseInt(e);return t<0||t>this.videos.length||!this.videos[t]?null:this.maxScreenIndex===t?this._isFullScreen?{left:"0px",top:"0px",width:this.WinScreenWidth+"px",height:this.WinScreenHeight+"px"}:{left:"0px",top:"0px",width:this.opt.width,height:this.opt.height}:this._getVideoStyleByLayout(t)}},{key:"isFullScreen",value:function(){return this._isFullScreen||!1}},{key:"setFullScreen",value:function(e){var t=this.playerC;e?this.launchFullScreenStyle():/IE9|IE10/i.test(this.browserV)?this.launchFullScreenIE11L():(t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen(),this.launchFullScreenStyle()),this.updateFullScreenState(!0)}},{key:"launchFullScreenStyle",value:function(){this.playerC.style.position="fixed"}},{key:"launchFullScreenIE11L",value:function(){var e=this.playerC.className;this.playerC.className=e+" ie-fullscreen"}},{key:"exitFullscreen",value:function(e){e?this.exitFullScreenStyle():/IE9|IE10/i.test(this.browserV)?this.exitFullscreenIE11L():(console.log("exitFullscreen"),this.exitFullScreenStyle(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}},{key:"exitFullscreenIE11L",value:function(){this.updateFullScreenState(!1);var e=this.playerC.className;this.playerC.className=e.split(" ").slice(e.split(" ").indexOf("ie-fullscreen"),1),this.playerC.style.position="relative"}},{key:"exitFullScreenStyle",value:function(){this.playerC.style.position="relative",this.updateFullScreenState(!1)}},{key:"updateFullScreenState",value:function(e){this._isFullScreen=e||!1;var t=this._isFullScreen?"h5vp-content h5vp-content-full":"h5vp-content";this.playerC.className=t,this.styleArr=this._getAllVideoStyleByLayout();for(var i=0,r=this.videos.length;i<r;i++){var n=this._getVideoStyleByLayout(i);this.maxScreenIndex===i?this._isFullScreen?this.videos[i].setPosition(0,0,this.WinScreenWidth+"px",this.WinScreenHeight+"px"):this.videos[i].setPosition(0,0,this.opt.width,this.opt.height):this.videos[i].setPosition(n.top,n.left,n.width,n.height)}this._historyTimeAxisSizeChange(),this._isFullScreen?this._emitter.emit(_.default.OnFullScreen):this._emitter.emit(_.default.OnExitFullScreen)}},{key:"screenChangeEvent",value:function(e){var i=this;if(/IE11/i.test(this.browserV))l.EventUtil.addHandler(document,"keydown",function(e){27===((e=e||window.event).keyCode||e.which)&&i._isFullScreen&&i.exitFullScreenStyle()});else if(/IE9|IE10/i.test(this.browserV))l.EventUtil.addHandler(document,"keydown",function(e){27===((e=e||window.event).keyCode||e.which)&&i._isFullScreen&&i.exitFullscreenIE11L()});else{var t=["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","msfullscreenchange"];l.EventUtil.addHandler(document,"keydown",function(e){27===((e=e||window.event).keyCode||e.which)&&i._isFullScreen&&i.exitFullScreenStyle()});for(var r=0;r<t.length;r++)document.addEventListener(t[r],function(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.msIsFullScreen;if(e&&t){if(e!=i.playerC)return;i.launchFullScreenStyle()}else i.exitFullScreenStyle()})}}},{key:"_addEvent",value:function(){this._clickEvent(),this._dblclickEvent(),this._dragEvent()}},{key:"_getEventInfo",value:function(e){e=l.EventUtil.getEvent(e);var t=l.EventUtil.getVideoContainerTarget(e);if(!t)return{index:-1,ele:null,x:e.offsetX,y:e.offsetY};var i=l.EventUtil.getEleToParentDistance(e.target,"h5vp-video-container"),r=i.offsetLeft,n=i.offsetTop,a=parseInt(t.getAttribute("index"));return{ele:t,index:isFinite(a)?a:-1,x:e.offsetX+r,y:e.offsetY+n}}},{key:"_clickEvent",value:function(){var i=this;l.EventUtil.addHandler(this.playerC,"click",function(e){var t=i._getEventInfo(e).index;0<=t&&t<i.videos.length&&(i._setFocusIndex(t),i.videos[t].showOrHideRightMenu(!1),i.videos[t].removeSelectDrawing(),i._emitter.emit(_.default.OnWndClick,t))})}},{key:"_dblclickEvent",value:function(){var s=this;l.EventUtil.addHandler(this.playerC,"dblclick",function(e){var t=s._getEventInfo(e),i=parseInt(t.index),r=t.x,n=t.y;if(!(i<0||i>=s.videos.length)){var a=s.videos[i].isInPtzRange(r,n);(!a||a&&s.enablePtzDoubleClick)&&(s._toggleMaxScreen(i),s.videos[i].isShowPtzRedArrow(!0,e),s._emitter.emit(_.default.OnWndDClik,i))}})}},{key:"_dragEvent",value:function(){var a=this,s=null,o=null;l.EventUtil.addHandler(this.playerC,"dragstart",function(e){if(0<=(s=a._getEventInfo(e)).index&&s.index<a.videos.length&&(a.videos[s.index].videoCMouseOverFlag=!1,s.index===a.maxScreenIndex||!a.enableExchangeScreen))return e.preventDefault(),void a.videos[s.index]._ptzControlByWin(0,0)}),l.EventUtil.addHandler(this.playerC,"dragend",function(e){a.videos[s.index].videoCMouseOverFlag=!1,(s&&0<=s.index||!a.enableExchangeScreen)&&a.videos[s.index]._ptzControlByWin(0,0)}),l.EventUtil.addHandler(this.playerC,"dragover",function(e){a.videos[s.index].videoCMouseOverFlag=!1,(s&&0<=s.index||!a.enableExchangeScreen)&&a.videos[s.index]._ptzControlByWin(0,0),e.preventDefault()}),l.EventUtil.addHandler(this.playerC,"drop",function(e){if(!(!(o=a._getEventInfo(e))||o.index<0||o.index>=a.videos.length)&&(a.videos[o.index].videoCMouseOverFlag=!1,s&&s.index!==a.maxScreenIndex)){var t=s.index,i=o.index;if(!(t<0||i<0||t==i)){if(a.enableExchangeScreen){a.videos[t].showOrHideRightMenu(!1);var r=a._getVideoStyleByLayout(i);a.videos[t].setPosition(r.top,r.left,r.width,r.height),r=a._getVideoStyleByLayout(t),a.videos[i].setPosition(r.top,r.left,r.width,r.height),a.videos[t].setAttributeIndex(i),a.videos[i].setAttributeIndex(t);var n=a.videos[t];a.videos[t]=a.videos[i],a.videos[i]=n,a.videos[i]._ptzControlByWin(0,0),a._setFocusIndex(i),a._emitter.emit(_.default.OnSwitchWindow,t,i)}else a._emitter.emit(_.default.OnUnexecutedSwitchWindow,t,i);i=t=-1}}})}},{key:"addEventListener",value:function(e,t){e===_.default.OnH5msInit&&this._h5msClient&&this._h5msClient.status===E.HttpStatus.kSuccess?this._emitter.emit(_.default.OnH5msInit,E.HttpEvents.OnInitSuccess):e===_.default.OnH5msError&&this._h5msClient&&this._h5msClient.status===E.HttpStatus.kInitError?this._emitter.emit(_.default.OnH5msError,E.HttpEvents.OnInitFail):e===_.default.OnH5msError&&this._h5msClient&&this._h5msClient.status===E.HttpStatus.kError&&this._emitter.emit(_.default.OnH5msError,E.HttpEvents.OnKeepAliveFail),this._emitter.addListener(e,t)}},{key:"removeEventListener",value:function(e){this._emitter.removeAllListeners(e)}},{key:"listenAndEmitEvent",value:function(e){var o=this;e.addEvent(_.default.OnMouseEnter,function(e){o._emitter.emit(_.default.OnMouseEnter,e)}),e.addEvent(_.default.OnMouseLeave,function(e){o.opt.enablePtzMotion&&0<=o._mousedownindex&&o.videos[o._mousedownindex]&&o.videos[o._mousedownindex]._ptzControlByWin(0,0),o._mousedownindex=-1,o._emitter.emit(_.default.OnMouseLeave,e)}),e.addEvent(_.default.OnMouseDown,function(e){o._mousedownindex=e,o._emitter.emit(_.default.OnMouseDown,e)}),e.addEvent(_.default.OnMouseUp,function(e){o._mousedownindex!=e&&(o.opt.enablePtzMotion&&0<=o._mousedownindex&&o.videos[o._mousedownindex]&&o.videos[o._mousedownindex]._ptzControlByWin(0,0),o._mousedownindex=-1),o._emitter.emit(_.default.OnMouseUp,e)}),e.addEvent(_.default.OnMouseMove,function(e){o._emitter.emit(_.default.OnMouseMove,e)}),e.addEvent(_.default.OnPTZControlEvent,function(e,t,i,r,n,a){o._emitter.emit(_.default.OnPTZControlEvent,e,t,i,r,n,a)}),e.addEvent(_.default.OnPTZControl3DEvent,function(e,t,i,r,n,a,s){o._emitter.emit(_.default.OnPTZControl3DEvent,e,t,i,r,n,a,s)}),e.addEvent(_.default.OnVideoClose,function(e){o._emitter.emit(_.default.OnVideoClose,e),o._historyTimeAxisVideoClose(e)}),e.addEvent(_.default.OnVideoStart,function(e){o._historyTimeAxisVideoStart(e)}),e.addEvent(_.default.OnTimeaxisLevel,function(e,t,i){o._historyTimeAxisLevel(e,t,i)}),e.addEvent(_.default.OnDrawingObject,function(e){o._emitter.emit(_.default.OnDrawingObject,e)}),e.addEvent(_.default.OnZoomStatusChange,function(e,t){o._emitter.emit(_.default.OnZoomStatusChange,e,t),0<=e&&e<o.videos.length&&o.videos[e].checkZoomBtnStatus()}),e.addEvent(_.default.OnWndClick,function(e){0<=e&&e<o.videos.length&&(o._setFocusIndex(e),o.videos[e].showOrHideRightMenu(!1),o._emitter.emit(_.default.OnWndClick,e))}),e.addEvent(_.default.OnMouseDown,function(e,t){0<=e&&e<o.videos.length&&(o._setFocusIndex(e),o.videos[e].showOrHideRightMenu(!1),t||o.videos[e].removeSelectDrawing(),o._emitter.emit(_.default.OnMouseDown,e))}),e.addEvent(_.default.OnWndDClik,function(e){0<=e&&e<o.videos.length&&(o._toggleMaxScreen(e),o._emitter.emit(_.default.OnWndDClik,e))})}},{key:"version",get:function(){return"1.2.0"}},{key:"onResponse",get:function(){return this._onresponse},set:function(e){this._onresponse=e}},{key:"onError",get:function(){return this._onerror},set:function(e){this._onerror=e}},{key:"desEncodeType",get:function(){return this.opt.desEncodeType},set:function(e){return this.opt.desEncodeType=e}},{key:"backgroundColor",set:function(e){this.opt.backgroundColor=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setbackgroundColor(e)},get:function(){return this.opt.backgroundColor}},{key:"enableLoadingGif",set:function(e){if("boolean"==typeof e){this.opt.enableLoadingGif=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setLoadingFlag(e,this.opt.enableLoadingInfo)}else this._showDebuggInfo("set enableLoadingGif() param error!")},get:function(){return this.opt.enableLoadingGif}},{key:"enableLoadingInfo",set:function(e){if("boolean"==typeof e){this.opt.enableLoadingInfo=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setLoadingFlag(this.opt.enableLoadingGif,e)}else this._showDebuggInfo("set enableLoadingInfo() param error!")},get:function(){return this.opt.enableLoadingInfo}},{key:"showerror",set:function(e){if("boolean"==typeof e){this.opt.showerror=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setShowError(e,this.opt.showerrorDetail)}else this._showDebuggInfo("set showerror() param error!")},get:function(){return this.opt.showerror}},{key:"showerrorDetail",set:function(e){if("boolean"==typeof e){this.opt.showerrorDetail=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setShowError(this.opt.showerror,e)}else this._showDebuggInfo("set showerrorDetail() param error!")},get:function(){return this.opt.showerrorDetail}},{key:"enableProgressShowPts",set:function(e){if("boolean"==typeof e){this.opt.enableProgressShowPts=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setProgressShowPts(e)}else this._showDebuggInfo("set enableProgressShowPts() param error!")},get:function(){return this.opt.enableProgressShowPts}},{key:"layout",set:function(e){var t=e;if("string"==typeof t)t={layout:t.toUpperCase()};else if(0===t||null===t)t={layout:"0"};else if("object"!==(void 0===t?"undefined":s(t)))return void this._showDebuggInfo("set layout() param error!");"1A5"===t.layout||"1A7"===t.layout||"1A9"===t.layout||this._parselayout(t)?this._setLayout(t):this._showDebuggInfo("set layout() param error!")},get:function(){return this.opt.layout?this.opt.layout:{}}},{key:"layoutmargin",set:function(e){var t=this._getLayoutmargin(e);t?this._setLayoutmargin(t):this._showDebuggInfo("set layoutmargin() param error!")},get:function(){return this.opt.layoutmargin?this.opt.layoutmargin:{}}},{key:"layoutCount",get:function(){return this.layoutcount?this.layoutcount:0}},{key:"borderStyle",set:function(e){this.opt.border=p.Toolkit.deepMerge(this.opt.border,e);for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setBorderStyle(this.opt.border);this.opt.border&&this.opt.border.borderColor&&(this.playerC.style.background=this.opt.border.borderColor)},get:function(){return this.opt.border}},{key:"focusIndex",set:function(e){var t=parseInt(e);t<0||t>this.videos.length||!this.videos[t]?this._showDebuggInfo("set focusIndex() param error!"):this._setFocusIndex(t)},get:function(){return this.nFocusIndex}},{key:"maxWindowIndex",get:function(){return this.maxScreenIndex}},{key:"defaultBackground",set:function(e){this.opt.defBgClass=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].setDefBgImg(e)},get:function(){return this.opt.defBgClass}},{key:"enableExchangeWindow",set:function(e){this.opt.enableExchangeScreen=e||!1,this.enableExchangeScreen=e||!1},get:function(){return this.enableExchangeScreen}}]),R);function R(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,R);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,e.wsurl||w)),i={ele:"#video",videoSize:{width:0,height:0},border:{borderWidth:"2px",borderStyle:"solid",borderColor:"#B9BABB",focusBorderStyle:"solid",focusBorderColor:"red"},layout:"2*2",ratio:"origin",layoutmargin:{marginX:0,marginY:0},defBgClass:"h5vp-bg-img",errorBgClass:"h5vp-bg-img-error",backgroundColor:"#000",enablePtzMotion:!0,enableLoadingGif:!0,enableLoadingInfo:!0,enableProgressShowPts:!0,windowPtzSpeed:10,ptzRangeMode:1,top_bottom:20,left_right:20,showerror:!0,showerrorDetail:!0,reconnectCount:3,reconnectDuration:10,loadingTimeout:10,enablercdtimershaft:!0,rcdtimershaftshowtype:1,rcdtimershaft:{backcolor:"rgba(0, 0, 0, 0.5)",vodcolor:"rgba(45, 240, 249, 0.5)",novodcolor:"rgba(160, 125, 125, 0.5)",thumbpos:"53%",thumbcolor:"#E48E00",captioncolor:"rgba(45, 240, 249)",curtimecolor:"rgba(45, 240, 249)",level:0,curPositon:45,shrink:!0},desEncodeType:0,enableExchangeScreen:!0,enableStopZoomByDblclick:!1,vmShowAttribute:!0,wsurl:w};t.opt=p.Toolkit.deepMerge(i,e),t.opt.VMStrokeColorObj=t.VMStrokeColorObj,t.opt.VMTitleObj=t.VMTitleObj,t.opt.h5msUrl?t._h5msClient=t._initH5msClient(t.opt.h5msUrl,!0):t._h5msClient=null,t._reconnectCount=0,t._h5msClientList=[],t._showDebugInfo=!0,t.browserV=p.Toolkit.browserVersion(),t._isFullScreen=!1,t.maxScreenIndex=-1,t.nFocusIndex=0,t.enableExchangeScreen=t.opt.enableExchangeScreen,t.enablePtzDoubleClick=!1,t._timeAxisIndex=-1,t._timeAxisTimer=null,t.videos=[],"string"==typeof t.opt.ele?t.opt.ele=document.querySelector(t.opt.ele):t.opt.ele=t.opt.ele,t._emitter=new g.default,t._mousedownindex=-1,t._websocketctrl=null,t._onresponse=null,t._onerror=null,t._initDom(),a.EleResize.on(t.playerC,t._videoContainerResize.bind(t));var r=p.Toolkit.getBrowserZoomRatio();return t.WinScreenWidth=window.screen.width/(r/100),t.WinScreenHeight=window.screen.height/(r/100),t._windowResizeEvent(),t._initEvent(),t._httpctrl=null,t}T._defWsurl=w,T._extendClass=null,T.version="1.2.0",window.H5Player=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){for(e=""+e,t=t||2;e.length<t;)e="0"+e;return e}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var a={generateOnlyId:function(){return Number(Math.random().toString().substr(3,15)+Date.now()).toString(36)},getElementStyle:function(e,t){if("string"==typeof e)var i=document.querySelector(i);var r=arguments.length,n=void 0,a=void 0;return"currentStyle"in e?n=e.currentStyle:"getComputedStyle"in window&&(n=window.getComputedStyle(e,null)),"opacity"===t&&document.all?(a=e.filters)&&0<a.length&&a.alpha?a.alpha.opacity/100:1:("float"===t&&(t=document.all?"styleFloat":"cssFloat"),n=2==r?n[t]:n)},browserVersion:function(){var e=navigator.userAgent,t=/(msie\s|trident.*rv:)([\w.]+)/,i=/(firefox)\/([\w.]+)/,r=/(opera).+version\/([\w.]+)/,n=/(chrome)\/([\w.]+)/,a=/version\/([\w.]+).*(safari)/,s=void 0,o=void 0;e.toLowerCase();var l,u,h=(l=e.toLowerCase(),null!=(u=t.exec(l))?{browser:"IE",version:u[2]||"0"}:null!=(u=i.exec(l))?{browser:u[1]||"",version:u[2]||"0"}:null!=(u=r.exec(l))?{browser:u[1]||"",version:u[2]||"0"}:null!=(u=n.exec(l))?{browser:u[1]||"",version:u[2]||"0"}:null!=(u=a.exec(l))?{browser:u[2]||"",version:u[1]||"0"}:null!=u?{browser:"",version:"0"}:void 0);return h.browser&&(s=h.browser,o=h.version),s+o},insertAfter:function(e,t){var i=t.parentNode;i.lastChild==t?i.appendChild(e):i.insertBefore(e,t.nextSibling)},hexToRgb:function(e){if((e=e.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var t="#",i=1;i<4;i+=1)t+=e.slice(i,i+1).concat(e.slice(i,i+1));e=t}var r=[];for(i=1;i<7;i+=2)r.push(parseInt("0x"+e.slice(i,i+2)));return"rgb("+r.join(",")+")"}return e},rgbAndOpacityToRgba:function(e,t){var i=e.replace("rgb(","").replace(")","").split(",");return i.push(t),"rgba("+i.join(",")+")"},getBrowserZoomRatio:function(){var e=0,t=window.screen,i=navigator.userAgent.toLowerCase();return void 0!==window.devicePixelRatio?e=window.devicePixelRatio:~i.indexOf("msie")?t.deviceXDPI&&t.logicalXDPI&&(e=t.deviceXDPI/t.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(e=window.outerWidth/window.innerWidth),e=e&&Math.round(100*e)},getUuid:function(){var e,t=16,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[];for(t=t||i.length,e=0;e<32;e++)r[e]=i[0|Math.random()*t];return r.join("")},deepMerge:function(e,t){var i;for(i in t)t[i]&&"object"===r(t[i])&&!t[i].nodeType?(e[i]=t[i].constructor===Array?[]:{},this.deepMerge(e[i],t[i])):e[i]=t[i];return e},isPositiveInteger:function(e){return/^[0-9]+$/.test(e)},debounce:function(t,i,r){var n,a,s=null;return function(){if(n=this,a=arguments,s&&clearTimeout(s),r){var e=!s;s=setTimeout(function(){s=null},i),e&&t.apply(n,a)}else s=setTimeout(function(){t.apply(n,a)},i)}},findNearAncestor:function(e,t){for(;"BODY"!=e.tagName;){if(-1<e.className.indexOf(t))return e;e=e.parentNode}},getShapeDistance:function(t,e){if(e.length<1)return 0;var i=0,r=0,n=0,a=0;return e.forEach(function(e){n=e.x-t.x,e.y-t.y,a=a+n*n+n*n,i+=e.x,r+=e.y}),i/=e.length,r/=e.length,i-=t.x,r-=t.y,a=(a+i*i+r*r)/(e.length+1)},isPointInRect:function(e,t,i){if(2!=t.length)return!1;var r=parseInt(t[0].x),n=parseInt(t[1].x),a=parseInt(t[0].y),s=parseInt(t[1].y),o=parseInt(e.x),l=parseInt(e.y);n<r&&(r=parseInt(t[1].x),n=parseInt(t[0].x)),s<a&&(a=parseInt(t[1].y),s=parseInt(t[0].y));function u(e){return e<10&&-10<e}var h=o-r,d=l-a,c=o-n,f=l-s;return u(h)&&u(d)||u(c)&&u(f)?(i.mouse="nw-resize",i.direction="xy",u(h)&&u(d)?i.index=0:i.index=2,!0):u(h)&&u(f)||u(c)&&u(d)?(i.mouse="ne-resize",i.direction="xy",u(c)&&u(d)?i.index=1:i.index=3,!0):a<l&&l<s&&(u(c)||u(h))?(i.mouse="e-resize",i.direction="x",u(h)?i.index=0:i.index=2,!0):r<o&&o<n&&(u(d)||u(f))?(i.mouse="n-resize",i.direction="y",u(d)?i.index=0:i.index=2,!0):r<=o&&o<=n&&a<=l&&l<=s&&(i.mouse="move",!0)},isPointInPolygon:function(e,t,i){for(var r=parseInt(e.x),n=parseInt(e.y),a=!1,s=function(e){return e<10&&-10<e},o=0,l=t.length,u=l-1;o<l;u=o,o++){var h=parseInt(t[o].x),d=parseInt(t[o].y),c=parseInt(t[u].x),f=parseInt(t[u].y),p=n-d;if(s(r-h)&&s(p))return i.index=o,i.mouse="sw-resize",!0;var v=n-f;if(s(r-c)&&s(v))return i.index=u,i.mouse="sw-resize",!0;if(d<n&&n<=f||n<=d&&f<n){var m=h+(n-d)*(c-h)/(f-d);if(m===r)return i.mouse="move",!0;r<m&&(a=!a)}}return a&&(i.mouse="move"),a},isPointInLine:function(e,t,i,r,n){if(2!=t.length)return!1;function a(e){return e<10&&-10<e}var s=parseInt(e.x),o=parseInt(e.y),l=parseInt(t[0].x),u=parseInt(t[0].y),h=parseInt(t[1].x),d=parseInt(t[1].y),c=s-l,f=o-u,p=s-h,v=o-d;if(1==n){var m=-1;if(0==r?m=c*c+f*f:1==r&&(m=p*p+v*v),0<=m&&m<=400&&(c*p<0||f*v<0))return i.index=r,i.mouse="pointer",!0}else if(2==n){var g=this.getLineArrowPoint(t),_=s-g[0].x,y=o-g[0].y,b=s-g[1].x,S=o-g[1].y;if((0==r||2==r)&&_*_+y*y<=400)return i.index=0,i.mouse="pointer",!0;if((1==r||2==r)&&b*b+S*S<=400)return i.index=1,i.mouse="pointer",!0}if(a(c)&&a(f))return i.index=0,i.mouse="sw-resize",!0;if(a(p)&&a(v))return i.index=1,i.mouse="sw-resize",!0;c=l-h,f=u-d;for(var E=!1,k=6/Math.sqrt(c*c+f*f),w=f*k,T=c*k,R=[{x:l+w,y:u-T},{x:l-w,y:u+T},{x:h-w,y:d+T},{x:h+w,y:d-T}],A=0,C=R.length,x=C-1;A<C;x=A,A++){var I=parseInt(R[A].x),O=parseInt(R[A].y),L=parseInt(R[x].x),D=parseInt(R[x].y);if(O<o&&o<=D||o<=O&&D<o){var P=I+(o-O)*(L-I)/(D-O);if(P===s){E=!0;break}s<P&&(E=!E)}}return E&&(i.mouse="move"),E},isPointInDoubleline:function(e,t,i,r,n,a,s){if(this.isPointInLine(e,t,i,r,n))return!0;for(var o=this.deepMerge([],t),l=parseInt(a),u=parseInt(s),h=0;h<o.length;h++)o[h].x+=l,o[h].y+=u;return this.isPointInLine(e,o,i,r,n)},getLineArrowPoint:function(e){var t=parseInt(e[0].x),i=parseInt(e[0].y),r=parseInt(e[1].x),n=parseInt(e[1].y);if(t==n&&i==n)return[{x:0,y:0},{x:0,y:0}];var a=r-t,s=n-i,o=(t+r)/2,l=(i+n)/2,u=20/Math.sqrt(a*a+s*s),h=s*u,d=a*u;return[{x:parseInt(o-h),y:parseInt(l+d)},{x:parseInt(o+h),y:parseInt(l-d)}]},getLinePoint:function(e,t){var i=parseInt(e[0].x),r=parseInt(e[0].y),n=parseInt(e[1].x),a=parseInt(e[1].y);if(i==a&&r==a)return[{x:0,y:0},{x:0,y:0}];var s=n-i,o=a-r,l=t/Math.sqrt(s*s+o*o),u=o*l,h=s*l;return[{x:parseInt(i+u),y:parseInt(r-h)},{x:parseInt(n+u),y:parseInt(a-h)}]},dateTime2mills:function(e){return Date.parse(new Date(e))/1e3},mills2datetime:function(e){var t=new Date(e);return t.getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate())+" "+n(t.getHours())+":"+n(t.getMinutes())+":"+n(t.getSeconds())}};t.Toolkit=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={aggregation:function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),i=1;i<t;i++)a[i-1]=arguments[i];var r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,e),s);function s(){for(var e,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(i)));return a.forEach(function(e){"function"==typeof e.prototype.initializer&&e.prototype.initializer.apply(n,i)}),n}function n(t,i){Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i)).forEach(function(e){e.match(/^(?:initializer|constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return a.forEach(function(e){n(r.prototype,e.prototype),n(r,e)}),r},addHandler:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},removeHandler:function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null},getEvent:function(e){return e||window.event},getVideoContainerTarget:function(e){var t=e.target||e.srcElement,i=null;try{if("string"==typeof t.className&&-1!==t.className.indexOf("h5vp-video-container"))i=t;else{if("string"==typeof t.className&&-1!==t.className.indexOf("h5vp-container"))return null;i=r.getParentEle(t,"h5vp-video-container")}}catch(e){}return i},getPageOffset:function(e){for(var t=0,i=0;e&&e!==document.body;)t+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;return{offsetLeft:t,offsetTop:i}},getEleToParentDistance:function(e,t){for(var i=0,r=0;e&&e!==document.body&&(!t||t&&!e.classList.contains(t));)i+=e.offsetLeft||0,r+=e.offsetTop||0,e=e.offsetParent;return{offsetLeft:i,offsetTop:r}},getParentEle:function(e,t){for(;e&&e!==document.body&&!e.classList.contains(t);)e=e.parentNode;return e!==document.body?e:null},getTarget:function(e){return e.target||e.srcElement},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}};t.EventUtil=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={_handleResize:function(e){var t=(e.target||e.srcElement).__resizeTrigger__;if(t){var i=t.__z_resizeListeners;if(i)for(var r=i.length,n=0;n<r;n++){var a=i[n],s=a.handler,o=a.context;s.apply(o,[e])}}},_removeHandler:function(e,t,i){var r=e.__z_resizeListeners;if(r)for(var n=r.length,a=0;a<n;a++){var s=r[a];if(s.handler===t&&s.context===i)return void r.splice(a,1)}},_createResizeTrigger:function(e){var t=document.createElement("object");return t.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden;opacity: 0; pointer-events: none; z-index: -1;"),t.onload=a._handleObjectLoad,t.type="text/html",e.appendChild(t),t.data="about:blank",t},_handleObjectLoad:function(e){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",a._handleResize)}};document.attachEvent?(a.on=function(e,t,i){var r=e.__z_resizeListeners;r||(r=[],e.__z_resizeListeners=r,(e.__resizeTrigger__=e).attachEvent("onresize",a._handleResize)),r.push({handler:t,context:i})},a.off=function(e,t,i){var r=e.__z_resizeListeners;r&&(a._removeHandler(e,t,i),0===r.length&&(e.detachEvent("onresize",a._handleResize),delete e.__z_resizeListeners))}):(a.on=function(e,t,i){var r=e.__z_resizeListeners;if(!r){r=[],e.__z_resizeListeners=r,"static"===getComputedStyle(e,null).position&&(e.style.position="relative");var n=a._createResizeTrigger(e);(e.__resizeTrigger__=n).__resizeElement__=e}r.push({handler:t,context:i})},a.off=function(e,t,i){var r=e.__z_resizeListeners;if(r&&(a._removeHandler(e,t,i),0===r.length)){var n=e.__resizeTrigger__;n&&(n.contentDocument.defaultView.removeEventListener("resize",a._handleResize),e.removeChild(n),delete e.__resizeTrigger__),delete e.__z_resizeListeners}}),t.EleResize=a},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"createToolbar",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("createToolbar() param error!"):this.videos[i].createToolbar(t)}},{key:"removeToolbar",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("removeToolbar() param error!"):this.videos[i].removeToolbar(t)}},{key:"setStaticContent",value:function(e,t,i){var r=parseInt(e);r<0||r>=this.videos.length?this._showDebuggInfo("setStaticContent() param error!"):this.videos[r].setStaticContent(t,i)}},{key:"getStaticContent",value:function(e,t){var i=parseInt(e);if(!(i<0||i>=this.videos.length))return this.videos[i].getStaticContent(t);this._showDebuggInfo("getStaticContent() param error!")}},{key:"getToobarItemStatusById",value:function(e,t){var i=parseInt(e);if(!(i<0||i>=this.videos.length))return this.videos[i].getToobarItemStatusById(t);this._showDebuggInfo("getToobarItemStatusById() param error!")}},{key:"setToolbarMenuById",value:function(e,t,i){var r=parseInt(e);r<0||r>=this.videos.length?this._showDebuggInfo("setToolbarMenuById() param error!"):this.videos[r].setToolbarMenuById(t,i)}},{key:"setToolbarItemAttrsById",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setToolbarItemAttrsById(t,i);this._showDebuggInfo("setToolbarItemAttrsById() param error!")}},{key:"setToolbarItemGray",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setToolbarItemGray(t,i);this._showDebuggInfo("setToolbarItemGray() param error!")}},{key:"setToolbarItemChecked",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setToolbarItemChecked(t,i);this._showDebuggInfo("setToolbarItemChecked() param error!")}},{key:"setToolbarItemText",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setToolbarItemText(t,i);this._showDebuggInfo("setToolbarItemText() param error!")}},{key:"showOrHideToolbar",value:function(e,t,i){var r=parseInt(e);r<0||r>=this.videos.length?this._showDebuggInfo("showOrHideToolbar() param error!"):this.videos[r].showOrHideToolbar(t,i)}},{key:"getVideoInfo",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("getVideoInfo() param error!"),null):this.videos[t].getVideoInfo()}},{key:"getStreamRate",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("getStreamRate() param error!"),null):this.videos[t].getStreamRate()}},{key:"setPlayTime",value:function(e,t){var i=parseInt(e),r=parseFloat(t);return i<0||i>=this.videos.length||!this.videos[i]||r<0||isNaN(r)?(this._showDebuggInfo("setPlayTime() param error!"),!1):this.videos[i].setPlayTime(r)}},{key:"getPlaySpeed",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length||!this.videos[t]?(this._showDebuggInfo("getPlaySpeed() param error!"),0):this.videos[t].getPlaySpeed()}},{key:"setPlaySpeed",value:function(e,t){var i=parseInt(e),r=parseFloat(t);return i<0||i>=this.videos.length||!this.videos[i]||r<0||isNaN(r)||16<r?(this._showDebuggInfo("setPlaySpeed() param error!"),!1):this.videos[i].setPlaySpeed(r)}},{key:"setRatio",value:function(e,t){var i=parseInt(e);return i<0||i>=this.videos.length||!this.videos[i]||"string"!=typeof t?(this._showDebuggInfo("setRatio() param error!"),!1):this.videos[i].setRatio(t.toLowerCase())}}]),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(s,[{key:"initializer",value:function(e){}},{key:"createRightMenu",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length||"object"!=(void 0===t?"undefined":r(t))?this._showDebuggInfo("createRightMenu() param error!"):this.videos[i].createRightMenu(t)}},{key:"removeRightMenu",value:function(e){var t=parseInt(e);t<0||t>=this.videos.length?this._showDebuggInfo("removeRightMenu() param error!"):this.videos[t].removeRightMenu()}},{key:"getRightMenuItemById",value:function(e,t){var i=parseInt(e);if(!(i<0||i>=this.videos.length))return this.videos[i].getRightMenuItemById(t);this._showDebuggInfo("getRightMenuItemById() param error!")}},{key:"setRightMenuItemAttrsById",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setRightMenuItemAttrsById(t,i);this._showDebuggInfo("setRightMenuItemAttrsById() param error!")}},{key:"setRightMenuItemGray",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setRightMenuItemGray(t,i);this._showDebuggInfo("setRightMenuItemGray() param error!")}},{key:"setRightMenuItemChecked",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setRightMenuItemChecked(t,i);this._showDebuggInfo("setRightMenuItemChecked() param error!")}},{key:"setRightMenuItemText",value:function(e,t,i){var r=parseInt(e);if(!(r<0||r>=this.videos.length))return this.videos[r].setRightMenuItemText(t,i);this._showDebuggInfo("setRightMenuItemText() param error!")}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s)}t.default=a},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"initializer",value:function(){}},{key:"ptzControl",value:function(e,t,i){var r=parseInt(e),n=parseInt(t),a=parseInt(i||0);return r<0||r>=this.videos.length||!this.videos[r]||n<0||19<n?(this._showDebuggInfo("ptzControl() param error!"),!1):this.videos[r].ptzControl(n,a)}},{key:"ptzControl3d",value:function(e,t,i,r,n,a){var s=parseInt(e),o=parseInt(t);return parseFloat(i),parseFloat(r),parseFloat(n),parseFloat(a),s<0||s>=this.videos.length||!this.videos[s]||o<0||2<o?(this._showDebuggInfo("ptzControl3d() param error!"),!1):this.videos[s].ptzControl3d(t,i,r,n,a)}},{key:"ptzLock",value:function(e,t){var i=parseInt(e),r=parseInt(t||0);return i<0||i>=this.videos.length||!this.videos[i]?(this._showDebuggInfo("ptzLock() param error!"),!1):this.videos[i].ptzLock(r)}},{key:"SetWindowPtz",value:function(e,t){var i=parseInt(e);return!(i<0||i>=this.videos.length||!this.videos[i]||"boolean"!=typeof t)&&this.videos[i].SetWindowPTZ(t)}},{key:"setWindowPtz",value:function(e,t){var i=parseInt(e);return!(i<0||i>=this.videos.length||!this.videos[i]||"boolean"!=typeof t)&&this.videos[i].SetWindowPTZ(t)}},{key:"getWindowPtzStatus",value:function(e){var t=parseInt(e);return!(t<0||t>=this.videos.length||!this.videos[t])&&this.videos[t].isWindowPTZ()}},{key:"setWindowPtzRange",value:function(e,t,i){var r=parseInt(e),n=parseInt(t),a=parseInt(i);if(0===r&&0<n&&0<a||1===r&&0<n&&n<50&&0<a&&a<50){this.opt.ptzRangeMode=r,this.opt.top_bottom=n,this.opt.left_right=a;for(var s=0,o=this.videos.length;s<o;s++)this.videos[s].setPTZRange(e,t,i);return!0}return!1}},{key:"setWindowPtz3D",value:function(e,t,i){var r=parseInt(e);return!(r<0||r>=this.videos.length||!this.videos[r]||"boolean"!=typeof t)&&(t?this.videos[r].startPtz3D(i):this.videos[r].stopPtz3D())}},{key:"getWindowPtz3DStatus",value:function(e){var t=parseInt(e);return!(t<0||t>=this.videos.length||!this.videos[t])&&this.videos[t].getPtz3DStatus()}},{key:"startZoom",value:function(e,t){var i=parseInt(e);return!(i<0||i>=this.videos.length||!this.videos[i])&&this.videos[i].startZoom(t)}},{key:"stopZoom",value:function(e){var t=parseInt(e);return!(t<0||t>=this.videos.length||!this.videos[t])&&this.videos[t].stopZoom()}},{key:"getZoomStatus",value:function(e){var t=parseInt(e);return!(t<0||t>=this.videos.length||!this.videos[t])&&this.videos[t].getZoomStatus()}},{key:"enablePtzMotion",set:function(e){if("boolean"==typeof e){this.opt.enablePtzMotion=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].EnablePTZ(e)}else this._showDebuggInfo("set enablePtzMotion() param error!")},get:function(){return this.opt.enablePtzMotion}},{key:"windowPtzSpeed",set:function(e){var t=parseInt(e);if(t<=0||15<t)this._showDebuggInfo("set windowPtzSpeed() param error!");else{this.opt.windowPtzSpeed=t;for(var i=0,r=this.videos.length;i<r;i++)this.videos[i].SetWndPtzSpeed(t)}},get:function(){return this.opt.windowPtzSpeed}},{key:"enableStopZoomByDblclick",set:function(e){e=!!e,this.opt.enableStopZoomByDblclick=e;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].stopZoomByDblclick(e)},get:function(){return this.opt.enableStopZoomByDblclick}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"initializer",value:function(){}},{key:"addWaterMark",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("addWaterMark() param error!"):this.videos[i].addWaterMark(t)}},{key:"getWaterMarkById",value:function(e,t){var i=parseInt(e);return i<0||i>=this.videos.length?(this._showDebuggInfo("getWaterMarkById() param error!"),null):this.videos[i].getWaterMarkById(t)}},{key:"delWaterMarkById",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("delWaterMarkById() param error!"):this.videos[i].delWaterMarkById(t)}},{key:"changeWaterMarkById",value:function(e,t,i){var r=parseInt(e);r<0||r>=this.videos.length?this._showDebuggInfo("changeWaterMarkById() param error!"):this.videos[r].changeWaterMarkById(t,i)}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=i(337);var s=(r(o,[{key:"initializer",value:function(){this.defaultConfig=(0,a.createDefaultConfig)(),this.VMStrokeColorObj={},this._initStrokeColorByType(),this.VMTitleObj={},this._initTitleByType()}},{key:"_setRTVOStrokeColor",value:function(e,t){this._setStrokeColorByType(e,t);for(var i=0,r=this.layoutcount;i<r;i++)this.videos[i].vOpt.VMStrokeColorObj=this.VMStrokeColorObj}},{key:"_initStrokeColorByType",value:function(){this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_CAR]="rgb(214,38,30)",this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_BICYCLE]="rgb(0,211,12)",this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_TRICYCLE]="rgb(0,211,12)",this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_PEDESTRIAN]="rgb(255,42,245)",this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_FACE]="rgb(255,42,245)"}},{key:"_initTitleByType",value:function(e){this.VMTitleObj[this.defaultConfig.OBJ_TYPE_CAR]="车辆",this.VMTitleObj[this.defaultConfig.OBJ_TYPE_BICYCLE]="自行车",this.VMTitleObj[this.defaultConfig.OBJ_TYPE_TRICYCLE]="非机动车",this.VMTitleObj[this.defaultConfig.OBJ_TYPE_PEDESTRIAN]="行人",this.VMTitleObj[this.defaultConfig.OBJ_TYPE_FACE]="人脸"}},{key:"_setStrokeColorByType",value:function(e,t){var i={};i[e]=t,this.VMStrokeColorObj=Object.assign(this.VMStrokeColorObj,i)}},{key:"vmPersonStrokeColor",set:function(e){this._setRTVOStrokeColor(this.defaultConfig.OBJ_TYPE_PEDESTRIAN,e)},get:function(){return this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_PEDESTRIAN]}},{key:"vmCarStrokeColor",set:function(e){this._setRTVOStrokeColor(this.defaultConfig.OBJ_TYPE_CAR,e)},get:function(){return this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_CAR]}},{key:"vmBicycleStrokeColor",set:function(e){this._setRTVOStrokeColor(this.defaultConfig.OBJ_TYPE_BICYCLE,e)},get:function(){return this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_BICYCLE]}},{key:"vmTricycleStrokeColor",set:function(e){this._setRTVOStrokeColor(this.defaultConfig.OBJ_TYPE_TRICYCLE,e)},get:function(){return this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_TRICYCLE]}},{key:"vmFaceStrokeColor",set:function(e){this._setRTVOStrokeColor(this.defaultConfig.OBJ_TYPE_FACE,e)},get:function(){return this.VMStrokeColorObj[this.defaultConfig.OBJ_TYPE_FACE]}},{key:"vmShowAttribute",set:function(e){this.opt.vmShowAttribute=e||!1;for(var t=0,i=this.videos.length;t<i;t++)this.videos[t].enableShowAttribute(this.opt.vmShowAttribute)},get:function(){return this.opt.vmShowAttribute}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDefaultConfig=function(){return Object.assign({},r)};var r=t.defaultConfig={enableWorker:!0,enableStashBuffer:!1,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:90,autoCleanupMinBackwardDuration:10,autoSpeedMaxDurationForLive:2,autoSpeedMinDurationForLive:1,autoSeekDurationForLive:4,statisticsInfoReportInterval:1e3,fixAudioTimestampGap:!0,accurateSeek:!0,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,OBJ_TYPE_CAR:1,OBJ_TYPE_BICYCLE:2,OBJ_TYPE_TRICYCLE:3,OBJ_TYPE_PEDESTRIAN:4,OBJ_TYPE_FACE:1024}},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"initializer",value:function(){}},{key:"startDrawing",value:function(e,t,i){var r=parseInt(e);return r<0||r>=this.videos.length||"rect"!==t&&"polygon"!=t&&"line"!==t&&"doubleline"!==t?(this._showDebuggInfo("startDrawing() param error!"),!1):this.videos[r].startDrawing(t,i)}},{key:"stopDrawing",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("stopDrawing() param error!"):this.videos[i].stopDrawing(t)}},{key:"deleteDrawingById",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("deleteDrawingById() param error!"):this.videos[i].deleteDrawingById(t)}},{key:"addDrawingObject",value:function(e,t){var i=parseInt(e);i<0||i>=this.videos.length?this._showDebuggInfo("addDrawingObject() param error!"):this.videos[i].addDrawingObject(t)}},{key:"getAllDrawingObject",value:function(e){var t=parseInt(e);return t<0||t>=this.videos.length?(this._showDebuggInfo("getAllDrawingObject() param error!"),null):this.videos[t].getAllDrawingObject()}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=i(329);var s=(r(o,[{key:"initializer",value:function(){}},{key:"_historyTimeAxisFocusChange",value:function(e,t){this.videos&&this.enablercdtimershaft&&this._showTimeAxisIfNeed()}},{key:"_historyTimeAxisSizeChange",value:function(){var e=this.videos;e&&this.enablercdtimershaft&&e[this._timeAxisIndex]&&e[this._timeAxisIndex].updateTimeAxis()}},{key:"_historyTimeAxisVideoClose",value:function(e){this.videos&&this.enablercdtimershaft&&this._timeAxisIndex===e&&(this._closeTimeAxis(),this._showTimeAxisIfNeed())}},{key:"_historyTimeAxisLevel",value:function(e,t,i){e==this._timeAxisIndex&&(this.opt.rcdtimershaft.level=t,null!=i&&(this.opt.rcdtimershaft.shrink=i))}},{key:"_showTimeAxisIfNeed",value:function(){var e=this.videos;if(e&&this.enablercdtimershaft){if(this._isVodPlay(this.nFocusIndex)){if(this.nFocusIndex==this._timeAxisIndex&&e[this._timeAxisIndex].isShowTimeAxis())return;return this._closeTimeAxis(),this._timeAxisIndex=this.nFocusIndex,void(e[this._timeAxisIndex]&&e[this._timeAxisIndex].showTimeAxis(this.opt.rcdtimershaft))}if(0!=this.rcdtimershaftshowtype||"fix"==this.rcdtimershaft.curPositon){if(!(e[this._timeAxisIndex]&&e[this._timeAxisIndex].isVodPlay()&&e[this._timeAxisIndex].isShowTimeAxis())){this._closeTimeAxis();for(var t=-1,i=0;i<e.length;i++){if(e[i].isVodPlay())return void e[this._timeAxisIndex=i].showTimeAxis(this.opt.rcdtimershaft);e[i].getIdleOrBusy()&&(t=i)}2==this.rcdtimershaftshowtype&&-1!=t?e[this._timeAxisIndex=t].showTimeAxis(this.opt.rcdtimershaft):3!=this.rcdtimershaftshowtype&&"fix"!==this.rcdtimershaft.curPositon||!e[0]||e[this._timeAxisIndex=0].showTimeAxis(this.opt.rcdtimershaft)}}else this._closeTimeAxis()}}},{key:"_historyTimeAxisVideoStart",value:function(e){var t=this.videos;if(t&&this.enablercdtimershaft){var i=t[e];i&&(i.isVodPlay()?this.nFocusIndex!=e&&this._isVodPlay(this._timeAxisIndex)||(this._closeTimeAxis(),this._timeAxisIndex=e,i.showTimeAxis(this.opt.rcdtimershaft)):2==this.rcdtimershaftshowtype&&-1==this._timeAxisIndex&&(this._closeTimeAxis(),this._timeAxisIndex=e,i.showTimeAxis(this.opt.rcdtimershaft)))}}},{key:"_isVodPlay",value:function(e){var t=parseInt(e);return!(t<0||t>=this.videos.length)&&this.videos[t].isVodPlay()}},{key:"_closeTimeAxis",value:function(){for(var e=this.videos,t=0;t<e.length;t++)e[t]&&e[t].closeTimeAxis();this._timeAxisIndex=-1}},{key:"rcdtimershaft",set:function(e){this.opt.rcdtimershaft=a.Toolkit.deepMerge(this.opt.rcdtimershaft,e);var t=this._timeAxisIndex;this._closeTimeAxis(),this._timeAxisIndex=t,this.videos[t]&&this.videos[t].showTimeAxis(this.opt.rcdtimershaft)},get:function(){return this.opt.rcdtimershaft}},{key:"enablercdtimershaft",set:function(e){this.opt.enablercdtimershaft=e,this.opt.enablercdtimershaft&&this.videos?this._showTimeAxisIfNeed():this._closeTimeAxis()},get:function(){return this.opt.enablercdtimershaft}},{key:"rcdtimershaftshowtype",set:function(e){this.opt.rcdtimershaftshowtype=e,this.opt.enablercdtimershaft&&this.videos&&this._showTimeAxisIfNeed()},get:function(){return this.opt.rcdtimershaftshowtype}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=_(i(341)),s=_(i(386)),o=_(i(389)),l=_(i(390)),u=_(i(392)),h=_(i(393)),d=_(i(394)),c=_(i(395)),f=_(i(396)),p=i(330),v=i(329),m=_(i(343)),g=_(i(391));function _(e){return e&&e.__esModule?e:{default:e}}var y="正在开流...",b="视频流加载中...",S="第",E="次重连中...",k="视频流接收超时",w=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(T,p.EventUtil.aggregation(s.default,o.default,l.default,u.default,h.default,d.default,f.default,c.default)),r(T,[{key:"destroy",value:function(){this._videoplayer&&(this._videoplayer.destroy(),this._videoplayer=null,this._emitter.emit(g.default.OnVideoClose,this.vOpt.index)),this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=null),this.closeTimeAxis()}},{key:"_getOrignWidthHeight",value:function(){this.width=this.vOpt.width,this.height=this.vOpt.height}},{key:"_createCanvas",value:function(){return document.createElement("canvas")}},{key:"_createVideoEle",value:function(){var e=document.createElement("div"),t=document.createElement("video");e.className="div-"+this.vOpt.ele+" h5vp-video-container",e.style.position="absolute",e.setAttribute("index",this.vOpt.index),t.className=this.vOpt.ele,t.setAttribute("draggable",!0),t.setAttribute("index",this.vOpt.index),e.style.float="left",e.style.width=this.vOpt.width,e.style.height=this.vOpt.height,e.style.top=this.vOpt.top,e.style.left=this.vOpt.left;var i=document.createElement("div");i.className="npvideo-loading-container";var r=document.createElement("div");r.className="npvideo-loading",i.appendChild(r);var n=document.createElement("div");n.className="npvideo-loading-info",i.appendChild(n),this.vOpt.playerC.appendChild(e),e.appendChild(i),e.appendChild(t),this.vOpt.videoC=e,this.vOpt.videoEle=t,this.vOpt.videoLoading=i,this.vOpt.loadingInfoDiv=n,this._setBgImg(!0),this._setBorderStyle(this.isFocusScreen),this.setRatio(this.vOpt.ratio),this._addEvent()}},{key:"_onflverror",value:function(e,t,i){if(this._dataRate=0,this._fps=0,this._updateDateRate(),!this._firstError){if(this._firstError=!0,this._errorAtTime<=0&&(this._errorAtTime=(new Date).getTime()),this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=null),this._videoplayer.unload(),this._restartTimes<this.vOpt.reconnectCount)return this._restartTimer=window.setTimeout(this._createPlayer.bind(this),0),this._restartTimes++,this.vOpt.loadingInfoDiv&&(this.vOpt.loadingInfoDiv.innerHTML=S+this._restartTimes+E),void console.log("第",this._restartTimes,"次重连中... BY COUNT");if(this._hasPlayed&&(this.vOpt.reconnectDuration<0||(new Date).getTime()-this._errorAtTime<1e3*this.vOpt.reconnectDuration)){if(this._restartTimer=window.setTimeout(this._createPlayer.bind(this),3e3),this._restartTimes++,this.vOpt.loadingInfoDiv){this._showOrHideLoading(!0);var r=this._restartTimes-(0<=this.vOpt.reconnectCount?this.vOpt.reconnectCount:0);this.vOpt.loadingInfoDiv.innerHTML=S+r+E}return void console.log("第",this._restartTimes,"次重连中... BY TIME")}this.errorBgToggle(!0),this._showError(e,t,i),this._clearLoadingCheckTimer()}}},{key:"_onflvloading_complete",value:function(){console.log("onloading_complete")}},{key:"_onflvstatistics_info",value:function(e){0!==this._videoWidth&&0!==this._videoHeight||void 0!==this._videoplayer&&this._videoplayer&&(this._videoWidth=this._videoplayer.mediaInfo.videoWidth,this._videoHeight=this._videoplayer.mediaInfo.videoHeight),this._fps=e.decodedFrames-this._lastdecodedFrames,this._lastdecodedFrames=e.decodedFrames,this._fps<0&&(this._fps=0),this._dataRate=e.dataRate,this._updateDateRate(),this._onstatisticsinfo&&this._onstatisticsinfo({videoWideth:this._videoWidth,videoHeight:this._videoHeight,frameRate:this._fps,dataRate:this._dataRate,durtion:this.durationT})}},{key:"_onflvcommand_response",value:function(e,t,i){console.log("oncommand_response",e,t,i)}},{key:"_onflvcommand_notify",value:function(e,t,i){console.log("oncommand_notify",e,t,i)}},{key:"_onflvfirstcanplay",value:function(){if(this._showOrHideLoading(!1),this._clearLoadingCheckTimer(),this.delWaterMarkById("_showError_"),this.errorBgToggle(!1),this.isFirstCanPlay=!0,this._hasPlayed=!0,this._restartTimes=0,this._errorAtTime=0,this.durationT=this._videoplayer.duration,this._videoWidth=this._videoplayer.mediaInfo.videoWidth,this._videoHeight=this._videoplayer.mediaInfo.videoHeight,"origin"===this.vOpt.ratio){var e=this._getOriginVideoSize(),t=this.setZoomSVGPosition(e);this.setRTSVGPosition(t),this.setVMCanvasPosition(t)}}},{key:"_onflvplay",value:function(){this.showOrHideBtn("videoPause",!0),this.showOrHideBtn("videoPlay",!1)}},{key:"_onflvpause",value:function(){this.showOrHideBtn("videoPause",!1),this.showOrHideBtn("videoPlay",!0)}},{key:"_onflvspeedchange",value:function(){}},{key:"_onflvobjectinfo",value:function(e){this.RTVOInit(e)}},{key:"_onflvrecordseek",value:function(e){null!=e.error&&0!=e.error&&this._isVodPlay&&this._updateHistoryTimeAxis(0<this._videoStartPts?this.getPlayPts():this._srcStartPts)}},{key:"_onflvstartstream",value:function(e){this._videoplayer&&this._isVodPlay&&null==this._videoRecordList&&this._videoplayer.queryRecord(this._videoSrc),this.vOpt.loadingInfoDiv&&0==e&&(this.vOpt.loadingInfoDiv.innerHTML=b),0==e&&0<this.vOpt.loadingTimeout&&null==this._loadingCheckTimer&&(this._loadingCheckTimer=window.setTimeout(this._loadingTimeoutCheck.bind(this),1e3*this.vOpt.loadingTimeout))}},{key:"_onflvqueryrecord",value:function(e){if(this._videoRecordList=[],0==e.error){var t=e.info;if("string"==typeof t&&(t=JSON.parse(t)),t&&0<t.length){for(var i=0,r=0,n=-1,a=0;a<t.length;a++)i=new Date(t[a].begintime.replace(/-/g,"/")).getTime(),r=new Date(t[a].endtime.replace(/-/g,"/")).getTime(),(-1==n||i<n)&&(n=i),this._videoRecordList.push([i,r]);-1!=n&&(this._videoStartPts=n,this._videoSrc&&(this._playtimeOffset=(this._videoStartPts-this._srcStartPts)/1e3,this._playtimeOffset<0&&(this._playtimeOffset=0),0<this._playtimeOffset&&this._videoplayer.setPlaybackOffset(this._playtimeOffset)))}}this._updateHistoryTimeAxisRecord(v.Toolkit.deepMerge([],this._videoRecordList))}},{key:"_loadingTimeoutCheck",value:function(){this.firstcanplay||(this._videoplayer&&this._videoplayer.unload(),this.errorBgToggle(!0),this._showError(k),this._clearLoadingCheckTimer())}},{key:"_clearLoadingCheckTimer",value:function(){this._loadingCheckTimer&&(clearTimeout(this._loadingCheckTimer),this._loadingCheckTimer=null)}},{key:"isVodPlay",value:function(){return this._isVodPlay}},{key:"getPlayPts",value:function(){return this._videoplayer?1e3*this._videoplayer.currentTime+this._videoStartPts:0}},{key:"setPlayPts",value:function(e){if(this._videoplayer&&0<this.durationT){var t=(e-this._videoStartPts)/1e3;t<0?t=0:t>this.durationT&&(t=this.durationT),this._videoplayer.currentTime=t}else this._updateHistoryTimeAxis(0<this._videoStartPts?this.getPlayPts():this._srcStartPts)}},{key:"getVideoRange",value:function(){if(!this._videoRecordRange&&this._isVodPlay){var e=new Date(this._videoSrc.endtime.replace(/-/g,"/")).getTime();this._videoRecordRange={begintime:this._srcStartPts,endtime:e}}return this._videoRecordRange?v.Toolkit.deepMerge({},this._videoRecordRange):null}},{key:"getVideoEl",value:function(){return this.vOpt.videoC}},{key:"getRecordList",value:function(){return this._videoRecordList?v.Toolkit.deepMerge([],this._videoRecordList):null}},{key:"_createPlayer",value:function(){this._videoplayer&&(this._videoplayer.destroy(),this._videoplayer=null),this._firstError=!1,this.isFirstCanPlay=!1,this._videoplayer=new a.default({channelInfo:this._videoSrc,callbacks:this._paramSrc.callbacks,url:this._paramSrc.wsurl,h5msClient:this._paramSrc.h5msClient},this.vOpt.playConfig),this._videoplayer.on("error",this._onflverror.bind(this)),this._videoplayer.on("loading_complete",this._onflvloading_complete.bind(this)),this._videoplayer.on("statistics_info",this._onflvstatistics_info.bind(this)),this._videoplayer.on("firstcanplay",this._onflvfirstcanplay.bind(this)),this._videoplayer.on("pause",this._onflvpause.bind(this)),this._videoplayer.on("play",this._onflvplay.bind(this)),this._videoplayer.on("speedchange",this._onflvspeedchange.bind(this)),this._videoplayer.on("objectinfo",this._onflvobjectinfo.bind(this)),this._videoplayer.on("streamstart",this._onflvstartstream.bind(this)),this._videoplayer.on("queryrecord",this._onflvqueryrecord.bind(this)),this._videoplayer.on("seek",this._onflvrecordseek.bind(this)),this._videoplayer.attachMediaElement(this.vOpt.videoEle),this._videoplayer.load()}},{key:"startVideo",value:function(e,t,i,r){this._videoplayer&&this._videoCloseFunc(),i=i||this.vOpt.wsurl,this.isIdle=!1,this._videoStartPts=0,this._playtimeOffset=0,this._videoRecordRange=null,this._videoRecordList=null;var n="string"==typeof e.devicetype?e.devicetype.toLowerCase():"";return"flv"==n||"hls"==n||"native"==n?(this._hasStartEvent=!1,0<this.vOpt.loadingTimeout&&(this._loadingCheckTimer=window.setTimeout(this._loadingTimeoutCheck.bind(this),1e3*this.vOpt.loadingTimeout))):this._hasStartEvent=!0,"pfsfile"==n&&(e.streamtype="vod"),this._videoSrc=v.Toolkit.deepMerge({},e),this._paramSrc={callbacks:t,wsurl:i,h5msClient:r},e&&"vod"===e.streamtype&&-1!=n.indexOf("pvg")&&this._videoSrc.begintime?(this._isVodPlay=!0,this._videoStartPts=this._srcStartPts=new Date(this._videoSrc.begintime.replace(/-/g,"/")).getTime()):this._isVodPlay=!1,this._hasPlayed=!1,this._createPlayer(),this.setRatio(this.vOpt.ratio),e.title&&(this._videoTitle=e.title),this._setBgImg(!1),this._videoplayer.currentTime||(this.vOpt.loadingInfoDiv&&(this._hasStartEvent?this.vOpt.loadingInfoDiv.innerHTML=y:this.vOpt.loadingInfoDiv.innerHTML=b),this._showOrHideLoading(!0)),this._emitter.emit(g.default.OnVideoStart,this.vOpt.index),!0}},{key:"stopVideo",value:function(){var e=!1;return this.filterObj={bright:50,contrast:50,saturate:50,tone:50,blur:50,gray:50,invert:50,opacity:50,sepia:50},this._videoplayer&&(this._videoplayer.setFilter(this.filterObj),this.stopRTVO(),this.stopPtz3D(),this.stopZoom(),this._videoplayer.destroy(),this._videoplayer=null,this._lastdecodedFrames=0,this._videoWidth=0,this._videoHeight=0,this._fps=0,this._dataRate=0,this._firstError=!1,this._restartTimes=0,this._errorAtTime=0,this._videotitle="",this._videoSrc=null,this._paramSrc=null,this._isVodPlay=!1,this._videoRecordList=null,this._videoStartPts=0,this._videoRecordRange=null,this._srcStartPts=0,this._playtimeOffset=0,this.isFirstCanPlay=!1,this.isPlaying=!1,this.durationT=0,this.currentT=0,this.currentP=0,e=!(this._hasStartEvent=!1)),this._hasPlayed=!1,this._showOrHideLoading(!1),this._setBgImg(!0),this.isVideoPtz=!1,this.isIdle=!0,this._changeVideoCursor(),this.ptzDirection=-1,this.mousewheelTimer&&(clearTimeout(this.mousewheelTimer),this.mousewheelTimer=null),this._clearLoadingCheckTimer(),this._updateDateRate(),this.delWaterMarkById("_showError_"),this.errorBgToggle(!1),this.setRatio(this.vOpt.ratio),e&&this._emitter.emit(g.default.OnVideoClose,this.vOpt.index),!0}},{key:"errorBgToggle",value:function(e){(this._showErroring=e)&&this.vOpt.showerror?this.vOpt.videoC.classList.add(this.vOpt.errorBgClass):this.vOpt.videoC.classList.remove(this.vOpt.errorBgClass)}},{key:"_playOrPause",value:function(){this.isPlaying?this.pause():this.play()}},{key:"setFilter",value:function(e){this._videoplayer&&(this._videoplayer.setFilter(e),this.filterObj=this._videoplayer.getFilter(),this.setZoomFilter())}},{key:"getFilter",value:function(){return this.filterObj}},{key:"singleFramePlay",value:function(){return this._videoplayer&&(this._videoplayer.singleFramePlay(),this.showOrHideBtn("videoPause",!1),this.showOrHideBtn("videoPlay",!0)),!0}},{key:"play",value:function(){return!!this._videoplayer&&this._videoplayer.play()}},{key:"pause",value:function(){return!!this._videoplayer&&this._videoplayer.pause()}},{key:"segmentPlay",value:function(e,t,i){return this._videoplayer&&this._videoplayer.segmentPlay(e,t,i),!0}},{key:"getVideoInfo",value:function(){return this._videoplayer?(0===this.durationT&&(this.durationT=this._videoplayer.duration),{videowidth:this._videoWidth,videoheight:this._videoHeight,durtion:this.durationT}):null}},{key:"getStreamRate",value:function(){return{datarate:this._dataRate,framerate:this._fps}}},{key:"capturePicture",value:function(e,t,i){return this._videoplayer?this._videoplayer.catchPicture(e,t,i):""}},{key:"continuousShooting",value:function(e,t,i,r,n){return!this._videoplayer||this._videoplayer.continuousShooting(e,t,i,r,n)}},{key:"setFocusIndex",value:function(e){this.isFocusScreen!==e&&(this.isFocusScreen=e,this._setBorderStyle(e),this.mouseEvent(e))}},{key:"_showOrHideLoading",value:function(e){this._showLoading=e,this.vOpt.videoLoading&&(this.vOpt.loadingInfoDiv&&(this.vOpt.loadingInfoDiv.style.display=this.vOpt.enableLoadingInfo?"block":"none"),this.vOpt.enableLoadingGif?this.vOpt.videoLoading.style.display=e?"block":"none":this.vOpt.videoLoading.style.display="none")}},{key:"setProgressShowPts",value:function(e){this.vOpt.enableProgressShowPts=e||!1}},{key:"setLoadingFlag",value:function(e,t){this.vOpt.enableLoadingGif=e||!1,this.vOpt.enableLoadingInfo=t||!1,this.vOpt.loadingInfoDiv&&this._showLoading&&(this.vOpt.loadingInfoDiv.style.display=this.vOpt.enableLoadingInfo?"block":"none",this.vOpt.videoLoading.style.display=e?"block":"none")}},{key:"setShowError",value:function(e,t){this.vOpt.showerror=e||!1,this.vOpt.showerrorDetail=t||!1,e&&this._showErroring?this.vOpt.videoC.classList.add(this.vOpt.errorBgClass):this.vOpt.videoC.classList.remove(this.vOpt.errorBgClass),this._showErroring&&this._showErrorOpacity()}},{key:"getIdleOrBusy",value:function(){return!this.isIdle}},{key:"setBorderStyle",value:function(e){this.vOpt.border=e,this._setBorderStyle(this.isFocusScreen)}},{key:"_setBorderStyle",value:function(e){var t=this.vOpt.border,i=this.vOpt.videoC.style;t.borderWidth&&(i.borderWidth=t.borderWidth),t.borderStyle&&!e?i.borderStyle=t.borderStyle:t.focusBorderStyle&&e&&(i.borderStyle=t.focusBorderStyle),t.borderColor&&!e?i.borderColor=t.borderColor:t.focusBorderColor&&e&&(i.borderColor=t.focusBorderColor)}},{key:"setBgImg",value:function(e){return this.vOpt.bgImgClass&&this.vOpt.videoC.classList.remove(this.vOpt.bgImgClass),this.vOpt.bgImgClass=!e||""==e||e&&"string"!=typeof e?null:e,this._setBgImg(this.isIdle),!0}},{key:"setDefBgImg",value:function(e){return!(!e||e&&"string"!=typeof e||(this.vOpt.videoC.classList.remove(this.vOpt.defBgClass),this.vOpt.defBgClass=e,this._setBgImg(this.isIdle),0))}},{key:"setbackgroundColor",value:function(e){this.vOpt.backgroundColor=e,""!=this.vOpt.videoC.style.background&&(this.vOpt.videoC.style.background=this.vOpt.backgroundColor)}},{key:"_setBgImg",value:function(e){(this.vOpt.bgImgClass||this.vOpt.defBgClass)&&(e?(this.vOpt.videoC.style.background="",this.vOpt.bgImgClass?(this.vOpt.videoC.classList.remove(this.vOpt.defBgClass),this.vOpt.videoC.classList.add(this.vOpt.bgImgClass)):this.vOpt.videoC.classList.add(this.vOpt.defBgClass)):(this.vOpt.videoC.style.background=this.vOpt.backgroundColor,this.vOpt.bgImgClass&&this.vOpt.videoC.classList.remove(this.vOpt.bgImgClass),this.vOpt.videoC.classList.remove(this.vOpt.defBgClass)))}},{key:"setMax",value:function(e,t){switch(e){case"big":this.isMaxScreen=!0,this.vOpt.videoC.style.display="inline-block";break;case"hide":this.isMaxScreen=!1,this.vOpt.videoC.style.display="none";break;case"origin":this.isMaxScreen=!1,this.vOpt.videoC.style.display="inline-block"}}},{key:"setPosition",value:function(e,t,i,r){this.resetWaterMarkPos(this.vOpt.width,this.vOpt.height,i,r),this.vOpt.width=i,this.vOpt.height=r,this.vOpt.videoC.style.top=e,this.vOpt.videoC.style.left=t,this.vOpt.videoC.style.width=i,this.vOpt.videoC.style.height=r,this.setRatio(this._videoRatio)}},{key:"setAttributeIndex",value:function(e){this.vOpt.videoC.setAttribute("index",e),this.vOpt.videoEle.setAttribute("index",e),this.vOpt.index=e}},{key:"_addEvent",value:function(){var i=this,e=i.vOpt.videoC,t=i.vOpt.videoEle;p.EventUtil.addHandler(t,"play",function(e){i.isPlaying=!0}),p.EventUtil.addHandler(t,"pause",function(e){i.isPlaying=!1}),p.EventUtil.addHandler(t,"seeking",function(e){i.durationT&&0!==i.durationT&&isFinite(i.durationT)}),p.EventUtil.addHandler(t,"canplay",function(e){i._showOrHideLoading(!1)}),p.EventUtil.addHandler(t,"seeked",function(e){}),p.EventUtil.addHandler(t,"timeupdate",function(e){if(!i.isDragProgress&&i._videoplayer){i.currentT=i._videoplayer.currentTime+i._playtimeOffset,i.updatePorgress();var t=new Date;i.reduceTBefore=Date.parse(t)-Math.floor(1e3*i.currentT),i._updateCurrentTText(),i._isVodPlay&&0<i._videoStartPts&&i._updateHistoryTimeAxis(i.getPlayPts())}}),p.EventUtil.addHandler(e,"click",function(e){i.videoCMouseOverFlag=!1}),p.EventUtil.addHandler(e,"mouseenter",function(e){i.videoCMouseOverFlag=!0,i._emitter.emit(g.default.OnMouseEnter,i.vOpt.index),i.showToolbarAuto(!0),i.mouseEvent(i.isFocusScreen)}),p.EventUtil.addHandler(e,"mouseleave",function(e){i.videoCMouseOverFlag&&(i._emitter.emit(g.default.OnMouseLeave,i.vOpt.index),i.showToolbarAuto(!1),i.showOrHideRightMenu(!1),i.isShowPtzRedArrow(!1,e))}),p.EventUtil.addHandler(e,"mousedown",function(e){i._emitter.emit(g.default.OnMouseDown,i.vOpt.index),0==e.button&&v.Toolkit.isPositiveInteger(i.ptzDirection)&&i.ptzDirection<=19&&i._ptzControlByWin(i.ptzDirection,i.vOpt.windowPtzSpeed,3)}),p.EventUtil.addHandler(e,"mouseup",function(e){i._emitter.emit(g.default.OnMouseUp,i.vOpt.index),v.Toolkit.isPositiveInteger(i.ptzDirection)&&i.ptzDirection<=19&&i._ptzControlByWin(i.ptzDirection,0,4)}),p.EventUtil.addHandler(e,"contextmenu",function(e){i.videoCMouseOverFlag=!1,(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1,i._changeVideoCursor(),i.rightMenuEle&&i.showOrHideRightMenu(!0,e)}),p.EventUtil.addHandler(e,"mousemove",function(e){i.videoCMouseOverFlag=!0,i.isShowPtzRedArrow(!0,e),i._emitter.emit(g.default.OnMouseMove,i.vOpt.index)})}},{key:"formartTime",value:function(e){function t(e){return(e=e.toString())[1]?e:"0"+e}if(!isFinite(e))return"00:00:00";var i=Math.floor(e/60),r=Math.floor(e%60),n=Math.floor(i/60);return i=Math.floor(i%60),t(n)+":"+t(i)+":"+t(r)}},{key:"addEvent",value:function(e,t){this._emitter.on(e,t)}}]),T);function T(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(T.__proto__||Object.getPrototypeOf(T)).call(this));return t.vOpt=v.Toolkit.deepMerge({ele:"npvideo-ele",src:null,callback:null,toolbar:[],rightMenu:[],defBgClass:"h5vp-bg-img",errorBgClass:"h5vp-bg-img-error",bgImgClass:null,backgroundColor:"#000",ratio:"stretch",showerror:!0,clickFunc:function(){}},e),t._emitter=new m.default,t.isMaxScreen=!1,t.isIdle=!0,t.isFocusScreen=!1,t._videoRatio=t.vOpt.ratio,t._showLoading=!1,t._showErroring=!1,t.vOpt.toolbarEleArr=[],t._getOrignWidthHeight(),t._videoplayer=null,t._lastdecodedFrames=0,t._videoWidth=0,t._videoHeight=0,t._fps=0,t._dataRate=0,t._firstError=!1,t._restartTimes=0,t._errorAtTime=0,t._createVideoEle(),t._onstatisticsinfo=null,t._videotitle="",t._videoSrc=null,t._paramSrc=null,t._videoRecordList=null,t._videoRecordRange=null,t._videoStartPts=0,t._srcStartPts=0,t._playtimeOffset=0,t._isVodPlay=!1,t._hasStartEvent=!1,t._loadingCheckTimer=null,t.isFirstCanPlay=!1,t._hasPlayed=!1,t.isPlaying=!1,t.durationT=0,t.currentT=0,t.currentP=0,t.isDragProgress=!1,t.maxProgressWidth=0,t.mousewheelTimer=null,t.videoCMouseOverFlag=!1,t.filterObj={bright:50,contrast:50,saturate:50,tone:50,blur:50,gray:50,invert:50,opacity:50,sepia:50},t}t.default=w},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=u(i(342)),a=u(i(344)),s=u(i(350)),o=u(i(384)),l=u(i(345));function u(e){return e&&e.__esModule?e:{default:e}}var d=(r(c,[{key:"destroy",value:function(){null!=this._player&&(this._player.destroy(),this._player=null),this._shootingCanvas=null,this._captureCanvas=null,this._mediaElement=null}},{key:"on",value:function(e,t){null!=this._player&&this._player.on(e,t)}},{key:"off",value:function(e,t){null!=this._player&&this._player.off(e,t)}},{key:"attachMediaElement",value:function(e){null!=this._player&&(this._player.attachMediaElement(e),this._mediaElement=e,this._captureCanvas=document.createElement("canvas"),this._captureCanvas,this._shootingCanvas=document.createElement("canvas"),this._shootingCanvas)}},{key:"detachMediaElement",value:function(){this._timerstep&&(window.clearInterval(this._timerstep),this._timerstep=null),this._timershooting&&(window.clearInterval(this._timershooting),this._timershooting=null),null!=this._player&&(this._player.detachMediaElement(),this._mediaElement=null)}},{key:"load",value:function(){null!=this._player&&this._player.load()}},{key:"unload",value:function(){this._timerstep&&(window.clearInterval(this._timerstep),this._timerstep=null),null!=this._player&&this._player.unload()}},{key:"play",value:function(){if(this._timerstep&&(window.clearInterval(this._timerstep),this._timerstep=null),null==this._player)return!1;if(this._playspeed!=this._player.playbackRate&&8<this._playspeed){var e=this;window.setTimeout(function(){e._player.playbackRate=e._playspeed},1e3)}return this._player.play()}},{key:"pause",value:function(){return null!=this._player&&this._player.pause()}},{key:"setPlaybackOffset",value:function(e){return!(!this._player||!this._player.setPlaybackOffset||(this._player.setPlaybackOffset(e),0))}},{key:"ptzControl",value:function(e,t){if(null!=this._player&&this._player.ptzControl&&"undefined"!==this._player.ptzControl)return this._player.ptzControl(e,t)}},{key:"ptzLock",value:function(e){if(null!=this._player&&this._player.ptzLock&&"undefined"!==this._player.ptzLock)return this._player.ptzLock(e)}},{key:"ptzControl3D",value:function(e,t,i,r,n){if(null!=this._player&&this._player.ptzControl3D&&"undefined"!==this._player.ptzControl3D)return this._player.ptzControl3D(e,t,i,r,n)}},{key:"queryRecord",value:function(e){if(null!=this._player&&this._player.queryRecord&&"undefined"!==this._player.queryRecord)return this._player.queryRecord(e)}},{key:"catchPicture",value:function(e,t,i){if(this._mediaElement&&this._captureCanvas){e=e||"jpeg";var r=this._mediaElement.videoWidth,n=this._mediaElement.videoHeight,a=parseInt(t||-1),s=parseInt(i||-1);r<a&&(a=r),n<s&&(s=n),0<a&&s<=0?s=Math.ceil(a*n/r):0<s&&a<=0?a=Math.ceil(r*s/n):a<=0&&s<=0&&(a=r,s=n),this._captureCanvas.width=a,this._captureCanvas.height=s,this._captureCanvas.getContext("2d").drawImage(this._mediaElement,0,0,r,n,0,0,a,s);try{return this._captureCanvas.toDataURL("image/"+e)}catch(e){return h.default.e(this.TAG,"catchPicture "+e.name+" "+e.code+" "+e.message),""}}}},{key:"continuousShooting",value:function(e,t,i,r,n){if(this._mediaElement&&this._shootingCanvas&&!this._timershooting){e=e||"jpeg";var a=this._mediaElement.videoWidth,s=this._mediaElement.videoHeight,o=parseInt(r||-1),l=parseInt(n||-1);a<o&&(o=a),s<l&&(l=s),0<o&&l<=0?l=Math.ceil(o*s/a):0<l&&o<=0?o=Math.ceil(a*l/s):o<=0&&l<=0&&(o=a,l=s),this._shootingCanvas.width=o,this._shootingCanvas.height=l,this._shootingCanvas.getContext("2d").drawImage(this._mediaElement,0,0,a,s,0,0,o,l);try{i(0,this._shootingCanvas.toDataURL("image/"+e))}catch(e){return i(-1,"continuousShooting "+e.name+" "+e.code+" "+e.message),h.default.e(this.TAG,"continuousShooting "+e.name+" "+e.code+" "+e.message),!1}if(1<t){this._shootingInfo={playtime:this._mediaElement.currentTime,count:t,index:1,callback:i,type:e};var u=parseInt(500*this._player.frameDuration/this._player.playbackRate);u<5?u=5:50<u&&(u=50),this._timershooting=window.setInterval(this._shootingCheck.bind(this),u)}return!0}}},{key:"_shootingCheck",value:function(){if(!this._mediaElement||!this._player)return window.clearInterval(this._timershooting),void(this._timershooting=null);var e=this._mediaElement.currentTime;if(e-this._shootingInfo.playtime>=this._player.frameDuration){this._shootingInfo.playtime=e,this._shootingCanvas.getContext("2d").drawImage(this._mediaElement,0,0,this._mediaElement.videoWidth,this._mediaElement.videoHeight,0,0,this._shootingCanvas.width,this._shootingCanvas.height);try{this._shootingInfo.callback(this._shootingInfo.index,this._shootingCanvas.toDataURL("image/"+this._shootingInfo.type))}catch(e){this._shootingInfo.callback(-1,"continuousShooting "+e.name+" "+e.code+" "+e.message)}this._shootingInfo.index++}this._shootingInfo.index===this._shootingInfo.count&&(window.clearInterval(this._timershooting),this._timershooting=null)}},{key:"_transformFilterVal",value:function(e){"number"==typeof e.bright?(e.bright<0?e.bright=0:100<e.bright&&(e.bright=100),this.filterObj.bright=e.bright,e.bright=(e.bright<=50?10+9*e.bright/5:100+3*(e.bright-50))+"%"):e.bright="","number"==typeof e.contrast?(e.contrast<0?e.contrast=0:100<e.contrast&&(e.contrast=100),this.filterObj.contrast=e.contrast,e.contrast=(e.contrast<=50?10+9*e.contrast/5:100+18*(e.contrast-50))+"%"):e.contrast="","number"==typeof e.saturate?(e.saturate<0?e.saturate=0:100<e.saturate&&(e.saturate=100),this.filterObj.saturate=e.saturate,e.saturate=(e.saturate<=50?10+9*e.saturate/5:100+18*(e.saturate-50))+"%"):e.saturate="","number"==typeof e.tone?(e.tone<0?e.tone=0:100<e.tone&&(e.tone=100),this.filterObj.tone=e.tone,e.tone=(e.tone<=50?180-3.6*e.tone:540-3.6*e.tone)+"deg"):e.tone="","number"==typeof e.gray?(e.gray<0?e.gray=0:100<e.gray&&(e.gray=100),this.filterObj.gray=e.gray,e.gray=(50<=e.gray?2*(e.gray-50):100-2*e.gray)+"%"):e.gray="","number"==typeof e.invert?(e.invert<0?e.invert=0:100<e.invert&&(e.invert=100),this.filterObj.invert=e.invert,e.invert=(50<=e.invert?2*(e.invert-50):100-2*e.invert)+"%"):e.invert="","number"==typeof e.opacity?(e.opacity<0?e.opacity=0:100<e.opacity&&(e.opacity=100),this.filterObj.opacity=e.opacity,e.opacity=(50<=e.opacity?200-2*e.opacity:2*e.opacity)+"%"):e.opacity="","number"==typeof e.sepia?(e.sepia<0?e.sepia=0:100<e.sepia&&(e.sepia=100),this.filterObj.sepia=e.sepia,e.sepia=(50<=e.sepia?2*(e.sepia-50):100-2*e.sepia)+"%"):e.sepia=""}},{key:"setFilter",value:function(e){var t=Object.assign({},e);this._transformFilterVal(t);var i="";i+=t.bright?"brightness("+t.bright+")":"",i+=t.contrast?"contrast("+t.contrast+")":"",i+=t.saturate?"saturate("+t.saturate+")":"",i+=t.tone?"hue-rotate("+t.tone+")":"",i+=t.gray?"grayscale("+t.gray+")":"",i+=t.invert?"invert("+t.invert+")":"",i+=t.opacity?"opacity("+t.opacity+")":"",i+=t.sepia?"sepia("+t.sepia+")":"",this._mediaElement.style.webkitFilter=i,this._mediaElement.style.filter=i}},{key:"getFilter",value:function(){return this.filterObj}},{key:"singleFramePlay",value:function(){if(this._mediaElement.paused){var e=10*this._player.frameDuration;this._mediaElement.playbackRate=3<e?3:e;try{this._mediaElement.play().catch(function(e){})}catch(e){}this._prePlaytime=this._mediaElement.currentTime,this._timerstep||(this._timerstep=window.setInterval(this._stepPlayCheck.bind(this),20))}else this._mediaElement.pause()}},{key:"_stepPlayCheck",value:function(){if(!this._mediaElement||!this._player)return window.clearInterval(this._timerstep),void(this._timerstep=null);var e=this._mediaElement.currentTime-this._prePlaytime;(e>=this._player.frameDuration||e<=0-this._player.frameDuration)&&(this._mediaElement.pause(),8<this._playspeed?this._mediaElement.playbackRate=8:this._mediaElement.playbackRate=this._playspeed,window.clearInterval(this._timerstep),this._timerstep=null)}},{key:"segmentPlay",value:function(e,t,i){t<=e||t<0||e<0?(this._segmentStart=-1,this._segmentEnd=-1,this._segmentLoop=!1,this._player.off("playtime",this._checkPlayTime.bind(this))):(this._segmentStart=e,this._segmentEnd=t,this._segmentLoop=i,this._player.currentTime=e,this._player.off("playtime",this._checkPlayTime.bind(this)),this._player.on("playtime",this._checkPlayTime.bind(this)))}},{key:"_checkPlayTime",value:function(e){this._segmentStart>=this._segmentEnd||this._segmentStart<0||this._segmentEnd<0?this._player.off("playtime",this._checkPlayTime.bind(this)):e>=this._segmentEnd&&(this._segmentLoop?this._player.currentTime=this._segmentStart:(this._segmentStart=-1,this._segmentEnd=-1,this._player.pause(),this._player.off("playtime",this._checkPlayTime.bind(this))),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.SEGMENTPLAY_COMPLETE))}},{key:"type",get:function(){if(null!=this._player)return this._player.type}},{key:"buffered",get:function(){if(null!=this._player)return this._player.buffered}},{key:"duration",get:function(){return null!=this._player?this._player.duration:0}},{key:"volume",get:function(){if(null!=this._player)return this._player.volume},set:function(e){null!=this._player&&(this._player.volume=e)}},{key:"muted",get:function(){if(null!=this._player)return this._player.muted},set:function(e){null!=this._player&&(this._player.muted=e)}},{key:"currentTime",get:function(){return null!=this._player?this._player.currentTime:0},set:function(e){return!(null==this._player||!isFinite(e)||(0<=this._segmentStart&&0<this._segmentEnd&&(this._segmentStart>e||this._segmentEnd<e)&&(this._segmentStart=-1,this._segmentEnd=-1,this._player.off("playtime",this._checkPlayTime.bind(this)),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.SEGMENTPLAY_CANCEL)),this._player.currentTime=e,0))}},{key:"playbackRate",get:function(){return null!=this._player?this._playspeed:0},set:function(e){try{null!=this._player&&(this._player.playbackRate=e,this._playspeed=this._player.playbackRate)}catch(e){}}},{key:"mediaInfo",get:function(){return null!=this._player?this._player.mediaInfo:{}}},{key:"statisticsInfo",get:function(){return null!=this._player?this._player.statisticsInfo:{}}}]),c);function c(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),this.TAG="videoplayer",this._player=null,e&&e.channelInfo){var i=e.channelInfo.devicetype;"string"==typeof i&&("native"===(i=i.toLowerCase())?this._player=new a.default(e,t):"hls"===i&&(this._player=new o.default(e,t)))}null===this._player&&(this._player=new s.default(e,t)),this._callbacks=e.callbacks,this._mediaSource=e.channelInfo,this._mediaElement=null,this._captureCanvas=null,this._shootingCanvas=null,this._shootingInfo={},this._timershooting=null,this._playspeed=1,this._timerstep=null,this._prePlaytime=0,this._segmentStart=-1,this._segmentEnd=-1,this._segmentLoop=!1,this.filterObj={bright:50,contrast:50,saturate:50,tone:50,blur:50,gray:50,invert:50,opacity:50,sepia:50}}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(343),o=(a=s)&&a.__esModule?a:{default:a};var l=(r(u,null,[{key:"e",value:function(e,t){e&&!u.FORCE_GLOBAL_TAG||(e=u.GLOBAL_TAG);var i="["+e+"] > "+t;u.ENABLE_CALLBACK&&u.emitter.emit("log","error",i),u.ENABLE_ERROR&&(console.error?console.error(i):console.warn?console.warn(i):console.log(i))}},{key:"i",value:function(e,t){e&&!u.FORCE_GLOBAL_TAG||(e=u.GLOBAL_TAG);var i="["+e+"] > "+t;u.ENABLE_CALLBACK&&u.emitter.emit("log","info",i),u.ENABLE_INFO&&(console.info?console.info(i):console.log(i))}},{key:"w",value:function(e,t){e&&!u.FORCE_GLOBAL_TAG||(e=u.GLOBAL_TAG);var i="["+e+"] > "+t;u.ENABLE_CALLBACK&&u.emitter.emit("log","warn",i),u.ENABLE_WARN&&(console.warn?console.warn(i):console.log(i))}},{key:"d",value:function(e,t){e&&!u.FORCE_GLOBAL_TAG||(e=u.GLOBAL_TAG);var i="["+e+"] > "+t;u.ENABLE_CALLBACK&&u.emitter.emit("log","debug",i),u.ENABLE_DEBUG&&(console.debug?console.debug(i):console.log(i))}},{key:"v",value:function(e,t){e&&!u.FORCE_GLOBAL_TAG||(e=u.GLOBAL_TAG);var i="["+e+"] > "+t;u.ENABLE_CALLBACK&&u.emitter.emit("log","verbose",i),u.ENABLE_VERBOSE&&console.log(i)}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u)}l.GLOBAL_TAG="flv.js",l.FORCE_GLOBAL_TAG=!1,l.ENABLE_ERROR=!0,l.ENABLE_INFO=!0,l.ENABLE_WARN=!0,l.ENABLE_DEBUG=!0,l.ENABLE_VERBOSE=!0,l.ENABLE_CALLBACK=!1,l.emitter=new o.default,t.default=l},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function h(e){return void 0===e}((e.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,i,r,n,a,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var o=new Error('Uncaught, unspecified "error" event. ('+t+")");throw o.context=t,o}if(h(i=this._events[e]))return!1;if(l(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),i.apply(this,n)}else if(u(i))for(n=Array.prototype.slice.call(arguments,1),r=(s=i.slice()).length,a=0;a<r;a++)s[a].apply(this,n);return!0},r.prototype.on=r.prototype.addListener=function(e,t){var i;if(!l(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,l(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&(i=h(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.once=function(e,t){if(!l(t))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var i,r,n,a;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=(i=this._events[e]).length,r=-1,i===t||l(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(u(i)){for(a=n;0<a--;)if(i[a]===t||i[a].listener&&i[a].listener===t){r=a;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(l(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?l(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(l(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=d(i(343)),o=d(i(345)),l=i(346),u=i(337),h=i(348);function d(e){return e&&e.__esModule?e:{default:e}}var c=(n(f,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var i=this;e===o.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(o.default.MEDIA_INFO,i.mediaInfo)}):e===o.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(o.default.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if((this._mediaElement=e).addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("seeked",this.e.onvSeeked),e.addEventListener("error",this.e.onvError),e.addEventListener("ratechange",this.e.onvRateChange),e.addEventListener("timeupdate",this.e.onvTimeUpdate),e.addEventListener("ended",this.e.onvEnded),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("seeked",this.e.onvSeeked),this._mediaElement.removeEventListener("error",this.e.onvError),this._mediaElement.removeEventListener("ratechange",this.e.onvRateChange),this._mediaElement.removeEventListener("timeupdate",this.e.onvTimeUpdate),this._mediaElement.removeEventListener("ended",this.e.onvEnded),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new h.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.channelInfo.url,0<this._mediaElement.readyState&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load();try{this._mediaElement.muted=!0,this._mediaElement.autoplay=!0,this._mediaElement.play().catch(function(e){})}catch(e){}this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){this._emitter.emit(o.default.VIDEOPLAY),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.VIDEOPLAY);try{this._mediaElement.play().catch(function(e){})}catch(e){}return!0}},{key:"pause",value:function(){return this._emitter.emit(o.default.VIDEOPAUSE),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.VIDEOPAUSE),this._mediaElement.pause(),!0}},{key:"_onvCanPlay",value:function(e){!1===this._receivedCanPlay&&(this._emitter.emit(o.default.FIRST_CANPLAY),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.FIRST_CANPLAY)),this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvTimeUpdate",value:function(e){this._emitter.emit(o.default.PLAYTIME,this._mediaElement.currentTime),this._callbacks&&"function"==typeof this._callbacks.onplaytime&&this._mediaElement&&this._callbacks.onplaytime(this._mediaElement.currentTime)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeked",value:function(e){this._emitter.emit(o.default.VIDEOSEEK,{currentTime:this._mediaElement.currentTime}),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.VIDEOSEEK,{currentTime:this._mediaElement.currentTime})}},{key:"_onvRateChange",value:function(e){this._emitter.emit(o.default.SPEEDCHANGE,{playbackRate:this._mediaElement.playbackRate}),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.SPEEDCHANGE,{playbackRate:this._mediaElement.playbackRate})}},{key:"_onvError",value:function(e){var t=this._mediaElement.error.code?this._mediaElement.error.code:e.code;this._emitter.emit(o.default.ERROR,l.ErrorTypes.MEDIA_ERROR,l.ErrorDetails.MEDIA_VIDEO_ERROR,{code:t}),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onerror(l.ErrorTypes.MEDIA_ERROR,l.ErrorDetails.MEDIA_VIDEO_ERROR,{code:t})}},{key:"_onvEnded",value:function(e){this._emitter.emit(o.default.PLAY_COMPLETE),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.PLAY_COMPLETE)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){if(this._mediaElement){if(this._mediaElement.currentTime=e,this._mediaElement.paused)try{this._mediaElement.play().catch(function(e){})}catch(e){}}else this._pendingSeekTime=e}},{key:"playbackRate",get:function(){return this._mediaElement?this._mediaElement.playbackRate:0},set:function(e){if(this._mediaElement)return this._mediaElement.playbackRate=e}},{key:"mediaInfo",get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.videoWidth=this._mediaElement.videoWidth,e.videoHeight=this._mediaElement.videoHeight)),e}},{key:"frameDuration",get:function(){return this._frameDuration}},{key:"statisticsInfo",get:function(){var e={playerType:this._type,url:this._mediaDataSource.channelInfo.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();i=n.totalVideoFrames,r=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e}}]),f);function f(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new s.default,this._config=(0,u.createDefaultConfig)(),"object"===(void 0===t?"undefined":r(t))&&Object.assign(this._config,t),this._callbacks=null,"object"===r(e.callbacks)&&(this._callbacks=e.callbacks),e.channelInfo.devicetype&&"native"!==e.channelInfo.devicetype.toLowerCase())throw new h.InvalidArgumentException("NativePlayer does't support stream input!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvSeeked:this._onvSeeked.bind(this),onvError:this._onvError.bind(this),onvTimeUpdate:this._onvTimeUpdate.bind(this),onvEnded:this._onvEnded.bind(this),onvRateChange:this._onvRateChange.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null,this._receivedCanPlay=!1,this._frameDuration=.04}t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",COMMAND_RESPONSE:"command_response",COMMAND_NOTIFY:"command_notify",STARTSTREAM:"streamstart",FIRST_CANPLAY:"firstcanplay",LOADED_METADATA:"loadedmetadata",PTZCONTROL:"ptzcontrol",SPEEDCHANGE:"speedchange",VIDEOPAUSE:"pause",VIDEOPLAY:"play",VIDEOSEEK:"seek",PLAYTIME:"playtime",SEGMENTPLAY_COMPLETE:"segmentplay_complete",SEGMENTPLAY_CANCEL:"segmentplay_cancel",OBJECTINFO:"objectinfo",PLAY_COMPLETE:"play_complete",QUERYRECORD:"queryrecord"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorDetails=t.ErrorTypes=void 0;var r,n=i(347),a=i(349),s=(r=a)&&r.__esModule?r:{default:r};t.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",STREAM_ERROR:"StreamError",OTHER_ERROR:"OtherError"},t.ErrorDetails={NETWORK_EXCEPTION:n.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:n.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:n.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:n.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_VIDEO_ERROR:"MediaVideoError",MEDIA_FORMAT_ERROR:s.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:s.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:s.default.CODEC_UNSUPPORTED,STARTSTREAM_ERROR:"StartStreamError",READFILEERROR_ERROR:"ReadFileError"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLoader=t.LoaderErrors=t.LoaderStatus=void 0;var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=i(348);var s=t.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};t.LoaderErrors={OK:"OK",EXCEPTION:"Exception",UNSUPPORT:"Unsupport",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",CONNECTING_ERROR:"ConnectingError",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},t.BaseLoader=(r(o,[{key:"destroy",value:function(){this._status=s.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===s.kConnecting||this._status===s.kBuffering}},{key:"open",value:function(e,t){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),o);function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._type=e||"undefined",this._status=s.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=t.RuntimeException=(r(u,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),u);function u(e){o(this,u),this._message=e}t.IllegalStateException=(s(h,l),r(h,[{key:"name",get:function(){return"IllegalStateException"}}]),h);function h(e){return o(this,h),a(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,e))}t.InvalidArgumentException=(s(d,l),r(d,[{key:"name",get:function(){return"InvalidArgumentException"}}]),d);function d(e){return o(this,d),a(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e))}t.NotImplementedException=(s(c,l),r(c,[{key:"name",get:function(){return"NotImplementedException"}}]),c);function c(e){return o(this,c),a(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=m(i(343)),g=m(i(342)),o=m(i(351)),l=m(i(345)),u=m(i(352)),h=m(i(374)),d=m(i(380)),c=m(i(381)),f=i(346),p=i(337),v=i(348);m(i(382));function m(e){return e&&e.__esModule?e:{default:e}}var _=(n(y,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null,this._h5msClient=null,this._duration=0}},{key:"on",value:function(e,t){var i=this;e===l.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){i._emitter.emit(l.default.MEDIA_INFO,i.mediaInfo)}):e===l.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){i._emitter.emit(l.default.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){var t=this;if(this._mediaElement=e,this._mediaElement.load(),e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),e.addEventListener("seeked",this.e.onvSeeked),e.addEventListener("error",this.e.onvError),e.addEventListener("ratechange",this.e.onvRateChange),e.addEventListener("timeupdate",this.e.onvTimeUpdate),this._msectl=new d.default(this._config),this._msectl.on(c.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(c.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(c.default.SOURCE_OPEN,function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())}),this._msectl.on(c.default.ERROR,function(e){t._emitter.emit(l.default.ERROR,f.ErrorTypes.MEDIA_ERROR,f.ErrorDetails.MEDIA_MSE_ERROR,e),t._callbacks&&"function"==typeof t._callbacks.onerror&&t._callbacks.onerror(f.ErrorTypes.MEDIA_ERROR,f.ErrorDetails.MEDIA_MSE_ERROR,e)}),this._msectl.on(c.default.SOURCE_SEEK,function(e){t._mediaElement&&(t._requestSetTime=!0,t._mediaElement.currentTime=e,t._edgeseeking=!1)}),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement.removeEventListener("seeked",this.e.onvSeeked),this._mediaElement.removeEventListener("error",this.e.onvError),this._mediaElement.removeEventListener("ratechange",this.e.onvRateChange),this._mediaElement.removeEventListener("timeupdate",this.e.onvTimeUpdate),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var i=this;if(this._h5msClient){var r=this._mediaDataSource.channelInfo;this._h5msClient.startStream(r,function(e){if(console.log(e),e&&0===e.param.error&&e.msg&&e.msg.playUrl&&e.msg.streamId){if(i._mediaDataSource.url=e.msg.playUrl,i._mediaDataSource.streamId=e.msg.streamId,i._mediaDataSource.mediaType="h5msflv",i._mediaType="h5msflv",!i._mediaDataSource.isLive&&r.begintime&&r.endtime&&(i._mediaDataSource.duration=new Date(r.endtime.replace(/-/g,"/")).getTime()-new Date(r.begintime.replace(/-/g,"/")).getTime(),i._h5msClient.setSpeed(i._mediaDataSource.streamId,1)),e.msg.streamInfo){console.log(e.msg.streamInfo);var t=JSON.parse(e.msg.streamInfo);(t=t&&JSON.parse(t.info))&&(i._frameDuration=t.frameRate/1e3,i._mediaDataSource.duration=t.times)}i._internalLoad()}e&&-1===e.param.error&&(e.param.error=-105e3),i._onStartStream(e)})}else this._internalLoad()}},{key:"_internalLoad",value:function(){var r=this;if(!this._mediaElement)throw new v.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new v.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad)if(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened)this._hasPendingLoad=!0;else{0<this._mediaElement.readyState&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new u.default(this._mediaDataSource,this._config),this._transmuxer.on(h.default.COMMAND_RESPONSE,function(e){r._wsCommandResponse(e)}),this._transmuxer.on(h.default.INIT_SEGMENT,function(e,t){r._msectl.appendInitSegment(t)}),this._transmuxer.on(h.default.MEDIA_SEGMENT,function(e,t){if(r._msectl.appendMediaSegment(t),r._config.lazyLoad&&!r._mediaDataSource.isLive&&"flv"===r._mediaType){var i=r._mediaElement.currentTime;t.info.endDts>=1e3*(i+r._config.lazyLoadMaxDuration)&&null==r._progressChecker&&(g.default.v(r.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),r._suspendTransmuxer())}}),this._transmuxer.on(h.default.LOADING_COMPLETE,function(){"flv"!=r._mediaType?r._emitter.emit(l.default.ERROR,f.ErrorTypes.NETWORK_ERROR,"WebsocketClosed",{error:-1}):(r._msectl.endOfStream(),r._emitter.emit(l.default.LOADING_COMPLETE))}),this._transmuxer.on(h.default.IO_ERROR,function(e,t){r._emitter.emit(l.default.ERROR,f.ErrorTypes.NETWORK_ERROR,e,t),r._callbacks&&"function"==typeof r._callbacks.onerror&&r._callbacks.onerror(f.ErrorTypes.NETWORK_ERROR,e,t)}),this._transmuxer.on(h.default.RECOVERED_EARLY_EOF,function(){r._emitter.emit(l.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(h.default.DEMUX_ERROR,function(e,t){r._emitter.emit(l.default.ERROR,f.ErrorTypes.MEDIA_ERROR,e,{code:-1,msg:t})}),this._transmuxer.on(h.default.MEDIA_INFO,function(e){"number"==typeof(r._mediaInfo=e).fps&&0!=e.fps&&(r._frameDuration=1/e.fps),r._emitter.emit(l.default.MEDIA_INFO,Object.assign({},e))}),this._transmuxer.on(h.default.METADATA_ARRIVED,function(e){r._emitter.emit(l.default.METADATA_ARRIVED,e)}),this._transmuxer.on(h.default.SCRIPTDATA_ARRIVED,function(e){r._emitter.emit(l.default.SCRIPTDATA_ARRIVED,e)}),this._transmuxer.on(h.default.STATISTICS_INFO,function(e){r._statisticsInfo=r._fillStatisticsInfo(e),r._emitter.emit(l.default.STATISTICS_INFO,Object.assign({},r._statisticsInfo))}),this._transmuxer.on(h.default.RECOMMEND_SEEKPOINT,function(e){r._mediaElement&&!r._config.accurateSeek&&(r._requestSetTime=!0,r._mediaElement.currentTime=e/1e3)}),this._transmuxer.open();try{this._mediaElement.muted=!0,this._mediaElement.autoplay=!0,this._mediaElement.play().catch(function(e){}),this._emitter.emit(l.default.VIDEOPLAY)}catch(e){}}}},{key:"unload",value:function(){if(this._mediaElement){this._mediaElement.playbackRate=this._mediaElement.defaultPlaybackRate;try{this._mediaElement.pause(),this._mediaElement.src="",this._mediaElement.removeAttribute("src")}catch(e){}}this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null),this._h5msClient&&(this._h5msClient=null)}},{key:"play",value:function(){if(this._mediaDataSource.isLive)return!1;this._emitter.emit(l.default.VIDEOPLAY),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.VIDEOPLAY);try{this._mediaElement.play().catch(function(e){})}catch(e){}return!0}},{key:"pause",value:function(){return!this._mediaDataSource.isLive&&(this._emitter.emit(l.default.VIDEOPAUSE),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.VIDEOPAUSE),this._mediaElement.pause(),!0)}},{key:"setPlaybackOffset",value:function(e){this._playbackStreamOffset=e}},{key:"ptzControl",value:function(e,t){return!!(this._mediaElement&&this._transmuxer&&this._mediaDataSource.isLive)&&("fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"PtzControl",param:{cmd:parseInt(e),value:parseInt(t)}}):"h5msflv"===this._mediaType&&this._h5msClient.ptzControl(this._mediaDataSource.streamId,parseInt(e),parseInt(t)),!0)}},{key:"ptzLock",value:function(e){return!!(this._mediaElement&&this._transmuxer&&this._mediaDataSource.isLive)&&("fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"PtzLock",param:{value:parseInt(e)}}):"h5msflv"===this._mediaType&&this._h5msClient.ptzLock(this._mediaDataSource.streamId,parseInt(e)),!0)}},{key:"ptzControl3D",value:function(e,t,i,r,n){return!!(this._mediaElement&&this._transmuxer&&this._mediaDataSource.isLive)&&("fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"PtzControl3D",param:{direct:parseInt(e),x:t,y:i,w:r,h:n}}):"h5msflv"===this._mediaType&&this._h5msClient.ptzControl3D(this._mediaDataSource.streamId,parseInt(e),t,i,r,n),!0)}},{key:"queryRecord",value:function(e){!this._mediaDataSource.isLive&&this._transmuxer&&("fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"QueryRecord",param:e}):"h5msflv"===this._mediaType&&this._h5msClient.queryRecord(e,this._onQueryRecord.bind(this)))}},{key:"_onStartStream",value:function(e){this._emitter.emit(l.default.STARTSTREAM,e.param.error),0!==e.param.error?(this._emitter.emit(l.default.ERROR,f.ErrorTypes.STREAM_ERROR,f.ErrorDetails.STARTSTREAM_ERROR,Object.assign({},e.param,e.rederved)),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onerror(f.ErrorTypes.STREAM_ERROR,f.ErrorDetails.STARTSTREAM_ERROR,Object.assign({},e.param,e.rederved))):this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.STARTSTREAM)}},{key:"_onPtzControl",value:function(e){this._emitter.emit(l.default.PTZCONTROL,Object.assign({},e.param,e.rederved)),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.PTZCONTROL,Object.assign({},e.param,e.rederved))}},{key:"_onSetSpeed",value:function(e){this._emitter.emit(l.default.SPEEDCHANGE,Object.assign({playbackRate:this._mediaElement.playbackRate},e.param,e.rederved)),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.SPEEDCHANGE,Object.assign({playbackRate:this._mediaElement.playbackRate},e.param,e.rederved))}},{key:"_onSeek",value:function(e){if(this._loadingComplete&&(this._loadingComplete=!1),0===e.param.error){var t=(e.param.value-"0")/1e3;"fmp4"===this._mediaType?this._msectl.seek(t):"h5msflv"===this._mediaType&&(this._msectl.seek(t),this._transmuxer.seek(e.param.value-"0")),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t)}else this._emitter.emit(l.default.VIDEOSEEK,{error:e.param.error}),this._edgeseeking=!1,g.default.e(this.TAG,"_wsCommandResponse Seek("+e.param.value/1e3+") "+e.param.error+" ")}},{key:"_onQueryRecord",value:function(e){this._emitter.emit(l.default.QUERYRECORD,Object.assign({},e.param||e,e.rederved))}},{key:"_onPause",value:function(e){g.default.v(this.TAG,"_wsCommandResponse Pause "+e.param.error+" ")}},{key:"_wsCommandResponse",value:function(e){var t=JSON.parse(e);if(t&&t.type)if("response"===t.type)switch(t.name){case"StartStream":this._onStartStream(t);break;case"PtzControl":case"PtzControl3D":this._onPtzControl(t);break;case"SetSpeed":this._onSetSpeed(t);break;case"Seek":this._onSeek(t);break;case"Pause":this._onPause(t);break;case"QueryRecord":this._onQueryRecord(t)}else"notify"===t.type?"VodEnd"==t.name?(this._loadingComplete=!0,this._emitter.emit(l.default.LOADING_COMPLETE)):"ReadFileError"==t.name?(this._emitter.emit(l.default.ERROR,f.ErrorTypes.STREAM_ERROR,f.ErrorDetails.READFILEERROR_ERROR,Object.assign({},t.param,t.rederved)),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onerror(f.ErrorTypes.STREAM_ERROR,f.ErrorDetails.READFILEERROR_ERROR,Object.assign({},t.param,t.rederved))):"frameduration"==t.name?this._frameDuration=t.param/1e3:(this._emitter.emit(l.default.COMMAND_NOTIFY,t.name,t.name,Object.assign({},t.param,t.rederved)),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onnotify(t.name,Object.assign({},t.param,t.rederved))):"objectinfo"===t.type&&this._emitter.emit(l.default.OBJECTINFO,t);else g.default.e(this.TAG,"_wsCommandResponse "+e+" ")}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();i=n.totalVideoFrames,r=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e}},{key:"_onmseUpdateEnd",value:function(){if(!(!this._config.lazyLoad||this._config.autoSpeedMaxDurationForLive<=0||this._progressChecker||this._loadingComplete)){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,i=0,r=0,n=!1,a=0;a<e.length;a++){var s=e.start(a),o=e.end(a);if(s<=t&&t<o){i=s,r=o,n=!0;break}}if(null===this._currentRange)this._currentRange={},this._currentRange.start=i,this._currentRange.end=r;else if(this._currentRange.end!==r||this._edgeseeking)n||this._edgeseeking||"flv"==this._mediaType||1<=e.length&&(i=e.start(e.length-1),r=e.end(e.length-1),t=this._mediaElement.currentTime=i,g.default.w(this.TAG,"_onmseUpdateEnd bufferedcannotfind seek "+t+" to "+i));else if(r-.5<=t){for(var l=0,u=0,h=0,d=0;d<e.length;d++){var c=e.start(d),f=e.end(d);if(t<c){u=c,h=f,l=1,g.default.w(this.TAG,"_onmseUpdateEnd fount bufferedchange seek "+t+" to "+c);break}c!=i&&(u=c,u=f,l=2,g.default.w(this.TAG,"_onmseUpdateEnd back bufferedchange seek "+t+" to "+c))}0!=l&&"flv"!=this._mediaType&&(i=u,r=h,t=this._mediaElement.currentTime=i)}this._currentRange.start=i,this._currentRange.end=r;var p=!this._mediaDataSource.isLive&&r>=t+this._config.lazyLoadMaxDuration,v=this._mediaDataSource.isLive&&0<this._config.autoSpeedMaxDurationForLive&&r>=t+this._config.autoSpeedMaxDurationForLive;if(!p&&!v||this._mediaElement.seeking||this._edgeseeking||(this._suspendTransmuxer(),g.default.v(this.TAG,"Maximum buffering duration exceeded, suspend task")),v&&r>=t+this._config.autoSeekDurationForLive&&"flv"!=this._mediaType){g.default.v(this.TAG,"_onmseUpdateEnd buffered.length "+e.length+" "+i+" to "+r);var m=r-this._config.autoSpeedMaxDurationForLive;this._mediaElement.currentTime=m,g.default.v(this.TAG,"_onmseUpdateEnd seek "+t+" to "+m)}}}},{key:"_onmseBufferFull",value:function(){g.default.v(this.TAG,"MSE SourceBuffer is full, suspend task"),null!=this._progressChecker||this._mediaElement.seeking||this._edgeseeking||this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._mediaDataSource.isLive?this._mediaElement.playbackRate="fmp4"===this._mediaType?1.75:1.25:"flv"===this._mediaType?this._transmuxer.pause():"h5msflv"===this._mediaType?this._h5msClient.pause(this._mediaDataSource.streamId,!0,this._onPause.bind(this)):this._transmuxer.sendcmd({type:"command",name:"Pause",param:{value:1}}),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),500)))}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,i=!0,r=0,n=0;n<t.length;n++){var a=t.start(n),s=t.end(n);if(a<=e&&e<s){i=!!(!this._mediaDataSource.isLive&&e>=s-this._config.lazyLoadRecoverDuration||this._mediaDataSource.isLive&&e>=s-this._config.autoSpeedMinDurationForLive),r=s;break}}i||this._mediaElement.seeking||this._edgeseeking?(window.clearInterval(this._progressChecker),this._progressChecker=null,i&&(g.default.v(this.TAG,"Continue loading from paused position"),this._mediaDataSource.isLive?this._mediaElement.playbackRate=1:"flv"===this._mediaType?this._transmuxer.resume():"h5msflv"===this._mediaType?this._h5msClient.pause(this._mediaDataSource.streamId,!1,this._onPause.bind(this)):this._transmuxer.sendcmd({type:"command",name:"Pause",param:{value:0}}))):(this._mediaDataSource.isLive&&r>=e+this._config.autoSeekDurationForLive&&"flv"!=this._mediaType&&(this._mediaElement.currentTime=r-this._config.autoSpeedMaxDurationForLive,g.default.v(this.TAG,"_checkProgressAndResume reset currentTime = "+this._mediaElement.currentTime)),this._mediaDataSource.isLive&&(this._mediaElement.playbackRate="fmp4"===this._mediaType?1.75:1.25))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r<=e&&e<n)return!0}return!1}},{key:"_internalSeek",value:function(e){if(!(e<0||isFinite(this._mediaElement.duration)&&e>this._mediaElement.duration)){this._seektime=e;var t=this._isTimepointBuffered(e),i=!1,r=0;if(e<1&&0<this._mediaElement.buffered.length){var n=this._mediaElement.buffered.start(0);(n<1&&e<n||o.default.safari)&&(i=!0,r=o.default.safari?.1:n)}if(i)this._requestSetTime=!0,this._mediaElement.currentTime=r;else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e,g.default.v(this.TAG,"_internalSeek directSeek "+e);null!=this._progressChecker&&this._checkProgressAndResume()}else this._edgeseeking=!0,this._edgeseeking,null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),console.log("_msectl seek "+e),"fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"Seek",param:{value:parseInt(1e3*(e+this._playbackStreamOffset))}}):"h5msflv"===this._mediaType?(this._h5msClient.seek(this._mediaDataSource.streamId,parseInt(1e3*(e+this._playbackStreamOffset)),this._onSeek.bind(this)),this._h5msClient.pause(this._mediaDataSource.streamId,!1)):(this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e));"fmp4"==this._mediaType&&window.setTimeout(this._checkSeekingTimeout.bind(this),5e3)}}},{key:"_checkSeekingTimeout",value:function(){this._edgeseeking&&(this._edgeseeking=!1)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),g.default.v(this.TAG,"_checkAndApplyUnbufferedSeekpoint  msestreamseek "+e),"fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"Seek",param:{value:parseInt(1e3*(e+this._playbackStreamOffset))}}):"h5msflv"===this._mediaType?this._h5msClient.seek(this._mediaDataSource.streamId,parseInt(1e3*(e+this._playbackStreamOffset)),this._onSeek.bind(this)):(this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){if(!this._loadingComplete){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var i=t.buffered;0<i.length&&t.currentTime<i.start(0)&&(g.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+i.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=i.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,i=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&0<i.length){var r=i.start(0);if(r<1&&t<r||o.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=o.default.safari?.1:r)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=n&&(this._requestSetTime=!0,this._mediaElement.currentTime=n.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._mediaDataSource.isLive||(this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50))}}},{key:"_onvTimeUpdate",value:function(e){null!=this._progressChecker&&this._checkProgressAndResume(),this._emitter.emit(l.default.PLAYTIME,this._mediaElement.currentTime),this._callbacks&&"function"==typeof this._callbacks.onplaytime&&this._mediaElement&&this._callbacks.onplaytime(this._mediaElement.currentTime)}},{key:"_onvCanPlay",value:function(e){!1===this._receivedCanPlay&&(this._emitter.emit(l.default.FIRST_CANPLAY),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.FIRST_CANPLAY)),this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"_onvSeeked",value:function(e){this._mediaDataSource.isLive||("fmp4"!=this._mediaType&&(this._edgeseeking=!1),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(l.default.VIDEOSEEK,{error:0,currentTime:this._mediaElement.currentTime}),this._emitter.emit(l.default.VIDEOSEEK,{error:0,currentTime:this._mediaElement.currentTime}))}},{key:"_onvError",value:function(e){var t=this._mediaElement.error.code?this._mediaElement.error.code:e.code;this._emitter.emit(l.default.ERROR,f.ErrorTypes.MEDIA_ERROR,f.ErrorDetails.MEDIA_VIDEO_ERROR,{code:t}),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onerror(f.ErrorTypes.MEDIA_ERROR,f.ErrorDetails.MEDIA_VIDEO_ERROR,{code:t})}},{key:"_onvRateChange",value:function(e){}},{key:"_setStreamRate",value:function(e){if(!this._mediaDataSource.isLive&&this._transmuxer){var t=0;t=e<=.25?-1:e<=.5?0:e<=1?1:e<=2?2:e<=4?3:4,this._transmuxer&&"fmp4"===this._mediaType?this._transmuxer.sendcmd({type:"command",name:"SetSpeed",param:{value:t}}):this._h5msClient&&"h5msflv"===this._mediaType&&this._h5msClient.setSpeed(this._mediaDataSource.streamId,t,this._onSetSpeed.bind(this))}}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._h5msClient&&!isFinite(this._mediaElement.duration)&&isFinite(this._duration)&&0<this._duration?this._duration:(this._duration=this._mediaElement.duration,this._mediaElement.duration)}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?isFinite(this._duration)?this._mediaElement.currentTime>this._duration?this._duration:2==this._mediaElement.readyState&&(this._duration-this._mediaElement.currentTime<3||this._loadingComplete)&&!this._mediaElement.paused?this._duration:this._edgeseeking?this._seektime:this._mediaElement.currentTime:this._mediaElement.currentTime:0},set:function(e){this._mediaDataSource.isLive||(this._mediaElement&&this._receivedCanPlay?(this._beforSeekTime=this._mediaElement.currentTime,this._internalSeek(e),this.play()):this._pendingSeekTime=e)}},{key:"playbackRate",get:function(){return this._mediaElement?this._mediaDataSource.isLive?1:this._mediaElement.playbackRate:0},set:function(e){if(this._mediaElement)return this._mediaDataSource.isLive?void 0:(this._setStreamRate(e),this._mediaElement.playbackRate=16<e?16:e)}},{key:"mediaInfo",get:function(){return this._mediaElement&&(null==this._mediaInfo&&(this._mediaInfo={}),this._mediaInfo.duration=this._duration,this._mediaInfo.videoWidth=this._mediaElement.videoWidth,this._mediaInfo.videoHeight=this._mediaElement.videoHeight),Object.assign({},this._mediaInfo)}},{key:"frameDuration",get:function(){return this._frameDuration}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),y);function y(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new s.default,this._mediaType=null,this._mediaDataSource=e,this._callbacks=null,"object"===r(e.callbacks)&&(this._callbacks=e.callbacks),this._config=(0,p.createDefaultConfig)(),"object"===(void 0===t?"undefined":r(t))&&Object.assign(this._config,t),e.channelInfo&&"live"===e.channelInfo.streamtype?(this._mediaDataSource.isLive=!0,this._config.isLive=!0):(this._mediaDataSource.channelInfo.streamtype="vod",this._mediaDataSource.isLive=!1,this._config.isLive=!1),this._h5msClient=null;var i=e.channelInfo;i&&i.devicetype&&"flv"===i.devicetype.toLowerCase()?(Object.assign(this._mediaDataSource,e.channelInfo),this._mediaDataSource.mediaType="flv",this._mediaType="flv"):!e.h5msClient||i.devicetype&&"pfsfile"===i.devicetype.toLowerCase()&&"npfs"!=i.url.substring(0,4).toLowerCase()?(this._mediaDataSource.mediaType="fmp4",this._mediaType="fmp4"):(this._h5msClient=e.h5msClient,t||(this._config.autoSpeedMaxDurationForLive=4,this._config.autoSpeedMinDurationForLive=2,this._config.autoSeekDurationForLive=4)),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this),onvError:this._onvError.bind(this),onvSeeked:this._onvSeeked.bind(this),onvRateChange:this._onvRateChange.bind(this),onvTimeUpdate:this._onvTimeUpdate.bind(this)},window.performance&&window.performance.now?this._now=window.performance.now.bind(window.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._beforSeekTime=-1,this._playbackStreamOffset=0,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null,this._chromeNeedIDRFix=o.default.chrome&&(o.default.version.major<50||50===o.default.version.major&&o.default.version.build<2661),this._alwaysSeekKeyframe=!(!(this._chromeNeedIDRFix||o.default.msedge||o.default.msie)||"flv"!==this._mediaType),this._checkseeking=!!(this._chromeNeedIDRFix||o.default.msedge||o.default.msie),this._alwaysSeekKeyframe?this._config.accurateSeek=!1:this._config.accurateSeek=!0,this._mediaDataSource.channelInfo.fixiframe=!!this._chromeNeedIDRFix,this._currentRange=null,this._duration=0,this._edgeseeking=!1,this._seektime=0,this._loadingComplete=!1,this._frameDuration=.04}t.default=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0<=e.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],r={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},n={};if(r.browser){n[r.browser]=!0;var a=r.majorVersion.split(".");n.version={major:parseInt(r.majorVersion,10),string:r.version},1<a.length&&(n.version.minor=parseInt(a[1],10)),2<a.length&&(n.version.build=parseInt(a[2],10))}if(r.platform&&(n[r.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),n.rv||n.iemobile){n.rv&&delete n.rv;r.browser="msie",n.msie=!0}if(n.edge){delete n.edge;r.browser="msedge",n.msedge=!0}if(n.opr){r.browser="opera",n.opera=!0}if(n.safari&&n.android){r.browser="android",n.android=!0}for(var s in n.name=r.browser,n.platform=r.platform,o)o.hasOwnProperty(s)&&delete o[s];Object.assign(o,n)}(),t.default=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=a(s(343)),l=a(s(342)),u=a(s(353)),h=a(s(354)),d=a(s(374)),n=a(s(355));function a(e){return e&&e.__esModule?e:{default:e}}var c=(i(f,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),u.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"sendcmd",value:function(e){this._worker?this._worker.postMessage({cmd:"sendcmd",param:e}):this._controller.sendcmd(e)}},{key:"seek",value:function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onCommandResponse",value:function(e){var t=this;this._emitter&&Promise.resolve().then(function(){t._emitter.emit(d.default.COMMAND_RESPONSE,e)})}},{key:"_onInitSegment",value:function(e,t){var i=this;this._emitter&&Promise.resolve().then(function(){i._emitter.emit(d.default.INIT_SEGMENT,e,t)})}},{key:"_onMediaSegment",value:function(e,t){var i=this;this._emitter&&Promise.resolve().then(function(){i._emitter.emit(d.default.MEDIA_SEGMENT,e,t)})}},{key:"_onLoadingComplete",value:function(){var e=this;this._emitter&&Promise.resolve().then(function(){e._emitter.emit(d.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function(){var e=this;this._emitter&&Promise.resolve().then(function(){e._emitter.emit(d.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function(e){var t=this;this._emitter&&Promise.resolve().then(function(){t._emitter.emit(d.default.MEDIA_INFO,e)})}},{key:"_onMetaDataArrived",value:function(e){var t=this;this._emitter&&Promise.resolve().then(function(){t._emitter.emit(d.default.METADATA_ARRIVED,e)})}},{key:"_onScriptDataArrived",value:function(e){var t=this;this._emitter&&Promise.resolve().then(function(){t._emitter.emit(d.default.SCRIPTDATA_ARRIVED,e)})}},{key:"_onStatisticsInfo",value:function(e){var t=this;this._emitter&&Promise.resolve().then(function(){t._emitter.emit(d.default.STATISTICS_INFO,e)})}},{key:"_onIOError",value:function(e,t){var i=this;this._emitter&&Promise.resolve().then(function(){i._emitter.emit(d.default.IO_ERROR,e,t)})}},{key:"_onDemuxError",value:function(e,t){var i=this;this._emitter&&Promise.resolve().then(function(){i._emitter.emit(d.default.DEMUX_ERROR,e,t)})}},{key:"_onRecommendSeekpoint",value:function(e){var t=this;this._emitter&&Promise.resolve().then(function(){t._emitter.emit(d.default.RECOMMEND_SEEKPOINT,e)})}},{key:"_onLoggingConfigChanged",value:function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,i=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);if(this._emitter)switch(t.msg){case d.default.INIT_SEGMENT:case d.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,i.type,i.data);break;case d.default.LOADING_COMPLETE:case d.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case d.default.MEDIA_INFO:Object.setPrototypeOf(i,n.default.prototype),this._emitter.emit(t.msg,i);break;case d.default.METADATA_ARRIVED:case d.default.SCRIPTDATA_ARRIVED:case d.default.STATISTICS_INFO:this._emitter.emit(t.msg,i);break;case d.default.IO_ERROR:case d.default.DEMUX_ERROR:this._emitter.emit(t.msg,i.type,i.info);break;case d.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,i);break;case"logcat_callback":l.default.emitter.emit("log",i.type,i.logcat)}}}]),f);function f(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.TAG="Transmuxer",this._emitter=new o.default,this._mediaType=t.mediaType?t.mediaType.toLowerCase():"",i.enableWorker&&"undefined"!=typeof Worker&&"fmp4"!==this._mediaType)try{var e=s(375),r=this._worker=e(376);this._workerDestroying=!1,r.addEventListener("message",this._onWorkerMessage.bind(this)),r.onerror=function(e){};var n={};Object.assign(n,t),delete n.callbacks,delete n.h5msClient,r.postMessage({cmd:"init",param:[n,i]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},u.default.registerListener(this.e.onLoggingConfigChanged),r.postMessage({cmd:"logging_config",param:u.default.getConfig()})}catch(e){l.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new h.default(t,i)}else this._controller=new h.default(t,i);if(this._controller){var a=this._controller;a.on(d.default.IO_ERROR,this._onIOError.bind(this)),a.on(d.default.DEMUX_ERROR,this._onDemuxError.bind(this)),a.on(d.default.INIT_SEGMENT,this._onInitSegment.bind(this)),a.on(d.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),a.on(d.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),a.on(d.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),a.on(d.default.MEDIA_INFO,this._onMediaInfo.bind(this)),a.on(d.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),a.on(d.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),a.on(d.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),a.on(d.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this)),a.on(d.default.COMMAND_RESPONSE,this._onCommandResponse.bind(this))}}t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=o(i(343)),s=o(i(342));function o(e){return e&&e.__esModule?e:{default:e}}var l=(r(u,null,[{key:"getConfig",value:function(){return{globalTag:s.default.GLOBAL_TAG,forceGlobalTag:s.default.FORCE_GLOBAL_TAG,enableVerbose:s.default.ENABLE_VERBOSE,enableDebug:s.default.ENABLE_DEBUG,enableInfo:s.default.ENABLE_INFO,enableWarn:s.default.ENABLE_WARN,enableError:s.default.ENABLE_ERROR,enableCallback:s.default.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){s.default.GLOBAL_TAG=e.globalTag,s.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,s.default.ENABLE_VERBOSE=e.enableVerbose,s.default.ENABLE_DEBUG=e.enableDebug,s.default.ENABLE_INFO=e.enableInfo,s.default.ENABLE_WARN=e.enableWarn,s.default.ENABLE_ERROR=e.enableError,s.default.ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var e=u.emitter;if(0<e.listenerCount("change")){var t=u.getConfig();e.emit("change",t)}}},{key:"registerListener",value:function(e){u.emitter.addListener("change",e)}},{key:"removeListener",value:function(e){u.emitter.removeListener("change",e)}},{key:"addLogListener",value:function(e){s.default.emitter.addListener("log",e),0<s.default.emitter.listenerCount("log")&&(s.default.ENABLE_CALLBACK=!0,u._notifyChange())}},{key:"removeLogListener",value:function(e){s.default.emitter.removeListener("log",e),0===s.default.emitter.listenerCount("log")&&(s.default.ENABLE_CALLBACK=!1,u._notifyChange())}},{key:"forceGlobalTag",get:function(){return s.default.FORCE_GLOBAL_TAG},set:function(e){s.default.FORCE_GLOBAL_TAG=e,u._notifyChange()}},{key:"globalTag",get:function(){return s.default.GLOBAL_TAG},set:function(e){s.default.GLOBAL_TAG=e,u._notifyChange()}},{key:"enableAll",get:function(){return s.default.ENABLE_VERBOSE&&s.default.ENABLE_DEBUG&&s.default.ENABLE_INFO&&s.default.ENABLE_WARN&&s.default.ENABLE_ERROR},set:function(e){s.default.ENABLE_VERBOSE=e,s.default.ENABLE_DEBUG=e,s.default.ENABLE_INFO=e,s.default.ENABLE_WARN=e,s.default.ENABLE_ERROR=e,u._notifyChange()}},{key:"enableDebug",get:function(){return s.default.ENABLE_DEBUG},set:function(e){s.default.ENABLE_DEBUG=e,u._notifyChange()}},{key:"enableVerbose",get:function(){return s.default.ENABLE_VERBOSE},set:function(e){s.default.ENABLE_VERBOSE=e,u._notifyChange()}},{key:"enableInfo",get:function(){return s.default.ENABLE_INFO},set:function(e){s.default.ENABLE_INFO=e,u._notifyChange()}},{key:"enableWarn",get:function(){return s.default.ENABLE_WARN},set:function(e){s.default.ENABLE_WARN=e,u._notifyChange()}},{key:"enableError",get:function(){return s.default.ENABLE_ERROR},set:function(e){s.default.ENABLE_ERROR=e,u._notifyChange()}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u)}l.emitter=new a.default,t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=p(i(343)),s=p(i(342)),o=p(i(351)),l=p(i(355)),u=p(i(356)),h=p(i(361)),d=p(i(349)),c=p(i(365)),f=p(i(374));i(347);function p(e){return e&&e.__esModule?e:{default:e}}var v=(r(m,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(e,t){this._currentSegmentIndex=e;var i=this._mediaDataSource.segments[e],r=this._ioctl=new c.default(i,this._config,e);r.onError=this._onIOException.bind(this),r.onSeeked=this._onIOSeeked.bind(this),r.onComplete=this._onIOComplete.bind(this),r.onRedirect=this._onIORedirect.bind(this),r.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),"fmp4"==this._mediaType?r.onDataArrival=this._onInitDataFmp4Arrival.bind(this):null!=t?this._demuxer.bindDataSource(this._ioctl):r.onDataArrival=this._onInitChunkArrival.bind(this),r.onCommand=this._onCmdResponse.bind(this),r.open(t)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&this._ioctl.pause()}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&this._ioctl.resume()}},{key:"seek",value:function(e){if("h5msflv"===this._mediaType)return this._internalAbort(),this._demuxer.resetFirstParse(),this._remuxer.insertDiscontinuity(),this._remuxer.seek(),void this._loadSegment(0,0);if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var i=this._mediaInfo.segments[t];if(null==i)this._pendingSeekTime=e;else{var r=i.getNearestKeyframe(e);this._remuxer.seek(r.milliseconds),this._ioctl.seek(r.fileposition),this._pendingResolveSeekPoint=r.milliseconds}}else{var n=this._mediaInfo.segments[t];if(null==n)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t);else{var a=n.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(t)}}}}},{key:"_searchSegmentIndexContains",value:function(e){for(var t=this._mediaDataSource.segments,i=t.length-1,r=0;r<t.length;r++)if(e<t[r].timestampBase){i=r-1;break}return i}},{key:"sendcmd",value:function(e){this._ioctl&&this._ioctl.isWorking()&&this._ioctl.sendcmd(e)}},{key:"_onInitChunkArrival",value:function(e,t){var i=this,r=null,n=0;if(0<t&&this._demuxer)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,n=this._demuxer.parseChunks(e,t);else if((r=u.default.probe(e)).match){this._demuxer=new u.default(r,this._config),this._remuxer||("flv"!=this._mediaType&&(this._config.isLive=!0),this._remuxer=new h.default(this._config));var a=this._mediaDataSource;null==a.duration||isNaN(a.duration)||(this._demuxer.overridedDuration=a.duration),"boolean"==typeof a.hasAudio&&(this._demuxer.overridedHasAudio=a.hasAudio),"boolean"==typeof a.hasVideo&&(this._demuxer.overridedHasVideo=a.hasVideo),this._demuxer.timestampBase=a.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),n=this._demuxer.parseChunks(e,t)}else r=null,s.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){i._internalAbort()}),this._emitter.emit(f.default.DEMUX_ERROR,d.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),n=0;return n}},{key:"_onMediaInfo",value:function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,l.default.prototype));var i=Object.assign({},e);Object.setPrototypeOf(i,l.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=i,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)})}},{key:"_onMetaDataArrived",value:function(e){this._emitter.emit(f.default.METADATA_ARRIVED,e)}},{key:"_onScriptDataArrived",value:function(e){this._emitter.emit(f.default.SCRIPTDATA_ARRIVED,e)}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(e){if("fmp4"!==this._mediaType){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer.flushStashedSamples(),this._emitter.emit(f.default.LOADING_COMPLETE))}else this._emitter.emit(f.default.LOADING_COMPLETE)}},{key:"_onIORedirect",value:function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(f.default.RECOVERED_EARLY_EOF)}},{key:"_onCmdResponse",value:function(e){this._emitter.emit(f.default.COMMAND_RESPONSE,e)}},{key:"_onIOException",value:function(e,t){s.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter&&this._emitter.emit(f.default.IO_ERROR,e,t)}},{key:"_onInitDataFmp4Arrival",value:function(e){var t={type:"video",data:e,container:"video/mp4",codec:"avc1.4D4028"};this._emitter.emit(f.default.INIT_SEGMENT,"video",t),this._ioctl.onDataArrival=this._onDataFmp4Arrival.bind(this)}},{key:"_onDataFmp4Arrival",value:function(e){this._emitter.emit(f.default.MEDIA_SEGMENT,"video",{type:"video",data:e})}},{key:"_onDemuxException",value:function(e,t){s.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(f.default.DEMUX_ERROR,e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit(f.default.INIT_SEGMENT,e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(f.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var i=t.info.syncPoints,r=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,o.default.safari&&0<i.length&&i[0].originalDts===r&&(r=i[0].pts),this._emitter.emit(f.default.RECOMMEND_SEEKPOINT,r)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(e){var t=this._mediaInfo.segments[e],i=Object.assign({},t);i.duration=this._mediaInfo.duration,i.segmentCount=this._mediaInfo.segmentCount,delete i.segments,delete i.keyframesIndex,this._emitter.emit(f.default.MEDIA_INFO,i)}},{key:"_reportStatisticsInfo",value:function(){var e={};this._ioctl?(e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.dataRate=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType):e.dataRate=0,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(f.default.STATISTICS_INFO,e)}}]),m);function m(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),this.TAG="TransmuxingController",this._emitter=new a.default,this._config=i,t.segments||(t.segments=[{url:t.url,channelInfo:t.channelInfo,mediaType:t.mediaType,duration:t.duration,filesize:t.filesize}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaType=t.mediaType.toLowerCase(),this._mediaDataSource=t;var r=this._currentSegmentIndex=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=r,r+=e.duration,e.cors=t.cors,e.withCredentials=t.withCredentials,i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy)}),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}t.default=v},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}}},{key:"_search",value:function(e,t){var i=0,r=e.length-1,n=0,a=0,s=r;for(t<e[0]&&(i=0,a=s+1);a<=s;){if((n=a+Math.floor((s-a)/2))===r||t>=e[n]&&t<e[n+1]){i=n;break}e[n]<t?a=n+1:s=n-1}return i}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=s(i(342)),h=s(i(357)),R=s(i(359)),A=s(i(349)),a=s(i(355)),c=i(348);function s(e){return e&&e.__esModule?e:{default:e}}var o=(r(f,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"bindDataSource",value:function(e){return e.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new a.default}},{key:"resetFirstParse",value:function(){this._firstParse=!0}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(e,t){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new c.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,r=this._littleEndian;if(0===t){if(!(13<e.byteLength))return 0;i=f.probe(e).dataOffset}for(this._firstParse&&(this._firstParse=!1,t+i!==this._dataOffset&&T.default.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==new DataView(e,i).getUint32(0,!r)&&T.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4);i<e.byteLength;){this._dispatch=!0;var n=new DataView(e,i);if(i+11+4>e.byteLength)break;var a=n.getUint8(0),s=16777215&n.getUint32(0,!r);if(i+11+s+4>e.byteLength)break;if(8===a||9===a||18===a){var o=n.getUint8(4),l=n.getUint8(5),u=n.getUint8(6)|l<<8|o<<16|n.getUint8(7)<<24;0!=(16777215&n.getUint32(7,!r))&&T.default.w(this.TAG,"Meet tag which has StreamID != 0!");var h=i+11;switch(a){case 8:this._parseAudioData(e,h,s,u);break;case 9:this._parseVideoData(e,h,s,u,t+i);break;case 18:this._parseScriptData(e,h,s)}var d=n.getUint32(11+s,!r);d!==11+s&&T.default.w(this.TAG,"Invalid PrevTagSize "+d),i+=11+s+4}else T.default.w(this.TAG,"Unsupported tag type "+a+", size "+s+", skipped"),i+=11+s+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i}},{key:"_parseScriptData",value:function(e,t,i){var r=h.default.parseScriptData(e,t,i);if(r.hasOwnProperty("onMetaData")){if(null==r.onMetaData||"object"!==u(r.onMetaData))return void T.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&T.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var n=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},n)),"boolean"==typeof n.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=n.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof n.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=n.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof n.audiodatarate&&(this._mediaInfo.audioDataRate=n.audiodatarate),"number"==typeof n.videodatarate&&(this._mediaInfo.videoDataRate=n.videodatarate),"number"==typeof n.width&&(this._mediaInfo.width=n.width),"number"==typeof n.height&&(this._mediaInfo.height=n.height),"number"==typeof n.duration){if(!this._durationOverrided){var a=Math.floor(n.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof n.framerate){var s=Math.floor(1e3*n.framerate);if(0<s){var o=s/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=o,this._referenceFrameRate.fps_num=s,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=o}}if("object"===u(n.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var l=n.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l),n.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=n,T.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}0<Object.keys(r).length&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],i=[],r=1;r<e.times.length;r++){var n=this._timestampBase+Math.floor(1e3*e.times[r]);t.push(n),i.push(e.filepositions[r])}return{times:t,filepositions:i}}},{key:"_parseAudioData",value:function(e,t,i,r){if(i<=1)T.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var n=new DataView(e,t,i).getUint8(0),a=n>>>4;if(2==a||10==a){var s=0,o=(12&n)>>>2;if(0<=o&&o<=4){s=this._flvSoundRateTable[o];var l=1&n,u=this._audioMetadata,h=this._audioTrack;if(u||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(u=this._audioMetadata={}).type="audio",u.id=h.id,u.timescale=this._timescale,u.duration=this._duration,u.audioSampleRate=s,u.channelCount=0==l?1:2),10==a){var d=this._parseAACAudioData(e,t+1,i-1);if(null==d)return;if(0===d.packetType){u.config&&T.default.w(this.TAG,"Found another AudioSpecificConfig!");var c=d.data;u.audioSampleRate=c.samplingRate,u.channelCount=c.channelCount,u.codec=c.codec,u.originalCodec=c.originalCodec,u.config=c.config,u.refSampleDuration=1024/u.audioSampleRate*u.timescale,T.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",u);var f=this._mediaInfo;f.audioCodec=u.originalCodec,f.audioSampleRate=u.audioSampleRate,f.audioChannelCount=u.channelCount,f.hasVideo?null!=f.videoCodec&&(f.mimeType='video/x-flv; codecs="'+f.videoCodec+","+f.audioCodec+'"'):f.mimeType='video/x-flv; codecs="'+f.audioCodec+'"',f.isComplete()&&this._onMediaInfo(f)}else if(1===d.packetType){var p=this._timestampBase+r,v={unit:d.data,length:d.data.byteLength,dts:p,pts:p};h.samples.push(v),h.length+=d.data.length}else T.default.e(this.TAG,"Flv: Unsupported AAC data type "+d.packetType)}else if(2==a){if(!u.codec){var m=this._parseMP3AudioData(e,t+1,i-1,!0);if(null==m)return;u.audioSampleRate=m.samplingRate,u.channelCount=m.channelCount,u.codec=m.codec,u.originalCodec=m.originalCodec,u.refSampleDuration=1152/u.audioSampleRate*u.timescale,T.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",u);var g=this._mediaInfo;g.audioCodec=u.codec,g.audioSampleRate=u.audioSampleRate,g.audioChannelCount=u.channelCount,g.audioDataRate=m.bitRate,g.hasVideo?null!=g.videoCodec&&(g.mimeType='video/x-flv; codecs="'+g.videoCodec+","+g.audioCodec+'"'):g.mimeType='video/x-flv; codecs="'+g.audioCodec+'"',g.isComplete()&&this._onMediaInfo(g)}var _=this._parseMP3AudioData(e,t+1,i-1,!1);if(null==_)return;var y=this._timestampBase+r,b={unit:_,length:_.byteLength,dts:y,pts:y};h.samples.push(b),h.length+=_.length}}else this._onError(A.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+o)}else this._onError(A.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+a)}}},{key:"_parseAACAudioData",value:function(e,t,i){if(!(i<=1)){var r={},n=new Uint8Array(e,t,i);return r.packetType=n[0],0===n[0]?r.data=this._parseAACAudioSpecificConfig(e,t+1,i-1):r.data=n.subarray(1),r}T.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,i){var r,n,a=new Uint8Array(e,t,i),s=null,o=0,l=null;if(o=r=a[0]>>>3,(n=(7&a[0])<<1|a[1]>>>7)<0||n>=this._mpegSamplingRates.length)this._onError(A.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var u=this._mpegSamplingRates[n],h=(120&a[1])>>>3;if(!(h<0||8<=h)){5===o&&(l=(7&a[1])<<1|a[2]>>>7,a[2]);var d=self.navigator.userAgent.toLowerCase();return-1!==d.indexOf("firefox")?l=6<=n?(o=5,s=new Array(4),n-3):(o=2,s=new Array(2),n):-1!==d.indexOf("android")?(o=2,s=new Array(2),l=n):(o=5,l=n,s=new Array(4),6<=n?l=n-3:1==h&&(o=2,s=new Array(2),l=n)),s[0]=o<<3,s[0]|=(15&n)>>>1,s[1]=(15&n)<<7,s[1]|=(15&h)<<3,5===o&&(s[1]|=(15&l)>>>1,s[2]=(1&l)<<7,s[2]|=8,s[3]=0),{config:s,samplingRate:u,channelCount:h,codec:"mp4a.40."+o,originalCodec:"mp4a.40."+r}}this._onError(A.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}}},{key:"_parseMP3AudioData",value:function(e,t,i,r){if(!(i<4)){this._littleEndian;var n=new Uint8Array(e,t,i),a=null;if(r){if(255!==n[0])return;var s=n[1]>>>3&3,o=(6&n[1])>>1,l=(240&n[2])>>>4,u=(12&n[2])>>>2,h=3!=(n[3]>>>6&3)?2:1,d=0,c=0;switch(s){case 0:d=this._mpegAudioV25SampleRateTable[u];break;case 2:d=this._mpegAudioV20SampleRateTable[u];break;case 3:d=this._mpegAudioV10SampleRateTable[u]}switch(o){case 1:l<this._mpegAudioL3BitRateTable.length&&(c=this._mpegAudioL3BitRateTable[l]);break;case 2:l<this._mpegAudioL2BitRateTable.length&&(c=this._mpegAudioL2BitRateTable[l]);break;case 3:l<this._mpegAudioL1BitRateTable.length&&(c=this._mpegAudioL1BitRateTable[l])}a={bitRate:c,samplingRate:d,channelCount:h,codec:"mp3",originalCodec:"mp3"}}else a=n;return a}T.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")}},{key:"_parseVideoData",value:function(e,t,i,r,n){if(i<=1)T.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,i)[0],s=(240&a)>>>4,o=15&a;7==o?this._parseAVCVideoPacket(e,t+1,i-1,r,n,s):this._onError(A.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,i,r,n,a){if(i<4)T.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var s=this._littleEndian,o=new DataView(e,t,i),l=o.getUint8(0),u=(16777215&o.getUint32(0,!s))<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===l)this._parseAVCVideoData(e,t+4,i-4,r,n,a,u);else if(2!==l)return void this._onError(A.default.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,i){if(i<7)T.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var r=this._videoMetadata,n=this._videoTrack,a=this._littleEndian,s=new DataView(e,t,i);r?void 0!==r.avcc&&T.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(r=this._videoMetadata={}).type="video",r.id=n.id,r.timescale=this._timescale,r.duration=this._duration);var o=s.getUint8(0),l=s.getUint8(1);if(s.getUint8(2),s.getUint8(3),1===o&&0!==l)if(this._naluLengthSize=1+(3&s.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var u=31&s.getUint8(5);if(0!=u){1<u&&T.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+u);for(var h=6,d=0;d<u;d++){var c=s.getUint16(h,!a);if(h+=2,0!==c){var f=new Uint8Array(e,t+h,c);h+=c;var p=R.default.parseSPS(f);if(0===d){r.codecWidth=p.codec_size.width,r.codecHeight=p.codec_size.height,r.presentWidth=p.present_size.width,r.presentHeight=p.present_size.height,r.profile=p.profile_string,r.level=p.level_string,r.bitDepth=p.bit_depth,r.chromaFormat=p.chroma_format,r.sarRatio=p.sar_ratio,r.frameRate=p.frame_rate,!1!==p.frame_rate.fixed&&0!==p.frame_rate.fps_num&&0!==p.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var v=r.frameRate.fps_den,m=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(v/m);for(var g=f.subarray(1,4),_="avc1.",y=0;y<3;y++){var b=g[y].toString(16);b.length<2&&(b="0"+b),_+=b}r.codec=_;var S=this._mediaInfo;S.width=r.codecWidth,S.height=r.codecHeight,S.fps=r.frameRate.fps,S.profile=r.profile,S.level=r.level,S.refFrames=p.ref_frames,S.chromaFormat=p.chroma_format_string,S.sarNum=r.sarRatio.width,S.sarDen=r.sarRatio.height,S.videoCodec=_,S.hasAudio?null!=S.audioCodec&&(S.mimeType='video/x-flv; codecs="'+S.videoCodec+","+S.audioCodec+'"'):S.mimeType='video/x-flv; codecs="'+S.videoCodec+'"',S.isComplete()&&this._onMediaInfo(S)}}}var E=s.getUint8(h);if(0!==E){1<E&&T.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+E),h++;for(var k=0;k<E;k++){var w=s.getUint16(h,!a);h+=2,0!==w&&(h+=w)}r.avcc=new Uint8Array(i),r.avcc.set(new Uint8Array(e,t,i),0),T.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)}else this._onError(A.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(A.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(A.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(A.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}}},{key:"_parseAVCVideoData",value:function(e,t,i,r,n,a,s){for(var o=this._littleEndian,l=new DataView(e,t,i),u=[],h=0,d=0,c=this._naluLengthSize,f=this._timestampBase+r,p=1===a;d<i;){if(i<=d+4){T.default.w(this.TAG,"Malformed Nalu near timestamp "+f+", offset = "+d+", dataSize = "+i);break}var v=l.getUint32(d,!o);if(3===c&&(v>>>=8),i-c<v)return void T.default.w(this.TAG,"Malformed Nalus near timestamp "+f+", NaluSize > DataSize!");var m=31&l.getUint8(d+c);5==m&&(p=!0);var g=new Uint8Array(e,t+d,c+v),_={type:m,data:g};u.push(_),h+=g.byteLength,d+=c+v}if(u.length){var y=this._videoTrack,b={units:u,length:h,isKeyframe:p,dts:f,cts:s,pts:f+s};p&&(b.fileposition=n),y.samples.push(b),y.length+=h}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),i={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return i;var r=(4&t[4])>>>2!=0,n=0!=(1&t[4]),a=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}(t,5);return a<9?i:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:r,hasVideoTrack:n}}}]),f);function f(e,t){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new a.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0])}t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=s(i(342)),a=s(i(358)),y=i(348);function s(e){return e&&e.__esModule?e:{default:e}}var o,b=(o=new ArrayBuffer(2),new DataView(o).setInt16(0,256,!0),256===new Int16Array(o)[0]),l=(r(S,null,[{key:"parseScriptData",value:function(e,t,i){var r={};try{var n=S.parseValue(e,t,i),a=S.parseValue(e,t+n.size,i-n.size);r[n.data]=a.data}catch(e){_.default.e("AMF",e.toString())}return r}},{key:"parseObject",value:function(e,t,i){if(i<3)throw new y.IllegalStateException("Data not enough when parse ScriptDataObject");var r=S.parseString(e,t,i),n=S.parseValue(e,t+r.size,i-r.size),a=n.objectEnd;return{data:{name:r.data,value:n.data},size:r.size+n.size,objectEnd:a}}},{key:"parseVariable",value:function(e,t,i){return S.parseObject(e,t,i)}},{key:"parseString",value:function(e,t,i){if(i<2)throw new y.IllegalStateException("Data not enough when parse String");var r=new DataView(e,t,i).getUint16(0,!b);return{data:0<r?(0,a.default)(new Uint8Array(e,t+2,r)):"",size:2+r}}},{key:"parseLongString",value:function(e,t,i){if(i<4)throw new y.IllegalStateException("Data not enough when parse LongString");var r=new DataView(e,t,i).getUint32(0,!b);return{data:0<r?(0,a.default)(new Uint8Array(e,t+4,r)):"",size:4+r}}},{key:"parseDate",value:function(e,t,i){if(i<10)throw new y.IllegalStateException("Data size invalid when parse Date");var r=new DataView(e,t,i),n=r.getFloat64(0,!b),a=r.getInt16(8,!b);return{data:new Date(n+=60*a*1e3),size:10}}},{key:"parseValue",value:function(e,t,i){if(i<1)throw new y.IllegalStateException("Data not enough when parse Value");var r=new DataView(e,t,i),n=1,a=r.getUint8(0),s=void 0,o=!1;try{switch(a){case 0:s=r.getFloat64(1,!b),n+=8;break;case 1:s=!!r.getUint8(1),n+=1;break;case 2:var l=S.parseString(e,t+1,i-1);s=l.data,n+=l.size;break;case 3:s={};var u=0;for(9==(16777215&r.getUint32(i-4,!b))&&(u=3);n<i-4;){var h=S.parseObject(e,t+n,i-n-u);if(h.objectEnd)break;s[h.data.name]=h.data.value,n+=h.size}n<=i-3&&9==(16777215&r.getUint32(n-1,!b))&&(n+=3);break;case 8:s={},n+=4;var d=0;for(9==(16777215&r.getUint32(i-4,!b))&&(d=3);n<i-8;){var c=S.parseVariable(e,t+n,i-n-d);if(c.objectEnd)break;s[c.data.name]=c.data.value,n+=c.size}n<=i-3&&9==(16777215&r.getUint32(n-1,!b))&&(n+=3);break;case 9:n=1,o=!(s=void 0);break;case 10:s=[];var f=r.getUint32(1,!b);n+=4;for(var p=0;p<f;p++){var v=S.parseValue(e,t+n,i-n);s.push(v.data),n+=v.size}break;case 11:var m=S.parseDate(e,t+1,i-1);s=m.data,n+=m.size;break;case 12:var g=S.parseString(e,t+1,i-1);s=g.data,n+=g.size;break;default:n=i,_.default.w("AMF","Unsupported AMF value type "+a)}}catch(e){_.default.e("AMF",e.toString())}return{data:s,size:n,objectEnd:o}}}]),S);function S(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S)}t.default=l},function(e,t,i){"use strict";function l(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=[],i=e,r=0,n=e.length;r<n;)if(i[r]<128)t.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(l(i,r,1)){var a=(31&i[r])<<6|63&i[r+1];if(128<=a){t.push(String.fromCharCode(65535&a)),r+=2;continue}}}else if(i[r]<240){if(l(i,r,2)){var s=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(2048<=s&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),r+=3;continue}}}else if(i[r]<248&&l(i,r,3)){var o=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(65536<o&&o<1114112){o-=65536,t.push(String.fromCharCode(o>>>10|55296)),t.push(String.fromCharCode(1023&o|56320)),r+=4;continue}}t.push(String.fromCharCode(65533)),++r}return t.join("")}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(360),N=(a=s)&&a.__esModule?a:{default:a};var o=(r(U,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)2<=a&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)}},{key:"parseSPS",value:function(e){var t=U._ebsp2rbsp(e),i=new N.default(t);i.readByte();var r=i.readByte();i.readByte();var n=i.readByte();i.readUEG();var a=U.getProfileString(r),s=U.getLevelString(n),o=1,l=420,u=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(o=i.readUEG())&&i.readBits(1),o<=3&&(l=[0,420,422,444][o]),u=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var h=3!==o?8:12,d=0;d<h;d++)i.readBool()&&U._skipScalingList(i,d<6?16:64);i.readUEG();var c=i.readUEG();if(0===c)i.readUEG();else if(1===c){i.readBits(1),i.readSEG(),i.readSEG();for(var f=i.readUEG(),p=0;p<f;p++)i.readSEG()}var v=i.readUEG();i.readBits(1);var m=i.readUEG(),g=i.readUEG(),_=i.readBits(1);0===_&&i.readBits(1),i.readBits(1);var y=0,b=0,S=0,E=0;i.readBool()&&(y=i.readUEG(),b=i.readUEG(),S=i.readUEG(),E=i.readUEG());var k=1,w=1,T=0,R=!0,A=0,C=0;if(i.readBool()){if(i.readBool()){var x=i.readByte();0<x&&x<16?(k=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][x-1],w=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][x-1]):255===x&&(k=i.readByte()<<8|i.readByte(),w=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var I=i.readBits(32),O=i.readBits(32);R=i.readBool(),T=(A=O)/(C=2*I)}}var L=1;1===k&&1===w||(L=k/w);var D=0,P=0;P=0===o?(D=1,2-_):(D=3===o?1:2,(1===o?2:1)*(2-_));var M=16*(m+1),F=16*(g+1)*(2-_);M-=(y+b)*D,F-=(S+E)*P;var B=Math.ceil(M*L);return i.destroy(),i=null,{profile_string:a,level_string:s,bit_depth:u,ref_frames:v,chroma_format:l,chroma_format_string:U.getChromaFormatString(l),frame_rate:{fixed:R,fps:T,fps_den:C,fps_num:A},sar_ratio:{width:k,height:w},codec_size:{width:M,height:F},present_size:{width:B,height:F}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),U);function U(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,U)}t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=i(348);var a=(r(o,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new s.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(32<e)throw new s.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(r,this._current_word_bits_left),a=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,i=i<<n|a}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),o);function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=s(i(342)),X=s(i(362)),Z=s(i(363)),J=s(i(351)),Q=i(364),a=i(348);function s(e){return e&&e.__esModule?e:{default:e}}var o=(r(l,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new a.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var i=null,r="mp4",n=t.codec;if("audio"===e)i="mp3"===(this._audioMeta=t).codec&&this._mp3UseMpegAudio?(r="mpeg",n="",new Uint8Array):X.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,i=X.default.generateInitSegment(t)}if(!this._onInitSegment)throw new a.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:i.buffer,codec:n,container:e+"/"+r,mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(i.samples.push(e),i.length=e.length);var r={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(r.samples.push(t),r.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(r,!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var i,r=e,n=r.samples,a=void 0,s=-1,o=this._audioMeta.refSampleDuration,l="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,u=this._dtsBaseInited&&void 0===this._audioNextDts,h=!1;if(n&&0!==n.length&&(1!==n.length||t)){var d=0,c=null,f=0;f=l?(d=0,r.length):(d=8)+r.length;var p=null;if(1<n.length&&(f-=(p=n.pop()).length),null!=this._audioStashedLastSample){var v=this._audioStashedLastSample;this._audioStashedLastSample=null,n.unshift(v),f+=v.length}null!=p&&(this._audioStashedLastSample=p);var m=n[0].dts-this._dtsBase;if(this._audioNextDts)a=m-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())a=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(h=!0);else{var g=this._audioSegmentInfoList.getLastSampleBefore(m);if(null!=g){var _=m-(g.originalDts+g.duration);_<=3&&(_=0),a=m-(g.dts+g.duration+_)}else a=0}if(h){var y=m-a,b=this._videoSegmentInfoList.getLastSegmentBefore(m);if(null!=b&&b.beginDts<y){var S=Z.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(S){var E=b.beginDts,k=y-b.beginDts;q.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+E+", duration: "+k),n.unshift({unit:S,dts:E,pts:E}),f+=S.byteLength}}else h=!1}for(var w=[],T=0;T<n.length;T++){var R=n[T],A=R.unit,C=R.dts-this._dtsBase,x=C-a;-1===s&&(s=x);var I=0;I=T!==n.length-1?n[T+1].dts-this._dtsBase-a-x:null!=p?p.dts-this._dtsBase-a-x:1<=w.length?w[w.length-1].duration:Math.floor(o);var O=!1,L=null;if(1.5*o<I&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!J.default.safari){O=!0;var D=Math.abs(I-o),P=Math.ceil(D/o),M=x+o;q.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\ndts: "+(x+I)+" ms, expected: "+(x+Math.round(o))+" ms, delta: "+Math.round(D)+" ms, generate: "+P+" frames");var F=Z.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==F&&(q.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),F=A),L=[];for(var B=0;B<P;B++){var N=Math.round(M);if(0<L.length){var U=L[L.length-1];U.duration=N-U.dts}var j={dts:N,pts:N,cts:0,unit:F,size:F.byteLength,duration:0,originalDts:C,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};L.push(j),f+=j.size,M+=o}var z=L[L.length-1];z.duration=x+I-z.dts,I=Math.round(o)}w.push({dts:x,pts:x,cts:0,unit:R.unit,size:R.unit.byteLength,duration:I,originalDts:C,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),O&&w.push.apply(w,L)}l?c=new Uint8Array(f):((c=new Uint8Array(f))[0]=f>>>24&255,c[1]=f>>>16&255,c[2]=f>>>8&255,c[3]=255&f,c.set(X.default.types.mdat,4));for(var G=0;G<w.length;G++){var V=w[G].unit;c.set(V,d),d+=V.byteLength}var H=w[w.length-1];i=H.dts+H.duration,this._audioNextDts=i;var W=new Q.MediaSegmentInfo;W.beginDts=s,W.endDts=i,W.beginPts=s,W.endPts=i,W.originalBeginDts=w[0].originalDts,W.originalEndDts=H.originalDts+H.duration,W.firstSample=new Q.SampleInfo(w[0].dts,w[0].pts,w[0].duration,w[0].originalDts,!1),W.lastSample=new Q.SampleInfo(H.dts,H.pts,H.duration,H.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(W),r.samples=w,r.sequenceNumber++;var K=null;K=l?new Uint8Array:X.default.moof(r,s),r.samples=[],r.length=0;var Y={type:"audio",data:this._mergeBoxes(K,c).buffer,sampleCount:w.length,info:W};l&&u&&(Y.timestampOffset=s),this._onMediaSegment("audio",Y)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var i,r,n=e,a=n.samples,s=void 0,o=-1,l=-1;if(a&&0!==a.length&&(1!==a.length||t)){var u=8,h=null,d=8+e.length,c=null;if(1<a.length&&(d-=(c=a.pop()).length),null!=this._videoStashedLastSample){var f=this._videoStashedLastSample;this._videoStashedLastSample=null,a.unshift(f),d+=f.length}null!=c&&(this._videoStashedLastSample=c);var p=a[0].dts-this._dtsBase;if(this._videoNextDts)s=p-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())s=0;else{var v=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=v){var m=p-(v.originalDts+v.duration);m<=3&&(m=0),s=p-(v.dts+v.duration+m)}else s=0}0!=s&&console.log("_remuxVideo dtsCorrection: ",s);for(var g=new Q.MediaSegmentInfo,_=[],y=0;y<a.length;y++){var b=a[y],S=b.dts-this._dtsBase,E=b.isKeyframe,k=S-s,w=b.cts,T=k+w;-1===o&&(o=k,l=T);var R=0;if(R=y!==a.length-1?a[y+1].dts-this._dtsBase-s-k:null!=c?c.dts-this._dtsBase-s-k:1<=_.length?_[_.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),E){var A=new Q.SampleInfo(k,T,R,b.dts,!0);A.fileposition=b.fileposition,g.appendSyncPoint(A)}_.push({dts:k,pts:T,cts:w,units:b.units,size:b.length,isKeyframe:E,duration:R,originalDts:S,flags:{isLeading:0,dependsOn:E?2:1,isDependedOn:E?1:0,hasRedundancy:0,isNonSync:E?0:1}})}(h=new Uint8Array(d))[0]=d>>>24&255,h[1]=d>>>16&255,h[2]=d>>>8&255,h[3]=255&d,h.set(X.default.types.mdat,4);for(var C=0;C<_.length;C++)for(var x=_[C].units;x.length;){var I=x.shift().data;h.set(I,u),u+=I.byteLength}var O=_[_.length-1];if(i=O.dts+O.duration,r=O.pts+O.duration,this._videoNextDts=i,g.beginDts=o,g.endDts=i,g.beginPts=l,g.endPts=r,g.originalBeginDts=_[0].originalDts,g.originalEndDts=O.originalDts+O.duration,g.firstSample=new Q.SampleInfo(_[0].dts,_[0].pts,_[0].duration,_[0].originalDts,_[0].isKeyframe),g.lastSample=new Q.SampleInfo(O.dts,O.pts,O.duration,O.originalDts,O.isKeyframe),this._isLive||this._videoSegmentInfoList.append(g),n.samples=_,n.sequenceNumber++,this._forceFirstIDR){var L=_[0].flags;L.dependsOn=2,L.isNonSync=0}var D=X.default.moof(n,o);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(D,h).buffer,sampleCount:_.length,info:g})}}}},{key:"_mergeBoxes",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Q.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new Q.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!J.default.chrome||!(J.default.version.major<50||50===J.default.version.major&&J.default.version.build<2661)),this._fillSilentAfterSeek=J.default.msedge||J.default.msie,this._mp3UseMpegAudio=!J.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}t.default=o},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(d,null,[{key:"init",value:function(){for(var e in d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]})d.types.hasOwnProperty(e)&&(d.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=d.constants={};t.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),t.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),t.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSC=t.STCO=t.STTS,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),t.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,i=null,r=Array.prototype.slice.call(arguments,1),n=r.length,a=0;a<n;a++)t+=r[a].byteLength;(i=new Uint8Array(t))[0]=t>>>24&255,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i.set(e,4);for(var s=8,o=0;o<n;o++)i.set(r[o],s),s+=r[o].byteLength;return i}},{key:"generateInitSegment",value:function(e){var t=d.box(d.types.ftyp,d.constants.FTYP),i=d.moov(e),r=new Uint8Array(t.byteLength+i.byteLength);return r.set(t,0),r.set(i,t.byteLength),r}},{key:"moov",value:function(e){var t=d.mvhd(e.timescale,e.duration),i=d.trak(e),r=d.mvex(e);return d.box(d.types.moov,t,i,r)}},{key:"mvhd",value:function(e,t){return d.box(d.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(e){return d.box(d.types.trak,d.tkhd(e),d.mdia(e))}},{key:"tkhd",value:function(e){var t=e.id,i=e.duration,r=e.presentWidth,n=e.presentHeight;return d.box(d.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,n>>>8&255,255&n,0,0]))}},{key:"mdia",value:function(e){return d.box(d.types.mdia,d.mdhd(e),d.hdlr(e),d.minf(e))}},{key:"mdhd",value:function(e){var t=e.timescale,i=e.duration;return d.box(d.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))}},{key:"hdlr",value:function(e){var t=null;return t="audio"===e.type?d.constants.HDLR_AUDIO:d.constants.HDLR_VIDEO,d.box(d.types.hdlr,t)}},{key:"minf",value:function(e){var t=null;return t="audio"===e.type?d.box(d.types.smhd,d.constants.SMHD):d.box(d.types.vmhd,d.constants.VMHD),d.box(d.types.minf,t,d.dinf(),d.stbl(e))}},{key:"dinf",value:function(){return d.box(d.types.dinf,d.box(d.types.dref,d.constants.DREF))}},{key:"stbl",value:function(e){return d.box(d.types.stbl,d.stsd(e),d.box(d.types.stts,d.constants.STTS),d.box(d.types.stsc,d.constants.STSC),d.box(d.types.stsz,d.constants.STSZ),d.box(d.types.stco,d.constants.STCO))}},{key:"stsd",value:function(e){return"audio"===e.type?"mp3"===e.codec?d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp3(e)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp4a(e)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.avc1(e))}},{key:"mp3",value:function(e){var t=e.channelCount,i=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return d.box(d.types[".mp3"],r)}},{key:"mp4a",value:function(e){var t=e.channelCount,i=e.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return d.box(d.types.mp4a,r,d.esds(e))}},{key:"esds",value:function(e){var t=e.config||[],i=t.length,r=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(t).concat([6,1,2]));return d.box(d.types.esds,r)}},{key:"avc1",value:function(e){var t=e.avcc,i=e.codecWidth,r=e.codecHeight,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return d.box(d.types.avc1,n,d.box(d.types.avcC,t))}},{key:"mvex",value:function(e){return d.box(d.types.mvex,d.trex(e))}},{key:"trex",value:function(e){var t=e.id,i=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.box(d.types.trex,i)}},{key:"moof",value:function(e,t){return d.box(d.types.moof,d.mfhd(e.sequenceNumber),d.traf(e,t))}},{key:"mfhd",value:function(e){var t=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return d.box(d.types.mfhd,t)}},{key:"traf",value:function(e,t){var i=e.id,r=d.box(d.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),n=d.box(d.types.tfdt,new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t])),a=d.sdtp(e),s=d.trun(e,a.byteLength+16+16+8+16+8+8);return d.box(d.types.traf,r,n,s,a)}},{key:"sdtp",value:function(e){for(var t=e.samples||[],i=t.length,r=new Uint8Array(4+i),n=0;n<i;n++){var a=t[n].flags;r[n+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return d.box(d.types.sdtp,r)}},{key:"trun",value:function(e,t){var i=e.samples||[],r=i.length,n=12+16*r,a=new Uint8Array(n);t+=8+n,a.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0);for(var s=0;s<r;s++){var o=i[s].duration,l=i[s].size,u=i[s].flags,h=i[s].cts;a.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,l>>>24&255,l>>>16&255,l>>>8&255,255&l,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s)}return d.box(d.types.trun,a)}},{key:"mdat",value:function(e){return d.box(d.types.mdat,e)}}]),d);function d(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d)}n.init(),t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.SampleInfo=function e(t,i,r,n,a){s(this,e),this.dts=t,this.pts=i,this.duration=r,this.originalDts=n,this.isSyncPoint=a,this.fileposition=null},t.MediaSegmentInfo=(r(a,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),a);function a(){s(this,a),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}t.IDRSampleList=(r(o,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(0<t.length&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,i=0,r=t.length-1,n=0,a=0,s=r;for(e<t[0].dts&&(i=0,a=s+1);a<=s;){if((n=a+Math.floor((s-a)/2))===r||e>=t[n].dts&&e<t[n+1].dts){i=n;break}t[n].dts<e?a=n+1:s=n-1}return this._list[i]}}]),o);function o(){s(this,o),this._list=[]}t.MediaSegmentInfoList=(r(l,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var i=t.length-1,r=0,n=0,a=i,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>t[r].lastSample.originalDts&&e<t[r+1].originalBeginDts){s=r;break}t[r].originalBeginDts<e?n=r+1:a=r-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,i=e,r=this._lastAppendLocation,n=0;-1!==r&&r<t.length&&i.originalBeginDts>=t[r].lastSample.originalDts&&(r===t.length-1||r<t.length-1&&i.originalBeginDts<t[r+1].originalBeginDts)?n=r+1:0<t.length&&(n=this._searchNearestSegmentBefore(i.originalBeginDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,i)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return 0<=t?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),i=this._list[t].syncPoints;0===i.length&&0<t;)t--,i=this._list[t].syncPoints;return 0<i.length?i[i.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),l);function l(e){s(this,l),this._type=e,this._list=[],this._lastAppendLocation=-1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=p(i(342)),a=p(i(366)),o=i(347),l=p(i(367)),u=p(i(368)),h=(p(i(369)),p(i(370))),d=p(i(371)),c=p(i(372)),f=p(i(373)),m=i(348);function p(e){return e&&e.__esModule?e:{default:e}}var v=(r(g,null,[{key:"isSupported",value:function(){return d.default.isSupported()}}]),r(g,[{key:"destroy",value:function(){this._loader&&(this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null),this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onCommand=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){if("fmp4"!==this._mediaType){var e=this._config;if("range"===e.seekType)this._seekHandler=new c.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",i=e.seekParamEnd||"bend";this._seekHandler=new f.default(t,i)}else{if("custom"!==e.seekType)throw new m.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new m.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}}}},{key:"_selectLoader",value:function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL){if(!d.default.isSupported())throw new m.RuntimeException("Your browser doesn't support websocket !");this._loaderClass=d.default}else if(l.default.isSupported())this._loaderClass=l.default;else if(u.default.isSupported())this._loaderClass=u.default;else{if(!h.default.isSupported())throw new m.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=h.default}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this),this._loader.onCommand=this._onCmdResponse.bind(this)}},{key:"open",value:function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._loader?(this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))):this._onLoaderError(o.LoaderErrors.UNSUPPORT,{code:-1,msg:"unsupport websocket"})}},{key:"abort",value:function(){this._loader?(this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)):this._onLoaderError(o.LoaderErrors.UNSUPPORT,{code:-1,msg:"unsupport websocket"})}},{key:"sendcmd",value:function(e){this._loader?this._loader.send(e):this._onLoaderError(o.LoaderErrors.UNSUPPORT,{code:-1,msg:"unsupport websocket"})}},{key:"pause",value:function(){this.isWorking()&&("fmp4"!=this._mediaType&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0),this._paused=!0)}},{key:"resume",value:function(){if(this._paused&&(this._paused=!1,"fmp4"!=this._mediaType)){var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}}},{key:"seek",value:function(e){this._paused=!1,"flv"===this._mediaType&&(this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0))}},{key:"_internalSeek",value:function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var i={from:e,to:-1};this._currentRange={from:i.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,i),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(e){if(!e||"string"!=typeof e||0===e.length)throw new m.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var i=new ArrayBuffer(t);if(0<this._stashUsed){var r=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(i,0,t).set(r,0)}this._stashBuffer=i,this._bufferSize=t}}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,i=t.length-1,r=0,n=0,a=i;if(e<t[0])return t[0];for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?n=r+1:a=r-1}}},{key:"_adjustStashSize",value:function(e){var t=0;8192<(t=this._config.isLive?e:e<512?e:512<=e&&e<=1024?Math.floor(1.5*e):2*e)&&(t=8192);var i=1024*t+1048576;this._bufferSize<i&&this._expandBuffer(i),this._stashSize=1024*t}},{key:"_dispatchChunks",value:function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)}},{key:"_onURLRedirect",value:function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)}},{key:"_onContentLengthKnown",value:function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(e,t,i){if(!this._onDataArrival)throw new m.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(this._speedSampler.addBytes(e.byteLength),"fmp4"!=this._mediaType){if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof());var r=this._speedSampler.lastSecondKBps;if(0!==r){var n=this._normalizeSpeed(r);this._speedNormalized!==n&&(this._speedNormalized=n,this._adjustStashSize(n))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)new Uint8Array(this._stashBuffer,0,this._stashSize).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else{var a=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(0<this._stashUsed){var s=this._stashBuffer.slice(0,this._stashUsed),o=this._dispatchChunks(s,this._stashByteStart);if(o<s.byteLength){if(0<o){var l=new Uint8Array(s,o);a.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=o}}else this._stashUsed=0,this._stashByteStart+=o;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),a=new Uint8Array(this._stashBuffer,0,this._bufferSize)),a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var u=this._dispatchChunks(e,t);if(u<e.byteLength){var h=e.byteLength-u;h>this._bufferSize&&(this._expandBuffer(h),a=new Uint8Array(this._stashBuffer,0,this._bufferSize)),a.set(new Uint8Array(e,u),0),this._stashUsed+=h,this._stashByteStart=t+u}}}else if(0===this._stashUsed){var d=this._dispatchChunks(e,t);if(d<e.byteLength){var c=e.byteLength-d;c>this._bufferSize&&this._expandBuffer(c),new Uint8Array(this._stashBuffer,0,this._bufferSize).set(new Uint8Array(e,d),0),this._stashUsed+=c,this._stashByteStart=t+d}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var f=new Uint8Array(this._stashBuffer,0,this._bufferSize);f.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var p=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(p<this._stashUsed&&0<p){var v=new Uint8Array(this._stashBuffer,p);f.set(v,0)}this._stashUsed-=p,this._stashByteStart+=p}}}else this._onDataArrival(e,t)}},{key:"_flushStashBuffer",value:function(e){if(0<this._stashUsed){var t=this._stashBuffer.slice(0,this._stashUsed),i=this._dispatchChunks(t,this._stashByteStart),r=t.byteLength-i;if(i<t.byteLength){if(!e){if(0<i){var n=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(t,i);n.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=i}return 0}s.default.w(this.TAG,r+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,r}return 0}},{key:"_onLoaderComplete",value:function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onCmdResponse",value:function(e){this._onCommand&&this._onCommand(e)}},{key:"_onLoaderError",value:function(e,t){switch(s.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case o.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var i=this._currentRange.to+1;return void(i<this._totalLength&&(s.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(i,!1)))}e=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:}if(!this._onError)throw new m.RuntimeException("IOException: "+t.msg);this._onError(e,t)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(e){this._extraData=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onCommand",get:function(){return this._onCommand},set:function(e){this._onCommand=e}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(e){this._onSeeked=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(e){this._onRedirect=e}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===h.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),g);function g(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),this.TAG="IOController",this._config=t,this._extraData=i,this._stashInitialSize=393216,null!=t.stashInitialSize&&0<t.stashInitialSize&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,!(this._enableStash=!0)===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._mediaType="string"==typeof e.mediaType?e.mediaType.toLowerCase():"","fmp4"!=this._mediaType?this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url):this._isWebSocketURL=!0,this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new a.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onCommand=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}t.default=v},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:500<=this._now()-this._lastCheckpoint?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}a(i(342));var o=a(i(351)),d=i(347),c=i(348);function a(e){return e&&e.__esModule?e:{default:e}}var s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,d.BaseLoader),r(l,null,[{key:"isSupported",value:function(){try{var e=o.default.msedge&&15048<=o.default.version.minor,t=!o.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}}}]),r(l,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0}(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var r=this;this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var n=this._seekHandler.getConfig(i,t),a=new self.Headers;if("object"===h(n.headers)){var s=n.headers;for(var o in s)s.hasOwnProperty(o)&&a.append(o,s[o])}var l={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===h(this._config.headers))for(var u in this._config.headers)a.append(u,this._config.headers[u]);!1===e.cors&&(l.mode="same-origin"),e.withCredentials&&(l.credentials="include"),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),this._status=d.LoaderStatus.kConnecting,fetch,self.fetch(n.url,l).then(function(e){if(r._requestAbort)return r._requestAbort=!1,void(r._status=d.LoaderStatus.kIdle);if(e.ok&&200<=e.status&&e.status<=299){if(e.url!==n.url&&r._onURLRedirect){var t=r._seekHandler.removeURLParameters(e.url);r._onURLRedirect(t)}var i=e.headers.get("Content-Length");return null!=i&&(r._contentLength=parseInt(i),0!==r._contentLength&&r._onContentLengthKnown&&r._onContentLengthKnown(r._contentLength)),r._pump.call(r,e.body.getReader())}if(r._status=d.LoaderStatus.kError,!r._onError)throw new c.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);r._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}).catch(function(e){if(!r._abortController||!r._abortController.signal.aborted){if(r._status=d.LoaderStatus.kError,!r._onError)throw e;r._onError(d.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}})}},{key:"abort",value:function(){this._requestAbort=!0,this._abortController&&this._abortController.abort(),this._pFetch&&this._pFetch.abort()}},{key:"_pump",value:function(a){var s=this;return a.read().then(function(e){if(e.done)if(null!==s._contentLength&&s._receivedLength<s._contentLength){s._status=d.LoaderStatus.kError;var t=d.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(!s._onError)throw new c.RuntimeException(i.msg);s._onError(t,i)}else s._status=d.LoaderStatus.kComplete,s._onComplete&&s._onComplete(s._range.from,s._range.from+s._receivedLength-1);else{if(!0===s._requestAbort)return s._requestAbort=!1,s._status=d.LoaderStatus.kComplete,a.cancel();s._status=d.LoaderStatus.kBuffering;var r=e.value.buffer,n=s._range.from+s._receivedLength;s._receivedLength+=r.byteLength,s._onDataArrival&&s._onDataArrival(r,n,s._receivedLength),s._pump(a)}}).catch(function(e){if(11!==e.code||!o.default.msedge){s._status=d.LoaderStatus.kError;var t=0,i=null;if(i=19!==e.code&&"network error"!==e.message||!(null===s._contentLength||null!==s._contentLength&&s._receivedLength<s._contentLength)?(t=d.LoaderErrors.EXCEPTION,{code:e.code,msg:e.message}):(t=d.LoaderErrors.EARLY_EOF,{code:e.code,msg:"Fetch stream meet Early-EOF"}),!s._onError)throw new c.RuntimeException(i.msg);s._onError(t,i)}})}}]),l);function l(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,"fetch-stream-loader"));return i.TAG="FetchStreamLoader",i._seekHandler=e,i._config=t,i._needStash=!0,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i._abortController=null,i._pFetch=null,i}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(342),o=(a=s)&&a.__esModule?a:{default:a},h=i(347),l=i(348);var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,h.BaseLoader),r(c,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),(e.responseType="moz-chunked-arraybuffer")===e.responseType}catch(e){return o.default.w("MozChunkedLoader",e.message),!1}}}]),r(c,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0}(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var r=this._seekHandler.getConfig(i,t);this._requestURL=r.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",r.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"===u(r.headers)){var a=r.headers;for(var s in a)a.hasOwnProperty(s)&&n.setRequestHeader(s,a[s])}if("object"===u(this._config.headers)){var o=this._config.headers;for(var l in o)o.hasOwnProperty(l)&&n.setRequestHeader(l,o[l])}this._status=h.LoaderStatus.kConnecting,n.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=h.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var i=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(i)}if(0!==t.status&&(t.status<200||299<t.status)){if(this._status=h.LoaderStatus.kError,!this._onError)throw new l.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=h.LoaderStatus.kBuffering}}},{key:"_onProgress",value:function(e){if(this._status!==h.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,i,this._receivedLength)}}},{key:"_onLoadEnd",value:function(e){!0!==this._requestAbort?this._status!==h.LoaderStatus.kError&&(this._status=h.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1}},{key:"_onXhrError",value:function(e){this._status=h.LoaderStatus.kError;var t=0,i=null;if(i=this._contentLength&&e.loaded<this._contentLength?(t=h.LoaderErrors.EARLY_EOF,{code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=h.LoaderErrors.EXCEPTION,{code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}}]),c);function c(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,"xhr-moz-chunked-loader"));return i.TAG="MozChunkedLoader",i._seekHandler=e,i._config=t,i._needStash=!0,i._xhr=null,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(342),o=(a=s)&&a.__esModule?a:{default:a},c=i(347),l=i(348);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,c.BaseLoader),r(h,null,[{key:"isSupported",value:function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),(e.responseType="ms-stream")===e.responseType}catch(e){return o.default.w("MSStreamLoader",e.message),!1}}}]),r(h,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0}(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._internalOpen(e,t,!1)}},{key:"_internalOpen",value:function(e,t,i){this._dataSource=e,i?this._currentRange=t:this._totalRange=t;var r=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?r=this._currentRedirectedURL:null!=e.redirectedURL&&(r=e.redirectedURL));var n=this._seekHandler.getConfig(r,t);this._currentRequestURL=n.url;var a=this._reader=new self.MSStreamReader;a.onprogress=this._msrOnProgress.bind(this),a.onload=this._msrOnLoad.bind(this),a.onerror=this._msrOnError.bind(this);var s=this._xhr=new XMLHttpRequest;if(s.open("GET",n.url,!0),s.responseType="ms-stream",s.onreadystatechange=this._xhrOnReadyStateChange.bind(this),s.onerror=this._xhrOnError.bind(this),e.withCredentials&&(s.withCredentials=!0),"object"===d(n.headers)){var o=n.headers;for(var l in o)o.hasOwnProperty(l)&&s.setRequestHeader(l,o[l])}if("object"===d(this._config.headers)){var u=this._config.headers;for(var h in u)u.hasOwnProperty(h)&&s.setRequestHeader(h,u[h])}this._isReconnecting?this._isReconnecting=!1:this._status=c.LoaderStatus.kConnecting,s.send()}},{key:"abort",value:function(){this._internalAbort(),this._status=c.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)}},{key:"_xhrOnReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState)if(200<=t.status&&t.status<=299){if(this._status=c.LoaderStatus.kBuffering,null!=t.responseURL){var i=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}var r=t.getResponseHeader("Content-Length");if(null!=r&&null==this._contentLength){var n=parseInt(r);0<n&&(this._contentLength=n,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=c.LoaderStatus.kError,!this._onError)throw new l.RuntimeException("MSStreamLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else if(3===t.readyState&&200<=t.status&&t.status<=299){this._status=c.LoaderStatus.kBuffering;var a=t.response;this._reader.readAsArrayBuffer(a)}}},{key:"_xhrOnError",value:function(e){this._status=c.LoaderStatus.kError;var t=c.LoaderErrors.EXCEPTION,i={code:-1,msg:e.constructor.name+" "+e.type};if(!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}},{key:"_msrOnProgress",value:function(e){var t=e.target.result;if(null!=t){var i=t.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=t.byteLength;var r=this._totalRange.from+this._receivedLength;this._receivedLength+=i.byteLength,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),t.byteLength>=this._bufferLimit&&(o.default.v(this.TAG,"MSStream buffer exceeded max size near "+(r+i.byteLength)+", reconnecting..."),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()}},{key:"_doReconnectIfNeeded",value:function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var e={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,e,!0)}}},{key:"_msrOnLoad",value:function(e){this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}},{key:"_msrOnError",value:function(e){this._status=c.LoaderStatus.kError;var t=0,i=null;if(i=this._contentLength&&this._receivedLength<this._contentLength?(t=c.LoaderErrors.EARLY_EOF,{code:-1,msg:"MSStream meet Early-Eof"}):(t=c.LoaderErrors.EARLY_EOF,{code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}}]),h);function h(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,"xhr-msstream-loader"));return i.TAG="MSStreamLoader",i._seekHandler=e,i._config=t,i._needStash=!0,i._xhr=null,i._reader=null,i._totalRange=null,i._currentRange=null,i._currentRequestURL=null,i._currentRedirectedURL=null,i._contentLength=null,i._receivedLength=0,i._bufferLimit=16777216,i._lastTimeBufferSize=0,i._isReconnecting=!1,i}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=h(i(342)),s=h(i(366)),o=i(347),l=i(348);function h(e){return e&&e.__esModule?e:{default:e}}var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,o.BaseLoader),r(c,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),(e.responseType="arraybuffer")===e.responseType}catch(e){return a.default.w("RangeLoader",e.message),!1}}}]),r(c,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0}(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t,this._status=o.LoaderStatus.kConnecting;var i=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(i=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||i?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,i=t+e;null!=this._contentLength&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:i},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var i=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?i=this._currentRedirectedURL:null!=e.redirectedURL&&(i=e.redirectedURL));var r=this._seekHandler.getConfig(i,t);this._currentRequestURL=r.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",r.url,!0),n.responseType="arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onload=this._onLoad.bind(this),n.onerror=this._onXhrError.bind(this),e.withCredentials&&(n.withCredentials=!0),"object"===u(r.headers)){var a=r.headers;for(var s in a)a.hasOwnProperty(s)&&n.setRequestHeader(s,a[s])}if("object"===u(this._config.headers)){var o=this._config.headers;for(var l in o)o.hasOwnProperty(l)&&n.setRequestHeader(l,o[l])}n.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var i=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(200<=t.status&&t.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else{if(this._status=o.LoaderStatus.kError,!this._onError)throw new l.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}}},{key:"_onProgress",value:function(e){if(this._status!==o.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,t=this._totalLengthReceived=!0;var i=e.total;this._internalAbort(),null!=i&0!==i&&(this._totalLength=i)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var r=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(r)}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,i=t.length-1,r=0,n=0,a=i;if(e<t[0])return t[0];for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?n=r+1:a=r-1}}},{key:"_onLoad",value:function(e){if(this._status!==o.LoaderStatus.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,3<=this._zeroSpeedChunkCount&&(t=this._speedSampler.currentKBps)),0!==t){var i=this._normalizeSpeed(t);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var r=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(r,n,this._receivedLength),a&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=o.LoaderStatus.kError;var t=0,i=null;if(i=this._contentLength&&0<this._receivedLength&&this._receivedLength<this._contentLength?(t=o.LoaderErrors.EARLY_EOF,{code:-1,msg:"RangeLoader meet Early-Eof"}):(t=o.LoaderErrors.EXCEPTION,{code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new l.RuntimeException(i.msg);this._onError(t,i)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),c);function c(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,"xhr-range-loader"));return i.TAG="RangeLoader",i._seekHandler=e,i._config=t,i._needStash=!1,i._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],i._currentChunkSizeKB=384,i._currentSpeedNormalized=0,i._zeroSpeedChunkCount=0,i._xhr=null,i._speedSampler=new s.default,i._requestAbort=!1,i._waitForTotalLength=!1,i._totalLengthReceived=!1,i._currentRequestURL=null,i._currentRedirectedURL=null,i._currentRequestRange=null,i._totalLength=null,i._contentLength=null,i._receivedLength=0,i._lastTimeLoaded=0,i}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(342),o=((a=s)&&a.__esModule,i(347)),l=i(348);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,o.BaseLoader),r(h,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket&&window&&(self.WebSocket=window.WebSocket),void 0!==self.WebSocket}catch(e){return!1}}}]),r(h,[{key:"destroy",value:function(){this._ws&&this.abort(),this._status=o.LoaderStatus.kIdle,this._onDataArrival=null,this._onError=null,this._onComplete=null,this._onCommand=null,function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(r):void 0}(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"destroy",this).call(this)}},{key:"isWorking",value:function(){return this._status===o.LoaderStatus.kConnecting||this._status===o.LoaderStatus.kBuffering}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._channelInfo=e.channelInfo,this._status=o.LoaderStatus.kConnecting}catch(e){this._status=o.LoaderStatus.kError;var i={code:e.code,msg:e.message};if(!this._onError)throw new l.RuntimeException(i.msg);this._onError(o.LoaderErrors.EXCEPTION,i)}}},{key:"send",value:function(e){var t=this._ws;if(t&&1===t.readyState)"string"==typeof e?t.send(e):t.send(JSON.stringify(e));else{this._status=o.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket readyState while sending"};if(!this._onError)throw new l.RuntimeException(i.msg);this._onError(o.LoaderErrors.EXCEPTION,i)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=o.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function(e){this._status=o.LoaderStatus.kBuffering,this._channelInfo.devicetype&&"flv"===this._channelInfo.devicetype.toLowerCase()||this.send({type:"command",name:"StartStream",param:this._channelInfo})}},{key:"_onWebSocketClose",value:function(e){!0!==this._requestAbort?(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if("string"==typeof e.data)this._onCommandResponse(e.data);else if(e.data instanceof Blob){var i=new FileReader;i.onload=function(){t._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(e.data)}else{this._status=o.LoaderStatus.kError;var r={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new l.RuntimeException(r.msg);this._onError(o.LoaderErrors.EXCEPTION,r)}}},{key:"_onCommandResponse",value:function(e){this._onCommand&&this._onCommand(e)}},{key:"_dispatchArrayBuffer",value:function(e){var t=this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,t,this._receivedLength)}},{key:"_onWebSocketError",value:function(e){if(!this._requestAbort){this._status=o.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new l.RuntimeException(t.msg);this._onError(o.LoaderErrors.CONNECTING_ERROR,t)}}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onCommand",get:function(){return this._onCommand},set:function(e){this._onCommand=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),h);function h(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,"websocket-loader"));return e.TAG="WebSocketLoader",e._type="websocket-loader",e._needStash=!0,e._status=o.LoaderStatus.kIdle,e._onDataArrival=null,e._onError=null,e._onComplete=null,e._onCommand=null,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e._channelInfo=null,e}t.default=u},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"getConfig",value:function(e,t){var i={};if(0!==t.from||-1!==t.to){var r=void 0;r=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",i.Range=r}else this._zeroStart&&(i.Range="bytes=0-");return{url:e,headers:i}}},{key:"removeURLParameters",value:function(e){return e}}]),a);function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this._zeroStart=e||!1}t.default=n},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,[{key:"getConfig",value:function(e,t){var i=e;if(0!==t.from||-1!==t.to){var r=!0;-1===i.indexOf("?")&&(i+="?",r=!1),r&&(i+="&"),i+=this._startName+"="+t.from.toString(),-1!==t.to&&(i+="&"+this._endName+"="+t.to.toString())}return{url:i,headers:{}}}},{key:"removeURLParameters",value:function(e){var t=e.split("?")[0],i=void 0,r=e.indexOf("?");-1!==r&&(i=e.substring(r+1));var n="";if(null!=i&&0<i.length)for(var a=i.split("&"),s=0;s<a.length;s++){var o=a[s].split("="),l=0<s;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(n+="&"),n+=a[s])}return 0===n.length?t:t+"?"+n}}]),a);function a(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this._startName=e,this._endName=t}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint",COMMAND_RESPONSE:"command_response"}},function(e,t,f){function l(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=i,n.c=r,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var e=n(n.s=ENTRY_MODULE);return e.default||e}var p="[\\.|\\-|\\+|\\w|/|@]+",v="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+p+").*?\\)";function m(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function c(e,t,i){var r={};r[i]=[];var n=t.toString(),a=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return r;for(var s,o=a[1],l=new RegExp("(\\\\n|\\W)"+m(o)+v,"g");s=l.exec(n);)"dll-reference"!==s[3]&&r[i].push(s[3]);for(l=new RegExp("\\("+m(o)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+v,"g");s=l.exec(n);)e[s[2]]||(r[i].push(s[1]),e[s[2]]=f(s[1]).m),r[s[2]]=r[s[2]]||[],r[s[2]].push(s[4]);for(var u,h=Object.keys(r),d=0;d<h.length;d++)for(var c=0;c<r[h[d]].length;c++)u=r[h[d]][c],isNaN(1*u)||(r[h[d]][c]=1*r[h[d]][c]);return r}function g(i){return Object.keys(i).reduce(function(e,t){return e||0<i[t].length},!1)}e.exports=function(e,t){t=t||{};var i={main:f.m},r=t.all?{main:Object.keys(i.main)}:function(e,t){for(var i={main:[t]},r={main:[]},n={main:{}};g(i);)for(var a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o].pop();if(n[o]=n[o]||{},!n[o][l]&&e[o][l]){n[o][l]=!0,r[o]=r[o]||[],r[o].push(l);for(var u=c(e,e[o][l],o),h=Object.keys(u),d=0;d<h.length;d++)i[h[d]]=i[h[d]]||[],i[h[d]]=i[h[d]].concat(u[h[d]])}}return r}(i,e),n="";Object.keys(r).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;r[t][e];)e++;r[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+t+" = ("+l.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r[t].map(function(e){return JSON.stringify(e)+": "+i[t][e].toString()}).join(",")+"});\n"}),n=n+"new (("+l.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"}))(self);";var a=new window.Blob([n],{type:"text/javascript"});if(t.bare)return a;var s=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),o=new window.Worker(s);return o.objectURL=s,o}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(i(342));var a=r(i(353)),s=r(i(377)),o=r(i(354)),l=r(i(374));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(r){var i=null,n=function(e,t){r.postMessage({msg:"logcat_callback",data:{type:e,logcat:t}})}.bind(this);s.default.install(),r.addEventListener("message",function(e){switch(e.data.cmd){case"init":(i=new o.default(e.data.param[0],e.data.param[1])).on(l.default.IO_ERROR,function(e,t){r.postMessage({msg:l.default.IO_ERROR,data:{type:e,info:t}})}.bind(this)),i.on(l.default.DEMUX_ERROR,function(e,t){r.postMessage({msg:l.default.DEMUX_ERROR,data:{type:e,info:t}})}.bind(this)),i.on(l.default.INIT_SEGMENT,function(e,t){var i={msg:l.default.INIT_SEGMENT,data:{type:e,data:t}};r.postMessage(i,[t.data])}.bind(this)),i.on(l.default.MEDIA_SEGMENT,function(e,t){var i={msg:l.default.MEDIA_SEGMENT,data:{type:e,data:t}};r.postMessage(i,[t.data])}.bind(this)),i.on(l.default.LOADING_COMPLETE,function(){var e={msg:l.default.LOADING_COMPLETE};r.postMessage(e)}.bind(this)),i.on(l.default.RECOVERED_EARLY_EOF,function(){var e={msg:l.default.RECOVERED_EARLY_EOF};r.postMessage(e)}.bind(this)),i.on(l.default.MEDIA_INFO,function(e){var t={msg:l.default.MEDIA_INFO,data:e};r.postMessage(t)}.bind(this)),i.on(l.default.METADATA_ARRIVED,function(e){var t={msg:l.default.METADATA_ARRIVED,data:e};r.postMessage(t)}.bind(this)),i.on(l.default.SCRIPTDATA_ARRIVED,function(e){var t={msg:l.default.SCRIPTDATA_ARRIVED,data:e};r.postMessage(t)}.bind(this)),i.on(l.default.STATISTICS_INFO,function(e){var t={msg:l.default.STATISTICS_INFO,data:e};r.postMessage(t)}.bind(this)),i.on(l.default.RECOMMEND_SEEKPOINT,function(e){r.postMessage({msg:l.default.RECOMMEND_SEEKPOINT,data:e})}.bind(this));break;case"destroy":i&&(i.destroy(),i=null),r.postMessage({msg:"destroyed"});break;case"start":i.start();break;case"stop":i.stop();break;case"sendcmd":i.sendcmd(e.data.param);break;case"seek":i.seek(e.data.param);break;case"pause":i.pause();break;case"resume":i.resume();break;case"logging_config":var t=e.data.param;a.default.applyConfig(t),!0===t.enableCallback?a.default.addLogListener(n):a.default.removeLogListener(n)}})}},function(e,t,i){"use strict";function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}(a,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t},"function"!=typeof self.Promise&&i(378).polyfill()}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}n.install(),t.default=n},function(e,t,i){(function(B,N){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.6+9869a4bc
 */
e.exports=function(){"use strict";function u(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,t=void 0,n=void 0,s=function(e,t){c[r]=e,c[r+1]=t,2===(r+=2)&&(n?n(f):p())};var e="undefined"!=typeof window?window:void 0,a=e||{},o=a.MutationObserver||a.WebKitMutationObserver,l="undefined"==typeof self&&void 0!==B&&"[object process]"==={}.toString.call(B),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(f,1)}}var c=new Array(1e3);function f(){for(var e=0;e<r;e+=2){var t=c[e],i=c[e+1];t(i),c[e]=void 0,c[e+1]=void 0}r=0}var p=void 0;function v(e,t){var i=this,r=new this.constructor(_);void 0===r[g]&&P(r);var n=i._state;if(n){var a=arguments[n-1];s(function(){return L(n,r,a,i._result)})}else I(i,r,e,t);return r}function m(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(_);return R(t,e),t}p=l?function(){return B.nextTick(f)}:o?function(){var e=0,t=new o(f),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}():h?function(){var e=new MessageChannel;return e.port1.onmessage=f,function(){return e.port2.postMessage(0)}}():void 0===e?function(){try{var e=Function("return this")().require("vertx");return void 0===(t=e.runOnLoop||e.runOnContext)?d():function(){t(f)}}catch(e){return d()}}():d();var g=Math.random().toString(36).substring(2);function _(){}var y=void 0,b=1,S=2,E={error:null};function k(e){try{return e.then}catch(e){return E.error=e,E}}function w(e,t,i,r){try{e.call(t,i,r)}catch(e){return e}}function T(e,t,i){t.constructor===e.constructor&&i===v&&t.constructor.resolve===m?function(t,e){e._state===b?C(t,e._result):e._state===S?x(t,e._result):I(e,void 0,function(e){return R(t,e)},function(e){return x(t,e)})}(e,t):i===E?(x(e,E.error),E.error=null):void 0===i?C(e,t):u(i)?function(e,r,n){s(function(t){var i=!1,e=w(n,r,function(e){i||(i=!0,r!==e?R(t,e):C(t,e))},function(e){i||(i=!0,x(t,e))},t._label);!i&&e&&(i=!0,x(t,e))},e)}(e,t,i):C(e,t)}function R(e,t){e===t?x(e,new TypeError("You cannot resolve a promise with itself")):!function(e){var t=typeof e;return null!==e&&("object"==t||"function"==t)}(t)?C(e,t):T(e,t,k(t))}function A(e){e._onerror&&e._onerror(e._result),O(e)}function C(e,t){e._state===y&&(e._result=t,e._state=b,0!==e._subscribers.length&&s(O,e))}function x(e,t){e._state===y&&(e._state=S,e._result=t,s(A,e))}function I(e,t,i,r){var n=e._subscribers,a=n.length;e._onerror=null,n[a]=t,n[a+b]=i,n[a+S]=r,0===a&&e._state&&s(O,e)}function O(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r=void 0,n=void 0,a=e._result,s=0;s<t.length;s+=3)r=t[s],n=t[s+i],r?L(i,r,n,a):n(a);e._subscribers.length=0}}function L(e,t,i,r){var n=u(i),a=void 0,s=void 0,o=void 0,l=void 0;if(n){if((a=function(e,t){try{return e(t)}catch(e){return E.error=e,E}}(i,r))===E?(l=!0,s=a.error,a.error=null):o=!0,t===a)return void x(t,new TypeError("A promises callback cannot return that same promise."))}else a=r,o=!0;t._state!==y||(n&&o?R(t,a):l?x(t,s):e===b?C(t,a):e===S&&x(t,a))}var D=0;function P(e){e[g]=D++,e._state=void 0,e._result=void 0,e._subscribers=[]}var M=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(_),this.promise[g]||P(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&C(this.promise,this._result))):x(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===y&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===m){var n=k(t);if(n===v&&t._state!==y)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===F){var a=new i(_);T(a,t,n),this._willSettleAt(a,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},e.prototype._settledAt=function(e,t,i){var r=this.promise;r._state===y&&(this._remaining--,e===S?x(r,i):this._result[t]=i),0===this._remaining&&C(r,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;I(e,void 0,function(e){return i._settledAt(b,t,e)},function(e){return i._settledAt(S,t,e)})},e}();var F=function(){function t(e){this[g]=D++,this._result=this._state=void 0,this._subscribers=[],_!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){R(t,e)},function(e){x(t,e)})}catch(e){x(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var i=this.constructor;return u(t)?this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return F.prototype.then=v,F.all=function(e){return new M(this,e).promise},F.race=function(n){var a=this;return i(n)?new a(function(e,t){for(var i=n.length,r=0;r<i;r++)a.resolve(n[r]).then(e,t)}):new a(function(e,t){return t(new TypeError("You must pass an array to race."))})},F.resolve=m,F.reject=function(e){var t=new this(_);return x(t,e),t},F._setScheduler=function(e){n=e},F._setAsap=function(e){s=e},F._asap=s,F.polyfill=function(){var e=void 0;if(void 0!==N)e=N;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=F},F.Promise=F}()}).call(this,i(379),i(2))},function(e,t){var i,r,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,u=[],h=!1,d=-1;function c(){h&&l&&(h=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!h){var e=o(c);h=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new p(e,t)),1!==u.length||h||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=v,n.addListener=v,n.once=v,n.off=v,n.removeListener=v,n.removeAllListeners=v,n.emit=v,n.prependListener=v,n.prependOnceListener=v,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=u(i(343)),v=u(i(342)),l=u(i(351)),h=u(i(381)),s=i(364),o=i(348);function u(e){return e&&e.__esModule?e:{default:e}}var d=(r(c,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)throw new o.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");this._mediaElement=e;var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var i=this._pendingSegments[t];i.splice(0,i.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var r=this._sourceBuffers[t];if(r){if("closed"!==e.readyState){try{e.removeSourceBuffer(r)}catch(e){v.default.e(this.TAG,e.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){v.default.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}if(this._mediaElement){try{this._mediaElement.pause(),this._mediaElement.src="",this._mediaElement.removeAttribute("src")}catch(e){}this._mediaElement=null}this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var i=e,r=""+i.container;i.codec&&0<i.codec.length&&(r+=";codecs="+i.codec);var n=!1;if(v.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[i.type]=i,r!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])v.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+r);else{n=!0;try{var a=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(r);a.addEventListener("error",this.e.onSourceBufferError),a.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return v.default.e(this.TAG,e.message),void this._emitter.emit(h.default.ERROR,{code:e.code,msg:e.message})}}this._mimeTypes[i.type]=r}t||this._pendingSegments[i.type].push(i),n||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),l.default.safari&&"audio/mpeg"===i.container&&0<i.mediaDuration&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&!this._hasPendingRemoveRanges()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[t.type];!i||i.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(e){for(var t in this._seekpos=e,this._removechecktime=0,this._afterseek=!0,this._sourceBuffers)if(this._sourceBuffers[t]){var i=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{i.abort()}catch(e){v.default.e(this.TAG,e.message)}this._idrList.clear();var r=this._pendingSegments[t];if(r.splice(0,r.length),"closed"!==this._mediaSource.readyState){for(var n=0;n<i.buffered.length;n++){var a=i.buffered.start(n),s=i.buffered.end(n);this._pendingRemoveRanges[t].push({start:a,end:s})}if(i.updating||this._doRemoveRanges(),l.default.safari){var o=this._lastInitSegments[t];o&&(this._pendingSegments[t].push(o),i.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i)for(var r=i.buffered,n=0;n<r.length;n++){var a=r.start(n);if(r.end(n),e-a>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var i=this._sourceBuffers[t];if(i){for(var r=i.buffered,n=!1,a=0;a<r.length;a++){var s=r.start(a),o=r.end(a);if(s<=e&&e<o+3){if(e-s>=this._config.autoCleanupMaxBackwardDuration){n=!0;for(var l=e-this._config.autoCleanupMinBackwardDuration,u=this._pendingRemoveRanges[t],h=!1,d=0;d<u.length;d++)if(u[d].start===s){u[d].end=l,h=!0;break}h||this._pendingRemoveRanges[t].push({start:s,end:l})}}else if(o<e)if(this._config.isLive)n=!0,this._pendingRemoveRanges[t].push({start:s,end:o}),v.default.w(this.TAG,"_doCleanupSourceBuffer from "+s+" to "+o+"  doRemove "+n);else{n=!0;for(var c=this._pendingRemoveRanges[t],f=!1,p=0;p<c.length;p++)if(c[p].start===s){c[p].end=o,f=!0,v.default.v(this.TAG,"_doCleanupSourceBuffer reset _pendingRemoveRanges  currentTime "+e+" from "+s+" to "+o);break}f||this._pendingRemoveRanges[t].push({start:s,end:o})}}n&&!i.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,i=this._pendingMediaDuration;0<i&&(isNaN(t)||t<i)&&(v.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],i=this._pendingRemoveRanges[e];i.length&&!t.updating;){var r=i.shift();try{t.remove(r.start,r.end)}catch(e){v.default.e(this.TAG,e.message)}}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&0<e[t].length){var i=e[t].shift();if(i.timestampOffset){var r=this._sourceBuffers[t].timestampOffset,n=i.timestampOffset/1e3;.1<Math.abs(r-n)&&(v.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+n),this._sourceBuffers[t].timestampOffset=n),delete i.timestampOffset}if(!i.data||0===i.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(i.data),this._isBufferFull=!1,this._afterseek&&(v.default.v(this.TAG,"_afterseek appendBuffer"),this._afterseek=!1),"video"===t&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(i),22===e.code?(this._isBufferFull||this._emitter.emit(h.default.BUFFER_FULL),this._isBufferFull=!0):(v.default.e(this.TAG,e.message),this._emitter.emit(h.default.ERROR,{code:e.code,msg:e.message}))}}}},{key:"_onSourceOpen",value:function(){if(v.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),0<this._pendingSourceBufferInit.length)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(h.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function(){v.default.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){v.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e&&(e.video&&0<e.video.length||e.audio&&0<e.audio.length)}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e&&(e.video&&0<e.video.length||e.audio&&0<e.audio.length)}},{key:"_onSourceBufferUpdateEnd",value:function(){this._mediaElement&&(this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?(this._pendingSegments&&this._pendingSegments.video&&20<this._pendingSegments.video.length&&this._doAppendSegments(),this._doRemoveRanges()):this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),0<=this._seekpos&&this._checkSourceSeek(),this._emitter.emit(h.default.UPDATE_END))}},{key:"_onSourceBufferError",value:function(e){v.default.e(this.TAG,"SourceBuffer Error: "+e)}},{key:"_checkSourceSeek",value:function(){if(this._mediaElement)try{var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers)if("video"===t){var i=this._sourceBuffers[t];if(i){var r=i.buffered;this._bufferdlength!==r.length&&(this._bufferdlength=r.length);for(var n=0;n<r.length;n++){var a=r.start(n),s=r.end(n);if(0<=this._seekpos){var o=this._seekpos-a;if(10<o&&this._removechecktime++<this._defremovechecktime){var l=s<this._seekpos-10?s:this._seekpos-10;this._pendingRemoveRanges[t].push({start:a,end:l}),i.updating||this._doRemoveRanges()}if(10<s-this._seekpos&&this._removechecktime++<this._defremovechecktime){var u=a>this._seekpos+10?a:this._seekpos+10;this._pendingRemoveRanges[t].push({start:u,end:s}),i.updating||this._doRemoveRanges()}if(0<=o&&(this._seekpos<=s||o<3))return v.default.w(this.TAG,"_seekpos: "+this._seekpos),this._emitter.emit(h.default.SOURCE_SEEK,o<3?a:this._seekpos),void(this._seekpos=-1);if(-3<o&&this._seekpos<=s)return v.default.w(this.TAG,"MSEEvents.SOURCE_SEEK: "+this._seekpos+" to "+a),this._seekpos=-1,void this._emitter.emit(h.default.SOURCE_SEEK,a)}else if(this._seekpos>=-this._defseekchecktime)return e==a&&(this._seekpos=this._seekpos-1,this._seekpos<=-this._defseekchecktime&&this._emitter.emit(h.default.SOURCE_SEEK,a)),void(e-10<s&&(this._pendingRemoveRanges[t].push({_temp:a,end:s}),i.updating||this._doRemoveRanges()))}}}}catch(e){}}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),this.TAG="MSEController",this._config=e,this._emitter=new a.default,this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this._config.autoCleanupSourceBuffer=!0,this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._defseekchecktime=10,this._seekpos=-1-this._defseekchecktime,this._bufferdlength=0,this._defremovechecktime=2,this._removechecktime=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new s.IDRSampleList,this._afterseek=!1}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full",SOURCE_SEEK:"source_seek"}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpRequest=t.HttpEvents=t.HttpStatus=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}a(348);var s,o=a(343),l=(s=o)&&s.__esModule?s:{default:s};var u=t.HttpStatus={kIdle:0,kConnecting:1,kSuccess:2,kError:3,kInitError:4},h=t.HttpEvents={OnInitSuccess:"OnInitSuccess",OnInitFail:"OnInitFail",OnKeepAliveFail:"OnKeepAliveFail"},d=-104999;t.HttpRequest=(r(c,[{key:"destroy",value:function(){this._tokenId&&(this._postReq("/api/h5ms/mcc/v1/Logout",{tokenId:this._tokenId}),this._tokenId=null),this._keepAliveTimer&&(clearInterval(this._keepAliveTimer),this._keepAliveTimer=null),this._keepAliveWorker&&(this._workerDestroying||(this._workerDestroying=!0,this._keepAliveWorker.postMessage({cmd:"destroy"})))}},{key:"addEventListener",value:function(e,t){e===h.OnInitSucces&&this._status===u.kSuccess?this._emitter.emit(h.OnInitSuccess,this._url):e===h.OnInitFail&&this._status===u.kInitError?this._emitter.emit(h.OnInitFail,this._url):e===h.OnKeepAliveFail&&this._status===u.kError&&this._emitter.emit(h.OnKeepAliveFail,h.OnInitFail),this._emitter.addListener(e,t)}},{key:"listObject",value:function(e,t){var i={deviceType:e.devicetype,user:e.user,password:e.password,ip:e.ip,port:e.port,objType:e.objtype};return this._postReq("/api/h5ms/mcc/v1/ListObject",{tokenId:this._tokenId,param:i},function(e){"ListObject"==e.name?t&&t(e.param):t&&t(e)}),!0}},{key:"startStream",value:function(e,t){this.init(),"vod"===e.streamtype.toLowerCase()?this.startVodStream(e,t):this.startRealStream(e,t)}},{key:"startRealStream",value:function(e,t){var i={};Object.assign(i,e),i.protocolType="httpflv",i.deviceType=e.devicetype,delete i.devicetype,this._postReq("/api/h5ms/mcc/v1/StartRealStream",{tokenId:this._tokenId,param:i},t)}},{key:"queryRecord",value:function(e,t){var i={};return Object.assign(i,e),i.deviceType=e.devicetype,i.beginTime=e.begintime,i.endTime=e.endtime,delete i.devicetype,delete i.begintime,delete i.endtime,this._postReq("/api/h5ms/mcc/v1/QueryRecord",{tokenId:this._tokenId,param:i},function(e){"QueryRecord"==e.name?t&&t(e.param):t&&t(e)}),!0}},{key:"startVodStream",value:function(e,t){var i={};Object.assign(i,e),i.deviceType=e.devicetype,i.beginTime=e.begintime,i.endTime=e.endtime,delete i.devicetype,delete i.begintime,delete i.endtime,"pfsfile"==i.deviceType.toLowerCase()&&(i.deviceType="pfs"),i.protocolType="httpflv",this._postReq("/api/h5ms/mcc/v1/StartVodStream",{tokenId:this._tokenId,param:i},t)}},{key:"seek",value:function(e,t,i){this._postReq("/api/h5ms/mcc/v1/Seek",{tokenId:this._tokenId,param:{streamId:e,value:""+t}},i)}},{key:"setSpeed",value:function(e,t,i){this._postReq("/api/h5ms/mcc/v1/SetSpeed",{tokenId:this._tokenId,param:{streamId:e,value:t}},i)}},{key:"getSpeed",value:function(e,t){this._postReq("/api/h5ms/mcc/v1/GetSpeed",{tokenId:this._tokenId,param:{streamId:e}},t)}},{key:"pause",value:function(e,t,i){this._postReq("/api/h5ms/mcc/v1/Pause",{tokenId:this._tokenId,param:{streamId:e,value:t}},i)}},{key:"ptzControl",value:function(e,t,i,r){this._postReq("/api/h5ms/mcc/v1/PtzControl",{tokenId:this._tokenId,param:{streamId:e,cmd:t,value:i}},r)}},{key:"ptzControl3D",value:function(e,t,i,r,n,a,s){this._postReq("/api/h5ms/mcc/v1/PtzControl3D",{tokenId:this._tokenId,param:{streamId:e,direct:t,x:i,y:r,w:n,h:a}},s)}},{key:"ptzLock",value:function(e,t,i){this._postReq("/api/h5ms/mcc/v1/PtzLock",{tokenId:this._tokenId,param:{streamId:e,value:t}},i)}},{key:"init",value:function(){this._status!=u.kConnecting&&this._status!=u.kSuccess&&(this._keepAliveTimer&&(window.clearInterval(this._keepAliveTimer),this._keepAliveTimer=null),this._status=u.kConnecting,this._postReq("/api/h5ms/mcc/v1/Login",{user:this._config.h5msUser,password:this._config.h5msPassword},this._onInitCallback.bind(this)))}},{key:"_onInitCallback",value:function(e){if(e&&0===e.param.error&&"Login"===e.name){if(this._tokenId=e.msg.tokenId,this._status=u.kSuccess,"undefined"!=typeof Worker)if(null==this._keepAliveWorker)try{var t=a(375),i=this._keepAliveWorker=t(383);this._workerDestroying=!1,i.addEventListener("message",this._onWorkerMessage.bind(this)),i.onerror=function(e){},i.postMessage({cmd:"init",param:[this._url,{tokenId:this._tokenId},5e3]})}catch(e){console.warn("Error while initialize keepAliveTimer worker, fallback to inline keepAliveTimer"),this._keepAliveWorker=null,this._keepAliveTimer=window.setInterval(this._keepAlive.bind(this),5e3)}else this._keepAliveWorker.postMessage({cmd:"init",param:[this._url,{tokenId:this._tokenId},5e3]});else this._keepAliveTimer=window.setInterval(this._keepAlive.bind(this),5e3);for(this._onInit&&this._onInit(h.OnInitSuccess,this._url),this._emitter.emit(h.OnInitSuccess,this._url);0<this._taskList.length;){var r=this._taskList.shift();this._postReq(r[0],r[1],r[2])}}else for(this._status=u.kError,this._onError&&this._onError(h.OnInitFail,this._url),this._emitter.emit(h.OnInitFail,this._url);0<this._taskList.length;){var n=this._taskList.shift();n[2]&&(0,n[2])({error:d,param:{error:d},msg:h.OnInitFail})}}},{key:"_onWorkerMessage",value:function(e){var t=e.data,i=t.data.url,r=t.data.res;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._keepAliveWorker.terminate(),this._keepAliveWorker=null,void console.log("_keepAliveWorker.terminate()");switch(t.msg){case"KeepAliveError":if(i==this._url){if(r.msg&&"Invailed Token"===r.msg.errorMsg)return this._emitter.emit(h.OnKeepAliveFail,this._url,{}),this._status=u.kError,this._onError&&this._onError(h.OnKeepAliveFail,this._url),void this.init();this._emitter.emit(h.OnKeepAliveFail,this._url,{}),this._status=u.kError,this._onError&&this._onError(h.OnKeepAliveFail,this._url)}}}},{key:"_keepAlive",value:function(){var t=0;this._postReq("/api/h5ms/mcc/v1/KeepAlive",{tokenId:this._tokenId},function(e){if(e&&0===e.error&&"KeepAlive"===e.name)t=0;else{if(e.msg&&"Invailed Token"===e.msg.errorMsg)return this._emitter.emit(h.OnKeepAliveFail,this._url,{}),this._status=u.kError,this._onError&&this._onError(h.OnKeepAliveFail,this._url),void this.init();2<++t&&(this._emitter.emit(h.OnKeepAliveFail,this._url,{}),this._status=u.kError,this._onError&&this._onError(h.OnKeepAliveFail,this._url))}})}},{key:"_postReq",value:function(e,t,i){if(!t.tokenId&&this._status===u.kConnecting&&e.indexOf("Login")<0)this._taskList.push([e,t,i]);else if(this._status!==u.kError&&this._status!==u.kInitError)if(window.fetch){var r={method:"POST",mode:"cors",cache:"default",body:JSON.stringify(t),headers:new Headers({})};this._fetch(this._url+e,r,i)}else window.XMLHttpRequest&&this._xmlHttpRequest(this._url+e,t,i);else i&&i({error:d,param:{error:d}})}},{key:"_xmlHttpRequest",value:function(e,t,n){var a=!0,i=new XMLHttpRequest;i.onreadystatechange=function(e){var t=e.target;if(4==t.readyState)if(200==t.status&&a&&n){a=!1;var i=JSON.parse(t.responseText),r={error:200==i.code?0:i.code};i.msg.info&&(r.info=i.msg.info),i.msg.value&&(r.value=i.msg.value),n({name:i.cmd,param:r,msg:i.msg})}else this._status=u.kError,a&&n&&(a=!1,n({error:d,param:{error:d},msg:e}))},i.open("POST",e,!0),i.send(JSON.stringify(t)),i.onerror=function(e){this._status=u.kError,a&&n&&(a=!1,n({error:d,param:{error:d},msg:e}))}}},{key:"_fetch",value:function(e,t,i){var r=this,n=!0;window.fetch(e,t).then(function(e){return e.json()}).then(function(e){if(n&&i){n=!1;var t={error:200==e.code?0:e.code};e.msg.info&&(t.info=e.msg.info),e.msg.value&&(t.value=e.msg.value),i({name:e.cmd,param:t,msg:e.msg})}}).catch(function(e){r._status=u.kError,n&&i&&(n=!1,i({error:d,param:{error:d},msg:e}))})}},{key:"url",get:function(){return this._url}},{key:"status",get:function(){return this._status}},{key:"onError",set:function(e){this._onError=e,this._status==u.kInitError&&this._onError?this._onError(h.OnInitFail,this._url):this._status==u.kError&&this._onError&&this._onError(h.OnKeepAliveFail,this._url)},get:function(){return this._onError}},{key:"onInit",set:function(e){this._onInit=e,this._status==u.kSuccess&&this._onInit&&this._onInit(h.OnInitSuccess,this._url)},get:function(){return this._onInit}}]),c);function c(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),this.TAG="HttpRequest",this._config={h5msUser:"admin",h5msPassword:"admin"},"object"===(void 0===e?"undefined":i(e))&&Object.assign(this._config,e),this._tokenId=null,this._url=e.h5msUrl,this._status=u.kIdle,this._emitter=new l.default,this._keepAliveTimer=null,this._keepAliveWorker=null,this._workerDestroying=!1,this._onError=null,this._onInit=null,this._taskList=[]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=i(377),s=(r=n)&&r.__esModule?r:{default:r};t.default=function(t){var i=null,r=null,n=null;function a(){!function(e,t){if(fetch){var i={method:"POST",mode:"cors",cache:"default",body:JSON.stringify(t),headers:new Headers({})};!function(e,t,i){var r=this,n=!0;fetch(e,t).then(function(e){return e.json()}).then(function(e){n&&i&&(n=!1,i(e))}).catch(function(e){r._status=HttpStatus.kError,n&&i&&(n=!1,i({code:-1,msg:e}))})}(e,i)}else XMLHttpRequest&&function(e,t,r){var n=!0,i=new XMLHttpRequest;i.onreadystatechange=function(e){var t=e.target;if(4==t.readyState)if(200==t.status&&n&&r){n=!1;var i=JSON.parse(t.responseText);r(i)}else this._status=HttpStatus.kError,n&&r&&(n=!1,r({code:-1,msg:e}))},i.open("POST",e,!0),i.send(JSON.stringify(t)),i.onerror=function(e){this._status=HttpStatus.kError,n&&r&&(n=!1,r({code:-1,msg:e}))}}(e,t)}(r+"/api/h5ms/mcc/v1/KeepAlive",n)}s.default.install(),t.addEventListener("message",function(e){switch(e.data.cmd){case"init":i&&(clearInterval(i),i=null),r=e.data.param[0],n=e.data.param[1],i=setInterval(a,e.data.param[2]);break;case"destroy":i&&(clearInterval(i),i=null),t.postMessage({msg:"destroyed"})}})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=d(i(343)),o=d(i(345)),l=i(346),u=i(348),h=d(i(385));function d(e){return e&&e.__esModule?e:{default:e}}var c=(n(f,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this._player&&(this._player.destroy(),this._player=null),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var i=this;e===o.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(o.default.MEDIA_INFO,i.mediaInfo)}):e===o.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){i._emitter.emit(o.default.STATISTICS_INFO,i.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(!this._player)throw new u.IllegalStateException("HlsPlayer has been destroyed!");(this._mediaElement=e).addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("seeked",this.e.onvSeeked),e.addEventListener("error",this.e.onvError),e.addEventListener("ratechange",this.e.onvRateChange),e.addEventListener("timeupdate",this.e.onvTimeUpdate),this._player.attachMedia(e),this._player.on(h.default.Events.ERROR,this._onHlsError.bind(this))}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._player&&this._player.detachMedia(),this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("seeked",this.e.onvSeeked),this._mediaElement.removeEventListener("error",this.e.onvError),this._mediaElement.removeEventListener("ratechange",this.e.onvRateChange),this._mediaElement.removeEventListener("timeupdate",this.e.onvTimeUpdate),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement||!this._player)throw new u.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.muted=!0,this._mediaElement.autoplay=!0,this._player.loadSource(this._mediaDataSource.channelInfo.url),this._player.startLoad(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),1e3)}},{key:"unload",value:function(){this._player&&this._player.stopLoad(),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){if(this._mediaDataSource.isLive)return!1;this._emitter.emit(o.default.VIDEOPLAY),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.VIDEOPLAY);try{this._mediaElement.play().catch(function(e){})}catch(e){}return!0}},{key:"pause",value:function(){return!this._mediaDataSource.isLive&&(this._emitter.emit(o.default.VIDEOPAUSE),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.VIDEOPAUSE),this._mediaElement.pause(),!0)}},{key:"_onvCanPlay",value:function(e){!1===this._receivedCanPlay&&(this._emitter.emit(o.default.FIRST_CANPLAY),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.FIRST_CANPLAY)),this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvTimeUpdate",value:function(e){this._emitter.emit(o.default.PLAYTIME,this._mediaElement.currentTime),this._callbacks&&"function"==typeof this._callbacks.onplaytime&&this._mediaElement&&this._callbacks.onplaytime(this._mediaElement.currentTime)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeked",value:function(e){this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.VIDEOSEEK,{currentTime:this._mediaElement.currentTime}),this._emitter.emit(o.default.VIDEOSEEK,{currentTime:this._mediaElement.currentTime})}},{key:"_onvRateChange",value:function(e){this._emitter.emit(o.default.SPEEDCHANGE,{playbackRate:this._mediaElement.playbackRate}),this._callbacks&&"function"==typeof this._callbacks.onnotify&&this._callbacks.onnotify(o.default.SPEEDCHANGE,{playbackRate:this._mediaElement.playbackRate})}},{key:"_onvError",value:function(e){var t=this._mediaElement.error.code?this._mediaElement.error.code:e.code;this._emitter.emit(o.default.ERROR,l.ErrorTypes.MEDIA_ERROR,l.ErrorDetails.MEDIA_VIDEO_ERROR,{code:t}),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onerror(l.ErrorTypes.MEDIA_ERROR,l.ErrorDetails.MEDIA_VIDEO_ERROR,{code:t})}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"_onHlsError",value:function(e,t){if(0!=t.fatal){var i=l.ErrorTypes.OTHER_ERROR;switch(t.type){case h.default.ErrorTypes.NETWORK_ERROR:i=l.ErrorTypes.NETWORK_ERROR;break;case h.default.ErrorTypes.MEDIA_ERROR:case h.default.ErrorTypes.KEY_SYSTEM_ERROR:case h.default.ErrorTypes.MUX_ERROR:i=l.ErrorTypes.MEDIA_ERROR}this._emitter.emit(o.default.ERROR,i,t.details,{code:e.code}),this._callbacks&&"function"==typeof this._callbacks.onerror&&this._callbacks.onerror(i,t.details,{code:e.code})}else console.log(t)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement.currentTime},set:function(e){this._mediaDataSource.isLive||(this._mediaElement.currentTime=e)}},{key:"playbackRate",get:function(){return this._mediaElement?this._mediaDataSource.isLive?1:this._mediaElement.playbackRate:0},set:function(e){if(this._mediaElement)return this._mediaDataSource.isLive?void 0:this._mediaElement.playbackRate=16<e?16:e}},{key:"mediaInfo",get:function(){return this._mediaElement&&(null==this._mediaInfo&&(this._mediaInfo={}),this._mediaInfo.duration=this._mediaElement.duration,this._mediaInfo.videoWidth=this._mediaElement.videoWidth,this._mediaInfo.videoHeight=this._mediaElement.videoHeight),Object.assign({},this._mediaInfo)}},{key:"frameDuration",get:function(){return this._frameDuration}},{key:"statisticsInfo",get:function(){var e={playerType:this._type};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,i=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();i=n.totalVideoFrames,r=n.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(i=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=i,e.droppedFrames=r),e}}]),f);function f(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),this.TAG="HlsPlayer",this._type="HlsPlayer",this._emitter=new s.default,this._config=t,this._callbacks=null,"object"===r(e.callbacks)&&(this._callbacks=e.callbacks),"hls"!==e.channelInfo.devicetype.toLowerCase())throw new u.InvalidArgumentException("HlsPlayer does't support stream input!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvSeeked:this._onvSeeked.bind(this),onvError:this._onvError.bind(this),onvTimeUpdate:this._onvTimeUpdate.bind(this),onvRateChange:this._onvRateChange.bind(this)},this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null,this._receivedCanPlay=!1,this._frameDuration=.04,this._player=new h.default(this._config)}t.default=c},function(e,t,i){var r;"undefined"!=typeof window&&(r=function(){return(r={},n.m=i={"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty,f="~";function n(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,r||e,n),s=f?f+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(f=!1)),s.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)r.call(e,t)&&i.push(f?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=f?f+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,a=new Array(n);r<n;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=f?f+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,n,a){var s=f?f+e:e;if(!this._events[s])return!1;var o,l,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,r),!0;case 5:return u.fn.call(u.context,t,i,r,n),!0;case 6:return u.fn.call(u.context,t,i,r,n,a),!0}for(l=1,o=new Array(h-1);l<h;l++)o[l-1]=arguments[l];u.fn.apply(u.context,o)}else{var d,c=u.length;for(l=0;l<c;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,i);break;case 4:u[l].fn.call(u[l].context,t,i,r);break;default:if(!o)for(d=1,o=new Array(h-1);d<h;d++)o[d-1]=arguments[d];u[l].fn.apply(u[l].context,o)}}return!0},s.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},s.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},s.prototype.removeListener=function(e,t,i,r){var n=f?f+e:e;if(!this._events[n])return this;if(!t)return u(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||r&&!a.once||i&&a.context!==i||u(this,n);else{for(var s=0,o=[],l=a.length;s<l;s++)(a[s].fn!==t||r&&!a[s].once||i&&a[s].context!==i)&&o.push(a[s]);o.length?this._events[n]=1===o.length?o[0]:o:u(this,n)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=f?f+e:e,this._events[t]&&u(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=f,s.EventEmitter=s,e.exports=s},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,i){var r,h,n,a,d;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,h=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,d={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var r=d.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=d.normalizePath(r.path),d.buildURLFromParts(r)}var n=d.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return i.alwaysNormalize?(n.path=d.normalizePath(n.path),d.buildURLFromParts(n)):t;var a=d.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var s=h.exec(a.path);a.netLoc=s[1],a.path=s[2]}a.netLoc&&!a.path&&(a.path="/");var o={scheme:a.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(o.netLoc=a.netLoc,"/"!==n.path[0]))if(n.path){var l=a.path,u=l.substring(0,l.lastIndexOf("/")+1)+n.path;o.path=d.normalizePath(u)}else o.path=a.path,n.params||(o.params=a.params,n.query||(o.query=a.query));return null===o.path&&(o.path=i.alwaysNormalize?d.normalizePath(n.path):n.path),d.buildURLFromParts(o)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=d},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,f){function l(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=i,n.c=r,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var e=n(n.s=ENTRY_MODULE);return e.default||e}var p="[\\.|\\-|\\+|\\w|/|@]+",v="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+p+").*?\\)";function m(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function c(e,t,i){var r={};r[i]=[];var n=t.toString(),a=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return r;for(var s,o=a[1],l=new RegExp("(\\\\n|\\W)"+m(o)+v,"g");s=l.exec(n);)"dll-reference"!==s[3]&&r[i].push(s[3]);for(l=new RegExp("\\("+m(o)+'\\("(dll-reference\\s('+p+'))"\\)\\)'+v,"g");s=l.exec(n);)e[s[2]]||(r[i].push(s[1]),e[s[2]]=f(s[1]).m),r[s[2]]=r[s[2]]||[],r[s[2]].push(s[4]);for(var u,h=Object.keys(r),d=0;d<h.length;d++)for(var c=0;c<r[h[d]].length;c++)u=r[h[d]][c],isNaN(1*u)||(r[h[d]][c]=1*r[h[d]][c]);return r}function g(i){return Object.keys(i).reduce(function(e,t){return e||0<i[t].length},!1)}e.exports=function(e,t){t=t||{};var i={main:f.m},r=t.all?{main:Object.keys(i.main)}:function(e,t){for(var i={main:[t]},r={main:[]},n={main:{}};g(i);)for(var a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o].pop();if(n[o]=n[o]||{},!n[o][l]&&e[o][l]){n[o][l]=!0,r[o]=r[o]||[],r[o].push(l);for(var u=c(e,e[o][l],o),h=Object.keys(u),d=0;d<h.length;d++)i[h[d]]=i[h[d]]||[],i[h[d]]=i[h[d]].concat(u[h[d]])}}return r}(i,e),n="";Object.keys(r).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;r[t][e];)e++;r[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+t+" = ("+l.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r[t].map(function(e){return JSON.stringify(e)+": "+i[t][e].toString()}).join(",")+"});\n"}),n=n+"new (("+l.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"}))(self);";var a=new window.Blob([n],{type:"text/javascript"});if(t.bare)return a;var s=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),o=new window.Worker(s);return o.objectURL=s,o}},"./src/crypt/decrypter.js":
/*!********************************************!*\
  !*** ./src/crypt/decrypter.js + 3 modules ***!
  \********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.js */function(e,t,i){"use strict";var o=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),l=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();var u=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),r=0;r<4;r++)i[r]=t.getUint32(4*r);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],n=i[1],a=i[2],s=i[3],o=this.invSubMix,l=o[0],u=o[1],h=o[2],d=o[3],c=new Uint32Array(256),f=0,p=0,v=0;for(v=0;v<256;v++)c[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99;var g=c[t[e[f]=m]=f],_=c[g],y=c[_],b=257*c[m]^16843008*m;r[f]=b<<24|b>>>8,n[f]=b<<16|b>>>16,a[f]=b<<8|b>>>24,s[f]=b,b=16843009*y^65537*_^257*g^16843008*f,l[m]=b<<24|b>>>8,u[m]=b<<16|b>>>16,h[m]=b<<8|b>>>24,d[m]=b,f?(f=g^c[c[c[y^g]]],p^=c[c[p]]):f=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,r=0;r<t.length&&i;)i=t[r]===this.key[r],r++;if(!i){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,s,o,l,u=this.ksRows=4*(n+6+1),h=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),c=this.sBox,f=this.rcon,p=this.invSubMix,v=p[0],m=p[1],g=p[2],_=p[3];for(a=0;a<u;a++)a<n?o=h[a]=t[a]:(l=o,a%n==0?(l=c[(l=l<<8|l>>>24)>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[255&l],l^=f[a/n|0]<<24):6<n&&a%n==4&&(l=c[l>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[255&l]),h[a]=o=(h[a-n]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?h[a]:h[a-4],d[s]=s<4||a<=4?l:v[c[l>>>24]]^m[c[l>>>16&255]]^g[c[l>>>8&255]]^_[c[255&l]],d[s]=d[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i,r){for(var n,a,s,o,l,u,h,d,c,f,p,v,m,g,_=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,S=this.invSubMix,E=S[0],k=S[1],w=S[2],T=S[3],R=this.uint8ArrayToUint32Array_(i),A=R[0],C=R[1],x=R[2],I=R[3],O=new Int32Array(e),L=new Int32Array(O.length),D=this.networkToHostOrderSwap;t<O.length;){for(c=D(O[t]),f=D(O[t+1]),p=D(O[t+2]),v=D(O[t+3]),l=c^y[0],u=v^y[1],h=p^y[2],d=f^y[3],m=4,g=1;g<_;g++)n=E[l>>>24]^k[u>>16&255]^w[h>>8&255]^T[255&d]^y[m],a=E[u>>>24]^k[h>>16&255]^w[d>>8&255]^T[255&l]^y[m+1],s=E[h>>>24]^k[d>>16&255]^w[l>>8&255]^T[255&u]^y[m+2],o=E[d>>>24]^k[l>>16&255]^w[u>>8&255]^T[255&h]^y[m+3],l=n,u=a,h=s,d=o,m+=4;n=b[l>>>24]<<24^b[u>>16&255]<<16^b[h>>8&255]<<8^b[255&d]^y[m],a=b[u>>>24]<<24^b[h>>16&255]<<16^b[d>>8&255]<<8^b[255&l]^y[m+1],s=b[h>>>24]<<24^b[d>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[m+2],o=b[d>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&h]^y[m+3],m+=3,L[t]=D(n^A),L[t+1]=D(o^C),L[t+2]=D(s^x),L[t+3]=D(a^I),A=c,C=f,x=p,I=v,t+=4}return r?function(e){var t=e.byteLength,i=t&&new DataView(e).getUint8(t-1);return i?e.slice(0,t-i):e}(L.buffer):L.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),a=i("./src/errors.js"),h=i("./src/utils/logger.js"),s=i("./src/events.js"),r=i("./src/utils/get-self-scope.js"),d=Object(r.getSelfScope)(),n=function(){function e(e,t,i){var r=(void 0===i?{}:i).removePKCS7Padding,n=void 0===r||r;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=n)try{var a=d.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(t,i,r,n){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(h.logger.log("JS AES decrypt"),this.logEnabled=!1);var e=this.decryptor;e||(this.decryptor=e=new u),e.expandKey(i),n(e.decrypt(t,0,r,this.removePKCS7Padding))}else{this.logEnabled&&(h.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var s=this.subtle;this.key!==i&&(this.key=i,this.fastAesKey=new l(s,i)),this.fastAesKey.expandKey().then(function(e){new o(s,r).decrypt(t,e).catch(function(e){a.onWebCryptoError(e,t,i,r,n)}).then(function(e){n(e)})}).catch(function(e){a.onWebCryptoError(e,t,i,r,n)})}},t.onWebCryptoError=function(e,t,i,r,n){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,i,r,n)):(h.logger.error("decrypting error : "+e.message),this.observer.trigger(s.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=n},"./src/demux/demuxer-inline.js":
/*!**************************************************!*\
  !*** ./src/demux/demuxer-inline.js + 11 modules ***!
  \**************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.js */function(e,t,i){"use strict";var $=i("./src/events.js"),ee=i("./src/errors.js"),v=i("./src/crypt/decrypter.js"),p=i("./src/polyfills/number-isFinite.js"),te=i("./src/utils/logger.js"),r=i("./src/utils/get-self-scope.js");function n(e,t){return 255===e[t]&&240==(246&e[t+1])}function h(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function m(e,t){return!!(t+1<e.length&&n(e,t))}function a(e,t){if(m(e,t)){var i=h(e,t);t+5<e.length&&(i=d(e,t));var r=t+i;if(r===e.length||r+1<e.length&&n(e,r))return!0}return!1}function g(e,t,i,r,n){if(!e.samplerate){var a=function(e,t,i,r){var n,a,s,o,l,u=navigator.userAgent.toLowerCase(),h=r,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(n=1+((192&t[i+2])>>>6),a=(60&t[i+2])>>>2,!(d.length-1<a))return o=(1&t[i+2])<<2,o|=(192&t[i+3])>>>6,te.logger.log("manifest codec:"+r+",ADTS data:type:"+n+",sampleingIndex:"+a+"["+d[a]+"Hz],channelConfig:"+o),s=/firefox/i.test(u)?6<=a?(n=5,l=new Array(4),a-3):(n=2,l=new Array(2),a):-1!==u.indexOf("android")?(n=2,l=new Array(2),a):(n=5,l=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&6<=a?a-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(6<=a&&1==o||/vivaldi/i.test(u))||!r&&1==o)&&(n=2,l=new Array(2)),a)),l[0]=n<<3,l[0]|=(14&a)>>1,l[1]|=(1&a)<<7,l[1]|=o<<3,5===n&&(l[1]|=(14&s)>>1,l[2]=(1&s)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:d[a],channelCount:o,codec:"mp4a.40."+n,manifestCodec:h};e.trigger($.default.ERROR,{type:ee.ErrorTypes.MEDIA_ERROR,details:ee.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a})}(t,i,r,n);e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,te.logger.log("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)}}function _(e){return 9216e4/e}function y(e,t,i,r,n){var a=function(e,t,i,r,n){var a,s,o=e.length;if(a=h(e,t),s=d(e,t),0<(s-=a)&&t+a+s<=o)return{headerLength:a,frameLength:s,stamp:i+r*n}}(t,i,r,n,_(e.samplerate));if(a){var s=a.stamp,o=a.headerLength,l=a.frameLength,u={unit:t.subarray(i+o,i+o+l),pts:s,dts:s};return e.samples.push(u),{sample:u,length:l+o}}}var b,S=i("./src/demux/id3.js"),k=function(){function e(e,t,i){this.observer=e,this.config=i,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,i,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(S.default.getID3Data(e,0)||[]).length,i=e.length;t<i;t++)if(a(e,t))return te.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,i,r){for(var n=this._audioTrack,a=S.default.getID3Data(e,0)||[],s=S.default.getTimeStamp(a),o=Object(p.isFiniteNumber)(s)?90*s:9e4*t,l=0,u=o,h=e.length,d=a.length,c=[{pts:u,dts:u,data:a}];d<h-1;)if(m(e,d)&&d+5<h){g(n,this.observer,e,d,n.manifestCodec);var f=y(n,e,d,o,l);if(!f){te.logger.log("Unable to parse AAC frame");break}d+=f.length,u=f.sample.pts,l++}else S.default.isHeader(e,d)?(a=S.default.getID3Data(e,d),c.push({pts:u,dts:u,data:a}),d+=a.length):d++;this.remuxer.remux(n,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,i,r)},t.destroy=function(){},e}(),w=i("./src/demux/mp4demuxer.js"),E={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,i,r,n){if(!(i+24>t.length)){var a=this.parseHeader(t,i);if(a&&i+a.frameLength<=t.length){var s=r+n*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(i,i+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength}}}},parseHeader:function(e,t){var i=e[t+1]>>3&3,r=e[t+1]>>1&3,n=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!=i&&0!=n&&15!=n&&3!=a){var o=3==i?3-r:3==r?3:4,l=1e3*E.BitratesMap[14*o+n-1],u=3==i?0:2==i?1:2,h=E.SamplingRateMap[3*u+a],d=e[t+3]>>6==3?1:2,c=E.SamplesCoefficients[i][r],f=E.BytesInSlot[r],p=8*c*f;return{sampleRate:h,channelCount:d,frameLength:parseInt(c*l/h+s,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var i=this.parseHeader(e,t),r=4;i&&i.frameLength&&(r=i.frameLength);var n=t+r;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},T=E,R=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");r.set(e.subarray(i,i+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return 32<e&&te.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?i<<t|this.readBits(t):i},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,i=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(i+this.readEG()+256)%256),i=0===r?i:r},t.readSPS=function(){var e,t,i,r,n,a,s,o=0,l=0,u=0,h=0,d=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),v=this.skipBits.bind(this),m=this.skipEG.bind(this),g=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(d(),e=d(),c(5),v(3),d(),g(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var y=f();if(3===y&&v(1),g(),g(),v(1),p())for(a=3!==y?8:12,s=0;s<a;s++)p()&&_(s<6?16:64)}g();var b=f();if(0===b)f();else if(1===b)for(v(1),m(),m(),t=f(),s=0;s<t;s++)m();g(),v(1),i=f(),r=f(),0===(n=c(1))&&v(1),v(1),p()&&(o=f(),l=f(),u=f(),h=f());var S=[1,1];if(p()&&p())switch(d()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(i+1)-2*o-2*l),height:(2-n)*(r+1)*16-(n?2:4)*(u+h),pixelRatio:S}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),s=function(){function e(e,t,i,r){this.decryptdata=i,this.discardEPB=r,this.decrypter=new v.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(t,i,r,n){var a=t[i].unit,e=a.subarray(16,a.length-a.length%16),s=e.buffer.slice(e.byteOffset,e.byteOffset+e.length),o=this;this.decryptBuffer(s,function(e){e=new Uint8Array(e),a.set(e,16),n||o.decryptAacSamples(t,i+1,r)})},t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,i,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)i.set(e.subarray(n,n+16),r);return i},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var i=0,r=32;r<=e.length-16;r+=160,i+=16)e.set(t.subarray(i,i+16),r);return e},t.decryptAvcSample=function(t,i,r,n,a,s){var o=this.discardEPB(a.data),e=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(e.buffer,function(e){a.data=l.getAvcDecryptedUnit(o,e),s||l.decryptAvcSamples(t,i,r+1,n)})},t.decryptAvcSamples=function(e,t,i,r){for(;;t++,i=0){if(t>=e.length)return void r();for(var n=e[t].units;!(i>=n.length);i++){var a=n[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,i,r,a,s),!s)return}}}},e}(),o={video:1,audio:2,id3:3,text:4},A=function(){function O(e,t,i,r){this.observer=e,this.config=i,this.typeSupported=r,this.remuxer=t,this.sampleAes=null}var e=O.prototype;return e.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new s(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},O.probe=function(e){var t=O._syncOffset(e);return!(t<0)&&(t&&te.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),!0)},O._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},O.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:o[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},e.resetInitSegment=function(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=O.createTrack("video",r),this._audioTrack=O.createTrack("audio",r),this._id3Track=O.createTrack("id3",r),this._txtTrack=O.createTrack("text",r),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=i,this._duration=r},e.resetTimeStamp=function(){},e.append=function(e,t,i,r){var n,a,s,o,l,u=e.length,h=!1;this.contiguous=i;var d=this.pmtParsed,c=this._avcTrack,f=this._audioTrack,p=this._id3Track,v=c.pid,m=f.pid,g=p.pid,_=this._pmtId,y=c.pesData,b=f.pesData,S=p.pesData,E=this._parsePAT,k=this._parsePMT,w=this._parsePES,T=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),A=this._parseMPEGPES.bind(this),C=this._parseID3PES.bind(this),x=O._syncOffset(e);for(u-=(u+x)%188,n=x;n<u;n+=188)if(71===e[n]){if(a=!!(64&e[n+1]),s=((31&e[n+1])<<8)+e[n+2],1<(48&e[n+3])>>4){if((o=n+5+e[n+4])===n+188)continue}else o=n+4;switch(s){case v:a&&(y&&(l=w(y))&&void 0!==l.pts&&T(l,!1),y={data:[],size:0}),y&&(y.data.push(e.subarray(o,n+188)),y.size+=n+188-o);break;case m:a&&(b&&(l=w(b))&&void 0!==l.pts&&(f.isAAC?R(l):A(l)),b={data:[],size:0}),b&&(b.data.push(e.subarray(o,n+188)),b.size+=n+188-o);break;case g:a&&(S&&(l=w(S))&&void 0!==l.pts&&C(l),S={data:[],size:0}),S&&(S.data.push(e.subarray(o,n+188)),S.size+=n+188-o);break;case 0:a&&(o+=e[o]+1),_=this._pmtId=E(e,o);break;case _:a&&(o+=e[o]+1);var I=k(e,o,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(v=I.avc)&&(c.pid=v),0<(m=I.audio)&&(f.pid=m,f.isAAC=I.isAAC),0<(g=I.id3)&&(p.pid=g),h&&!d&&(te.logger.log("reparse from beginning"),h=!1,n=x-188),d=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger($.default.ERROR,{type:ee.ErrorTypes.MEDIA_ERROR,details:ee.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});y&&(l=w(y))&&void 0!==l.pts?(T(l,!0),c.pesData=null):c.pesData=y,b&&(l=w(b))&&void 0!==l.pts?(f.isAAC?R(l):A(l),f.pesData=null):(b&&b.size&&te.logger.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=b),S&&(l=w(S))&&void 0!==l.pts?(C(l),p.pesData=null):p.pesData=S,null==this.sampleAes?this.remuxer.remux(f,c,p,this._txtTrack,t,i,r):this.decryptAndRemux(f,c,p,this._txtTrack,t,i,r)},e.decryptAndRemux=function(e,t,i,r,n,a,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){o.decryptAndRemuxAvc(e,t,i,r,n,a,s)})}else this.decryptAndRemuxAvc(e,t,i,r,n,a,s)},e.decryptAndRemuxAvc=function(e,t,i,r,n,a,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){o.remuxer.remux(e,t,i,r,n,a,s)})}else this.remuxer.remux(e,t,i,r,n,a,s)},e.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e._parsePMT=function(e,t,i,r){var n,a,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<n;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){te.logger.log("unkown stream type:"+e[t]);break}case 15:-1===s.audio&&(s.audio=a);break;case 21:-1===s.id3&&(s.id3=a);break;case 219:if(!r){te.logger.log("unkown stream type:"+e[t]);break}case 27:-1===s.avc&&(s.avc=a);break;case 3:case 4:i?-1===s.audio&&(s.audio=a,s.isAAC=!1):te.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:te.logger.warn("HEVC stream type found, not supported for now");break;default:te.logger.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s},e._parsePES=function(e){var t,i,r,n,a,s,o,l,u=0,h=e.data;if(!e||0===e.size)return null;for(;h[0].length<19&&1<h.length;){var d=new Uint8Array(h[0].length+h[1].length);d.set(h[0]),d.set(h[1],h[0].length),h[0]=d,h.splice(1,1)}if(1!==((t=h[0])[0]<<16)+(t[1]<<8)+t[2])return null;if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;192&(i=t[7])&&(4294967295<(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2)&&(s-=8589934592),64&i?(4294967295<(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)&&(o-=8589934592),54e5<s-o&&(te.logger.warn(Math.round((s-o)/9e4)+"s delta between PTS and DTS, align them"),s=o)):o=s),l=(n=t[8])+9,e.size-=l,a=new Uint8Array(e.size);for(var c=0,f=h.length;c<f;c++){var p=(t=h[c]).byteLength;if(l){if(p<l){l-=p;continue}t=t.subarray(l),p-=l,l=0}a.set(t,u),u+=p}return r&&(r-=n+3),{data:a,pts:s,dts:o,len:r}},e.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,r=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,i.push(e)):t.dropped++}e.debug.length&&te.logger.log(e.pts+"/"+e.dts+":"+e.debug)},e._parseAVCPES=function(p,e){function v(e,t,i,r){return{key:e,pts:t,dts:i,units:[],debug:r}}var m,g,_,y=this,b=this._avcTrack,t=this._parseAVCNALu(p.data),S=this.avcSample,E=!1,k=this.pushAccesUnit.bind(this);p.data=null,S&&t.length&&!b.audFound&&(k(S,b),S=this.avcSample=v(!1,p.pts,p.dts,"")),t.forEach(function(e){switch(e.type){case 1:g=!0,(S=S||(y.avcSample=v(!0,p.pts,p.dts,""))).frame=!0;var t=e.data;if(E&&4<t.length){var i=new R(t).readSliceType();2!==i&&4!==i&&7!==i&&9!==i||(S.key=!0)}break;case 5:g=!0,(S=S||(y.avcSample=v(!0,p.pts,p.dts,""))).key=!0,S.frame=!0;break;case 6:g=!0,(m=new R(y.discardEPB(e.data))).readUByte();for(var r=0,n=0,a=!1,s=0;!a&&1<m.bytesAvailable;){for(r=0;r+=s=m.readUByte(),255===s;);for(n=0;n+=s=m.readUByte(),255===s;);if(4===r&&0!==m.bytesAvailable){if(a=!0,181===m.readUByte())if(49===m.readUShort())if(1195456820===m.readUInt())if(3===m.readUByte()){var o=m.readUByte(),l=31&o,u=[o,m.readUByte()];for(_=0;_<l;_++)u.push(m.readUByte()),u.push(m.readUByte()),u.push(m.readUByte());y._insertSampleInOrder(y._txtTrack.samples,{type:3,pts:p.pts,bytes:u})}}else if(n<m.bytesAvailable)for(_=0;_<n;_++)m.readUByte()}break;case 7:if(E=g=!0,!b.sps){var h=(m=new R(e.data)).readSPS();b.width=h.width,b.height=h.height,b.pixelRatio=h.pixelRatio,b.sps=[e.data],b.duration=y._duration;var d=e.data.subarray(1,4),c="avc1.";for(_=0;_<3;_++){var f=d[_].toString(16);f.length<2&&(f="0"+f),c+=f}b.codec=c}break;case 8:g=!0,b.pps||(b.pps=[e.data]);break;case 9:g=!1,b.audFound=!0,S&&k(S,b),S=y.avcSample=v(!1,p.pts,p.dts,"");break;case 12:g=!1;break;default:g=!1,S&&(S.debug+="unknown NAL "+e.type+" ")}S&&g&&S.units.push(e)}),e&&S&&(k(S,b),this.avcSample=null)},e._insertSampleInOrder=function(e,t){var i=e.length;if(0<i){if(t.pts>=e[i-1].pts)e.push(t);else for(var r=i-1;0<=r;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},e._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var i=this._avcTrack.samples;t=i[i.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},e._parseAVCNALu=function(e){var t,i,r,n,a=0,s=e.byteLength,o=this._avcTrack,l=o.naluState||0,u=l,h=[],d=-1;for(-1===l&&(n=31&e[d=0],l=0,a=1);a<s;)if(t=e[a++],l)if(1!==l)if(t)if(1===t){if(0<=d)r={data:e.subarray(d,a-l-1),type:n},h.push(r);else{var c=this._getLastNalUnit();if(c&&(u&&a<=4-u&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-u)),0<(i=a-l-1))){var f=new Uint8Array(c.data.byteLength+i);f.set(c.data,0),f.set(e.subarray(0,i),c.data.byteLength),c.data=f}}l=a<s?(n=31&e[d=a],0):-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(0<=d&&0<=l&&(r={data:e.subarray(d,s),type:n,state:l},h.push(r)),0===h.length){var p=this._getLastNalUnit();if(p){var v=new Uint8Array(p.data.byteLength+e.byteLength);v.set(p.data,0),v.set(e,p.data.byteLength),p.data=v}}return o.naluState=l,h},e.discardEPB=function(e){for(var t,i,r=e.byteLength,n=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(n.push(a+2),a+=2):a++;if(0===n.length)return e;t=r-n.length,i=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===n[0]&&(s++,n.shift()),i[a]=e[s];return i},e._parseAACPES=function(e){var t,i,r,n,a,s,o,l=this._audioTrack,u=e.data,h=e.pts,d=this.aacOverFlow,c=this.aacLastPTS;if(d){var f=new Uint8Array(d.byteLength+u.byteLength);f.set(d,0),f.set(u,d.byteLength),u=f}for(r=0,a=u.length;r<a-1&&!m(u,r);r++);if(r&&(o=r<a-1?(s="AAC PES did not start with ADTS header,offset:"+r,!1):(s="no ADTS header found in AAC PES",!0),te.logger.warn("parsing error:"+s),this.observer.trigger($.default.ERROR,{type:ee.ErrorTypes.MEDIA_ERROR,details:ee.ErrorDetails.FRAG_PARSING_ERROR,fatal:o,reason:s}),o))return;if(g(l,this.observer,u,r,this.audioCodec),i=0,t=_(l.samplerate),d&&c){var p=c+t;1<Math.abs(p-h)&&(te.logger.log("AAC: align PTS for overlapping frames by "+Math.round((p-h)/90)),h=p)}for(;r<a;)if(m(u,r)&&r+5<a){var v=y(l,u,r,h,i);if(!v)break;r+=v.length,n=v.sample.pts,i++}else r++;d=r<a?u.subarray(r,a):null,this.aacOverFlow=d,this.aacLastPTS=n},e._parseMPEGPES=function(e){for(var t=e.data,i=t.length,r=0,n=0,a=e.pts;n<i;)if(T.isHeader(t,n)){var s=T.appendFrame(this._audioTrack,t,n,a,r);if(!s)break;n+=s.length,r++}else n++},e._parseID3PES=function(e){this._id3Track.samples.push(e)},O}(),C=function(){function e(e,t,i){this.observer=e,this.config=i,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,i,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,i,r=S.default.getID3Data(e,0);if(r&&void 0!==S.default.getTimeStamp(r))for(t=r.length,i=Math.min(e.length-1,t+100);t<i;t++)if(T.probe(e,t))return te.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,i,r){for(var n=S.default.getID3Data(e,0),a=S.default.getTimeStamp(n),s=a?90*a:9e4*t,o=n.length,l=e.length,u=0,h=0,d=this._audioTrack,c=[{pts:s,dts:s,data:n}];o<l;)if(T.isHeader(e,o)){var f=T.appendFrame(d,e,o,s,u);if(!f)break;o+=f.length,h=f.sample.pts,u++}else S.default.isHeader(e,o)?(n=S.default.getID3Data(e,o),c.push({pts:h,dts:h,data:n}),o+=n.length):o++;this.remuxer.remux(d,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,i,r)},t.destroy=function(){},e}(),W=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),l=Math.pow(2,32)-1,ie=function(){function c(){}return c.init=function(){var e;for(e in c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})c.types.hasOwnProperty(e)&&(c.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:t,audio:i};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=n,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,a,o,a,s),c.DINF=c.box(c.types.dinf,c.box(c.types.dref,r))},c.box=function(e){for(var t,i=Array.prototype.slice.call(arguments,1),r=8,n=i.length,a=n;n--;)r+=i[n].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),n=0,r=8;n<a;n++)t.set(i[n],r),r+=i[n].byteLength;return t},c.hdlr=function(e){return c.box(c.types.hdlr,c.HDLR_TYPES[e])},c.mdat=function(e){return c.box(c.types.mdat,e)},c.mdhd=function(e,t){t*=e;var i=Math.floor(t/(1+l)),r=Math.floor(t%(1+l));return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},c.mdia=function(e){return c.box(c.types.mdia,c.mdhd(e.timescale,e.duration),c.hdlr(e.type),c.minf(e))},c.mfhd=function(e){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},c.minf=function(e){return"audio"===e.type?c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(e)):c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(e))},c.moof=function(e,t,i){return c.box(c.types.moof,c.mfhd(e),c.traf(i,t))},c.moov=function(e){for(var t=e.length,i=[];t--;)i[t]=c.trak(e[t]);return c.box.apply(null,[c.types.moov,c.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(c.mvex(e)))},c.mvex=function(e){for(var t=e.length,i=[];t--;)i[t]=c.trex(e[t]);return c.box.apply(null,[c.types.mvex].concat(i))},c.mvhd=function(e,t){t*=e;var i=Math.floor(t/(1+l)),r=Math.floor(t%(1+l)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,n)},c.sdtp=function(e){var t,i,r=e.samples||[],n=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)t=r[i].flags,n[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return c.box(c.types.sdtp,n)},c.stbl=function(e){return c.box(c.types.stbl,c.stsd(e),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))},c.avc1=function(e){var t,i,r,n=[],a=[];for(t=0;t<e.sps.length;t++)r=(i=e.sps[t]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(i));for(t=0;t<e.pps.length;t++)r=(i=e.pps[t]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(i));var s=c.box(c.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))},c.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},c.mp4a=function(e){var t=e.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),c.box(c.types.esds,c.esds(e)))},c.mp3=function(e){var t=e.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))},c.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?c.box(c.types.stsd,c.STSD,c.mp4a(e)):c.box(c.types.stsd,c.STSD,c.mp3(e)):c.box(c.types.stsd,c.STSD,c.avc1(e))},c.tkhd=function(e){var t=e.id,i=e.duration*e.timescale,r=e.width,n=e.height,a=Math.floor(i/(1+l)),s=Math.floor(i%(1+l));return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,n>>8&255,255&n,0,0]))},c.traf=function(e,t){var i=c.sdtp(e),r=e.id,n=Math.floor(t/(1+l)),a=Math.floor(t%(1+l));return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a])),c.trun(e,i.length+16+20+8+16+8+8),i)},c.trak=function(e){return e.duration=e.duration||4294967295,c.box(c.types.trak,c.tkhd(e),c.mdia(e))},c.trex=function(e){var t=e.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},c.trun=function(e,t){var i,r,n,a,s,o,l=e.samples||[],u=l.length,h=12+16*u,d=new Uint8Array(h);for(t+=8+h,d.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),i=0;i<u;i++)n=(r=l[i]).duration,a=r.size,s=r.flags,o=r.cts,d.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*i);return c.box(c.types.trun,d)},c.initSegment=function(e){c.types||c.init();var t,i=c.moov(e);return(t=new Uint8Array(c.FTYP.byteLength+i.byteLength)).set(c.FTYP),t.set(i,c.FTYP.byteLength),t},c}(),x=function(){function e(e,t,i,r){this.observer=e,this.config=t,this.typeSupported=i;var n=navigator.userAgent;this.isSafari=r&&-1<r.indexOf("Apple")&&n&&!n.match("CriOS"),this.ISGenerated=!1}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.remux=function(e,t,i,r,n,a,s){if(this.ISGenerated||this.generateIS(e,t,n),this.ISGenerated){var o=e.samples.length,l=t.samples.length,u=n,h=n;if(o&&l){var d=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;u+=Math.max(0,d),h+=Math.max(0,-d)}if(o){e.timescale||(te.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,n));var c,f=this.remuxAudio(e,u,a,s);if(l)f&&(c=f.endPTS-f.startPTS),t.timescale||(te.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,n)),this.remuxVideo(t,h,a,c,s)}else if(l){var p=this.remuxVideo(t,h,a,0,s);p&&e.codec&&this.remuxEmptyAudio(e,u,a,p)}}i.samples.length&&this.remuxID3(i,n),r.samples.length&&this.remuxText(r,n),this.observer.trigger($.default.FRAG_PARSED)},t.generateIS=function(e,t,i){var r,n,a=this.observer,s=e.samples,o=t.samples,l=this.typeSupported,u="audio/mp4",h={},d={tracks:h},c=void 0===this._initPTS;if(c&&(r=n=1/0),e.config&&s.length&&(e.timescale=e.samplerate,te.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(l.mpeg?(u="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),h.audio={container:u,codec:e.codec,initSegment:!e.isAAC&&l.mpeg?new Uint8Array:ie.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(r=n=s[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&o.length){var f=t.inputTimeScale;t.timescale=f,h.video={container:"video/mp4",codec:t.codec,initSegment:ie.initSegment([t]),metadata:{width:t.width,height:t.height}},c&&(r=Math.min(r,o[0].pts-f*i),n=Math.min(n,o[0].dts-f*i),this.observer.trigger($.default.INIT_PTS_FOUND,{initPTS:r}))}Object.keys(h).length?(a.trigger($.default.FRAG_PARSING_INIT_SEGMENT,d),this.ISGenerated=!0,c&&(this._initPTS=r,this._initDTS=n)):a.trigger($.default.ERROR,{type:ee.ErrorTypes.MEDIA_ERROR,details:ee.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,i,r,n){var a,s,o,l,u,h,d,c=8,f=e.timescale,p=e.samples,v=[],m=p.length,g=this._PTSNormalize,_=this._initPTS,y=this.nextAvcDts,b=this.isSafari;if(0!==m){b&&(i|=p.length&&y&&(n&&Math.abs(t-y/f)<.1||Math.abs(p[0].pts-y-_)<f/5)),i||(y=t*f),p.forEach(function(e){e.pts=g(e.pts-_,y),e.dts=g(e.dts-_,y)}),p.sort(function(e,t){var i=e.dts-t.dts,r=e.pts-t.pts;return i||r||e.id-t.id});var S=p.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(S<0){te.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(S/90)+" ms to overcome this issue");for(var E=0;E<p.length;E++)p[E].dts+=S}var k=p[0];u=Math.max(k.dts,0),l=Math.max(k.pts,0);var w=Math.round((u-y)/90);i&&w&&(1<w?te.logger.log("AVC:"+w+" ms hole between fragments detected,filling it"):w<-1&&te.logger.log("AVC:"+-w+" ms overlapping between fragments detected"),u=y,p[0].dts=u,l=Math.max(l-w,y),p[0].pts=l,te.logger.log("Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(u/90)+",delta:"+w+" ms")),k=p[p.length-1],d=Math.max(k.dts,0),h=Math.max(k.pts,0,d),b&&(a=Math.round((d-u)/(p.length-1)));for(var T=0,R=0,A=0;A<m;A++){for(var C=p[A],x=C.units,I=x.length,O=0,L=0;L<I;L++)O+=x[L].data.length;R+=O,T+=I,C.length=O,C.dts=b?u+A*a:Math.max(C.dts,u),C.pts=Math.max(C.pts,C.dts)}var D=R+4*T+8;try{s=new Uint8Array(D)}catch(e){return void this.observer.trigger($.default.ERROR,{type:ee.ErrorTypes.MUX_ERROR,details:ee.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:D,reason:"fail allocating video mdat "+D})}var P=new DataView(s.buffer);P.setUint32(0,D),s.set(ie.types.mdat,4);for(var M=0;M<m;M++){for(var F=p[M],B=F.units,N=0,U=void 0,j=0,z=B.length;j<z;j++){var G=B[j],V=G.data,H=G.data.byteLength;P.setUint32(c,H),c+=4,s.set(V,c),c+=H,N+=4+H}if(b)U=Math.max(0,a*Math.round((F.pts-F.dts)/a));else{if(M<m-1)a=p[M+1].dts-F.dts;else{var W=this.config,K=F.dts-p[0<M?M-1:M].dts;if(W.stretchShortVideoTrack){var Y=W.maxBufferHole,q=Math.floor(Y*f),X=(r?l+r*f:this.nextAudioPts)-F.pts;q<X?((a=X-K)<0&&(a=K),te.logger.log("It is approximately "+X/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=K}else a=K}U=Math.round(F.pts-F.dts)}v.push({size:N,duration:a,cts:U,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:F.key?2:1,isNonSync:F.key?0:1}})}this.nextAvcDts=d+a;var Z=e.dropped;if(e.nbNalu=0,e.dropped=0,v.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")){var J=v[0].flags;J.dependsOn=2,J.isNonSync=0}e.samples=v,o=ie.moof(e.sequenceNumber++,u,e),e.samples=[];var Q={data1:o,data2:s,startPTS:l/f,endPTS:(h+a)/f,startDTS:u/f,endDTS:this.nextAvcDts/f,type:"video",hasAudio:!1,hasVideo:!0,nb:v.length,dropped:Z};return this.observer.trigger($.default.FRAG_PARSING_DATA,Q),Q}},t.remuxAudio=function(e,t,i,r){var n,a,s,o,l,u,h=e.inputTimeScale,d=e.timescale,c=h/d,f=(e.isAAC?1024:1152)*c,p=this._PTSNormalize,v=this._initPTS,m=!e.isAAC&&this.typeSupported.mpeg,g=m?0:8,_=e.samples,y=[],b=this.nextAudioPts;if(i|=_.length&&b&&(r&&Math.abs(t-b/h)<.1||Math.abs(_[0].pts-b-v)<20*f),_.forEach(function(e){e.pts=e.dts=p(e.pts-v,t*h)}),0!==(_=_.filter(function(e){return 0<=e.pts})).length){if(i||(b=r?t*h:_[0].pts),e.isAAC)for(var S=this.config.maxAudioFramesDrift,E=0,k=b;E<_.length;){var w,T=_[E];w=T.pts-k;var R=Math.abs(1e3*w/h);if(w<=-S*f)te.logger.warn("Dropping 1 audio frame @ "+(k/h).toFixed(3)+"s due to "+Math.round(R)+" ms overlap."),_.splice(E,1);else if(S*f<=w&&R<1e4&&k){var A=Math.round(w/f);te.logger.warn("Injecting "+A+" audio frame @ "+(k/h).toFixed(3)+"s due to "+Math.round(1e3*w/h)+" ms gap.");for(var C=0;C<A;C++){var x=Math.max(k,0);(a=W.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(te.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),a=T.unit.subarray()),_.splice(E,0,{unit:a,pts:x,dts:x}),k+=f,E++}T.pts=T.dts=k,k+=f,E++}else Math.abs(w),T.pts=T.dts=k,k+=f,E++}for(var I=_.length,O=0;I--;)O+=_[I].unit.byteLength;for(var L=0,D=_.length;L<D;L++){var P=_[L],M=P.unit,F=P.pts;if(void 0!==u)n.duration=Math.round((F-u)/c);else{var B=Math.round(1e3*(F-b)/h),N=0;if(i&&e.isAAC&&B){if(0<B&&B<1e4)N=Math.round((F-b)/f),te.logger.log(B+" ms hole between AAC samples detected,filling it"),0<N&&(O+=N*(a=(a=W.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||M.subarray()).length);else if(B<-12){te.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(b/h).toFixed(3)+"s/"+(F/h).toFixed(3)+"s/"+-B+"ms"),O-=M.byteLength;continue}F=b}if(l=F,!(0<O))return;O+=g;try{s=new Uint8Array(O)}catch(e){return void this.observer.trigger($.default.ERROR,{type:ee.ErrorTypes.MUX_ERROR,details:ee.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:O,reason:"fail allocating audio mdat "+O})}m||(new DataView(s.buffer).setUint32(0,O),s.set(ie.types.mdat,4));for(var U=0;U<N;U++)(a=W.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(te.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),a=M.subarray()),s.set(a,g),g+=a.byteLength,n={size:a.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(n)}s.set(M,g);var j=M.byteLength;g+=j,n={size:j,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(n),u=F}var z=0;if(2<=(I=y.length)&&(z=y[I-2].duration,n.duration=z),I){this.nextAudioPts=b=u+c*z,e.samples=y,o=m?new Uint8Array:ie.moof(e.sequenceNumber++,l/c,e),e.samples=[];var G=l/h,V=b/h,H={data1:o,data2:s,startPTS:G,endPTS:V,startDTS:G,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.observer.trigger($.default.FRAG_PARSING_DATA,H),H}return null}},t.remuxEmptyAudio=function(e,t,i,r){var n=e.inputTimeScale,a=n/(e.samplerate?e.samplerate:n),s=this.nextAudioPts,o=(void 0!==s?s:r.startDTS*n)+this._initDTS,l=r.endDTS*n+this._initDTS,u=1024*a,h=Math.ceil((l-o)/u),d=W.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(te.logger.warn("remux empty Audio"),d){for(var c=[],f=0;f<h;f++){var p=o+f*u;c.push({unit:d,pts:p,dts:p})}e.samples=c,this.remuxAudio(e,t,i)}else te.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e){var t,i=e.samples.length,r=e.inputTimeScale,n=this._initPTS,a=this._initDTS;if(i){for(var s=0;s<i;s++)(t=e.samples[s]).pts=(t.pts-n)/r,t.dts=(t.dts-a)/r;this.observer.trigger($.default.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},t.remuxText=function(e){e.samples.sort(function(e,t){return e.pts-t.pts});var t,i=e.samples.length,r=e.inputTimeScale,n=this._initPTS;if(i){for(var a=0;a<i;a++)(t=e.samples[a]).pts=(t.pts-n)/r;this.observer.trigger($.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},t._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=i;return e},e}(),I=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,i,r,n,a,s,o){var l=this.observer,u="";e&&(u+="audio"),t&&(u+="video"),l.trigger($.default.FRAG_PARSING_DATA,{data1:o,startPTS:n,startDTS:n,type:u,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger($.default.FRAG_PARSED)},e}(),u=Object(r.getSelfScope)();try{b=u.performance.now.bind(u.performance)}catch(e){te.logger.debug("Unable to use Performance API on this environment"),b=u.Date.now}var c=function(){function e(e,t,i,r){this.observer=e,this.typeSupported=t,this.config=i,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,i,r,n,a,s,o,l,u,h,d,c){var f=this;if(0<e.byteLength&&null!=i&&null!=i.key&&"AES-128"===i.method){var t=this.decrypter;null==t&&(t=this.decrypter=new v.default(this.observer,this.config));var p=b();t.decrypt(e,i.key.buffer,i.iv.buffer,function(e){var t=b();f.observer.trigger($.default.FRAG_DECRYPTED,{stats:{tstart:p,tdecrypt:t}}),f.pushDecrypted(new Uint8Array(e),i,new Uint8Array(r),n,a,s,o,l,u,h,d,c)})}else this.pushDecrypted(new Uint8Array(e),i,new Uint8Array(r),n,a,s,o,l,u,h,d,c)},t.pushDecrypted=function(e,t,i,r,n,a,s,o,l,u,h,d){var c=this.demuxer;if(!c||(s||o)&&!this.probe(e)){for(var f=this.observer,p=this.typeSupported,v=this.config,m=[{demux:A,remux:x},{demux:w.default,remux:I},{demux:k,remux:x},{demux:C,remux:x}],g=0,_=m.length;g<_;g++){var y=m[g],b=y.demux.probe;if(b(e)){var S=this.remuxer=new y.remux(f,v,p,this.vendor);c=new y.demux(f,S,v,p),this.probe=b;break}}if(!c)return void f.trigger($.default.ERROR,{type:ee.ErrorTypes.MEDIA_ERROR,details:ee.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=c}var E=this.remuxer;(s||o)&&(c.resetInitSegment(i,r,n,u),E.resetInitSegment()),s&&(c.resetTimeStamp(d),E.resetTimeStamp(d)),"function"==typeof c.setDecryptData&&c.setDecryptData(t),c.append(e,a,l,h)},e}();t.default=c},"./src/demux/demuxer-worker.js":
/*!*************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve) */function(e,t,i){"use strict";i.r(t);var s=i(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),o=i(/*! ../events */"./src/events.js"),l=i(/*! ../utils/logger */"./src/utils/logger.js"),u=i(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");t.default=function(n){var a=new u.EventEmitter;a.trigger=function(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];a.emit.apply(a,[e,e].concat(i))},a.off=function(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];a.removeListener.apply(a,[e].concat(i))};function r(e,t){n.postMessage({event:e,data:t})}n.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":var i=JSON.parse(t.config);n.demuxer=new s.default(a,t.typeSupported,i,t.vendor),Object(l.enableLogs)(i.debug),r("init",null);break;case"demux":n.demuxer.push(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.discontinuity,t.trackSwitch,t.contiguous,t.duration,t.accurateTimeOffset,t.defaultInitPTS)}}),a.on(o.default.FRAG_DECRYPTED,r),a.on(o.default.FRAG_PARSING_INIT_SEGMENT,r),a.on(o.default.FRAG_PARSED,r),a.on(o.default.ERROR,r),a.on(o.default.FRAG_PARSING_METADATA,r),a.on(o.default.FRAG_PARSING_USERDATA,r),a.on(o.default.INIT_PTS_FOUND,r),a.on(o.default.FRAG_PARSING_DATA,function(e,t){var i=[],r={event:e,data:t};t.data1&&(r.data1=t.data1.buffer,i.push(t.data1.buffer),delete t.data1),t.data2&&(r.data2=t.data2.buffer,i.push(t.data2.buffer),delete t.data2),n.postMessage(r,i)})}},"./src/demux/id3.js":
/*!**************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
/*! exports provided: default, utf8ArrayToStr */function(e,t,i){"use strict";i.r(t),i.d(t,"utf8ArrayToStr",function(){return n});var d,c=i(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),r=function(){function o(){}return o.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},o.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},o.getID3Data=function(e,t){for(var i=t,r=0;o.isHeader(e,t);){r+=10,r+=o._readSize(e,t+6),o.isFooter(e,t+10)&&(r+=10),t+=r}if(0<r)return e.subarray(i,i+r)},o._readSize=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3]},o.getTimeStamp=function(e){for(var t=o.getID3Frames(e),i=0;i<t.length;i++){var r=t[i];if(o.isTimeStampFrame(r))return o._readTimeStamp(r)}},o.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},o._getFrameData=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=o._readSize(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},o.getID3Frames=function(e){for(var t=0,i=[];o.isHeader(e,t);){for(var r=o._readSize(e,t+6),n=(t+=10)+r;t+8<n;){var a=o._getFrameData(e.subarray(t)),s=o._decodeFrame(a);s&&i.push(s),t+=a.size+10}o.isFooter(e,t)&&(t+=10)}return i},o._decodeFrame=function(e){return"PRIV"===e.type?o._decodePrivFrame(e):"T"===e.type[0]?o._decodeTextFrame(e):"W"===e.type[0]?o._decodeURLFrame(e):void 0},o._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},o._decodePrivFrame=function(e){if(!(e.size<2)){var t=o._utf8ArrayToStr(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}}},o._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,i=o._utf8ArrayToStr(e.data.subarray(t),!0);t+=i.length+1;var r=o._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:i,data:r}}var n=o._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:n}}},o._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,i=o._utf8ArrayToStr(e.data.subarray(t));t+=i.length+1;var r=o._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:i,data:r}}var n=o._utf8ArrayToStr(e.data);return{key:e.type,data:n}},o._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var i=function(){var e=Object(c.getSelfScope)();d||void 0===e.TextDecoder||(d=new e.TextDecoder("utf-8"));return d}();if(i){var r=i.decode(e);if(t){var n=r.indexOf("\0");return-1!==n?r.substring(0,n):r}return r.replace(/\0/g,"")}for(var a,s,o,l=e.length,u="",h=0;h<l;){if(0===(a=e[h++])&&t)return u;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(a);break;case 12:case 13:s=e[h++],u+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[h++],o=e[h++],u+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0)}}return u},o}();var n=r._utf8ArrayToStr;t.default=r},"./src/demux/mp4demuxer.js":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);var c=i(/*! ../utils/logger */"./src/utils/logger.js"),l=i(/*! ../events */"./src/events.js"),o=Math.pow(2,32)-1,r=function(){function v(e,t){this.observer=e,this.remuxer=t}var e=v.prototype;return e.resetTimeStamp=function(e){this.initPTS=e},e.resetInitSegment=function(e,t,i,r){if(e&&e.byteLength){var n=this.initData=v.parseInitSegment(e);null==t&&(t="mp4a.40.5"),null==i&&(i="avc1.42e01e");var a={};n.audio&&n.video?a.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:r?e:null}:(n.audio&&(a.audio={container:"audio/mp4",codec:t,initSegment:r?e:null}),n.video&&(a.video={container:"video/mp4",codec:i,initSegment:r?e:null})),this.observer.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else t&&(this.audioCodec=t),i&&(this.videoCodec=i)},v.probe=function(e){return 0<v.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length},v.bin2str=function(e){return String.fromCharCode.apply(null,e)},v.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<8|e[t+1];return i<0?65536+i:i},v.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var i=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return i<0?4294967296+i:i},v.writeUint32=function(e,t,i){e.data&&(t+=e.start,e=e.data),e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},v.findBox=function(e,t){var i,r,n,a,s,o,l=[];if(e.data?(s=e.start,n=e.end,e=e.data):(s=0,n=e.byteLength),!t.length)return null;for(i=s;i<n;)o=1<(r=v.readUint32(e,i))?i+r:n,v.bin2str(e.subarray(i+4,i+8))===t[0]&&(1===t.length?l.push({data:e,start:i+8,end:o}):(a=v.findBox({data:e,start:i+8,end:o},t.slice(1))).length&&(l=l.concat(a))),i=o;return l},v.parseSegmentIndex=function(e){var t,i=v.findBox(e,["moov"])[0],r=i?i.end:null,n=0,a=v.findBox(e,["sidx"]);if(!a||!a[0])return null;t=[];var s=(a=a[0]).data[0],o=v.readUint32(a,n=0===s?8:16);n+=4;n+=0===s?8:16,n+=2;var l=a.end+0,u=v.readUint16(a,n);n+=2;for(var h=0;h<u;h++){var d=n,c=v.readUint32(a,d);d+=4;var f=2147483647&c;if(1==(2147483648&c)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var p=v.readUint32(a,d);d+=4,t.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/o,start:l,end:l+f-1}}),l+=f,n=d+=4}return{earliestPresentationTime:0,timescale:o,version:s,referencesCount:u,references:t,moovEndOffset:r}},v.parseInitSegment=function(e){var d=[];return v.findBox(e,["moov","trak"]).forEach(function(e){var t=v.findBox(e,["tkhd"])[0];if(t){var i=t.data[t.start],r=0===i?12:20,n=v.readUint32(t,r),a=v.findBox(e,["mdia","mdhd"])[0];if(a){i=a.data[a.start];var s=v.readUint32(a,r=0===i?12:20),o=v.findBox(e,["mdia","hdlr"])[0];if(o){var l={soun:"audio",vide:"video"}[v.bin2str(o.data.subarray(o.start+8,o.start+12))];if(l){var u=v.findBox(e,["mdia","minf","stbl","stsd"]);if(u.length){u=u[0];var h=v.bin2str(u.data.subarray(u.start+12,u.start+16));c.logger.log("MP4Demuxer:"+l+":"+h+" found")}d[n]={timescale:s,type:l},d[l]={timescale:s,id:n}}}}}}),d},v.getStartDTS=function(n,e){var t,i,r;return t=v.findBox(e,["moof","traf"]),i=[].concat.apply([],t.map(function(r){return v.findBox(r,["tfhd"]).map(function(e){var t,i;return t=v.readUint32(e,4),i=n[t].timescale||9e4,v.findBox(r,["tfdt"]).map(function(e){var t,i;return t=e.data[e.start],i=v.readUint32(e,4),1===t&&(i*=Math.pow(2,32),i+=v.readUint32(e,8)),i})[0]/i})})),r=Math.min.apply(null,i),isFinite(r)?r:0},v.offsetStartDTS=function(r,e,s){v.findBox(e,["moof","traf"]).map(function(i){return v.findBox(i,["tfhd"]).map(function(e){var t=v.readUint32(e,4),a=r[t].timescale||9e4;v.findBox(i,["tfdt"]).map(function(e){var t=e.data[e.start],i=v.readUint32(e,4);if(0===t)v.writeUint32(e,4,i-s*a);else{i*=Math.pow(2,32),i+=v.readUint32(e,8),i-=s*a,i=Math.max(i,0);var r=Math.floor(i/(1+o)),n=Math.floor(i%(1+o));v.writeUint32(e,4,r),v.writeUint32(e,8,n)}})})})},e.append=function(e,t,i,r){var n=this.initData;n||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),n=this.initData);var a,s=this.initPTS;if(void 0===s){var o=v.getStartDTS(n,e);this.initPTS=s=o-t,this.observer.trigger(l.default.INIT_PTS_FOUND,{initPTS:s})}v.offsetStartDTS(n,e,s),a=v.getStartDTS(n,e),this.remuxer.remux(n.audio,n.video,null,null,a,i,r,e)},e.destroy=function(){},v}();t.default=r},"./src/errors.js":
/*!***********************!*\
  !*** ./src/errors.js ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,i){"use strict";i.r(t),i.d(t,"ErrorTypes",function(){return r}),i.d(t,"ErrorDetails",function(){return n});var r={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/events.js":
/*!***********************!*\
  !*** ./src/events.js ***!
  \***********************/
/*! exports provided: default */function(e,t,i){"use strict";i.r(t);t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},"./src/hls.js":
/*!*********************************!*\
  !*** ./src/hls.js + 50 modules ***!
  \*********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */function(e,t,i){"use strict";var r={};i.r(r),i.d(r,"newCue",function(){return yt});var m,n,a,s,o=i("./node_modules/url-toolkit/src/url-toolkit.js"),c=i("./src/errors.js"),D=i("./src/polyfills/number-isFinite.js"),P=i("./src/events.js"),M=i("./src/utils/logger.js"),l={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},u=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(l[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(t,e){try{(function(e,t){var i="on"+e.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,t)}).call(this,t,e).call()}catch(e){M.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},e}();(n=m=m||{}).MANIFEST="manifest",n.LEVEL="level",n.AUDIO_TRACK="audioTrack",n.SUBTITLE_TRACK="subtitleTrack",(s=a=a||{}).MAIN="main",s.AUDIO="audio",s.SUBTITLE="subtitle";var h=i("./src/demux/mp4demuxer.js");function d(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f,p,A=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}return function(e,t,i){t&&d(e.prototype,t),i&&d(e,i)}(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(o.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();function v(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(p=f=f||{}).AUDIO="audio",p.VIDEO="video";var C=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[f.AUDIO]=!1,e[f.VIDEO]=!1,e),this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.sn=0,this.levelkey=void 0}var t=e.prototype;return t.setByteRange=function(e,t){var i=e.split("@",2),r=[];1===i.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(i[1]),r[1]=parseInt(i[0])+r[0],this._byteRange=r},t.addElementaryStream=function(e){this._elementaryStreams[e]=!0},t.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},t.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},t.setDecryptDataFromLevelKey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new A(e.baseuri,e.reluri)).method=e.method,i.iv=this.createInitializationVector(t)),i},function(e,t,i){t&&v(e.prototype,t),i&&v(e,i)}(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&M.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(D.isFiniteNumber)(this.programDateTime))return null;var e=Object(D.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]),e}();function g(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return function(e,t,i){t&&g(e.prototype,t),i&&g(e,i)}(e,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(D.isFiniteNumber)(this.fragments[0].programDateTime))}}]),e}(),_=/^(\d+)x(\d+)$/,y=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,I=function(){function i(e){for(var t in"string"==typeof e&&(e=i.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var e=i.prototype;return e.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(2*r,2*r+2),16);return i}return null},e.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},e.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.enumeratedString=function(e){return this[e]},e.decimalResolution=function(e){var t=_.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},i.parseAttrList=function(e){var t,i={};for(y.lastIndex=0;null!==(t=y.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),i[t[1]]=r}return i},i}(),b={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function S(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var E=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,k=/#EXT-X-MEDIA:(.*)/g,O=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),L=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,F=/\.(mp4|m4s|m4v|m4a)$/i,w=function(){function h(){}return h.findGroup=function(e,t){if(!e)return null;for(var i=null,r=0;r<e.length;r++){var n=e[r];n.id===t&&(i=n)}return i},h.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return 2<i.length?(t=i.shift()+".",t+=parseInt(i.shift()).toString(16),t+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):t=e,t},h.resolve=function(e,t){return o.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},h.parseMasterPlaylist=function(e,t){var i,r=[];function n(r,n){["video","audio"].forEach(function(t){var i=r.filter(function(e){return function(e,t){var i=b[t];return!!i&&!0===i[e.slice(0,4)]}(e,t)});if(i.length){var e=i.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});n[t+"Codec"]=0<e.length?e[0]:i[0],r=r.filter(function(e){return-1===i.indexOf(e)})}}),n.unknownCodecs=r}for(E.lastIndex=0;null!=(i=E.exec(e));){var a={},s=a.attrs=new I(i[1]);a.url=h.resolve(i[2],t);var o=s.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bitrate=s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),a.name=s.NAME,n([].concat((s.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=h.convertAVC1ToAVCOTI(a.videoCodec)),r.push(a)}return r},h.parseMasterPlaylistMedia=function(e,t,i,r){var n;void 0===r&&(r=[]);var a=[],s=0;for(k.lastIndex=0;null!==(n=k.exec(e));){var o={},l=new I(n[1]);if(l.TYPE===i){if(o.groupId=l["GROUP-ID"],o.name=l.NAME,o.type=i,o.default="YES"===l.DEFAULT,o.autoselect="YES"===l.AUTOSELECT,o.forced="YES"===l.FORCED,l.URI&&(o.url=h.resolve(l.URI,t)),o.lang=l.LANGUAGE,o.name||(o.name=o.lang),r.length){var u=h.findGroup(r,o.groupId);o.audioCodec=u?u.codec:r[0].codec}o.id=s++,a.push(o)}}return a},h.parseLevelPlaylist=function(e,t,i,r,n){var a,s,o=0,l=0,u=new x(t),h=new A,d=0,c=null,f=new C,p=null;for(O.lastIndex=0;null!==(a=O.exec(e));){var v=a[1];if(v){f.duration=parseFloat(v);var m=(" "+a[2]).slice(1);f.title=m||null,f.tagList.push(m?["INF",v,m]:["INF",v])}else if(a[3]){if(Object(D.isFiniteNumber)(f.duration)){var g=o++;f.type=r,f.start=l,f.levelkey=h,f.sn=g,f.level=i,f.cc=d,f.urlId=n,f.baseurl=t,f.relurl=(" "+a[3]).slice(1),B(f,c),u.fragments.push(f),l+=(c=f).duration,f=new C}}else if(a[4]){var _=(" "+a[4]).slice(1);c?f.setByteRange(_,c):f.setByteRange(_)}else if(a[5])f.rawProgramDateTime=(" "+a[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]),null===p&&(p=u.fragments.length);else{for(a=a[0].match(L),s=1;s<a.length&&void 0===a[s];s++);var y=(" "+a[s+1]).slice(1),b=(" "+a[s+2]).slice(1);switch(a[s]){case"#":f.tagList.push(b?[y,b]:[y]);break;case"PLAYLIST-TYPE":u.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=u.startSN=parseInt(y);break;case"TARGETDURATION":u.targetduration=parseFloat(y);break;case"VERSION":u.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":d++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(y);break;case"KEY":var S=new I(y),E=S.enumeratedString("METHOD"),k=S.URI,w=S.hexadecimalInteger("IV");E&&(h=new A,k&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(E)&&(h.method=E,h.baseuri=t,h.reluri=k,h.key=null,h.iv=w));break;case"START":var T=new I(y).decimalFloatingPoint("TIME-OFFSET");Object(D.isFiniteNumber)(T)&&(u.startTimeOffset=T);break;case"MAP":var R=new I(y);f.relurl=R.URI,R.BYTERANGE&&f.setByteRange(R.BYTERANGE),f.baseurl=t,f.level=i,f.type=r,f.sn="initSegment",u.initSegment=f,(f=new C).rawProgramDateTime=u.initSegment.rawProgramDateTime;break;default:M.logger.warn("line parsed but not handled: "+a)}}}return(f=c)&&!f.relurl&&(u.fragments.pop(),l-=f.duration),u.totalduration=l,u.averagetargetduration=l/u.fragments.length,u.endSN=o-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=d,!u.initSegment&&u.fragments.length&&u.fragments.every(function(e){return F.test(e.relurl)})&&(M.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(f=new C).relurl=u.fragments[0].relurl,f.baseurl=t,f.level=i,f.type=r,f.sn="initSegment",u.initSegment=f,u.needSidxRanges=!0),p&&function(e,t){for(var i=e[t],r=t-1;0<=r;r--){var n=e[r];n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}(u.fragments,p),u},h}();function B(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(D.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var T=window.performance,R=function(i){function v(e){var t;return(t=i.call(this,e,P.default.MANIFEST_LOADING,P.default.LEVEL_LOADING,P.default.AUDIO_TRACK_LOADING,P.default.SUBTITLE_TRACK_LOADING)||this).loaders={},t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(v,i),v.canHaveQualityLevels=function(e){return e!==m.AUDIO_TRACK&&e!==m.SUBTITLE_TRACK},v.mapContextToLevelType=function(e){switch(e.type){case m.AUDIO_TRACK:return a.AUDIO;case m.SUBTITLE_TRACK:return a.SUBTITLE;default:return a.MAIN}},v.getResponseUrl=function(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i};var e=v.prototype;return e.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,r=t.loader,n=new(i||r)(t);return e.loader=n,this.loaders[e.type]=n},e.getInternalLoader=function(e){return this.loaders[e.type]},e.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},e.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},e.destroy=function(){this.destroyInternalLoaders(),i.prototype.destroy.call(this)},e.onManifestLoading=function(e){this.load({url:e.url,type:m.MANIFEST,level:0,id:null,responseType:"text"})},e.onLevelLoading=function(e){this.load({url:e.url,type:m.LEVEL,level:e.level,id:e.id,responseType:"text"})},e.onAudioTrackLoading=function(e){this.load({url:e.url,type:m.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},e.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:m.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},e.load=function(e){var t=this.hls.config;M.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var i,r,n,a,s=this.getInternalLoader(e);if(s){var o=s.context;if(o&&o.url===e.url)return M.logger.trace("playlist request ongoing"),!1;M.logger.warn("aborting previous loader for type: "+e.type),s.abort()}switch(e.type){case m.MANIFEST:i=t.manifestLoadingMaxRetry,r=t.manifestLoadingTimeOut,n=t.manifestLoadingRetryDelay,a=t.manifestLoadingMaxRetryTimeout;break;case m.LEVEL:n=a=i=0,r=t.levelLoadingTimeOut;break;default:i=t.levelLoadingMaxRetry,r=t.levelLoadingTimeOut,n=t.levelLoadingRetryDelay,a=t.levelLoadingMaxRetryTimeout}s=this.createInternalLoader(e);var l={timeout:r,maxRetry:i,retryDelay:n,maxRetryDelay:a},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return M.logger.debug("Calling internal loader delegate for URL: "+e.url),s.load(e,l,u),!0},e.loadsuccess=function(e,t,i,r){if(void 0===r&&(r=null),i.isSidxRequest)return this._handleSidxRequest(e,i),void this._handlePlaylistLoaded(e,t,i,r);if(this.resetInternalLoader(i.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var n=e.data;t.tload=T.now(),0===n.indexOf("#EXTM3U")?0<n.indexOf("#EXTINF:")||0<n.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,i,r):this._handleMasterPlaylist(e,t,i,r):this._handleManifestParsingError(e,i,"no EXTM3U delimiter",r)},e.loaderror=function(e,t,i){void 0===i&&(i=null),this._handleNetworkError(t,i,!1,e)},e.loadtimeout=function(e,t,i){void 0===i&&(i=null),this._handleNetworkError(t,i,!0)},e._handleMasterPlaylist=function(e,t,i,r){var n=this.hls,a=e.data,s=v.getResponseUrl(e,i),o=w.parseMasterPlaylist(a,s);if(o.length){var l=o.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),u=w.parseMasterPlaylistMedia(a,s,"AUDIO",l),h=w.parseMasterPlaylistMedia(a,s,"SUBTITLES");if(u.length){var d=!1;u.forEach(function(e){e.url||(d=!0)}),!1===d&&o[0].audioCodec&&!o[0].attrs.AUDIO&&(M.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main"}))}n.trigger(P.default.MANIFEST_LOADED,{levels:o,audioTracks:u,subtitles:h,url:s,stats:t,networkDetails:r})}else this._handleManifestParsingError(e,i,"no level found in manifest",r)},e._handleTrackOrLevelPlaylist=function(e,t,i,r){var n=this.hls,a=i.id,s=i.level,o=i.type,l=v.getResponseUrl(e,i),u=Object(D.isFiniteNumber)(a)?a:0,h=Object(D.isFiniteNumber)(s)?s:u,d=v.mapContextToLevelType(i),c=w.parseLevelPlaylist(e.data,l,h,d,u);if(c.tload=t.tload,o===m.MANIFEST){var f={url:l,details:c};n.trigger(P.default.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:l,stats:t,networkDetails:r})}if(t.tparsed=T.now(),c.needSidxRanges){var p=c.initSegment.url;this.load({url:p,isSidxRequest:!0,type:o,level:s,levelDetails:c,id:a,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else i.levelDetails=c,this._handlePlaylistLoaded(e,t,i,r)},e._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var i=h.default.parseSegmentIndex(new Uint8Array(e.data));if(i){var r=i.references,n=t.levelDetails;r.forEach(function(e,t){var i=e.info;if(n){var r=n.fragments[t];0===r.byteRange.length&&r.setByteRange(String(1+i.end-i.start)+"@"+String(i.start))}}),n&&n.initSegment.setByteRange(String(i.moovEndOffset)+"@0")}},e._handleManifestParsingError=function(e,t,i,r){this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:i,networkDetails:r})},e._handleNetworkError=function(e,t,i,r){var n,a;void 0===i&&(i=!1),void 0===r&&(r=null),M.logger.info("A network error occured while loading a "+e.type+"-type playlist");var s=this.getInternalLoader(e);switch(e.type){case m.MANIFEST:n=i?c.ErrorDetails.MANIFEST_LOAD_TIMEOUT:c.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case m.LEVEL:n=i?c.ErrorDetails.LEVEL_LOAD_TIMEOUT:c.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case m.AUDIO_TRACK:n=i?c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}s&&(s.abort(),this.resetInternalLoader(e.type));var o={type:c.ErrorTypes.NETWORK_ERROR,details:n,fatal:a,url:e.url,loader:s,context:e,networkDetails:t};r&&(o.response=r),this.hls.trigger(P.default.ERROR,o)},e._handlePlaylistLoaded=function(e,t,i,r){var n=i.type,a=i.level,s=i.id,o=i.levelDetails;if(o&&o.targetduration)if(v.canHaveQualityLevels(i.type))this.hls.trigger(P.default.LEVEL_LOADED,{details:o,level:a||0,id:s||0,stats:t,networkDetails:r});else switch(n){case m.AUDIO_TRACK:this.hls.trigger(P.default.AUDIO_TRACK_LOADED,{details:o,id:s,stats:t,networkDetails:r});break;case m.SUBTITLE_TRACK:this.hls.trigger(P.default.SUBTITLE_TRACK_LOADED,{details:o,id:s,stats:t,networkDetails:r})}else this._handleManifestParsingError(e,i,"invalid target duration",r)},v}(u);var N=function(r){function e(e){var t;return(t=r.call(this,e,P.default.FRAG_LOADING)||this).loaders={},t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,r);var t=e.prototype;return t.destroy=function(){var e=this.loaders;for(var t in e){var i=e[t];i&&i.destroy()}this.loaders={},r.prototype.destroy.call(this)},t.onFragLoading=function(e){var t=e.frag,i=t.type,r=this.loaders,n=this.hls.config,a=n.fLoader,s=n.loader;t.loaded=0;var o,l,u,h=r[i];h&&(M.logger.warn("abort previous fragment loader for type: "+i),h.abort()),h=r[i]=t.loader=n.fLoader?new a(n):new s(n),o={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var d=t.byteRangeStartOffset,c=t.byteRangeEndOffset;Object(D.isFiniteNumber)(d)&&Object(D.isFiniteNumber)(c)&&(o.rangeStart=d,o.rangeEnd=c),l={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(o,l,u)},t.loadsuccess=function(e,t,i,r){void 0===r&&(r=null);var n=e.data,a=i.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(P.default.FRAG_LOADED,{payload:n,frag:a,stats:t,networkDetails:r})},t.loaderror=function(e,t,i){void 0===i&&(i=null);var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[r.type]=void 0,this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:i})},t.loadtimeout=function(e,t,i){void 0===i&&(i=null);var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[r.type]=void 0,this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:i})},t.loadprogress=function(e,t,i,r){void 0===r&&(r=null);var n=t.frag;n.loaded=e.loaded,this.hls.trigger(P.default.FRAG_LOAD_PROGRESS,{frag:n,stats:e,networkDetails:r})},e}(u);var U=function(i){function e(e){var t;return(t=i.call(this,e,P.default.KEY_LOADING)||this).loaders={},t.decryptkey=null,t.decrypturl=null,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},u.prototype.destroy.call(this)},t.onKeyLoading=function(e){var t=e.frag,i=t.type,r=this.loaders[i],n=t.decryptdata,a=n.uri;if(a!==this.decrypturl||null===this.decryptkey){var s,o,l,u=this.hls.config;r&&(M.logger.warn("abort previous key loader for type:"+i),r.abort()),t.loader=this.loaders[i]=new u.loader(u),this.decrypturl=a,this.decryptkey=null,s={url:a,frag:t,responseType:"arraybuffer"},o={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,o,l)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(P.default.KEY_LOADED,{frag:t}))},t.loadsuccess=function(e,t,i){var r=i.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(P.default.KEY_LOADED,{frag:r})},t.loaderror=function(e,t){var i=t.frag,r=i.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:e})},t.loadtimeout=function(e,t){var i=t.frag,r=i.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},e}(u);var j="NOT_LOADED",z="APPENDING",G="PARTIAL",V="OK",H=function(i){function e(e){var t;return(t=i.call(this,e,P.default.BUFFER_APPENDED,P.default.FRAG_BUFFERED,P.default.FRAG_LOADED)||this).bufferPadding=.2,t.fragments=Object.create(null),t.timeRanges=Object.create(null),t.config=e.config,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,u.prototype.destroy.call(this),i.prototype.destroy.call(this)},t.getBufferedFrag=function(r,n){var a=this.fragments,e=Object.keys(a).filter(function(e){var t=a[e];if(t.body.type!==n)return!1;if(!t.buffered)return!1;var i=t.body;return i.startPTS<=r&&r<=i.endPTS});if(0===e.length)return null;var t=e.pop();return a[t].body},t.detectEvictedFragments=function(n,a){var s,o,l=this;Object.keys(this.fragments).forEach(function(e){var t=l.fragments[e];if(!0===t.buffered){var i=t.range[n];if(i){s=i.time;for(var r=0;r<s.length;r++)if(o=s[r],!1===l.isTimeBuffered(o.startPTS,o.endPTS,a)){l.removeFragment(t.body);break}}}})},t.detectPartialFragments=function(i){var r=this,e=this.getFragmentKey(i),n=this.fragments[e];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){if(i.hasElementaryStream(e)){var t=r.timeRanges[e];n.range[e]=r.getBufferedTimes(i.startPTS,i.endPTS,t)}}))},t.getBufferedTimes=function(e,t,i){for(var r,n,a=[],s=!1,o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,n=i.end(o)+this.bufferPadding,r<=e&&t<=n){a.push({startPTS:Math.max(e,i.start(o)),endPTS:Math.min(t,i.end(o))});break}if(e<n&&r<t)a.push({startPTS:Math.max(e,i.start(o)),endPTS:Math.min(t,i.end(o))}),s=!0;else if(t<=r)break}return{time:a,partial:s}},t.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},t.getPartialFragment=function(i){var r,n,a,s=this,o=null,l=0;return Object.keys(this.fragments).forEach(function(e){var t=s.fragments[e];s.isPartial(t)&&(n=t.body.startPTS-s.bufferPadding,a=t.body.endPTS+s.bufferPadding,n<=i&&i<=a&&(r=Math.min(i-n,a-i),l<=r&&(o=t.body,l=r)))}),o},t.getState=function(e){var t=this.getFragmentKey(e),i=this.fragments[t],r=j;return void 0!==i&&(r=i.buffered?!0===this.isPartial(i)?G:V:z),r},t.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},t.isTimeBuffered=function(e,t,i){for(var r,n,a=0;a<i.length;a++){if(r=i.start(a)-this.bufferPadding,n=i.end(a)+this.bufferPadding,r<=e&&t<=n)return!0;if(t<=r)return!1}return!1},t.onFragLoaded=function(e){var t=e.frag;Object(D.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},t.onBufferAppended=function(e){var i=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var t=i.timeRanges[e];i.detectEvictedFragments(e,t)})},t.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},t.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},t.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},t.removeAllFragments=function(){this.fragments=Object.create(null)},e}(u),W={search:function(e,t){for(var i=0,r=e.length-1,n=null,a=null;i<=r;){var s=t(a=e[n=(i+r)/2|0]);if(0<s)i=n+1;else{if(!(s<0))return a;r=n-1}}return null}},K=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var i=e.buffered,r=0;r<i.length;r++)if(t>=i.start(r)&&t<=i.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,i){try{if(e){var r,n=e.buffered,a=[];for(r=0;r<n.length;r++)a.push({start:n.start(r),end:n.end(r)});return this.bufferedInfo(a,t,i)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,i){e.sort(function(e,t){var i=e.start-t.start;return i||t.end-e.end});for(var r=[],n=0;n<e.length;n++){var a=r.length;if(a){var s=r[a-1].end;e[n].start-s<i?e[n].end>s&&(r[a-1].end=e[n].end):r.push(e[n])}else r.push(e[n])}for(var o,l=0,u=t,h=t,d=0;d<r.length;d++){var c=r[d].start,f=r[d].end;if(c<=t+i&&t<f)u=c,l=(h=f)-t;else if(t+i<c){o=c;break}}return{len:l,start:u,end:h,nextStart:o}},e}(),Y=i("./node_modules/eventemitter3/index.js"),q=i("./node_modules/webworkify-webpack/index.js"),X=i("./src/demux/demuxer-inline.js");function Z(){return MediaSource||window.WebKitMediaSource}var J=i("./src/utils/get-self-scope.js");var Q=function(e){function t(){return e.apply(this,arguments)||this}return function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(t,e),t.prototype.trigger=function(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(i))},t}(Y.EventEmitter),$=Object(J.getSelfScope)(),ee=Z(),te=function(){function e(i,e){var r=this;this.hls=i,this.id=e;function t(e,t){(t=t||{}).frag=r.frag,t.id=r.id,i.trigger(e,t)}var n=this.observer=new Q,a=i.config;n.on(P.default.FRAG_DECRYPTED,t),n.on(P.default.FRAG_PARSING_INIT_SEGMENT,t),n.on(P.default.FRAG_PARSING_DATA,t),n.on(P.default.FRAG_PARSED,t),n.on(P.default.ERROR,t),n.on(P.default.FRAG_PARSING_METADATA,t),n.on(P.default.FRAG_PARSING_USERDATA,t),n.on(P.default.INIT_PTS_FOUND,t);var s={mp4:ee.isTypeSupported("video/mp4"),mpeg:ee.isTypeSupported("audio/mpeg"),mp3:ee.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){var l;M.logger.log("demuxing in webworker");try{l=this.w=q(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(e){i.trigger(P.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},l.postMessage({cmd:"init",typeSupported:s,vendor:o,id:e,config:JSON.stringify(a)})}catch(e){M.logger.warn("Error in worker:",e),M.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),l&&$.URL.revokeObjectURL(l.objectURL),this.demuxer=new X.default(n,s,a,o),this.w=void 0}}else this.demuxer=new X.default(n,s,a,o)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},t.push=function(e,t,i,r,n,a,s,o){var l=this.w,u=Object(D.isFiniteNumber)(n.startPTS)?n.startPTS:n.start,h=n.decryptdata,d=this.frag,c=!(d&&n.cc===d.cc),f=!(d&&n.level===d.level),p=d&&n.sn===d.sn+1,v=!f&&p;if(c&&M.logger.log(this.id+":discontinuity detected"),f&&M.logger.log(this.id+":switch detected"),this.frag=n,l)l.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:i,videoCodec:r,timeOffset:u,discontinuity:c,trackSwitch:f,contiguous:v,duration:a,accurateTimeOffset:s,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[]);else{var m=this.demuxer;m&&m.push(e,h,t,i,r,u,c,f,v,a,s,o)}},t.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":$.URL.revokeObjectURL(this.w.objectURL);break;case P.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},e}();function ie(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i)}}function re(e,t,i){var r=e[t],n=e[i],a=n.startPTS;Object(D.isFiniteNumber)(a)?t<i?(r.duration=a-r.start,r.duration<0&&M.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(n.duration=r.start-a,n.duration<0&&M.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):n.start=t<i?r.start+r.duration:Math.max(r.start-n.duration,0)}function ne(e,t,i,r,n,a){var s=i;if(Object(D.isFiniteNumber)(t.startPTS)){var o=Math.abs(t.startPTS-i);Object(D.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,s=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),r=Math.max(r,t.endPTS),n=Math.min(n,t.startDTS),a=Math.max(a,t.endDTS)}var l=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=s,t.endPTS=r,t.startDTS=n,t.endDTS=a,t.duration=r-i;var u,h,d,c=t.sn;if(!e||c<e.startSN||c>e.endSN)return 0;for(u=c-e.startSN,(h=e.fragments)[u]=t,d=u;0<d;d--)re(h,d,d-1);for(d=u;d<h.length-1;d++)re(h,d,d+1);return e.PTSKnown=!0,l}function ae(e,i){i.initSegment&&e.initSegment&&(i.initSegment=e.initSegment);var r,n=0;if(se(e,i,function(e,t){n=e.cc-t.cc,Object(D.isFiniteNumber)(e.startPTS)&&(t.start=t.startPTS=e.startPTS,t.endPTS=e.endPTS,t.duration=e.duration,t.backtracked=e.backtracked,t.dropped=e.dropped,r=t),i.PTSKnown=!0}),i.PTSKnown){if(n){M.logger.log("discontinuity sliding from playlist, take drift into account");for(var t=i.fragments,a=0;a<t.length;a++)t[a].cc+=n}r?ne(i,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):function(e,t){var i=t.startSN-e.startSN,r=e.fragments,n=t.fragments;if(i<0||i>r.length)return;for(var a=0;a<n.length;a++)n[a].start+=r[i].start}(e,i),i.PTSKnown=e.PTSKnown}}function se(e,t,i){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=r;s<=n;s++){var o=e.fragments[a+s],l=t.fragments[s];if(!o||!l)break;i(o,l,s)}}function oe(e,t,i){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=r/2;return e&&t.endSN===e.endSN&&(r=n),i&&(r=Math.max(n,r-(window.performance.now()-i))),Math.round(r)}var le={toString:function(e){for(var t="",i=e.length,r=0;r<i;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}};function ue(i,e){e.fragments.forEach(function(e){if(e){var t=e.start+i;e.start=e.startPTS=t,e.endPTS=t+e.duration}}),e.PTSKnown=!0}function he(e,t,i){!function(e,t,i){if(function(e,t,i){var r=!1;return t&&t.details&&i&&(i.endCC>i.startCC||e&&e.cc<i.startCC)&&(r=!0),r}(e,i,t)){var r=function(e,t){var i=e.fragments,r=t.fragments;if(r.length&&i.length){var n=function(e,t){for(var i=null,r=0;r<e.length;r+=1){var n=e[r];if(n&&n.cc===t){i=n;break}}return i}(i,r[0].cc);if(n&&(!n||n.startPTS))return n;M.logger.log("No frag in previous level to align on")}else M.logger.log("No fragments to align")}(i.details,t);r&&(M.logger.log("Adjusting PTS using last level due to CC increase within current level"),ue(r.start,t))}}(e,i,t),!i.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var i=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-i)/1e3+t.fragments[0].start;Object(D.isFiniteNumber)(r)&&(M.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),ue(r,e))}}(i,t.details)}function de(e,t,i){if(!Array.isArray(e)||!e.length||!Object(D.isFiniteNumber)(t))return null;if(t<e[0].programDateTime)return null;if(t>=e[e.length-1].endProgramDateTime)return null;i=i||0;for(var r=0;r<e.length;++r){var n=e[r];if(a=t,s=i,o=n,void 0,l=1e3*Math.min(s,o.duration+(o.deltaPTS?o.deltaPTS:0)),o.endProgramDateTime-l>a)return n}var a,s,o,l;return null}function ce(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=e?t[e.sn-t[0].sn+1]:null;return n&&!fe(i,r,n)?n:W.search(t,fe.bind(null,i,r))}function fe(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=e?1:i.start-r>e&&i.start?-1:0}var pe=function(){function e(e,t,i,r){this.config=e,this.media=t,this.fragmentTracker=i,this.hls=r,this.stallReported=!1}var t=e.prototype;return t.poll=function(e,t){var i=this.config,r=this.media,n=r.currentTime,a=window.performance.now();if(n!==e)return this.stallReported&&(M.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(a-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(r.ended||!r.buffered.length||2<r.readyState||r.seeking&&K.isBuffered(r,n))){var s=a-this.stalled,o=K.bufferInfo(r,n,i.maxBufferHole);this.stalled?(1e3<=s&&this._reportStall(o.len),this._tryFixBufferStall(o,s)):this.stalled=a}},t._tryFixBufferStall=function(e,t){var i=this.config,r=this.fragmentTracker,n=this.media.currentTime,a=r.getPartialFragment(n);a&&this._trySkipBufferHole(a),.5<e.len&&t>1e3*i.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,i=this.media;this.stallReported||(this.stallReported=!0,M.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),t.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.hls,i=this.media,r=i.currentTime,n=0,a=0;a<i.buffered.length;a++){var s=i.buffered.start(a);if(n<=r&&r<s)return i.currentTime=Math.max(s,i.currentTime+.1),M.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+i.currentTime),this.stalled=null,void t.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+i.currentTime,frag:e});n=i.buffered.end(a)}},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,r=i.currentTime,n=(this.nudgeRetry||0)+1;if((this.nudgeRetry=n)<e.nudgeMaxRetry){var a=r+n*e.nudgeOffset;M.logger.log("adjust currentTime from "+r+" to "+a),i.currentTime=a,t.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else M.logger.error("still stuck in high buffer @"+r+" after "+e.nudgeMaxRetry+", raise fatal error"),t.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var me=function(a){function e(e){for(var t,i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return(t=a.call.apply(a,[this,e].concat(r))||this)._tickInterval=null,t._tickTimer=null,t._tickCallCount=0,t._boundTick=t.tick.bind(ve(ve(t))),t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,a);var t,i,r=e.prototype;function n(e){return t.apply(this,arguments)}function s(){return i.apply(this,arguments)}return r.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},r.hasInterval=function(){return!!this._tickInterval},r.hasNextTick=function(){return!!this._tickTimer},r.setInterval=(t=function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)},n.toString=function(){return t.toString()},n),r.clearInterval=(i=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),!(this._tickInterval=null))},s.toString=function(){return i.toString()},s),r.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),!(this._tickTimer=null))},r.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},r.doTick=function(){},e}(u);var ge="STOPPED",_e="STARTING",ye="IDLE",be="PAUSED",Se="KEY_LOADING",Ee="FRAG_LOADING",ke="FRAG_LOADING_WAITING_RETRY",we="WAITING_TRACK",Te="PARSING",Re="PARSED",Ae="BUFFER_FLUSHING",Ce="ENDED",xe="ERROR",Ie="WAITING_INIT_PTS",Oe="WAITING_LEVEL",Le=function(e){function t(){return e.apply(this,arguments)||this}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(t,e);var i=t.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ge},i._streamEnded=function(e,t){var i=this.fragCurrent,r=this.fragmentTracker;if(t.live||!i||i.backtracked||i.sn!==t.endSN||e.nextStart)return!1;var n=r.getState(i);return n===G||n===V},i.onMediaSeeking=function(){var e=this.config,t=this.media,i=this.mediaBuffer,r=this.state,n=t?t.currentTime:null,a=K.bufferInfo(i||t,n,this.config.maxBufferHole);if(Object(D.isFiniteNumber)(n)&&M.logger.log("media seeking to "+n.toFixed(3)),r===Ee){var s=this.fragCurrent;if(0===a.len&&s){var o=e.maxFragLookUpTolerance,l=s.start-o,u=s.start+s.duration+o;n<l||u<n?(s.loader&&(M.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ye):M.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===Ce&&(0===a.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=ye);t&&(this.lastCurrentTime=n),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=n),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=ge,this.fragmentTracker=null},t}(me);function De(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pe=function(r){function e(e,t){var i;return(i=r.call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHING,P.default.MANIFEST_LOADING,P.default.MANIFEST_PARSED,P.default.LEVEL_LOADED,P.default.KEY_LOADED,P.default.FRAG_LOADED,P.default.FRAG_LOAD_EMERGENCY_ABORTED,P.default.FRAG_PARSING_INIT_SEGMENT,P.default.FRAG_PARSING_DATA,P.default.FRAG_PARSED,P.default.ERROR,P.default.AUDIO_TRACK_SWITCHING,P.default.AUDIO_TRACK_SWITCHED,P.default.BUFFER_CREATED,P.default.BUFFER_APPENDED,P.default.BUFFER_FLUSHED)||this).fragmentTracker=t,i.config=e.config,i.audioCodecSwap=!1,i._state=ge,i.stallReported=!1,i.gapController=null,i}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,r);var t=e.prototype;return t.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=i.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=r,this.loadedmetadata=!1}0<t&&-1===e&&(M.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=ye,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=ge},t.stopLoad=function(){this.forceStartLoad=!1,r.prototype.stopLoad.call(this)},t.doTick=function(){switch(this.state){case Ae:this.fragLoadError=0;break;case ye:this._doTickIdle();break;case Oe:var e=this.levels[this.level];e&&e.details&&(this.state=ye);break;case ke:var t=window.performance.now(),i=this.retryDate;(!i||i<=t||this.media&&this.media.seeking)&&(M.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ye)}this._checkBuffer(),this._checkFragmentChanged()},t._doTickIdle=function(){var e=this.hls,t=e.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&t.startFragPrefetch)){var r;r=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=e.nextLoadLevel,a=this.levels[n];if(a){var s,o=a.bitrate;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=K.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,r,t.maxBufferHole),u=l.len;if(!(s<=u)){M.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=n;var h=a.details;if(!h||h.live&&this.levelLastLoaded!==n)this.state=Oe;else{if(this._streamEnded(l,h)){var d={};return this.altAudio&&(d.type="video"),this.hls.trigger(P.default.BUFFER_EOS,d),void(this.state=Ce)}this._fetchPayloadOrEos(r,l,h)}}}}},t._fetchPayloadOrEos=function(e,t,i){var r=this.fragPrevious,n=this.level,a=i.fragments,s=a.length;if(0!==s){var o,l=a[0].start,u=a[s-1].start+a[s-1].duration,h=t.end;if(i.initSegment&&!i.initSegment.data)o=i.initSegment;else if(i.live){var d=this.config.initialLiveManifestSize;if(s<d)return void M.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+d);if(null===(o=this._ensureFragmentAtLivePoint(i,h,l,u,r,a,s)))return}else h<l&&(o=a[0]);(o=o||this._findFragment(l,r,s,a,h,u,i))&&(o.encrypted?(M.logger.log("Loading key for "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n),this._loadKey(o)):(M.logger.log("Loading "+o.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n+", currentTime:"+e.toFixed(3)+",bufferEnd:"+h.toFixed(3)),this._loadFragment(o)))}},t._ensureFragmentAtLivePoint=function(e,t,i,r,n,a,s){var o,l=this.hls.config,u=this.media,h=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(i-l.maxFragLookUpTolerance,r-h)){var d=this.liveSyncPosition=this.computeLivePosition(i,e);M.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,u&&u.readyState&&u.duration>d&&(u.currentTime=d),this.nextLoadPosition=d}if(e.PTSKnown&&r<t&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(n)if(e.hasProgramDateTime)M.logger.log("live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),o=de(a,n.endProgramDateTime,l.maxFragLookUpTolerance);else{var c=n.sn+1;if(c>=e.startSN&&c<=e.endSN){var f=a[c-e.startSN];n.cc===f.cc&&(o=f,M.logger.log("live playlist, switching playlist, load frag with next SN: "+o.sn))}o||(o=W.search(a,function(e){return n.cc-e.cc}))&&M.logger.log("live playlist, switching playlist, load frag with same CC: "+o.sn)}o||(o=a[Math.min(s-1,Math.round(s/2))],M.logger.log("live playlist, switching playlist, unknown, load middle frag : "+o.sn))}return o},t._findFragment=function(e,t,i,r,n,a,s){var o,l=this.hls.config;n<a?o=ce(t,r,n,n>a-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance):o=r[i-1];if(o){var u=o.sn-s.startSN,h=t&&o.level===t.level,d=r[u-1],c=r[1+u];if(t&&o.sn===t.sn)if(h&&!o.backtracked)if(o.sn<s.endSN){var f=t.deltaPTS;f&&f>l.maxBufferHole&&t.dropped&&u?(o=d,M.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(o=c,M.logger.log("SN just loaded, load next one: "+o.sn,o))}else o=null;else o.backtracked&&(c&&c.backtracked?(M.logger.warn("Already backtracked from fragment "+c.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+c.sn),o=c):(M.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,d?(o=d).backtracked=!0:u&&(o=null)))}return o},t._loadKey=function(e){this.state=Se,this.hls.trigger(P.default.KEY_LOADING,{frag:e})},t._loadFragment=function(e){var t=this.fragmentTracker.getState(e);"initSegment"!==(this.fragCurrent=e).sn&&(this.startFragRequested=!0),Object(D.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===j||t===G?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(P.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new te(this.hls,"main")),this.state=Ee):t===z&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},t.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,a.MAIN)},t.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},t._checkFragmentChanged=function(){var e,t,i=this.media;if(i&&i.readyState&&!1===i.seeking&&((t=i.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),K.isBuffered(i,t)?e=this.getBufferedFrag(t):K.isBuffered(i,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(P.default.FRAG_CHANGED,{frag:r});var n=r.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(P.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=r}}},t.immediateLevelSwitch=function(){if(M.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,K.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},t.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,i,r;if((i=this.getBufferedFrag(e.currentTime))&&1<i.startPTS&&this.flushMainBuffer(0,i.startPTS-1),e.paused)t=0;else{var n=this.hls.nextLoadLevel,a=this.levels[n],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*s)+1:0}if(r=(r=this.getBufferedFrag(e.currentTime+t))&&this.followingBufferedFrag(r)){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)}}},t.flushMainBuffer=function(e,t){this.state=Ae;var i={startOffset:e,endOffset:t};this.altAudio&&(i.type="video"),this.hls.trigger(P.default.BUFFER_FLUSHING,i)},t.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new pe(i,t,this.fragmentTracker,this.hls)},t.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(M.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(D.isFiniteNumber)(t)&&M.logger.log("media seeked to "+t.toFixed(3)),this.tick()},t.onManifestLoading=function(){M.logger.log("trigger BUFFER_RESET"),this.hls.trigger(P.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},t.onManifestParsed=function(e){var t,i=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(i=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=i&&r,this.audioCodecSwitch&&M.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},t.onLevelLoaded=function(e){var t=e.details,i=e.level,r=this.levels[this.levelLastLoaded],n=this.levels[i],a=t.totalduration,s=0;if(M.logger.log("level "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var o=n.details;o&&0<t.fragments.length?(ae(o,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,o),t.PTSKnown&&Object(D.isFiniteNumber)(s)?M.logger.log("live playlist sliding:"+s.toFixed(3)):(M.logger.log("live playlist - outdated PTS, unknown sliding"),he(this.fragPrevious,r,t))):(M.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,he(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(n.details=t,this.levelLastLoaded=i,this.hls.trigger(P.default.LEVEL_UPDATED,{details:t,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=t.startTimeOffset;Object(D.isFiniteNumber)(l)?(l<0&&(M.logger.log("negative start time offset "+l+", count from end of last fragment"),l=s+a+l),M.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l):t.live?(this.startPosition=this.computeLivePosition(s,t),M.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Oe&&(this.state=ye),this.tick()},t.onKeyLoaded=function(){this.state===Se&&(this.state=ye,this.tick())},t.onFragLoaded=function(e){var t=this.fragCurrent,i=this.hls,r=this.levels,n=this.media,a=e.frag;if(this.state===Ee&&t&&"main"===a.type&&a.level===t.level&&a.sn===t.sn){var s=e.stats,o=r[t.level],l=o.details;if(this.bitrateTest=!1,this.stats=s,M.logger.log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),a.bitrateTest&&i.nextLoadLevel)this.state=ye,this.startFragRequested=!1,s.tparsed=s.tbuffered=window.performance.now(),i.trigger(P.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=ye,s.tparsed=s.tbuffered=window.performance.now(),l.initSegment.data=e.payload,i.trigger(P.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else{M.logger.log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=Te,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var u=!(n&&n.seeking)&&(l.PTSKnown||!l.live),h=l.initSegment?l.initSegment.data:[],d=this._getAudioCodec(o);(this.demuxer=this.demuxer||new te(this.hls,"main")).push(e.payload,h,d,o.videoCodec,t,l.totalduration,u)}}this.fragLoadError=0},t.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===Te){var r,n,a=e.tracks;if(a.audio&&this.altAudio&&delete a.audio,n=a.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(M.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==n.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==n.container&&(s="mp4a.40.2",M.logger.log("Android: force audio codec to "+s)),n.levelCodec=s,n.id=e.id}for(r in(n=a.video)&&(n.levelCodec=this.levels[this.level].videoCodec,n.id=e.id),this.hls.trigger(P.default.BUFFER_CODECS,a),a){n=a[r],M.logger.log("main track:"+r+",container:"+n.container+",codecs[level/parsed]=["+n.levelCodec+"/"+n.codec+"]");var l=n.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(P.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}},t.onFragParsingData=function(t){var i=this,e=this.fragCurrent,r=t.frag;if(e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&("audio"!==t.type||!this.altAudio)&&this.state===Te){var n=this.levels[this.level],a=e;if(Object(D.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+e.duration,t.endDTS=t.startDTS+e.duration),!0===t.hasAudio&&a.addElementaryStream(f.AUDIO),!0===t.hasVideo&&a.addElementaryStream(f.VIDEO),M.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(a.dropped=t.dropped,a.dropped)if(a.backtracked)M.logger.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var s=n.details;if(!s||a.sn!==s.startSN)return M.logger.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=ye,this.fragPrevious=a,void this.tick();M.logger.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var o=ne(n.details,a,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(P.default.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:o,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&i.state===Te&&(i.appended=!0,i.pendingBuffering=!0,l.trigger(P.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}},t.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===Te&&(this.stats.tparsed=window.performance.now(),this.state=Re,this._checkAppendedParsed())},t.onAudioTrackSwitching=function(e){var t=!!e.url,i=e.id;if(!t){if(this.mediaBuffer!==this.media){M.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(M.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ye}var n=this.hls;n.trigger(P.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(P.default.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},t.onAudioTrackSwitched=function(e){var t=e.id,i=!!this.hls.audioTracks[t].url;if(i){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(M.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i,this.tick()},t.onBufferCreated=function(e){var t,i,r=e.tracks,n=!1;for(var a in r){var s=r[a];"main"===s.id?(t=s,"video"===(i=a)&&(this.videoBuffer=r[a].buffer)):n=!0}n&&t?(M.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},t.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==Te&&t!==Re||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},t._checkAppendedParsed=function(){if(!(this.state!==Re||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;M.logger.log("main buffered : "+le.toString(t.buffered)),this.fragPrevious=e;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(P.default.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.state=ye}this.tick()}},t.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var i=!!this.media&&K.isBuffered(this.media,this.media.currentTime)&&K.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);M.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ke}else M.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=xe;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==xe&&(e.fatal?(this.state=xe,M.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Oe||(this.state=ye));break;case c.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==Te&&this.state!==Re||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ye):(M.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},t._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,M.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},t._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},t.onFragLoadEmergencyAborted=function(){this.state=ye,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},t.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;e&&this.fragmentTracker.detectEvictedFragments(f.VIDEO,e.buffered),this.state=ye,this.fragPrevious=null},t.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.computeLivePosition=function(e,t){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-i)},t._seekToStartPos=function(){var e=this.media,t=e.currentTime,i=e.seeking?t:this.startPosition;t!==i&&(M.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+t+" "),e.currentTime=i)},t._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(M.logger.log("swapping playlist audio codec"),t=t&&(-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},function(e,t,i){t&&De(e.prototype,t),i&&De(e,i)}(e,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,M.logger.log("main stream:"+t+"->"+e),this.hls.trigger(P.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),e}(Le);function Me(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}window.performance;var Fe,Be=function(i){function e(e){var t;return(t=i.call(this,e,P.default.MANIFEST_LOADED,P.default.LEVEL_LOADED,P.default.AUDIO_TRACK_SWITCHED,P.default.FRAG_LOADED,P.default.ERROR)||this).canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,Fe=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},t.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},t.stopLoad=function(){this.canload=!1},t.onManifestLoaded=function(e){var t,i=[],r=[],n={},a=null,s=!1,o=!1;if(e.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,s=s||!!e.videoCodec,o=o||!!e.audioCodec,Fe&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=n[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,i.push(e)),t&&(t.AUDIO&&(o=!0,ie(a||e,"audio",t.AUDIO)),t.SUBTITLES&&ie(a||e,"text",t.SUBTITLES))}),s&&o&&(i=i.filter(function(e){return!!e.videoCodec})),i=i.filter(function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||S(t,"audio"))&&(!i||S(i,"video"))}),e.audioTracks&&(r=e.audioTracks.filter(function(e){return!e.audioCodec||S(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),0<i.length){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var l=0;l<i.length;l++)if(i[l].bitrate===t){this._firstLevel=l,M.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(P.default.MANIFEST_PARSED,{levels:i,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:s,altAudio:r.some(function(e){return!!e.url})})}else this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},t.setLevelInternal=function(e){var t=this._levels,i=this.hls;if(0<=e&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){M.logger.log("switching to level "+e);var r=t[this.currentLevelIndex=e];r.level=e,i.trigger(P.default.LEVEL_SWITCHING,r)}var n=t[e],a=n.details;if(!a||a.live){var s=n.urlId;i.trigger(P.default.LEVEL_LOADING,{url:n.url[s],level:e,id:s})}}else i.trigger(P.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},t.onError=function(e){if(e.fatal)e.type===c.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,i=!1,r=!1;switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,i=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,i=!0}void 0!==t&&this.recoverLevel(e,t,i,r)}},t.recoverLevel=function(e,t,i,r){var n,a,s,o=this,l=this.hls.config,u=e.details,h=this._levels[t];if(h.loadError++,h.fragmentError=r,i){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return M.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return o.loadLevel()},a),e.levelRetry=!0,this.levelRetryCount++,M.logger.warn("level controller, "+u+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(i||r)&&(1<(n=h.url.length)&&h.loadError<n?(h.urlId=(h.urlId+1)%n,h.details=void 0,M.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+h.urlId)):-1===this.manualLevelIndex?(s=0===t?this._levels.length-1:t-1,M.logger.warn("level controller, "+u+": switch to "+s),this.hls.nextAutoLevel=this.currentLevelIndex=s):r&&(M.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},t.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var i=this._levels[t.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},t.onLevelLoaded=function(e){var t=this,i=e.level,r=e.details;if(i===this.currentLevelIndex){var n=this._levels[i];if(n.fragmentError||(n.loadError=0,this.levelRetryCount=0),r.live){var a=oe(n.details,r,e.stats.trequest);M.logger.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout(function(){return t.loadLevel()},a)}else this.clearTimer()}},t.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var r=-1,n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===t){r=n;break}r!==i.urlId&&(i.urlId=r,this.startLoad())}},t.loadLevel=function(){if(M.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&0<e.url.length){var t=this.currentLevelIndex,i=e.urlId,r=e.url[i];M.logger.log("Attempt loading level index "+t+" with URL-id "+i),this.hls.trigger(P.default.LEVEL_LOADING,{url:r,level:t,id:i})}}},function(e,t,i){t&&Me(e.prototype,t),i&&Me(e,i)}(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),e}(u),Ne=i("./src/demux/id3.js");function Ue(e,t){var i=null;try{i=new window.Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function je(e){if(e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}var ze=function(i){function e(e){var t;return(t=i.call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHING,P.default.FRAG_PARSING_METADATA)||this).id3Track=void 0,t.media=void 0,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.destroy=function(){u.prototype.destroy.call(this)},t.onMediaAttached=function(e){this.media=e.media,this.media},t.onMediaDetaching=function(){je(this.id3Track),this.id3Track=void 0,this.media=void 0},t.getID3Track=function(e){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return Ue(i,this.media),i}return this.media.addTextTrack("metadata","id3")},t.onFragParsingMetadata=function(e){var t=e.frag,i=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var a=Ne.default.getID3Frames(i[n].data);if(a){var s=i[n].pts,o=n<i.length-1?i[n+1].pts:t.endPTS;s===o&&(o+=1e-4);for(var l=0;l<a.length;l++){var u=a[l];if(!Ne.default.isTimeStampFrame(u)){var h=new r(s,o,"");h.value=u,this.id3Track.addCue(h)}}}}},e}(u);var Ge=function(){function e(e){this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Ve=function(){function e(e,t,i,r){this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ge(t),this.fast_=new Ge(i)}var t=e.prototype;return t.sample=function(e,t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/i;this.fast_.sample(i,r),this.slow_.sample(i,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function He(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Ke=window.performance,Ye=function(i){function e(e){var t;return(t=i.call(this,e,P.default.FRAG_LOADING,P.default.FRAG_LOADED,P.default.FRAG_BUFFERED,P.default.ERROR)||this).lastLoadedFragLevel=0,t._nextAutoLevel=-1,t.hls=e,t.timer=null,t._bwEstimator=null,t.onCheck=t._abandonRulesCheck.bind(We(We(t))),t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.destroy=function(){this.clearTimer(),u.prototype.destroy.call(this)},t.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i,r,n=this.hls,a=n.config,s=t.level;r=n.levels[s].details.live?(i=a.abrEwmaFastLive,a.abrEwmaSlowLive):(i=a.abrEwmaFastVoD,a.abrEwmaSlowVoD),this._bwEstimator=new Ve(n,r,i,a.abrEwmaDefaultEstimate)}},t._abandonRulesCheck=function(){var e=this.hls,t=e.media,i=this.fragCurrent;if(i){var r=i.loader,n=e.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return M.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var a=r.stats;if(t&&a&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&i.autoLevel&&i.level){var s=Ke.now()-a.trequest,o=Math.abs(t.playbackRate);if(s>500*i.duration/o){var l=e.levels,u=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/s),h=l[i.level],d=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,c=a.total?a.total:Math.max(a.loaded,Math.round(i.duration*d/8)),f=t.currentTime,p=(c-a.loaded)/u,v=(K.bufferInfo(t,f,e.config.maxBufferHole).end-f)/o;if(v<2*i.duration/o&&v<p){var m;for(m=i.level-1;n<m;m--){var g=l[m].realBitrate?Math.max(l[m].realBitrate,l[m].bitrate):l[m].bitrate;if(i.duration*g/(6.4*u)<v)break}void 0<p&&(M.logger.warn("loading too slow, abort fragment loading and switch to level "+m+":fragLoadedDelay["+m+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+p.toFixed(1)+":"+v.toFixed(1)),e.nextLoadLevel=m,this._bwEstimator.sample(s,a.loaded),r.abort(),this.clearTimer(),e.trigger(P.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:a}))}}}}},t.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(D.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[t.level],r=(i.loaded?i.loaded.bytes:0)+e.stats.loaded,n=(i.loaded?i.loaded.duration:0)+e.frag.duration;i.loaded={bytes:r,duration:n},i.realBitrate=Math.round(8*r/n)}if(e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}},t.onFragBuffered=function(e){var t=e.stats,i=e.frag;if(!0!==t.aborted&&"main"===i.type&&Object(D.isFiniteNumber)(i.sn)&&(!i.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;M.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},t.onError=function(e){switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){clearInterval(this.timer),this.timer=null},t._findBestLevel=function(e,t,i,r,n,a,s,o,l){for(var u=n;r<=u;u--){var h=l[u];if(h){var d=h.details,c=d?d.totalduration/d.fragments.length:t,f=!!d&&d.live,p=void 0;p=u<=e?s*i:o*i;var v=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=v*c/p;if(M.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+v+"/"+c+"/"+a+"/"+m),v<p&&(!m||f&&!this.bitrateTestDelay||m<a))return u}}return-1},function(e,t,i){t&&He(e.prototype,t),i&&He(e,i)}(e,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel;return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,i=e.levels,r=e.config,n=e.minAutoLevel,a=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=(K.bufferInfo(a,l,r.maxBufferHole).end-l)/u,c=this._findBestLevel(s,o,h,n,t,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor,i);if(0<=c)return c;M.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var f=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,v=r.abrBandWidthUpFactor;if(0==d){var m=this.bitrateTestDelay;if(m)f=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-m,M.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),p=v=1}return c=this._findBestLevel(s,o,h,n,t,d+f,p,v,i),Math.max(c,0)}}]),e}(u);var qe=Z(),Xe=function(t){function e(e){var o;return(o=t.call(this,e,P.default.MEDIA_ATTACHING,P.default.MEDIA_DETACHING,P.default.MANIFEST_PARSED,P.default.BUFFER_RESET,P.default.BUFFER_APPENDING,P.default.BUFFER_CODECS,P.default.BUFFER_EOS,P.default.BUFFER_FLUSHING,P.default.LEVEL_PTS_UPDATED,P.default.LEVEL_UPDATED)||this)._msDuration=null,o._levelDuration=null,o._levelTargetDuration=10,o._live=null,o._objectUrl=null,o._needsFlush=!1,o._needsEos=!1,o.config=void 0,o.audioTimestampOffset=void 0,o.bufferCodecEventsExpected=0,o.media=null,o.mediaSource=null,o.segments=[],o.parent=void 0,o.appending=!1,o.appended=0,o.appendError=0,o.flushBufferCounter=0,o.tracks={},o.pendingTracks={},o.sourceBuffer={},o.flushRange=[],o._onMediaSourceOpen=function(){M.logger.log("media source opened"),o.hls.trigger(P.default.MEDIA_ATTACHED,{media:o.media});var e=o.mediaSource;e&&e.removeEventListener("sourceopen",o._onMediaSourceOpen),o.checkPendingTracks()},o._onMediaSourceClose=function(){M.logger.log("media source closed")},o._onMediaSourceEnded=function(){M.logger.log("media source ended")},o._onSBUpdateEnd=function(){if(o.audioTimestampOffset&&o.sourceBuffer.audio){var e=o.sourceBuffer.audio;M.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+o.audioTimestampOffset),e.timestampOffset=o.audioTimestampOffset,delete o.audioTimestampOffset}o._needsFlush&&o.doFlush(),o._needsEos&&o.checkEos(),o.appending=!1;var i=o.parent,t=o.segments.reduce(function(e,t){return t.parent===i?e+1:e},0),r={},n=o.sourceBuffer;for(var a in n){var s=n[a];if(!s)throw Error("handling source buffer update end error: source buffer for "+a+" uninitilized and unable to update buffered TimeRanges.");r[a]=s.buffered}o.hls.trigger(P.default.BUFFER_APPENDED,{parent:i,pending:t,timeRanges:r}),o._needsFlush||o.doAppending(),o.updateMediaElementDuration(),0===t&&o.flushLiveBackBuffer()},o._onSBUpdateError=function(e){M.logger.error("sourceBuffer error:",e),o.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},o.config=e.config,o}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,t);var i=e.prototype;return i.destroy=function(){u.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,i=this.tracks.audio;if("audio"===t&&i&&"audio/mpeg"===i.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(.1<Math.abs(r.timestampOffset-e.start)){var n=r.updating;try{r.abort()}catch(e){M.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(M.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},i.onManifestParsed=function(e){this.bufferCodecEventsExpected=e.altAudio?2:1,M.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var i=this.mediaSource=new qe;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(i),this._objectUrl=t.src}},i.onMediaDetaching=function(){M.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){M.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):M.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(P.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,i=Object.keys(t).length;(i&&!e||2===i)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var i=e[t];try{i&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this._onSBUpdateEnd),i.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(t){var i=this;Object.keys(this.sourceBuffer).length||(Object.keys(t).forEach(function(e){i.pendingTracks[e]=t[e]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(var r in e)if(!t[r]){var n=e[r];if(!n)throw Error("source buffer exists for track "+r+", however track does not");var a=n.levelCodec||n.codec,s=n.container+";codecs="+a;M.logger.log("creating sourceBuffer("+s+")");try{var o=t[r]=i.addSourceBuffer(s);o.addEventListener("updateend",this._onSBUpdateEnd),o.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:o,codec:a,container:n.container,levelCodec:n.levelCodec}}catch(e){M.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(P.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var i=this.sourceBuffer[t];i&&!i.ended&&(i.ended=!0,M.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var i in e){var r=e[i];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}M.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){M.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(!this.media)throw Error("flushLiveBackBuffer called without attaching media");if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))for(var t=this.media.currentTime,i=this.sourceBuffer,r=Object.keys(i),n=t-Math.max(e,this._levelTargetDuration),a=r.length-1;0<=a;a--){var s=r[a],o=i[s];if(o){var l=o.buffered;0<l.length&&n>l.start(0)&&this.removeBufferRange(s,o,0,n)}}}},i.onLevelUpdated=function(e){var t=e.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer){var r=this.sourceBuffer[i];if(r&&!0===r.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(M.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(D.isFiniteNumber)(e))&&(M.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,i=this.sourceBuffer;try{for(var r in i){var n=i[r];n&&(t+=n.buffered.length)}}catch(e){M.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(P.default.BUFFER_FLUSHED)}},i.doAppending=function(){var t=this.config,i=this.hls,r=this.segments,e=this.sourceBuffer;if(Object.keys(e).length){if(!this.media||this.media.error)return this.segments=[],void M.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var n=r.shift();if(n)try{var a=e[n.type];if(!a)return void this._onSBUpdateEnd();if(a.updating)return void r.unshift(n);a.ended=!1,this.parent=n.parent,a.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0}catch(e){M.logger.error("error while trying to append buffer:"+e.message),r.unshift(n);var s={type:c.ErrorTypes.MEDIA_ERROR,parent:n.parent,details:"",fatal:!1};22===e.code?(this.segments=[],s.details=c.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,s.details=c.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.appendErrorMaxRetry&&(M.logger.log("fail "+t.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],s.fatal=!0)),i.trigger(P.default.ERROR,s)}}}},i.flushBuffer=function(e,t,i){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var n="null";if(this.media&&(n=this.media.currentTime.toFixed(3)),M.logger.log("flushBuffer,pos/start/end: "+n+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return M.logger.warn("abort flushing too many retries"),!0;var a=r[i];if(a){if(a.ended=!1,a.updating)return M.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(i,a,e,t))return this.flushBufferCounter++,!1}return M.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,i,r){try{for(var n=0;n<t.buffered.length;n++){var a=t.buffered.start(n),s=t.buffered.end(n),o=Math.max(a,i),l=Math.min(s,r);if(.5<Math.min(l,s)-o){var u="null";return this.media&&(u=this.media.currentTime.toString()),M.logger.log("sb remove "+e+" ["+o+","+l+"], of ["+a+","+s+"], pos:"+u),t.remove(o,l),!0}}}catch(e){M.logger.warn("removeBufferRange failed",e)}return!1},e}(u);function Ze(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Je=function(i){function n(e){var t;return(t=i.call(this,e,P.default.FPS_DROP_LEVEL_CAPPING,P.default.MEDIA_ATTACHING,P.default.MANIFEST_PARSED,P.default.BUFFER_CODECS,P.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,t.firstLevel=null,t.levels=[],t.media=null,t.restrictedLevels=[],t.timer=null,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(n,i);var e=n.prototype;return e.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.stopCapping())},e.onFpsDropLevelCapping=function(e){n.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},e.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},e.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},e.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},e.onLevelsUpdated=function(e){this.levels=e.levels},e.onMediaDetaching=function(){this.stopCapping()},e.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},e.getMaxLevel=function(i){var r=this;if(!this.levels)return-1;var e=this.levels.filter(function(e,t){return n.isLevelAllowed(t,r.restrictedLevels)&&t<=i});return n.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},e.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},n.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},n.getMaxLevelByMediaSize=function(e,t,i){if(!e||e&&!e.length)return-1;for(var r,n,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=i)&&(r=o,!(n=e[s+1])||r.width!==n.width||r.height!==n.height)){a=s;break}}return a},function(e,t,i){t&&Ze(e.prototype,t),i&&Ze(e,i)}(n,[{key:"mediaWidth",get:function(){var e,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=n.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=n.contentScaleFactor),e}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),n}(u);var Qe=window.performance,$e=function(t){function e(e){return t.call(this,e,P.default.MEDIA_ATTACHING)||this}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,t);var i=e.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},i.checkFPS=function(e,t,i){var r=Qe.now();if(t){if(this.lastTime){var n=r-this.lastTime,a=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/n,l=this.hls;if(l.trigger(P.default.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),0<o&&a>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;M.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),0<u&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(P.default.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,l.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}(u),et=window,tt=et.performance,it=et.XMLHttpRequest,rt=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,i){this.context=e,this.config=t,this.callbacks=i,this.stats={trequest:tt.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var t,i=this.context;t=this.loader=new it;var e=this.stats;e.tfirst=0,e.loaded=0;var r=this.xhrSetup;try{if(r)try{r(t,i.url)}catch(e){t.open("GET",i.url,!0),r(t,i.url)}t.readyState||t.open("GET",i.url,!0)}catch(e){return void this.callbacks.onError({code:t.status,text:e.message},i,t)}i.rangeEnd&&t.setRequestHeader("Range","bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=i.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.readystatechange=function(e){var t=e.currentTarget,i=t.readyState,r=this.stats,n=this.context,a=this.config;if(!r.aborted&&2<=i)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(tt.now(),r.trequest)),4===i){var s=t.status;if(200<=s&&s<300){var o,l;r.tload=Math.max(r.tfirst,tt.now()),l="arraybuffer"===n.responseType?(o=t.response).byteLength:(o=t.responseText).length,r.loaded=r.total=l;var u={url:t.responseURL,data:o};this.callbacks.onSuccess(u,r,n,t)}else r.retry>=a.maxRetry||400<=s&&s<499?(M.logger.error(s+" while loading "+n.url),this.callbacks.onError({code:s,text:t.statusText},n,t)):(M.logger.warn(s+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},t.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,i=this.stats;i.loaded=e.loaded,e.lengthComputable&&(i.total=e.total);var r=this.callbacks.onProgress;r&&r(i,this.context,null,t)},e}();function nt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var at=function(i){function e(e){var t;return(t=i.call(this,e,P.default.MANIFEST_LOADING,P.default.MANIFEST_PARSED,P.default.AUDIO_TRACK_LOADED,P.default.AUDIO_TRACK_SWITCHED,P.default.LEVEL_LOADED,P.default.ERROR)||this)._trackId=-1,t._selectDefaultTrack=!0,t.tracks=[],t.trackIdBlacklist=Object.create(null),t.audioGroupId=null,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},t.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(P.default.AUDIO_TRACKS_UPDATED,{audioTracks:t})},t.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)M.logger.warn("Invalid audio track id:",e.id);else{if(M.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},t.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},t.onLevelLoaded=function(e){var t=this.hls.levels[e.level];if(t.audioGroupIds){var i=t.audioGroupIds[t.urlId];this.audioGroupId!==i&&(this.audioGroupId=i,this._selectInitialAudioTrack())}},t.onError=function(e){e.type===c.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(M.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},t._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)M.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)M.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];M.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var i=t.url,r=t.type,n=t.id;this.hls.trigger(P.default.AUDIO_TRACK_SWITCHING,{id:n,type:r,url:i}),this._loadTrackDetailsIfNeeded(t)}},t.doTick=function(){this._updateTrack(this._trackId)},t._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var i=this.tracks[this._trackId],r=null;if(i&&(r=i.name),this._selectDefaultTrack){var n=e.filter(function(e){return e.default});n.length?e=n:M.logger.warn("No default audio tracks defined")}var a=!1,s=function(){e.forEach(function(e){a||t.audioGroupId&&e.groupId!==t.audioGroupId||r&&r!==e.name||(t._setAudioTrack(e.id),a=!0)})};s(),a||(r=null,s()),a||(M.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},t._needsTrackLoading=function(e){var t=e.details,i=e.url;return!(t&&!t.live)&&!!i},t._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,i=e.id;M.logger.log("loading audio-track playlist for id: "+i),this.hls.trigger(P.default.AUDIO_TRACK_LOADING,{url:t,id:i})}},t._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,M.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},t._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],i=t.name,r=t.language,n=t.groupId;M.logger.warn("Loading failed on audio track id: "+e+", group-id: "+n+', name/language: "'+i+'" / "'+r+'"');for(var a=e,s=0;s<this.tracks.length;s++){if(!this.trackIdBlacklist[s])if(this.tracks[s].name===i){a=s;break}}a!==e?(M.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):M.logger.warn('No fallback audio-track found for name/language: "'+i+'" / "'+r+'"')},function(e,t,i){t&&nt(e.prototype,t),i&&nt(e,i)}(e,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}]),e}(me);function st(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ot(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}var lt=window.performance,ut=function(r){function e(e,t){var i;return(i=r.call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHING,P.default.AUDIO_TRACKS_UPDATED,P.default.AUDIO_TRACK_SWITCHING,P.default.AUDIO_TRACK_LOADED,P.default.KEY_LOADED,P.default.FRAG_LOADED,P.default.FRAG_PARSING_INIT_SEGMENT,P.default.FRAG_PARSING_DATA,P.default.FRAG_PARSED,P.default.ERROR,P.default.BUFFER_RESET,P.default.BUFFER_CREATED,P.default.BUFFER_APPENDED,P.default.BUFFER_FLUSHED,P.default.INIT_PTS_FOUND)||this).fragmentTracker=t,i.config=e.config,i.audioCodecSwap=!1,i._state=ge,i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,r);var t=e.prototype;return t.onInitPtsFound=function(e){var t=e.id,i=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[i]=r,this.videoTrackCC=i,M.logger.log("InitPTS for cc: "+i+" found from video track: "+r),this.state===Ie&&this.tick())},t.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<t&&-1===e?(M.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=ye):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=_e),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=ge},t.doTick=function(){var e,t,i,r=this.hls,n=r.config;switch(this.state){case xe:case be:case Ae:break;case _e:this.state=we,this.loadedmetadata=!1;break;case ye:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!n.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,l=K.bufferInfo(s,e,n.maxBufferHole),u=K.bufferInfo(o,e,n.maxBufferHole),h=l.len,d=l.end,c=this.fragPrevious,f=Math.min(n.maxBufferLength,n.maxMaxBufferLength),p=Math.max(f,u.len),v=this.audioSwitch,m=this.trackId;if((h<p||v)&&m<a.length){if(void 0===(i=a[m].details)){this.state=we;break}if(!v&&this._streamEnded(l,i))return this.hls.trigger(P.default.BUFFER_EOS,{type:"audio"}),void(this.state=Ce);var g,_=i.fragments,y=_.length,b=_[0].start,S=_[y-1].start+_[y-1].duration;if(v)if(i.live&&!i.PTSKnown)M.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),d=0;else if(d=e,i.PTSKnown&&e<b){if(!(l.end>b||l.nextStart))return;M.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=b+.05}if(i.initSegment&&!i.initSegment.data)g=i.initSegment;else if(d<=b){if(g=_[0],null!==this.videoTrackCC&&g.cc!==this.videoTrackCC&&(g=function(e,t){return W.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}(_,this.videoTrackCC)),i.live&&g.loadIdx&&g.loadIdx===this.fragLoadIdx){var E=l.nextStart?l.nextStart:b;return M.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(E+.05)),void(this.media.currentTime=E+.05)}}else{var k,w=n.maxFragLookUpTolerance,T=c?_[c.sn-_[0].sn+1]:void 0,R=function(e){var t=Math.min(w,e.duration);return e.start+e.duration-t<=d?1:e.start-t>d&&e.start?-1:0};(k=d<S?(S-w<d&&(w=0),T&&!R(T)?T:W.search(_,R)):_[y-1])&&(b=(g=k).start,c&&g.level===c.level&&g.sn===c.sn&&(g.sn<i.endSN?(g=_[g.sn+1-i.startSN],M.logger.log("SN just loaded, load next one: "+g.sn)):g=null))}g&&(g.encrypted?(M.logger.log("Loading key for "+g.sn+" of ["+i.startSN+" ,"+i.endSN+"],track "+m),this.state=Se,r.trigger(P.default.KEY_LOADING,{frag:g})):(M.logger.log("Loading "+g.sn+", cc: "+g.cc+" of ["+i.startSN+" ,"+i.endSN+"],track "+m+", currentTime:"+e+",bufferEnd:"+d.toFixed(3)),this.fragCurrent=g,!v&&this.fragmentTracker.getState(g)!==j||("initSegment"!==g.sn&&(this.startFragRequested=!0),Object(D.isFiniteNumber)(g.sn)&&(this.nextLoadPosition=g.start+g.duration),r.trigger(P.default.FRAG_LOADING,{frag:g}),this.state=Ee)))}break;case we:(t=this.tracks[this.trackId])&&t.details&&(this.state=ye);break;case ke:var A=lt.now(),C=this.retryDate,x=(s=this.media)&&s.seeking;(!C||C<=A||x)&&(M.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ye);break;case Ie:var I=this.videoTrackCC;if(void 0===this.initPTS[I])break;var O=this.waitingFragment;if(O){var L=O.frag.cc;I!==L?(t=this.tracks[this.trackId]).details&&t.details.live&&(M.logger.warn("Waiting fragment CC ("+L+") does not match video track CC ("+I+")"),this.waitingFragment=null,this.state=ye):(this.state=Ee,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=ye}},t.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)},t.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(M.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},t.onAudioTracksUpdated=function(e){M.logger.log("audio tracks updated"),this.tracks=e.audioTracks},t.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=be,this.waitingFragment=null,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=ye),this.tick()},t.onAudioTrackLoaded=function(e){var t=e.details,i=e.id,r=this.tracks[i],n=t.totalduration,a=0;if(M.logger.log("track "+i+" loaded ["+t.startSN+","+t.endSN+"],duration:"+n),t.live){var s=r.details;s&&0<t.fragments.length?(ae(s,t),a=t.fragments[0].start,t.PTSKnown?M.logger.log("live audio playlist sliding:"+a.toFixed(3)):M.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,M.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var o=t.startTimeOffset;Object(D.isFiniteNumber)(o)?(M.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===we&&(this.state=ye),this.tick()},t.onKeyLoaded=function(){this.state===Se&&(this.state=ye,this.tick())},t.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag;if(this.state===Ee&&t&&"audio"===i.type&&i.level===t.level&&i.sn===t.sn){var r=this.tracks[this.trackId],n=r.details,a=n.totalduration,s=t.level,o=t.sn,l=t.cc,u=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",h=this.stats=e.stats;if("initSegment"===o)this.state=ye,h.tparsed=h.tbuffered=lt.now(),n.initSegment.data=e.payload,this.hls.trigger(P.default.FRAG_BUFFERED,{stats:h,frag:t,id:"audio"}),this.tick();else{this.state=Te,this.appended=!1,this.demuxer||(this.demuxer=new te(this.hls,"audio"));var d=this.initPTS[l],c=n.initSegment?n.initSegment.data:[];if(n.initSegment||void 0!==d){this.pendingBuffering=!0,M.logger.log("Demuxing "+o+" of ["+n.startSN+" ,"+n.endSN+"],track "+s);this.demuxer.push(e.payload,c,u,null,t,a,!1,d)}else M.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+n.startSN+" ,"+n.endSN+"],track "+s),this.waitingFragment=e,this.state=Ie}}this.fragLoadError=0},t.onFragParsingInitSegment=function(e){var t=this.fragCurrent,i=e.frag;if(t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===Te){var r,n=e.tracks;if(n.video&&delete n.video,r=n.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(P.default.BUFFER_CODECS,n),M.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;if(a){var s={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(P.default.BUFFER_APPENDING,s))}this.tick()}}},t.onFragParsingData=function(t){var i=this,e=this.fragCurrent,r=t.frag;if(e&&"audio"===t.id&&"audio"===t.type&&r.sn===e.sn&&r.level===e.level&&this.state===Te){var n=this.trackId,a=this.tracks[n],s=this.hls;Object(D.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+e.duration,t.endDTS=t.startDTS+e.duration),e.addElementaryStream(f.AUDIO),M.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),ne(a.details,e,t.startPTS,t.endPTS);var o=this.audioSwitch,l=this.media,u=!1;if(o)if(l&&l.readyState){var h=l.currentTime;M.logger.log("switching audio track : currentTime:"+h),h>=t.startPTS&&(M.logger.log("switching audio track : flushing all audio"),this.state=Ae,s.trigger(P.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,s.trigger(P.default.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,s.trigger(P.default.AUDIO_TRACK_SWITCHED,{id:n});var d=this.pendingData;if(!d)return M.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(P.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&d.push({type:t.type,data:e,parent:"audio",content:"data"})}),!u&&d.length&&(d.forEach(function(e){i.state===Te&&(i.pendingBuffering=!0,i.hls.trigger(P.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},t.onFragParsed=function(e){var t=this.fragCurrent,i=e.frag;t&&"audio"===e.id&&i.sn===t.sn&&i.level===t.level&&this.state===Te&&(this.stats.tparsed=lt.now(),this.state=Re,this._checkAppendedParsed())},t.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},t.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==Te&&t!==Re||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},t._checkAppendedParsed=function(){if(!(this.state!==Re||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,i=this.hls;if(e){this.fragPrevious=e,t.tbuffered=lt.now(),i.trigger(P.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&M.logger.log("audio buffered : "+le.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,i.trigger(P.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ye}this.tick()}},t.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:var i=e.frag;if(i&&"audio"!==i.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var n=this.config;if(r<=n.fragLoadingMaxRetry){this.fragLoadError=r;var a=Math.min(Math.pow(2,r-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);M.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=lt.now()+a,this.state=ke}else M.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=xe}break;case c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==xe&&(this.state=e.fatal?xe:ye,M.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case c.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===Te||this.state===Re)){var s=this.mediaBuffer,o=this.media.currentTime;if(s&&K.isBuffered(s,o)&&K.isBuffered(s,o+.5)){var l=this.config;l.maxMaxBufferLength>=l.maxBufferLength&&(l.maxMaxBufferLength/=2,M.logger.warn("AudioStreamController: reduce max buffer length to "+l.maxMaxBufferLength+"s")),this.state=ye}else M.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ae,this.hls.trigger(P.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},t.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(M.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach(function(e){t.hls.trigger(P.default.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=Re):(this.state=ye,this.fragPrevious=null,this.tick())},function(e,t,i){t&&st(e.prototype,t),i&&st(e,i)}(e,[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,M.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),e}(Le),ht=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var y={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function b(e){return"string"==typeof e&&(!!t[e.toLowerCase()]&&e.toLowerCase())}function S(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)e[r]=i[r]}return e}function e(e,t,i){var r=this,n={enumerable:!0};r.hasBeenReset=!1;var a="",s=!1,o=e,l=t,u=i,h=null,d="",c=!0,f="auto",p="start",v=50,m="middle",g=50,_="middle";Object.defineProperty(r,"id",S({},n,{get:function(){return a},set:function(e){a=""+e}})),Object.defineProperty(r,"pauseOnExit",S({},n,{get:function(){return s},set:function(e){s=!!e}})),Object.defineProperty(r,"startTime",S({},n,{get:function(){return o},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");o=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"endTime",S({},n,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"text",S({},n,{get:function(){return u},set:function(e){u=""+e,this.hasBeenReset=!0}})),Object.defineProperty(r,"region",S({},n,{get:function(){return h},set:function(e){h=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"vertical",S({},n,{get:function(){return d},set:function(e){var t=function(e){return"string"==typeof e&&(!!y[e.toLowerCase()]&&e.toLowerCase())}(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"snapToLines",S({},n,{get:function(){return c},set:function(e){c=!!e,this.hasBeenReset=!0}})),Object.defineProperty(r,"line",S({},n,{get:function(){return f},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"lineAlign",S({},n,{get:function(){return p},set:function(e){var t=b(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"position",S({},n,{get:function(){return v},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"positionAlign",S({},n,{get:function(){return m},set:function(e){var t=b(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"size",S({},n,{get:function(){return g},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"align",S({},n,{get:function(){return _},set:function(e){var t=b(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),r.displayState=void 0}return e.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},e}();function dt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new ot,this.regionList=[]}function ct(){this.values=Object.create(null)}function ft(e,t,i,r){var n=r?e.split(r):[e];for(var a in n)if("string"==typeof n[a]){var s=n[a].split(i);if(2===s.length)t(s[0],s[1])}}ct.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,i){for(var r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var pt=new ht(0,0,0),vt="middle"===pt.align?"middle":"center";function mt(t,e,s){var i=t;function r(){var e=function(e){function t(e,t,i,r){return 3600*(0|e)+60*(0|t)+(0|i)+(0|r)/1e3}var i=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return i?i[3]?t(i[1],i[2],i[3].replace(":",""),i[4]):59<i[1]?t(i[1],i[2],0,i[4]):t(0,i[1],i[2],i[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function n(){t=t.replace(/^\s+/,"")}if(n(),e.startTime=r(),n(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);t=t.substr(3),n(),e.endTime=r(),n(),function(e,t){var a=new ct;ft(e,function(e,t){switch(e){case"region":for(var i=s.length-1;0<=i;i--)if(s[i].id===t){a.set(e,s[i].region);break}break;case"vertical":a.alt(e,t,["rl","lr"]);break;case"line":var r=t.split(","),n=r[0];a.integer(e,n),a.percent(e,n)&&a.set("snapToLines",!1),a.alt(e,n,["auto"]),2===r.length&&a.alt("lineAlign",r[1],["start",vt,"end"]);break;case"position":r=t.split(","),a.percent(e,r[0]),2===r.length&&a.alt("positionAlign",r[1],["start",vt,"end","line-left","line-right","auto"]);break;case"size":a.percent(e,t);break;case"align":a.alt(e,t,["start",vt,"end","left","right"])}},/:/,/\s/),t.region=a.get("region",null),t.vertical=a.get("vertical","");var i=a.get("line","auto");"auto"===i&&-1===pt.line&&(i=-1),t.line=i,t.lineAlign=a.get("lineAlign","start"),t.snapToLines=a.get("snapToLines",!0),t.size=a.get("size",100),t.align=a.get("align",vt);var r=a.get("position","auto");"auto"===r&&50===pt.position&&(r="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=r}(t,e)}function gt(e){return e.replace(/<br(?: \/)?>/gi,"\n")}dt.prototype={parse:function(e){var r=this;function t(){var e=r.buffer,t=0;for(e=gt(e);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var i=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,r.buffer=e.substr(t),i}e&&(r.buffer+=r.decoder.decode(e,{stream:!0}));try{var i;if("INITIAL"===r.state){if(!/\r\n|\n/.test(r.buffer))return this;var n=(i=t()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var a=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(a?a=!1:i=t(),r.state){case"HEADER":/:/.test(i)?ft(i,function(e,t){},/:/):i||(r.state="ID");continue;case"NOTE":i||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){r.state="NOTE";break}if(!i)continue;if(r.cue=new ht(0,0,""),r.state="CUE",-1===i.indexOf("--\x3e")){r.cue.id=i;continue}case"CUE":try{mt(i,r.cue,r.regionList)}catch(e){r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var s=-1!==i.indexOf("--\x3e");if(!i||s&&(a=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}r.cue.text&&(r.cue.text+="\n"),r.cue.text+=i;continue;case"BADCUE":i||(r.state="ID");continue}}}catch(e){"CUETEXT"===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state="INITIAL"===r.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var _t=dt;function yt(e,t,i,r){for(var n,a,s,o,l,u=window.VTTCue||window.TextTrackCue,h=0;h<r.rows.length;h++)if(s=!0,o=0,l="",!(n=r.rows[h]).isEmpty()){for(var d=0;d<n.chars.length;d++)n.chars[d].uchar.match(/\s/)&&s?o++:(l+=n.chars[d].uchar,s=!1);(n.cueStartTime=t)===i&&(i+=1e-4),a=new u(t,i,gt(l.trim())),16<=o?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=h+1:a.line=7<h?h-2:h+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}function bt(e){var t=e;return wt.hasOwnProperty(e)&&(t=wt[e]),String.fromCharCode(t)}function St(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t}function Et(e,t,i){return e.substr(i||0,t.length)===t}function kt(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()}var wt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Tt={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Rt={17:2,18:4,21:6,22:8,23:10,19:13,20:15},At={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ct={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xt=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],It={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel}},Ot=function(){function e(e,t,i,r,n){this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=r||"black",this.flash=n||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),Lt=function(){function e(e,t,i,r,n,a){this.uchar=e||" ",this.penState=new Ot(t,i,r,n,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),Dt=function(){function e(){this.chars=[];for(var e=0;e<100;e++)this.chars.push(new Lt);this.pos=0,this.currPenState=new Ot}var t=e.prototype;return t.equals=function(e){for(var t=!0,i=0;i<100;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<100;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<100;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(It.log("ERROR","Negative cursor position "+this.pos),this.pos=0):100<this.pos&&(It.log("ERROR","Too large cursor position "+this.pos),this.pos=100)},t.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){144<=e&&this.backSpace();var t=bt(e);100<=this.pos?It.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<100;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,i=0;i<100;i++){var r=this.chars[i].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),Pt=function(){function e(){this.rows=[];for(var e=0;e<15;e++)this.rows.push(new Dt);this.currRow=14,this.nrRollUpRows=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,i=0;i<15;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){It.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){It.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<15;i++)this.rows[i].clear();var r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var a=n.rows[r].cueStartTime;if(a&&a<It.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(n.rows[r+s])}}this.currRow=t;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[u].penState.foreground}var h={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(h)},t.setBkgData=function(e){It.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){It.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),It.log("INFO","Rolling up")}else It.log("DEBUG","roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],i="",r=-1,n=0;n<15;n++){var a=this.rows[n].getTextString();a&&(r=n+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return 0<t.length&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i},t.getTextAndFormat=function(){return this.rows},e}(),Mt=function(){function e(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Pt,this.nonDisplayedMemory=new Pt,this.lastOutputScreen=new Pt,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,It.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";It.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(It.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){It.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){It.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){It.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){It.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){It.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){It.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){It.log("INFO","TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){It.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){It.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){It.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){It.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(It.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,It.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){It.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=46<=e,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}It.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=It.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),Ft=function(){function e(e,t,i){this.field=e||1,this.outputs=[t,i],this.channels=[new Mt(1,t),new Mt(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var i,r,n,a=!1;this.lastTime=e,It.setTime(e);for(var s=0;s<t.length;s+=2)if(r=127&t[s],n=127&t[s+1],0!=r||0!=n){if(It.log("DATA","["+St([t[s],t[s+1]])+"] -> ("+St([r,n])+")"),!(i=(i=(i=(i=this.parseCmd(r,n))||this.parseMidrow(r,n))||this.parsePAC(r,n))||this.parseBackgroundAttributes(r,n)))if(a=this.parseChars(r,n))if(this.currChNr&&0<=this.currChNr)this.channels[this.currChNr-1].insertChars(a);else It.log("WARNING","No channel found yet. TEXT-MODE?");i?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,It.log("WARNING","Couldn't parse cleaned data "+St([r,n])+" orig: "+St([t[s],t[s+1]])))}else this.dataCounters.padding+=2},t.parseCmd=function(e,t){var i=null;if(!((20===e||28===e)&&32<=t&&t<=47)&&!((23===e||31===e)&&33<=t&&t<=35))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,It.log("DEBUG","Repeated command ("+St([e,t])+") is dropped"),!0;i=20===e||23===e?1:2;var r=this.channels[i-1];return 20===e||28===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},t.parseMidrow=function(e,t){var i=null;return(17===e||25===e)&&32<=t&&t<=47&&((i=17===e?1:2)!==this.currChNr?(It.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].ccMIDROW(t),It.log("DEBUG","MIDROW ("+St([e,t])+")"),!0))},t.parsePAC=function(e,t){var i,r=null;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127)&&!((16===e||24===e)&&64<=t&&t<=95))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);i=e<=23?1:2,r=64<=t&&t<=95?1==i?Tt[e]:At[e]:1==i?Rt[e]:Ct[e];var n=this.interpretPAC(r,t);return this.channels[i-1].setPAC(n),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=i,!0},t.interpretPAC=function(e,t){var i=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return i=95<t?t-96:t-64,r.underline=1==(1&i),i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r},t.parseChars=function(e,t){var i=null,r=null,n=null;if(17<=(n=25<=e?(i=2,e-8):(i=1,e))&&n<=19){var a=t;a=17===n?t+80:18===n?t+112:t+144,It.log("INFO","Special char '"+bt(a)+"' in channel "+i),r=[a]}else 32<=e&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=St(r);It.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},t.parseBackgroundAttributes=function(e,t){var i,r,n;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(i={},16===e||24===e?(r=Math.floor((t-32)/2),i.background=xt[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0)),n=e<24?1:2,this.channels[n-1].setBkgData(i),this.lastCmdA=null,!(this.lastCmdB=null))},t.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}(),Bt=function(){function e(e,t){this.timelineController=e,this.trackName=t,this.startTime=null,this.endTime=null,this.screen=null}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},t.newCue=function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},e}(),Nt={parse:function(e,t,r,n,i,a){var s,o=Object(Ne.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",u=0,h=0,d=0,c=[],f=!0,p=!1,v=new _t;v.oncue=function(e){var t=r[n],i=r.ccOffset;t&&t.new&&(void 0!==h?i=r.ccOffset=t.start:function(e,t,i){var r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,r.new=!1;for(;n&&n.new;)e.ccOffset+=r.start-n.start,r.new=!1,n=e[(r=n).prevCC];e.presentationOffset=i}(r,n,d)),d&&(i=d-r.presentationOffset),p&&(e.startTime+=i-h,e.endTime+=i-h),e.id=kt(e.startTime.toString())+kt(e.endTime.toString())+kt(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&c.push(e)},v.onparsingerror=function(e){s=e},v.onflush=function(){s&&a?a(s):i(c)},o.forEach(function(e){if(f){if(Et(e,"X-TIMESTAMP-MAP=")){p=!(f=!1),e.substr(16).split(",").forEach(function(e){Et(e,"LOCAL:")?l=e.substr(6):Et(e,"MPEGTS:")&&(u=parseInt(e.substr(7)))});try{t+(9e4*r[n].start||0)<0&&(t+=8589934592),u-=t,h=function(e){var t=parseInt(e.substr(-3)),i=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),n=9<e.length?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(D.isFiniteNumber)(t)&&Object(D.isFiniteNumber)(i)&&Object(D.isFiniteNumber)(r)&&Object(D.isFiniteNumber)(n)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*i,t+=6e4*r,t+=36e5*n}(l)/1e3,d=u/9e4}catch(e){p=!1,s=e}return}""===e&&(f=!1)}v.parse(e+"\n")}),v.flush()}};function Ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var jt=function(n){function e(e){var t;if((t=n.call(this,e,P.default.MEDIA_ATTACHING,P.default.MEDIA_DETACHING,P.default.FRAG_PARSING_USERDATA,P.default.FRAG_DECRYPTED,P.default.MANIFEST_LOADING,P.default.MANIFEST_LOADED,P.default.FRAG_LOADED,P.default.LEVEL_SWITCHING,P.default.INIT_PTS_FOUND)||this).hls=e,t.config=e.config,t.enabled=!0,t.Cues=e.config.cueHandler,t.textTracks=[],t.tracks=[],t.unparsedVttFrags=[],t.initPTS=[],t.cueRanges=[],t.captionsTracks={},t.captionsProperties={textTrack1:{label:t.config.captionsTextTrack1Label,languageCode:t.config.captionsTextTrack1LanguageCode},textTrack2:{label:t.config.captionsTextTrack2Label,languageCode:t.config.captionsTextTrack2LanguageCode}},t.config.enableCEA708Captions){var i=new Bt(Ut(Ut(t)),"textTrack1"),r=new Bt(Ut(Ut(t)),"textTrack2");t.cea608Parser=new Ft(0,i,r)}return t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,n);var t=e.prototype;return t.addCues=function(e,t,i,r){for(var n,a,s,o,l=this.cueRanges,u=!1,h=l.length;h--;){var d=l[h],c=(n=d[0],a=d[1],s=t,o=i,Math.min(a,o)-Math.max(n,s));if(0<=c&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],i),u=!0,.5<c/(i-t)))return}u||l.push([t,i]),this.Cues.newCue(this.captionsTracks[e],t,i,r)},t.onInitPtsFound=function(e){var t=this;if("main"===e.id&&(this.initPTS[e.frag.cc]=e.initPTS),this.unparsedVttFrags.length){var i=this.unparsedVttFrags;this.unparsedVttFrags=[],i.forEach(function(e){t.onFragLoaded(e)})}},t.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var r=t.textTracks[i];if(r[e])return r}return null},t.createCaptionsTrack=function(e){var t=this.captionsProperties[e],i=t.label,r=t.languageCode,n=this.captionsTracks;if(!n[e]){var a=this.getExistingTrack(e);if(a)n[e]=a,je(n[e]),Ue(n[e],this.media);else{var s=this.createTextTrack("captions",i,r);s&&(s[e]=!0,n[e]=s)}}},t.createTextTrack=function(e,t,i){var r=this.media;if(r)return r.addTextTrack(e,t,i)},t.destroy=function(){u.prototype.destroy.call(this)},t.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},t.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){je(t[e]),delete t[e]})},t.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)je(t[i])}},t.onManifestLoaded=function(e){var o=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,t){var i,r,n;if(t<l.length){for(var a=null,s=0;s<l.length;s++)if(r=l[s],n=e,r&&r.label===n.name&&!r.textTrack1&&!r.textTrack2){a=l[s];break}a&&(i=a)}i=i||o.createTextTrack("subtitles",e.name,e.lang),e.default?i.mode=o.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",o.textTracks.push(i)})}},t.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},t.onFragLoaded=function(e){var t=e.frag,i=e.payload;if("main"===t.type){var r=t.sn;if(r!==this.lastSn+1){var n=this.cea608Parser;n&&n.reset()}this.lastSn=r}else if("subtitle"===t.type)if(i.byteLength){if(!Object(D.isFiniteNumber)(this.initPTS[t.cc]))return this.unparsedVttFrags.push(e),void(this.initPTS.length&&this.hls.trigger(P.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var a=t.decryptdata;null!=a&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(t,i)}else this.hls.trigger(P.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},t._parseVTTs=function(t,e){var i=this.vttCCs;i[t.cc]||(i[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var n=this.textTracks,a=this.hls;Nt.parse(e,this.initPTS[t.cc],i,t.cc,function(e){var r=n[t.level];"disabled"!==r.mode?(e.forEach(function(t){if(!r.cues.getCueById(t.id))try{r.addCue(t)}catch(e){var i=new window.TextTrackCue(t.startTime,t.endTime,t.text);i.id=t.id,r.addCue(i)}}),a.trigger(P.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})):a.trigger(P.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},function(e){M.logger.log("Failed to parse VTT cue: "+e),a.trigger(P.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},t.onFragDecrypted=function(e){var t=e.payload,i=e.frag;if("subtitle"===i.type){if(!Object(D.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(i,t)}},t.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var i=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,i)}},t.extractCea608Data=function(e){for(var t,i,r,n=31&e[0],a=2,s=[],o=0;o<n;o++)t=e[a++],i=127&e[a++],r=127&e[a++],0==i&&0==r||0!=(4&t)&&0==(3&t)&&(s.push(i),s.push(r));return s},e}(u);function zt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];"subtitles"===r.kind&&r.label&&t.push(e[i])}return t}var Vt=function(i){function e(e){var t;return(t=i.call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHING,P.default.MANIFEST_LOADED,P.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],t.trackId=-1,t.media=null,t.stopped=!0,t.subtitleDisplay=!0,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.destroy=function(){u.prototype.destroy.call(this)},t.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},t.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},t.onManifestLoaded=function(e){var t=this,i=e.subtitles||[];this.tracks=i,this.hls.trigger(P.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:i}),i.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.onSubtitleTrackLoaded=function(e){var t=this,i=e.id,r=e.details,n=this.trackId,a=this.tracks,s=a[n];if(i>=a.length||i!==n||!s||this.stopped)this._clearReloadTimer();else if(M.logger.log("subtitle track "+i+" loaded"),r.live){var o=oe(s.details,r,e.stats.trequest);M.logger.log("Reloading live subtitle playlist in "+o+"ms"),this.timer=setTimeout(function(){t._loadCurrentTrack()},o)}else this._clearReloadTimer()},t.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},t.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},t._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},t._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,i=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(M.logger.log("Loading subtitle track "+e),i.trigger(P.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))},t._toggleTrackModes=function(e){var t=this.media,i=this.subtitleDisplay,r=this.trackId;if(t){var n=Gt(t.textTracks);if(-1===e)[].slice.call(n).forEach(function(e){e.mode="disabled"});else{var a=n[r];a&&(a.mode="disabled")}var s=n[e];s&&(s.mode=i?"showing":"hidden")}},t._setSubtitleTrackInternal=function(e){var t=this.hls,i=this.tracks;!Object(D.isFiniteNumber)(e)||e<-1||e>=i.length||(this.trackId=e,M.logger.log("Switching to subtitle track "+e),t.trigger(P.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},t._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=Gt(this.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack=e}},function(e,t,i){t&&zt(e.prototype,t),i&&zt(e,i)}(e,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}]),e}(u),Ht=i("./src/crypt/decrypter.js");function Wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var Kt=window.performance,Yt=function(r){function e(e,t){var i;return(i=r.call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHING,P.default.ERROR,P.default.KEY_LOADED,P.default.FRAG_LOADED,P.default.SUBTITLE_TRACKS_UPDATED,P.default.SUBTITLE_TRACK_SWITCH,P.default.SUBTITLE_TRACK_LOADED,P.default.SUBTITLE_FRAG_PROCESSED,P.default.LEVEL_UPDATED)||this).fragmentTracker=t,i.config=e.config,i.state=ge,i.tracks=[],i.tracksBuffered=[],i.currentTrackId=-1,i.decrypter=new Ht.default(e,e.config),i.lastAVStart=0,i._onMediaSeeking=i.onMediaSeeking.bind(Wt(Wt(i))),i}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,r);var t=e.prototype;return t.onSubtitleFragProcessed=function(e){var t=e.frag,i=e.success;if(this.fragPrevious=t,this.state=ye,i){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var n,a=t.start,s=0;s<r.length;s++)if(a>=r[s].start&&a<=r[s].end){n=r[s];break}var o=t.start+t.duration;n?n.end=o:(n={start:a,end:o},r.push(n))}}},t.onMediaAttached=function(e){var t=e.media;(this.media=t).addEventListener("seeking",this._onMediaSeeking),this.state=ye},t.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=ge},t.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=ye)},t.onSubtitleTracksUpdated=function(e){var t=this;M.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach(function(e){t.tracksBuffered[e.id]=[]})},t.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},t.onSubtitleTrackLoaded=function(e){var t=e.id,i=e.details,r=this.currentTrackId,n=this.tracks,a=n[r];t>=n.length||t!==r||!a||(i.live&&function(e,t,i){void 0===i&&(i=0);var r=-1;se(e,t,function(e,t,i){t.start=e.start,r=i});var n=t.fragments;if(r<0)n.forEach(function(e){e.start+=i});else for(var a=r+1;a<n.length;a++)n[a].start=n[a-1].start+n[a-1].duration}(a.details,i,this.lastAVStart),a.details=i,this.setInterval(500))},t.onKeyLoaded=function(){this.state===Se&&(this.state=ye)},t.onFragLoaded=function(e){var t=this.fragCurrent,i=e.frag.decryptdata,r=e.frag,n=this.hls;if(this.state===Ee&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&0<e.payload.byteLength&&i&&i.key&&"AES-128"===i.method){var a=Kt.now();this.decrypter.decrypt(e.payload,i.key.buffer,i.iv.buffer,function(e){var t=Kt.now();n.trigger(P.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:a,tdecrypt:t}})})}},t.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},t.doTick=function(){if(this.media)switch(this.state){case ye:var e=this.config,t=this.currentTrackId,i=this.fragmentTracker,r=this.media,n=this.tracks;if(!n||!n[t]||!n[t].details)break;var a,s=e.maxBufferHole,o=e.maxFragLookUpTolerance,l=Math.min(e.maxBufferLength,e.maxMaxBufferLength),u=K.bufferedInfo(this._getBuffered(),r.currentTime,s),h=u.end,d=u.len,c=n[t].details,f=c.fragments,p=f.length,v=f[p-1].start+f[p-1].duration;if(l<d)return;var m=this.fragPrevious;(a=h<v?(m&&c.hasProgramDateTime&&(a=de(f,m.endProgramDateTime,o)),a||ce(m,f,h,o)):f[p-1])&&a.encrypted?(M.logger.log("Loading key for "+a.sn),this.state=Se,this.hls.trigger(P.default.KEY_LOADING,{frag:a})):a&&i.getState(a)===j&&(this.fragCurrent=a,this.state=Ee,this.hls.trigger(P.default.FRAG_LOADING,{frag:a}))}else this.state=ye},t.stopLoad=function(){this.lastAVStart=0,r.prototype.stopLoad.call(this)},t._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},t.onMediaSeeking=function(){this.fragPrevious=null},e}(Le);function qt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xt,Zt;(Zt=Xt=Xt||{}).WIDEVINE="com.widevine.alpha",Zt.PLAYREADY="com.microsoft.playready";var Jt=function(i){function e(e){var t;return(t=i.call(this,e,P.default.MEDIA_ATTACHED,P.default.MEDIA_DETACHED,P.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,t._licenseXhrSetup=void 0,t._emeEnabled=void 0,t._requestMediaKeySystemAccess=void 0,t._mediaKeysList=[],t._media=null,t._hasSetMediaKeys=!1,t._requestLicenseFailureCount=0,t._onMediaEncrypted=function(e){M.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),t._attemptSetMediaKeys(),t._generateRequestWithPreferredKeySession(e.initDataType,e.initData)},t._widevineLicenseUrl=e.config.widevineLicenseUrl,t._licenseXhrSetup=e.config.licenseXhrSetup,t._emeEnabled=e.config.emeEnabled,t._requestMediaKeySystemAccess=e.config.requestMediaKeySystemAccessFunc,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,i);var t=e.prototype;return t.getLicenseServerUrl=function(e){switch(e){case Xt.WIDEVINE:return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},t._attemptKeySystemAccess=function(t,e,i){var r=this,n=function(e,t,i){switch(e){case Xt.WIDEVINE:return function(e,t){var i={videoCapabilities:[]};return t.forEach(function(e){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"'})}),[i]}(0,i);default:throw new Error("Unknown key-system: "+e)}}(t,0,i);M.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(t,n).then(function(e){r._onMediaKeySystemAccessObtained(t,e)}).catch(function(e){M.logger.error('Failed to obtain key-system "'+t+'" access:',e)})},t._onMediaKeySystemAccessObtained=function(t,e){var i=this;M.logger.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r),e.createMediaKeys().then(function(e){r.mediaKeys=e,M.logger.log('Media-keys created for key-system "'+t+'"'),i._onMediaKeysCreated()}).catch(function(e){M.logger.error("Failed to create media-keys:",e)})},t._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},t._onNewMediaKeySession=function(t){var i=this;M.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(e){i._onKeySessionMessage(t,e.message)},!1)},t._onKeySessionMessage=function(t,e){M.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(e){M.logger.log("Received license data, updating key-session"),t.update(e)})},t._attemptSetMediaKeys=function(){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return M.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});M.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(e,t){var i=this,r=this._mediaKeysList[0];if(!r)return M.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)M.logger.warn("Key-Session already initialized but requested again");else{var n=r.mediaKeysSession;if(!n)return M.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});M.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,n.generateRequest(e,t).then(function(){M.logger.debug("Key-session generation succeeded")}).catch(function(e){M.logger.error("Error generating key-session request:",e),i.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},t._createLicenseXhr=function(t,e,i){var r=new XMLHttpRequest,n=this._licenseXhrSetup;try{if(n)try{n(r,t)}catch(e){r.open("POST",t,!0),n(r,t)}r.readyState||r.open("POST",t,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,i),r},t._onLicenseRequestReadyStageChange=function(e,t,i,r){switch(e.readyState){case 4:if(200===e.status)this._requestLicenseFailureCount=0,M.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&M.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(M.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount)return void this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var n=3-this._requestLicenseFailureCount+1;M.logger.warn("Retrying license request, "+n+" attempts left"),this._requestLicense(i,r)}}},t._generateLicenseRequestChallenge=function(e,t){switch(e.mediaKeySystemDomain){case Xt.WIDEVINE:return t}throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},t._requestLicense=function(e,t){M.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return M.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(r,e,t);M.logger.log("Sending license request to URL: "+r);var a=this._generateLicenseRequestChallenge(i,e);n.send(a)}catch(e){M.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(P.default.ERROR,{type:c.ErrorTypes.KEY_SYSTEM_ERROR,details:c.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;(this._media=t).addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){this._media&&(this._media.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null)},t.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map(function(e){return e.audioCodec}),i=e.levels.map(function(e){return e.videoCodec});this._attemptKeySystemAccess(Xt.WIDEVINE,t,i)}},function(e,t,i){t&&qt(e.prototype,t),i&&qt(e,i)}(e,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}(u);function Qt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var $t=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),r.forEach(function(e){Qt(t,e,i[e])})}return t}({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:rt,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Ye,bufferController:Xe,capLevelController:Je,fpsController:$e,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null},function(){0;return{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es"}}(),{subtitleStreamController:Yt,subtitleTrackController:Vt,timelineController:jt,audioStreamController:ut,audioTrackController:at,emeController:Jt});function ei(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ti(e,t,i){return t&&ei(e.prototype,t),i&&ei(e,i),e}function ii(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}i.d(t,"default",function(){return ri});var ri=function(b){function S(e){var t;void 0===e&&(e={}),t=b.call(this)||this;var i=S.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in i)r in e||(e[r]=i[r]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(M.enableLogs)(e.debug),t.config=e,t._autoLevelCapping=-1;var n=t.abrController=new e.abrController(ii(ii(t))),a=new e.bufferController(ii(ii(t))),s=t.capLevelController=new e.capLevelController(ii(ii(t))),o=new e.fpsController(ii(ii(t))),l=new R(ii(ii(t))),u=new N(ii(ii(t))),h=new U(ii(ii(t))),d=new ze(ii(ii(t))),c=t.levelController=new Be(ii(ii(t))),f=new H(ii(ii(t))),p=[c,t.streamController=new Pe(ii(ii(t)),f)],v=e.audioStreamController;v&&p.push(new v(ii(ii(t)),f)),t.networkControllers=p;var m=[l,u,h,n,a,s,o,d,f];if(v=e.audioTrackController){var g=new v(ii(ii(t)));t.audioTrackController=g,m.push(g)}if(v=e.subtitleTrackController){var _=new v(ii(ii(t)));t.subtitleTrackController=_,p.push(_)}if(v=e.emeController){var y=new v(ii(ii(t)));t.emeController=y,m.push(y)}return(v=e.subtitleStreamController)&&p.push(new v(ii(ii(t)),f)),(v=e.timelineController)&&m.push(new v(ii(ii(t)))),t.coreComponents=m,t}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(S,b),S.isSupported=function(){return function(){var e=Z(),t=SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!r}()},ti(S,null,[{key:"version",get:function(){}},{key:"Events",get:function(){return P.default}},{key:"ErrorTypes",get:function(){return c.ErrorTypes}},{key:"ErrorDetails",get:function(){return c.ErrorDetails}},{key:"DefaultConfig",get:function(){return S.defaultConfig?S.defaultConfig:$t},set:function(e){S.defaultConfig=e}}]);var e=S.prototype;return e.destroy=function(){M.logger.log("destroy"),this.trigger(P.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},e.attachMedia=function(e){M.logger.log("attachMedia"),this.media=e,this.trigger(P.default.MEDIA_ATTACHING,{media:e})},e.detachMedia=function(){M.logger.log("detachMedia"),this.trigger(P.default.MEDIA_DETACHING),this.media=null},e.loadSource=function(e){e=o.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),M.logger.log("loadSource:"+e),this.url=e,this.trigger(P.default.MANIFEST_LOADING,{url:e})},e.startLoad=function(t){void 0===t&&(t=-1),M.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},e.stopLoad=function(){M.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.swapAudioCodec=function(){M.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){M.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},ti(S,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){M.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){M.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){M.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){M.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){M.logger.log("set startLevel:"+e);-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){M.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,i=e?e.length:0,r=0;r<i;r++){if(t<(e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate))return r}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),S}(Q)},"./src/polyfills/number-isFinite.js":
/*!******************************************!*\
  !*** ./src/polyfills/number-isFinite.js ***!
  \******************************************/
/*! exports provided: isFiniteNumber */function(e,t,i){"use strict";i.r(t),i.d(t,"isFiniteNumber",function(){return r});var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/utils/get-self-scope.js":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
/*! exports provided: getSelfScope */function(e,t,i){"use strict";function r(){return"undefined"==typeof window?self:window}i.r(t),i.d(t,"getSelfScope",function(){return r})},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(e,t,i){"use strict";i.r(t),i.d(t,"enableLogs",function(){return u}),i.d(t,"logger",function(){return h});var r=i(/*! ./get-self-scope */"./src/utils/get-self-scope.js");function a(){}var n={trace:a,debug:a,log:a,warn:a,info:a,error:a},s=n;var o=Object(r.getSelfScope)();function l(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];i.forEach(function(e){s[e]=t[e]?t[e].bind(t):function(r){var n=o.console[r];return n?function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0]&&(t[0]=function(e,t){return t="["+e+"] > "+t}(r,t[0])),n.apply(o.console,t)}:a}(e)})}var u=function(e){if(o.console&&!0===e||"object"==typeof e){l(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=n}}else s=n},h=s}},n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.js")).default;function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,r},e.exports=r())},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s,c=i(387),p=i(329),v=i(330),o=i(388),l=(s=o)&&s.__esModule?s:{default:s};var u=(n(h,[{key:"_createToolbar",value:function(e,t){var i=p.Toolkit.deepMerge({},e);if(i.items){var r=document.createElement("div");r.className=t+" toolbar-panel toolbar-"+this.vOpt.uuid;var n=document.createElement("div");n.className="toolbar-panel-inner",r.appendChild(n),this.vOpt.videoC.appendChild(r),this.vOpt.toolbarEleArr.push({type:t,toolbarEle:r});var a=this;v.EventUtil.addHandler(r,"dblclick",function(e){e.stopPropagation()}),v.EventUtil.addHandler(r,"click",function(e){a.videoCMouseOverFlag=!1}),v.EventUtil.addHandler(r,"mousemove",function(e){!0!==a.isDragProgress&&e.stopPropagation(),a.isShowPtzRedArrow(!1,e)}),v.EventUtil.addHandler(r,"mouseenter",function(e){e.stopPropagation(),a.isShowPtzRedArrow(!1,e)}),v.EventUtil.addHandler(r,"mouseleave",function(e){e.stopPropagation()}),v.EventUtil.addHandler(r,"mousedown",function(e){e.stopPropagation(),a.isShowPtzRedArrow(!1,e)}),v.EventUtil.addHandler(r,"contextmenu",function(e){e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1});for(var s=i.items,o=s.length,l=0;l<o;l++)this._createToolbarItems(s[l],"panel",n)}else this._createToolbarItems(i,"single")}},{key:"_createToolbarItems",value:function(t,e,i){var r=this;if("self-defined"!==t.style)if("string"==typeof t){var n=p.Toolkit.deepMerge({},c.defaultToolbarConf[t]);"videoRatio"===t&&n.menuList.list.map(function(e){r._videoRatio===e.value?e.checked=!0:e.checked=!1}),this.defaultToolbarConf[t]=n,t=n}else if(t.id){if(c.defaultToolbarConf[t.id]){var a=p.Toolkit.deepMerge({},c.defaultToolbarConf[t.id]);t=p.Toolkit.deepMerge(a,t)}this.defaultToolbarConf[t.id]=t}var o=this,s=document.createElement("div"),l=void 0;switch(i?i.appendChild(s):(this.vOpt.videoC.appendChild(s),this.vOpt.toolbarEleArr.push({type:null,toolbarEle:s})),"progress"===t.style?s.className=t.className:t.className&&("button"===t.type?t.menuList?s.className="toolbar-item-btn":(s.className="toolbar-item "+t.style+" "+t.className+" item-button",t.text&&(s.innerText=t.text)):s.className="toolbar-item "+t.style+" "+t.className),t.show?s.style.display="inline-block":s.style.display="none",s.setAttribute("data-id",t.id),t.style&&"self-defined"!==t.style&&"progress"!==t.style&&(-1<t.style.indexOf("right")?l="right":-1<t.style.indexOf("left")&&(l="left"),s.style.float=l),t.type){case"static":if(!t.menuList){if(s.setAttribute("data-type",t.type),s.className=s.className+" item-"+t.type,this.setStaticContent(t.id,t.text),"videoTitle"===t.id){var u=this._videoTitle?this._videoTitle:"未知视频";this.setStaticContent(t.id,u)}return}this._createMenuList(s,t);break;case"button":if(!t.menuList)return t.tooltip&&s.setAttribute("title",t.tooltip),v.EventUtil.addHandler(s,"click",function(e){e.stopPropagation(),o._btnClickFunction(t,s)}),v.EventUtil.addHandler(s,"mousedown",function(e){e.stopPropagation()}),v.EventUtil.addHandler(s,"mouseup",function(e){}),v.EventUtil.addHandler(s,"dblclick",function(e){e.stopPropagation()}),void s.setAttribute("data-type",t.type);this._createMenuList(s,t);break;case"progress":s.setAttribute("data-type","static"),this._videoProressD=document.createElement("div"),this._videoProressD.className="video-progress-detail",s.appendChild(this._videoProressD),this._bufferedProress=document.createElement("div"),this._bufferedProress.className="video-progress-buffered",this._videoProressD.appendChild(this._bufferedProress),this._realProress=document.createElement("div"),this._realProress.className="video-progress-real",this._videoProressD.appendChild(this._realProress),this._circleRange=document.createElement("span"),this._circleRange.className="video-circle-range",s.appendChild(this._circleRange);var h=document.createElement("span");h.className="video-progress-tip",s.appendChild(h);var d=this._videoProressD;try{d=this._videoProressD.closest(".video-progress")}catch(e){d=this._videoProressD.parentNode}v.EventUtil.addHandler(d,"click",function(e){var t=e||window.event,i=o._videoProressD.offsetWidth,r=t.offsetX,n=void 0;e.stopPropagation(),(t.target.classList.contains("video-circle-range")||t.target.classList.contains("video-progress-tip"))&&(r=(n=(n=v.EventUtil.getEleToParentDistance(t.target,"video-progress").offsetLeft)<0?0:n)+r),o._videoplayer&&(o.currentT=r/i*o.durationT,o._videoplayer.currentTime=o.currentT-o._playtimeOffset),o.updatePorgress()}),v.EventUtil.addHandler(d,"mousemove",p.Toolkit.debounce(function(e){if(!(o.durationT<=0)&&isFinite(o.durationT)){var t=e||window.event,i=o._videoProressD.offsetWidth,r=t.offsetX,n=void 0;e.stopPropagation(),(t.target.classList.contains("video-circle-range")||t.target.classList.contains("video-progress-tip"))&&(r=(n=(n=v.EventUtil.getEleToParentDistance(t.target,"video-progress").offsetLeft)<0?0:n)+r);var a=(r=i<(r=r<0?0:r)?i:r)/i*o.durationT;o._srcStartPts&&o.vOpt.enableProgressShowPts?h.innerText=new Date(o._srcStartPts+1e3*a).format("yyyy-MM-dd hh:mm:ss"):h.innerText=o.formartTime(a),h.style.visibility="visible";var s=h.clientWidth;h.style.left=r-12+"px",h.style.left=r<s/2?0:i<r+s/2?i-s+"px":r-s/2+"px"}},0,!0)),v.EventUtil.addHandler(d,"mouseout",function(e){h.style.visibility="hidden",e.stopPropagation()}),v.EventUtil.addHandler(this._circleRange,"mousedown",function(e){o.isDragProgress=!0,o.showOrHideRightMenu(!1),v.EventUtil.addHandler(o.vOpt.videoC,"mousemove",function(e){if(o.isDragProgress){var t=e||window.event,i=t.offsetX,r=o._videoProressD.offsetWidth;"video"===t.target.nodeName.toLowerCase()||t.target.classList.contains("toolbar-panel")?i=(i-=10)<0?0:i:t.target.classList.contains("video-progress-detail")||t.target.classList.contains("toolbar-panel-inner")||t.target.classList.contains("video-progress-real")||(i=(i=v.EventUtil.getEleToParentDistance(t.target,"h5vp-video-container").offsetLeft-10+i)<0?0:i);var n=i/r*100;n=100<n?100:n,o.currentP=n,setTimeout(function(){o._realProress&&(o._realProress.style.width=n+"%"),o._circleRange&&(o._circleRange.style.left=n+"%")},0)}}),v.EventUtil.addHandler(document,"mouseup",function(e){e.stopPropagation(),o.isDragProgress&&(o.showOrHideBtn("videoPlay",!1),o.showOrHideBtn("videoPause",!0),o.updatePorgress(!0),o.isDragProgress=!1)})})}}},{key:"getPlayTime",value:function(){return this._videoplayer?this._videoplayer.currentTime+this._playtimeOffset:0}},{key:"setPlayTime",value:function(e){return!!this._videoplayer&&(this._videoplayer.currentTime=e-this._playtimeOffset,!0)}},{key:"getPlaySpeed",value:function(){return this._videoplayer?this._videoplayer.playbackRate:1}},{key:"setPlaySpeed",value:function(e){if(this._videoplayer&&"number"==typeof e){if(this._videoplayer.playbackRate=e,this.getToobarBtnById("curRate")){var t="";t=.5==e||.25==e||.125==e||.0625==e?"x1/"+1/e:-1!==e.toString().indexOf(".")?(t="x"+e).substr(0,t.indexOf(".")+3):"x"+e,this.setStaticContent("curRate",t)}return!0}return!1}},{key:"_getOriginVideoSize",value:function(){var e=this.vOpt.videoC,t=e.clientWidth,i=e.clientHeight,r={left:0,top:0,width:t,height:i};return 0<this._videoWidth&&0<this._videoHeight&&(this._videoWidth/t<=this._videoHeight/i?(r.height=i,r.width=Math.round(this._videoWidth/this._videoHeight*i),r.top=0,r.left=Math.round((t-r.width)/2)):(r.width=t,r.height=Math.round(this._videoHeight/this._videoWidth*t),r.left=0,r.top=Math.round((i-r.height)/2))),r}},{key:"setRatio",value:function(e){if("origin"!==e&&"stretch"!==e&&"4:3"!==e&&"16:9"!==e&&"16:10"!==e)return!1;var t={};switch(this._videoRatio=e){case"origin":this.vOpt.videoEle.style.objectFit="contain",this.vOpt.videoC.style.padding=0;var i=this._getOriginVideoSize();t=this.setZoomSVGPosition(i),this.setVMCanvasPosition(t),this.setRTSVGPosition(t);break;case"stretch":this.vOpt.videoEle.style.objectFit="fill",this.vOpt.videoC.style.padding=0,t=this.setZoomSVGPosition({left:0,top:0,width:parseInt(this.vOpt.videoC.clientWidth),height:parseInt(this.vOpt.videoC.clientHeight)}),this.setVMCanvasPosition(t),this.setRTSVGPosition(t);break;case"4:3":this._ratioAdjust(.75);break;case"16:9":this._ratioAdjust(9/16);break;case"16:10":this._ratioAdjust(.625)}if(this.getToobarBtnById("videoRatio")){var r=this.getToobarItemStatusById("videoRatio"),n=r&&r.menuList&&r.menuList.list?r.menuList.list:[],a=[];if(r.isExecuteDefaultFunc){for(var s=0;s<n.length;s++)e==n[s].value?a.push({id:n[s].id,checked:!0}):a.push({id:n[s].id,checked:!1});this.setToolbarMenuById("videoRatio",a)}}return!0}},{key:"getRatioCode",value:function(){return this._videoRatio?this._videoRatio:this.vOpt.ratio}},{key:"_ratioAdjust",value:function(e){var t=this.vOpt.videoC.style.width,i=this.vOpt.videoC.style.height,r=parseInt(i)/parseInt(t);if(r!==e){this.vOpt.videoEle.style.objectFit="fill";var n=0,a={};0<r-e?(n=(parseInt(i)-parseInt(t)*e)/2,this.vOpt.videoC.style.paddingTop=n+"px",this.vOpt.videoC.style.paddingLeft=0,this.vOpt.videoC.style.paddingRight=0,this.vOpt.videoC.style.paddingBottom=n+"px",a=this.setZoomSVGPosition({left:0,top:n,width:parseInt(this.vOpt.videoC.clientWidth),height:parseInt(this.vOpt.videoC.clientHeight)-n-n}),this.setVMCanvasPosition(a),this.setRTSVGPosition(a)):r-e<0&&(n=(parseInt(t)-parseInt(i)/e)/2,this.vOpt.videoC.style.paddingTop=0,this.vOpt.videoC.style.paddingLeft=n+"px",this.vOpt.videoC.style.paddingRight=n+"px",this.vOpt.videoC.style.paddingBottom=0,a=this.setZoomSVGPosition({left:n,top:0,width:parseInt(this.vOpt.videoC.clientWidth)-n-n,height:parseInt(this.vOpt.videoC.clientHeight)}),this.setVMCanvasPosition(a),this.setRTSVGPosition(a))}}},{key:"_createMenuList",value:function(e,d){e.setAttribute("data-type",d.type+"-menu"),d.tooltip&&e.setAttribute("title",d.tooltip);var t=document.createDocumentFragment(),i=void 0;if("static"===d.type)e.className="static-menu-box item-"+d.type,(i=document.createElement("span")).className="static-menu-text",e.appendChild(i);else{var r=document.createElement("i");r.className=d.className+" item-button-icon",e.appendChild(r)}var c=document.createElement("ul");c.className="video-menu-list-box "+d.style,e.appendChild(c);for(var n=0;n<d.menuList.list.length;n++){var a=document.createElement("li"),s=d.menuList.list[n];s.checked?a.className="video-menu-list-li active":(s.checked=!1,a.className="video-menu-list-li"),s.gray?a.className="video-menu-list-li not-allowed":s.gray=!1,i&&s.checked&&(i.innerText=s.text,i.title=s.text),a.setAttribute("data-value",s.value),a.setAttribute("data-text",s.text),a.setAttribute("data-id",s.id);var o=document.createElement("div");o.className="toolbar-menu-icon-box",a.appendChild(o);var l=document.createElement("span");l.className="checked-icon",o.appendChild(l);var u=document.createElement("div");u.className="menu-text-text",a.appendChild(u),u.innerText=s.text,t.appendChild(a)}c.appendChild(t);var f=this;v.EventUtil.addHandler(e,"mouseenter",function(e){c.style.display="block",c.style.left=f._getVidoContainerEventInfo(e).x+"px"}),v.EventUtil.addHandler(e,"mouseleave",function(e){c.style.display="none"}),v.EventUtil.addHandler(c,"click",function(e){e.stopPropagation();var t=e||window.event;if(!(-1<t.target.className.indexOf("active"))){var i=p.Toolkit.findNearAncestor(t.target,"video-menu-list-li");if(i){for(var r=i.parentNode.children,n=r.length,a=[],s=0;s<n;s++){var o=r[s].getAttribute("data-value"),l=r[s].getAttribute("data-text"),u=r[s].getAttribute("data-id");if(i==r[s]){var h=d.menuList.list[s].checked;d.isOnlyOneChecked&&(d.isExecuteDefaultFunc&&("videoRateChange"===d.id&&f.setPlaySpeed(o),"videoRatio"===d.id&&f.setRatio(o)),f.setStaticContent(d.id,l)),d.menuList.list[s].function&&d.menuList.list[s].function({index:f.vOpt.index,item:d,clickedItem:d.menuList.list[s]}),a.push({id:u,checked:!(h&&!d.menuList.list[s].checked)})}else d.isOnlyOneChecked&&a.push({id:u,checked:!1})}f.setToolbarMenuById(d.id,a),c.style.display="none"}}})}},{key:"checkZoomBtnStatus",value:function(){var e=this.getZoomStatus(),t=this.getToobarBtnById("videoZoom");t&&("init"==e||"end"==e?(t.classList.remove("video-inzoom"),t.classList.add("video-zoom")):(t.classList.remove("video-zoom"),t.classList.add("video-inzoom")))}},{key:"_btnClickFunction",value:function(e,t){if(!e.gray)if(e.id){switch(e.id){case"videoClose":e.isExecuteDefaultFunc&&this._videoCloseFunc();break;case"videoPrintScreen":case"videoRatio":break;case"videoZoom":if(e.isExecuteDefaultFunc){var i=this.getZoomStatus(),r=this.getToobarBtnById("videoZoom");"init"==i||"end"==i?(this.startZoom(),r.classList.remove("video-zoom"),r.classList.add("video-inzoom")):(this.stopZoom(),r.classList.remove("video-inzoom"),r.classList.add("video-zoom"))}break;case"videoPause":e.isExecuteDefaultFunc&&(this.pause(),this.showOrHideBtn("videoPause",!1),this.showOrHideBtn("videoPlay",!0));break;case"videoPlay":e.isExecuteDefaultFunc&&(this.play(),this.showOrHideBtn("videoPlay",!1),this.showOrHideBtn("videoPause",!0));break;case"slowPlay":if(e.isExecuteDefaultFunc){for(var n=this._videoplayer.playbackRate,a=[16,8,4,2,1,.5,.25,.125,.0625],s=void 0,o=a.length-1;0<=o;o--)if(n<=a[o]){s=a[o+1];break}s="number"==typeof s?s:.0625,this.setPlaySpeed(s)}break;case"fastPlay":if(e.isExecuteDefaultFunc){for(var l=this._videoplayer.playbackRate,u=[16,8,4,2,1,.5,.25,.125,.0625],h=void 0,d=0,c=u.length;d<c;d++)if(u[d]<=l){h=u[d-1];break}h="number"==typeof h?h:16,this.setPlaySpeed(h)}break;case"stepPlay":e.isExecuteDefaultFunc&&(this.showOrHideBtn("videoPause",!1),this.showOrHideBtn("videoPlay",!0),this.singleFramePlay());break;case"videoRealNormal":case"videoRealHover":var f=this.getToobarBtnById("videoRealNormal")||this.getToobarBtnById("videoRealHover"),p=this.getToobarBtnById("videoHisNormal")||this.getToobarBtnById("videoHisHover");f.classList.contains("video-real-normal")&&(f.classList.remove("video-real-normal"),f.classList.add("video-real-hover"),p.classList.remove("video-history-hover"),p.classList.add("video-history-normal"));break;case"videoHisNormal":case"videoHisHover":var v=this.getToobarBtnById("videoRealNormal")||this.getToobarBtnById("videoRealHover"),m=this.getToobarBtnById("videoHisNormal")||this.getToobarBtnById("videoHisHover");m.classList.contains("video-history-normal")&&(m.classList.remove("video-history-normal"),m.classList.add("video-history-hover"),v.classList.remove("video-real-hover"),v.classList.add("video-real-normal"));break;default:e.hasOwnProperty("_rightmenu")&&!e.menuList&&this.rightMenuEle&&(this.rightMenuEle.style.display="none")}e.function&&e.function({index:this.vOpt.index,item:e,ele:t})}else e.function&&e.function({index:this.vOpt.index,item:e,ele:t})}},{key:"_showError",value:function(e,t,i){this._showOrHideLoading(!1),this._setBgImg(!0),this.isVideoPtz=!1,this._changeVideoCursor(),this.ptzDirection=-1,this.mousewheelTimer&&(clearTimeout(this.mousewheelTimer),this.mousewheelTimer=null);var r="";"StreamError"==e?r=l.default[""+(i.error?i.error:i.code)]:"MediaError"==e?r="MediaVideoError"==t?1==i.code?"取回过程被用户中止":2==i.code?"下载发生错误":3==i.code?"解码发生错误":4==i.code?"不支持的视音频":"播放标签其他异常":"MediaMSEError"==t?"源扩展发生错误":"解封装发生错误":"NetworkError"==e&&(r="Exception"==t?"网络异常":(t="Unsupport")?"网络协议不支持":"HTTP状态错误"),r&&""!=r||(r=e),this.addWaterMark({id:"_showError_",text:r,color:"rgba(255,255,255,.7)",fontSize:"17px",top:"50%",marginTop:"60px",opacity:this.vOpt.showerror&&this.vOpt.showerrorDetail?1:0})}},{key:"_showErrorOpacity",value:function(){this.changeWaterMarkById("_showError_",{opacity:this.vOpt.showerror&&this.vOpt.showerrorDetail?1:0})}},{key:"_videoCloseFunc",value:function(){this.delAllWaterMark(),this.stopDrawing(!0),this.stopVideo(),this.removeToolbar(),this.removeRightMenu()}},{key:"showOrHideBtn",value:function(e,t){var i=this.getToobarBtnById(e);i&&(i.style.display=t?"inline-block":"none"),this.setToobarItemStatusById(e,{show:t})}},{key:"_deepTraversal",value:function(e,t){if(e)for(var i=e.children,r=0,n=i.length;r<n;r++)i[r].getAttribute("data-id")===t?this.curOperateNode=i[r]:this._deepTraversal(i[r],t)}},{key:"getToobarBtnById",value:function(e){this.curOperateNode=null;for(var t=0,i=this.vOpt.toolbarEleArr.length;t<i;t++){var r=this.vOpt.toolbarEleArr[t].toolbarEle;this._deepTraversal(r,e)}return this.curOperateNode}},{key:"setToobarItemStatusById",value:function(e,t){if(!e||e&&"string"!=typeof e||!t||t&&"object"!=(void 0===t?"undefined":r(t)))return null;e&&this.defaultToolbarConf[e]&&(this.defaultToolbarConf[e]=p.Toolkit.deepMerge(this.defaultToolbarConf[e],t))}},{key:"setToolbarItemAttrsById",value:function(e,t){if(!e||e&&"string"!=typeof e||!t||t&&"object"!=(void 0===t?"undefined":r(t)))return null;e&&this.defaultToolbarConf[e]&&(this.defaultToolbarConf[e]=p.Toolkit.deepMerge(this.defaultToolbarConf[e],t));var i=this.getToobarBtnById(e);i&&(t.hasOwnProperty("checked")&&(t.checked?this._setToolbarCheckedStyle(i):this._setToolbarNotCheckedStyle(i)),t.hasOwnProperty("gray")&&(t.gray?this._setToolbarGrayStyle(i):this._setToolbarNotGrayStyle(i)),t.hasOwnProperty("text")&&(this.setToolbarItemText(e,t.text),i.children[1]&&(i.children[1].innerHTML=t.text)))}},{key:"_setToolbarCheckedStyle",value:function(e){e.classList.add("active"),e.classList.remove("not-allowed")}},{key:"_setToolbarNotCheckedStyle",value:function(e){e.classList.remove("active")}},{key:"setToolbarItemChecked",value:function(e,t){if(!e||e&&"string"!=typeof e||!0!==t&&!1!==t)return null;this.defaultToolbarConf[e]&&(this.defaultToolbarConf[e]=p.Toolkit.deepMerge(this.defaultToolbarConf[e],{checked:t}));var i=this.getToobarBtnById(e);t?this._setToolbarCheckedStyle(i):this._setToolbarNotCheckedStyle(i)}},{key:"_setToolbarGrayStyle",value:function(e){e.classList.add("not-allowed"),e.classList.remove("active")}},{key:"_setToolbarNotGrayStyle",value:function(e){e.classList.remove("not-allowed")}},{key:"setToolbarItemGray",value:function(e,t){if(!e||e&&"string"!=typeof e||!0!==t&&!1!==t)return null;this.defaultToolbarConf[e]&&(this.defaultToolbarConf[e]=p.Toolkit.deepMerge(this.defaultToolbarConf[e],{gray:t}));var i=this.getToobarBtnById(e);t?this._setToolbarGrayStyle(i):this._setToolbarNotGrayStyle(i)}},{key:"setToolbarItemText",value:function(e,t){if(!e||e&&"string"!=typeof e||t&&"string"!=typeof t)return null;this.defaultToolbarConf[e]&&(this.defaultToolbarConf[e]=p.Toolkit.deepMerge(this.defaultToolbarConf[e],{text:t}));var i=this.getToobarBtnById(e);i&&i.children[1]&&(i.children[1].innerHTML=t)}},{key:"getToobarItemStatusById",value:function(e){return e&&this.defaultToolbarConf[e]?this.defaultToolbarConf[e]:null}},{key:"setToolbarMenuById",value:function(e,t){if(e&&t&&(!t||0!==t.length)){var i=this.defaultToolbarConf[e],r=this.getToobarBtnById(e).lastChild.children;if(i&&i.menuList&&i.menuList.list&&0<i.menuList.list.length)for(var n=i.menuList.list,a=0,s=t.length;a<s;a++)for(var o=0,l=n.length;o<l;o++){var u=r[o];if(t[a].id==n[o].id){p.Toolkit.deepMerge(n[o],t[a]),n[o]&&n[o].checked?(u.classList.add("active"),u.classList.remove("not-allowed")):u.classList.remove("active"),n[o]&&n[o].gray?(u.classList.add("not-allowed"),u.classList.remove("active")):u.classList.remove("not-allowed");break}}}}},{key:"showToolbarAuto",value:function(e){e?this.vOpt.videoC.classList.add("hoverClass"):this.vOpt.videoC.classList.remove("hoverClass")}},{key:"showOrHideToolbar",value:function(e,t){if(t){var i=this.getToobarBtnById(t);i&&(i.style.display=e?"block":"none"),this.setToobarItemStatusById(t,{show:e})}else{var r="";void 0===e||(r=e?1:0);for(var n=0,a=this.vOpt.toolbarEleArr.length;n<a;n++)this.vOpt.toolbarEleArr[n].toolbarEle.style.opacity=r}}},{key:"createToolbar",value:function(e){for(var t in e)this._createToolbar(e[t],t)}},{key:"removeToolbar",value:function(e){if(!e){for(var t=0,i=this.vOpt.toolbarEleArr.length;t<i;t++){var r=this.vOpt.toolbarEleArr[t].toolbarEle;r&&r.parentNode&&r.parentNode.removeChild(r)}return this.defaultToolbarConf={},this._bufferedProress&&(this._bufferedProress=null),this._circleRange&&(this._circleRange=null),this._realProress&&(this._realProress=null),this._videoProressD&&(this._videoProressD=null),this.vOpt.toolbarEleArr=[],void(this._videoTitle="")}var n=this.getToobarBtnById(e);n&&n.parentNode&&n.parentNode.removeChild(n),this.defaultToolbarConf[e]&&delete this.defaultToolbarConf[e]}},{key:"setStaticContent",value:function(e,t){if(e&&t){var i=this.getToobarBtnById(e);if(i&&"static"===i.getAttribute("data-type")&&(i.innerText=t,i.setAttribute("title",t),this.setToobarItemStatusById(e,{text:t,tooltip:t})),i&&"static-menu"===i.getAttribute("data-type")){var r=i.firstChild;r.innerText=t,r.setAttribute("title",t),this.setToobarItemStatusById(e,{text:t,tooltip:t})}}}},{key:"getStaticContent",value:function(e){if(e){var t=this.getToobarBtnById(e);return t&&"static"===t.getAttribute("data-type")?t.innerText:void 0}}},{key:"updatePorgress",value:function(e){if(e){var t=this.currentP/100*this.durationT;this._videoplayer&&(this._videoplayer.currentTime=t-this._playtimeOffset,this._updateCurrentTText())}else this.currentP=Number(this.currentT/this.durationT*100),this.currentP=100<this.currentP?100:this.currentP,this._realProress&&(this._realProress.style.width=this.currentP+"%"),this._circleRange&&(this._circleRange.style.left=this.currentP+"%"),this._updateCurrentTText()}},{key:"_updateDateRate",value:function(){var e="--";this._dataRate&&!isNaN(this._dataRate)&&0<this._dataRate&&(e=Math.floor(this._dataRate)+"KB"),this.setStaticContent("videoRate",e);var t=this._fps?this._fps+"FPS":"--";this.setStaticContent("videoFps",t)}},{key:"_updateCurrentTText",value:function(){var e=0<this.durationT&&isFinite(this.durationT)?this.formartTime(this.durationT):"--",t="";t=0<this.currentT?this.formartTime(this.currentT)+"/"+e:"--/"+e,this.setStaticContent("videoTime",t)}}]),h);function h(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.defaultToolbarConf={}}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={videoClose:{id:"videoClose",text:"关闭当前流",gray:!1,checked:!1,isExecuteDefaultFunc:!0},lineSplit:{type:1,name:"lineSplit"},videoRatio:{id:"videoRatio",text:"设置画面比例",gray:!1,checked:!1,menuList:[{id:"orignRatio",text:"原始",value:"origin",gray:!1,originId:"videoRatio",checked:!0,function:function(e){console.log(e.item.value)}},{id:"stretchRatio",text:"拉伸",value:"stretch",gray:!1,originId:"videoRatio",checked:!1,function:function(e){console.log(e.item.value)}},{id:"4R3Ratio",text:"4:3",value:"4:3",gray:!1,originId:"videoRatio",checked:!1,function:function(e){console.log(e.item.value)}},{id:"16R9Ratio",text:"16:9",value:"16:9",gray:!1,checked:!1,originId:"videoRatio",function:function(e){console.log(e.item.value)}},{id:"16R10Ratio",text:"16:10",value:"16:10",gray:!1,originId:"videoRatio",checked:!1,function:function(e){console.log(e.item.value)}}]}};t.defaultToolbarConf={videoTitle:{id:"videoTitle",className:"video-title",style:"left-top",type:"static",show:!0,text:"无视频",tooltip:"无视频"},videoRate:{id:"videoRate",className:"video-rate",style:"left-top",type:"static",show:!0,text:"--",tooltip:"--"},videoFps:{id:"videoFps",className:"video-rate",style:"left-top",type:"static",show:!0,text:"--",tooltip:"--"},videoClose:{id:"videoClose",isExecuteDefaultFunc:!0,className:"video-close",type:"button",style:"right-top",show:!0,tooltip:"关闭"},videoPrintScreen:{id:"videoPrintScreen",isExecuteDefaultFunc:!0,className:"video-printscreen",type:"button",style:"right-top",show:!0,tooltip:"抓图"},videoRatio:{id:"videoRatio",className:"video-ratio",type:"button",style:"right-top",show:!0,tooltip:"画面比例",isExecuteDefaultFunc:!0,isOnlyOneChecked:!0,menuList:{list:[{id:"orignRatio",text:"原始",value:"origin",gray:!1,checked:!0},{id:"stretchRatio",text:"拉伸",value:"stretch",gray:!1,checked:!1},{id:"4R3Ratio",text:"4:3",value:"4:3",gray:!1,checked:!1},{id:"16R9Ratio",text:"16:9",value:"16:9",gray:!1,checked:!1},{id:"16R10Ratio",text:"16:10",value:"16:10",gray:!1,checked:!1}]}},videoZoom:{id:"videoZoom",isExecuteDefaultFunc:!0,className:"video-zoom",type:"button",style:"right-buttom",show:!0,tooltip:"数字放大"},videoRealHover:{id:"videoRealHover",className:"video-real-hover",type:"button",style:"left-bottom",show:!0,text:"实时",tooltip:"实时"},videoRealNormal:{id:"videoRealNormal",className:"video-real-normal",type:"button",style:"left-bottom",show:!0,text:"实时",tooltip:"实时"},videoHisNormal:{id:"videoHisNormal",className:"video-history-normal",type:"button",style:"left-bottom",show:!0,text:"历史",tooltip:"历史"},videoHisHover:{id:"videoHisHover",className:"video-history-hover",type:"button",style:"left-bottom",show:!0,text:"历史",tooltip:"历史"},videoPause:{id:"videoPause",isExecuteDefaultFunc:!0,className:"video-pause",type:"button",style:"left-bottom",show:!0,tooltip:"暂停"},videoPlay:{id:"videoPlay",isExecuteDefaultFunc:!0,className:"video-play",type:"button",style:"left-bottom",show:!1,tooltip:"播放"},slowPlay:{id:"slowPlay",isExecuteDefaultFunc:!0,className:"slow-play",type:"button",style:"left-bottom",show:!0,tooltip:"慢放"},stepPlay:{id:"stepPlay",isExecuteDefaultFunc:!0,className:"step-play",type:"button",style:"left-bottom",show:!0,tooltip:"单帧播放"},fastPlay:{id:"fastPlay",isExecuteDefaultFunc:!0,className:"fast-play",type:"button",style:"left-bottom",show:!0,tooltip:"快放"},curRate:{id:"curRate",className:"cur-rate",style:"left-bottom",type:"static",show:!0,text:"x1"},videoRateChange:{id:"videoRateChange",type:"static",style:"left-bottom",show:!0,text:"",isExecuteDefaultFunc:!0,isOnlyOneChecked:!0,menuList:{list:[{id:"16Rate",text:"x16",value:16,gray:!1,checked:!1},{id:"8Rate",text:"x8",value:8,gray:!1,checked:!1},{id:"4Rate",text:"x4",value:4,gray:!1,checked:!1},{id:"2Rate",text:"x2",value:2,gray:!1,checked:!1},{id:"1Rate",text:"x1",value:1,gray:!1,checked:!0},{id:"0.5Rate",text:"x1/2",value:.5,gray:!1,checked:!1},{id:"0.25Rate",text:"x1/4",value:.25,gray:!1,checked:!1},{id:"0.125Rate",text:"x1/8",value:.125,gray:!1,checked:!1},{id:"0.0625Rate",text:"x1/16",value:.0625,gray:!1,checked:!1}]}},videoProgress:{id:"videoProgress",className:"video-progress",type:"progress",key:1,show:!0},videoTime:{id:"videoTime",className:"video-time",style:"right-bottom",type:"static",key:1,show:!0,text:"--/--",tooltip:"--/--"}},t.defaultRightMenuConf=r},function(e,t,i){"use strict";e.exports={1:"操作成功并重起",2:"夹带数据",3:"操作成功但需要重起",4:"该指令需被重定向到其它服务器执行",5:"传输地址被自动协商和补齐",11:"请求类型与本驱动/过滤器不匹配，请尝试其它驱动/过滤器",12:"操作成功但没有连接",13:"操作成功，作为一个false结果",101:"成功新建db","-1":"未分类错误","-2":"avport错误","-3":"服务器配置信息被破坏","-4":"服务器必须重新启动","-5":"字符串的长度超出预设长度","-6":"指令已经过时","-7":"指令没有实现","-8":"运行时异常","-9":"驱动程序内部故障","-10":"内部程序逻辑错误","-11":"对象不支持的POSA接口","-12":"创建线程失败","-13":"空函数，不应该调用到此处","-14":"缺少或没有配置驱动(POSA对象构造器)","-15":"该功能限制使用","-16":"指令用法错误，程序逻辑错误","-17":"输出参数缓冲区太小","-18":"路由连接失败，找不到匹配网关主机模式集","-19":"试图注销尚未注册的POSA对象构造器","-20":"重复注册已经注册的POSA对象构造器","-21":"设置系统时间失败","-22":"设置服务器ip失败","-23":"取得服务器ip失败","-24":"更新系统文件失败","-25":"接收夹带数据失败","-26":"没有足够的内存","-27":"错误的组播地址数量","-28":"服务端检测到无法解析的请求","-29":"IO操作超时","-30":"IO操作被取消","-31":"连接正在进行中","-32":"未被挂装的Host","-33":"被固定挂装的Host","-34":"系统退出中，请求无法完成","-35":"外部程序逻辑错误","-41":"读取avsetting配置信息错误","-42":"写avsetting配置信息错误","-43":"没有找到要保存的类型","-45":"av名字错误","-46":"坐标不正确","-47":"宽度或是高度不正确","-48":"设置叠加位图不正确","-49":"获得动态感知错误","-50":"功能限制","-51":"设置编码参数失败","-52":"矩阵端口参数越界","-53":"视频尺寸参数错误","-54":"视频制式参数错误","-55":"视频编码器av口参数越界","-56":"视频编码器未知错误","-57":"视频解码器未知错误","-81":"列出用户信息失败","-82":"加入用户失败","-83":"删除用户失败","-84":"没有此用户","-85":"保存用户失败","-86":"用户数超出限制","-87":"没有请求的功能","-88":"没有权限访问","-89":"用户名或密码不正确","-90":"用户级别太低","-91":"已经有用户登录","-92":"本用户已经登录","-93":"不正确的对象名字","-94":"DDB存取出错","-95":"Ticket无效","-96":"登录失败","-97":"TCP Session连接数限制","-101":"设置的长度不能小于0","-102":"打开目录失败","-103":"删除文件失败","-104":"设置文件生存期错误","-105":"错误的时间格式","-106":"smf文件已经开始存储数据，请在存储数据前添加所有的流信息","-107":"被保护的文件无法删除，请取消保护后再删除","-110":"参数重复设置","-111":"参数不存在","-112":"磁盘空间不足","-141":"串口的端口号错误","-142":"打开串口失败","-143":"保存串口配置失败","-144":"读串口配置失败","-145":"setpioHelper错误","-146":"摄像头已经被锁定","-147":"摄像头不能被控制","-148":"访问受限","-149":"设备PTZControl失败","-150":"不支持的设备型号","-151":"向串口发送数据失败","-152":"获取PTZ操作信息失败","-153":"获取PTZ控制信息失败","-161":"磁盘号错误","-162":"磁盘格式化错误","-163":"错误的分区号","-164":"格式化磁盘分区错误","-166":"正在录像的文件不能删除","-167":"错误的文件名","-168":"没有找到满足条件的文件","-169":"错误的文件类型","-170":"缺少标题，不能录像","-171":"没有找到自动录像指令","-172":"设置自动录像失败","-173":"清除自动录像失败","-174":"分配地址失败","-175":"设置视频输出制式错误","-176":"设置视频输入制式错误","-177":"初始化MP4编码器错误","-178":"初始化MP4解码器错误","-179":"设定视频输入颜色","-180":"视频采集驱动初始化错误","-181":"视频显示驱动初始化错误","-182":"管理的objs超过系统范围","-183":"本sobj所拥有的targets超过限制","-184":"增加一个sobj错误","-185":"增加一个tboj错误","-186":"打开文件失败","-187":"没有找到指定的目标","-188":"处于disable状态","-189":"avsobj没有初始化","-190":"avtobj没有初始化","-191":"不能启动大图模式","-192":"在大图模式无法完成此操作","-193":"音频输入驱动初始化错误","-194":"音频输出驱动初始化错误","-195":"源重复打开","-196":"目标重复打开","-197":"MP3编码器初始化失败","-198":"MP3解码器初始化失败","-199":"错误的目标通道名","-200":"文件数目太多","-201":"错误的target数量(只支持一个target)","-202":"传输不存在或用户没有发起该target","-203":"错误的指令","-204":"错误的事件类型","-205":"错误的音频编码码率","-206":"串口处于disable状态","-207":"设置自动录像的条件重复","-208":"目标流不存在","-209":"节点处于断线状态","-210":"CarryId重复","-211":"CarryId不存在","-212":"设备处于断线状态","-213":"关闭文件错误","-214":"要读的长度错误","-215":"文件句柄错误","-216":"读文件错误","-217":"seekfile错误","-218":"得到文件长度错误","-219":"得到文件当前位置错误","-220":"没有音频数据","-221":"没有视频数据","-222":"写文件错误","-223":"系统资源(非内存)不足","-224":"PosaClass对象不存在","-225":"不是一个PosaSourceStream","-226":"不是一个PosaTargetStream","-227":"PosaHost对象已经存在","-228":"PosaHost对象不存在","-229":"PosaPort对象已经存在","-230":"PosaPort对象不存在","-231":"没有找到合适的PosaHost驱动","-232":"没有找到合适的PosaSourceStream驱动","-233":"没有找到合适的PosaTargetStream驱动","-234":"没有找到合适的PosaDecoder驱动","-235":"没有找到合适的PosaSilenceGenerator驱动","-236":"Posa对象已经存在","-237":"PosaSourceChannel已经被关闭","-238":"分配本地地址或端口失败","-239":"请求传输失败","-240":"请求接收数据失败","-241":"对象不存在","-242":"对象已经存在","-243":"对象属性设置错误","-244":"属性值为空或非法","-245":"不能分配到路径","-246":"目标必须是本地的，不能是远程的","-247":"路径连接失败","-248":"属性不存在","-249":"资源被抢占","-250":"资源编号错误","-251":"资源编号不存在","-252":"超过该网段最大数字码流数","-253":"POSA流I/O超时","-254":"POSA流格式不匹配","-255":"没有为软解码器设置Renderer","-256":"没有为POSA目标流设置源","-257":"POSA流的url格式不正确","-258":"UDP或TCP端口已经被占用","-259":"源流不存在","-260":"解码器初始化失败","-261":"解码失败","-262":"没有初始化POSA运行支持库","-263":"已经初始化过了POSA运行支持库","-264":"没有提供定时器API","-265":"加入到组播失败","-266":"连接设备失败","-267":"本地矩阵切换线路被抢占","-268":"选定的节点路由(PassNODE)中不包括本节点或者找不到对应的网关","-269":"传输的源和目标NPS地址不能都要求自动分配","-270":"服务器连接其它设备或服务器时发生网络断线错误","-271":"选定的节点路由(PassNODE)已经包括本节点","-272":"断线重连动作现在不能进行, 必须推迟","-273":"看门狗线程检查到源流在设定时间内没收到任何码流数据","-274":"非法的目标通道名称","-275":"检查到TCP socket已经无效(无法获取对方IP)","-276":"视频丢失","-277":"非法XML字符串","-278":"XML格式不匹配","-279":"抢占数字干线优先级不够","-300":"正在重连中","-301":"模块引用计数不为0","-302":"缓冲区长度不够","-320":"打开Sqlite数据库失败","-321":"查询Sqlite数据库失败","-322":"不支持的数据类型","-323":"创建数据表失败","-324":"删除数据表失败","-325":"删除数据失败","-326":"插入数据失败","-327":"更新数据失败","-350":"授权过期","-351":"录像达到授权最大路数或未授权","-352":"实时流达到授权最大路数或未授权","-353":"点播达到授权最大路数或未授权","-354":"矩阵模块功能未授权","-355":"帧标记模块功能未授权","-356":"报警主机模块功能未授权","-357":"PTZ控制功能未授权","-501":"函数或参数格式不正确","-502":"连接服务器失败","-503":"客户端功能未实现","-504":"客户端内存溢出","-505":"客户端不认识的属性类型","-506":"尚未连接服务器","-507":"发送失败","-508":"接收失败","-509":"客户端不能打开文件","-510":"客户端文件格式不正确","-511":"客户端不能读文件","-512":"客户端检测到无法解析的应答","-513":"已经连接了服务器","-514":"不正确的IP地址或主机名称","-515":"无法创建新的RawObject","-517":"服务器没有响应","-518":"收到无法处理的应答","-519":"传输已经发起","-520":"摄像机没有设置传输协议","-521":"摄像机的传输协议目前不支持","-522":"用户没有登录","-523":"网络接收超时","-524":"网络地址PING不通","-525":"服务器TCP端口错误","-526":"对方已经关闭连接","-527":"用户登录次数太多","-528":"设备不支持的参数配置","-600":"非法的服务器本地数据库文件","-601":"程序没有初始化","-702":"非法db对象ID","-703":"db缓冲区太小","-704":"db对象或者属性不存在","-705":"db对象或者属性已经存在","-706":"db内存不足","-707":"db没有初始化","-708":"db打开文件失败","-709":"db数据check失败","-710":"db类型不匹配","-711":"db非法对象名","-712":"db错误的文档","-713":"db密码不可读","-800":"设备尺寸太小","-801":"不能识别分区格式","-802":"存储设备上的ROFS版本高于当前程序支持版本","-803":"分区尺寸改变","-804":"分区头信息损坏","-805":"缺少关键Slice","-806":"Slice时间差过大","-807":"Package时间长度大于时间段最大允许值","-808":"磁盘空间不足","-809":"磁盘设备参数异常","-810":"Package数量为0","-811":"无效的Package序列号","-812":"没有与读mask匹配的Slice","-813":"打开ROFS原始设备失败","-814":"ROFS原始设备重复打开","-815":"非法ROFS存储设备名","-816":"只有未格式化或者停止态的磁盘才进行格式化/反格式化操作","-817":"不存在的StgName","-818":"缺少同步Slice","-819":"ROFS设备未格式化","-820":"ROFS设备录像中","-821":"ROFS设备数据修复中","-822":"ROFS设备未打开","-823":"无法获取ROFS设备信息","-824":"ROFS管理器已经初始化","-825":"ROFS管理器未初始化","-826":"ROFS固定区标识信息不匹配","-827":"ROFS固定区标识信息太大","-828":"ROFS Package内slice数太多","-829":"数据包信息损坏","-830":"数据信息不一致","-831":"用户取消ROFS设备数据修复","-832":"未处于修复状态","-833":"不是ROFS主设备","-834":"ROFS辅设备忙","-835":"ROFS索引数据损坏","-836":"ROFS时间段数据损坏","-837":"ROFS设备未开始同步拷贝","-838":"ROFS设备已经开始同步拷贝","-839":"不是ROFS辅设备","-840":"循环同步","-841":"ROFS设备写失败","-842":"ROFS设备读失败","-843":"没有与查询时间匹配的Package","-844":"没有与读条件时间匹配的Package索引","-845":"创建元数据文件失败","-846":"打开元数据文件失败","-847":"元数据文件尺寸错误","-848":"元数据文件内容错误","-855":"重复配置ROFS原始设备","-856":"ROFS2设备(StoreGroup)太小，无法格式化","-857":"存在通道时，ROFS2不能格式化","-858":"ROFS2基本头信息损坏","-859":"ROFS2非法块数量","-860":"ROFS2非法通道数量","-861":"ROFS2块头信息损坏","-862":"ROFS2通道头信息损坏","-863":"ROFS2剩余空间不足","-864":"ROFS2命名重复","-865":"ROFS2没有可用块","-866":"ROFS2未找到可删除的最旧数据块","-867":"ROFS2非法块大小","-868":"ROFS2构造组的磁盘路径不匹配","-869":"ROFS2数据已经加锁","-870":"ROFS2没有剩余可用空间，已经录像数据总时间没有满足设定值","-871":"通道名称不存在！","-872":"ROFS2块空间不足","-873":"ROFS2 由于录像周期已到达或是空间不足，未发生写设备动作","-874":"Player,ID 错误","-875":"Player,缓冲区需要数据","-876":"Player,缓冲区已满","-877":"Player, input slice缓冲区回调函数没有设置","-10002":"系统调用失败","-10003":"系统资源不足/被占用","-10004":"内存不足","-10005":"未分类异常","-10006":"内部程序逻辑错误","-10007":"外部程序逻辑错误","-10008":"不支持的功能","-10009":"功能未实现","-10010":"系统/任务退出中，请求无法完成","-10011":"服务端对象状态不支持，请求被拒绝","-10012":"参数值或格式不正确","-10013":"任务未完成","-10014":"服务已经存在","-10015":"服务不存在","-10016":"会话已经存在","-10017":"会话不存在","-10018":"TCP服务端口已经被使用","-10019":"网络对端关闭/或断线","-10020":"会话被放弃","-10021":"服务退出中","-10022":"连接服务器/设备失败","-10023":"未连接服务/设备","-10024":"接收数据失败","-10025":"发送数据失败","-10026":"无法解析的请求","-10027":"无法解析的应答","-10028":"功能已经启动","-10029":"功能未启动","-10030":"系统忙，请求/调用被忽略","-10031":"非法网络请求协议头","-10032":"巨大网络请求数据，拒绝","-10033":"动作已被请求","-10034":"动作未被请求","-10035":"服务连接中，稍后再试","-10036":"当前上下文中，无效IP地址","-10037":"请求端对象状态不支持，请求被拒绝","-10038":"网络连接超时","-10039":"资源使用中，不能卸载或删除","-10040":"ISCM授权失败","-10041":"对象已存在","-10042":"对象不存在","-10043":"会话处于并行调用模式，只支持并行posting型方法","-10044":"会话处于并行回调模式，只支持并行posting型回调/无法解析的网络数据","-10045":"对象状态不支持，调用被忽略","-10046":"TCP/UDP无有效端口可用","-10047":"检测到线程死锁，调用被忽略","-10048":"消息队列满，投递消息失败","-10049":"消息队列满，发送消息失败","-10050":"接口未定义","-10051":"对端方法不存在或不匹配，请检查网络两端接口版本是否一致","-10052":"对端回调不存在或不匹配，请检查网络两端接口版本是否一致","-10053":"回调未就绪，调用被忽略","-10054":"绑定回调连接失败","-10055":"方法匹配失败，请尝试调用其它方法集","-10056":"ISCM回调未实现，请在派生类中重载实现","-10057":"已经登录","-10058":"未登录","-10059":"ISCM客户端接口对象服务IPP无效","-10060":"ISCM接口对象异步调用队列满","-10061":"没有此用户","-10062":"用户名或密码不正确","-10063":"没有权限访问","-10064":"异步调用缓存内存大小限制","-10065":"会话未连接或正在关闭中","-10066":"此用户已被禁用","-10067":"无效UDP连接key","-10068":"对象名或路径名含有非法字符","-10069":"ISCM流式回调未实现，继续调用普通方式回调","-10100":"已在服务群组中","-10101":"不在服务群组中","-10102":"应用服务IPP冲突","-10103":"启动服务进程失败","-10104":"文件已存在","-10105":"文件不存在","-10106":"文件打开失败","-10107":"文件读失败","-10108":"文件写失败","-10109":"禁止操作此文件/路径名（服务使用中，或未授权路径）","-10110":"创建目录失败","-10111":"订阅回调已发起","-10112":"订阅回调未发起","-10113":"无效ISCM远程任务库","-10114":"无效ISCM远程任务函数","-10115":"ISCM远程任务已存在","-10116":"ISCM远程任务不存在","-10117":"无效ISCM模块","-10118":"ISCM模块已存在","-10119":"ISCM模块不存在","-20000":"基本错误边界值","-20001":"不支持","-20002":"功能暂未实现","-20003":"未初始化","-20005":"内存不足","-20004":"打开太多句柄，系统资源不足","-20006":"无效句柄，可能已经关闭","-20007":"无效对象名，没有这个对象","-20008":"参数错误","-20009":"没有文件","-20010":"正在查找文件","-20011":"查找文件时没有更多的文件","-20012":"查找文件时异常","-20013":"文件Url全路径错误","-20014":"元素已存在ESIST","-20015":"对象不存在","-20016":"OSD叠加文本错误","-20017":"OSD类型错误","-20018":"OSD显示错误","-20019":"获取默认端口错误","-20020":"登录失败","-20021":"没有更多查讯数据","-20022":"设置密码错误","-20023":"设置键值不存在","-20024":"对应的键没有值","-20025":"功能未实现","-20026":"获得句柄错误","-20027":"事件重复订阅","-20028":"读到文件末尾","-20029":"句柄不存在","-20030":"对象指针为空","-20031":"第一侦不是I侦","-20032":"不支持的平台","-20033":"缓冲区太小","-20034":"不支持的服务器类型","-20035":"没有权限","-20036":"超过最多画面数","-20037":"磁盘空间不足","-20038":"转码时内存错误（转码库返回）","-20039":"打开编码器错误（转码库返回）","-20040":"未查询到该分段录像","-21001":"句柄错误,获取窗口坐标失败","-21002":"播放缓冲区需要数据","-21003":"播放缓冲区已满","-21004":"输入多个slice方式下回调函数没有设置","-21005":"错误的播放命令","-21006":"错误的播放速度","-21007":"实时播放时不能采用回调方式输入Slice数据","-21008":"资源已经释放","-21009":"播放线程已经停止","-21010":"资源重复打开","-21011":"打开音频设备失败","-21012":"开始采集音频失败","-21013":"停止采集音频失败","-21014":"视频信息获取失败","-21015":"超过最大警告本地缓存","-21016":"小于最小警告本地缓存","-22001":"未定义的错误类型","-22002":"数据查询结果不正确",40025:"文件结束 桶结束",40026:"没有更多文件",40027:"没有系统错误","-30001":"流化已完成","-30002 ":"功能暂未实现","-30003":"流不存在或没流化","-30004":"不能识别","-30005":"正在转码","-30006":"转码失败","-30007":"正在流化","-30008":"流化失败","-30009":"流数据损坏","-30010":"版本不一致","-30011":"等待流化中","-30012":"对象不可写","-30013":"没有打开","-30014":"写入不完整","-30015":"文件不完整","-30016":"读不完整","-30017":"丢失文件","-30018":"上传流失败，可能是原始文件已经存在或者无法打开","-30019":"流状态不正常","-30020":"流化任务已经被取消","-30021":"函数调用顺序不正确","-30022":"无效的数据","-30023":"集群不存在","-30024":"成员不在集群中","-30025":"成员已经在当前集群中了","-30026":"成员已经在另外一个集群中了","-30027":"更新成员信息失败","-30028":"系统繁忙，请稍后再试","-30029":"引用的模块发生了错误","-30030":"数据校对出错","-30031":"操作对象为空，还未赋值","-40000":"文件或目录或桶不存在","-40001":"IO错误","-40002":"无效的句柄","-40003":"配置信息错误","-40004":"无效的参数","-40005":"创建句柄失败","-40006":"无效的路径","-40007":"文件或目录或桶已存在","-40008 ":"此路径是一个目录","-40009":"对象被写保护","-40010 ":"此路径不是一个目录","-40011":"存储空间已满","-40012":"对象不能创建","-40013":"路径太长","-40014":'无效的名称,文件名不能包含后面任何字符：/  : * " ? < > | ',"-40015":"设备IO错误","-40016":"文件已经删除","-40017":"文件太大","-40018":"不能偏移","-40019":"操作被禁止","-40020":"目录非空","-40021":"过期的文件句柄","-40022":"对象没有初始化","-40023":"内存不足","-40024":"打开太多句柄，系统资源不足","-40028 ":"对象正在被使用","-40029 ":"创建cache对象失败","-40030 ":"bfs前缀路径为空","-40031 ":"系统read读取文件失败","-40032 ":"系统pread错误","-40033 ":"未知的文件类型","-40034 ":"服务对象不存在","-41001 ":"数据库查询失败","-41002 ":"数据库查询结果不唯一","-41003 ":"更新数据库失败","-41004 ":"数据库删除操作失败","-41005 ":"查询记录中没有对应的键值","-41006 ":"数据库插入数据失败","-45001":"桶索引已经被打开","-45002":"桶操作 new 申请内存失败","-45003":"打开桶索引文件失败","-45004":"索引文件写失败","-45005":"索引文件读失败","-45006":"连接主节点超时","-45007":"key-v内存写入失败","-45008":"写dat文件失败","-45009":"关闭dat文件失败","-45010":"attr文件打开失败","-45011":"attr为空","-45012":"写入文件超时","-45013":"获取zk中桶打开个数失败","-45014":"桶正在被使用","-45015":"桶被损坏(索引文件或打包文件被损坏)","-45016":"未发现桶id","-45017":"桶的主节点未加载完成","-45018":"从桶的主节点获取桶信息失败","-45019":"选举桶主节点失败","-45020":"正在选举桶主节点","-45021":"与主节点所在PFS服务失去连接，正在尝试连接","-45022":"桶内索引文件不存在","-45023":"桶内索引文件或属性文件创建失败","-45024":"非主桶","-45025":"关闭主桶失败","-45026":"打开主桶失败","-50000":"小文件系统初始化失败","-50001":"获取桶Index文件错误","-50002":"监测桶路径错误，路径为/或为空或者此目录下含有其他文件夹","-80000 ":"参数错误","-80003 ":"创建流化器失败","-80005 ":"打开文件失败","-80006 ":"读取文件失败","-80007":"写入文件失败","-80008":"关闭文件失败","-80009":"移动文件指针失败","-80010":"第三方SDK失败","-80011":"空指针错误","-80012":"创建流化进程失败","-80013":"不支持的文件类型","-80014":"创建线程失败","-80015":"申请内存失败","-80016":"不支持的视频格式","-80017":"不支持的音频格式","-80018":"流化进程崩溃","-80019":"流化进程死掉","-101001":"未分配SS","-101002":"未分配FS","-101003":"未分配PAU","-101004":"设备未分配PAU","-101005":"超出用户流控限制","-101006":"超出平台流控限制","-101007":"非法的JSON字符串","-101008":"与PAU之间通信失败","-101030":"监视器已经被锁定","-101031":"监视器不能被控制","-102001":"会话无效（不存在）","-102002":"FS流断线","-102003":"非节点内部监视器","-102004":"监视器被锁定","-103001":"通道不可用","-103002":"PAU不可用","-103003":"未分配日志服务","-103004":"与PAU服务OPEN失败","-103005":"与PVG服务OPEN失败","-103006":"本地数据库未初始化","-103007":"本地数据库异常","-103008":"通道已在录像","-103009":"未分配PVG","-103010":"喊话通道被占用","-103011":"设备不存在","-103012":"请求的路径已经存在","-103013":"无可用的rofs3s","-103014":"PAU服务无法连接","-103015":"无资源权限(资源屏蔽)","-103016":"键盘巡检已存在","-103017":"键盘宏已存在","-103018":"调用次序错误","-103019":"用户被禁用","-103020":"通道录像被复用","-21200":"未播放","-21201":"已播放","-21202":"未下载","-21203":"未在sdk动态链接库中找到对应函数","-21204":"动态加载sdk失败","-21205":"输入参数非法","-21206":"登陆服务器失败","-21207":"功能未实现或不支持","-21208":"内存不足","-21209":"该命名对象不存在","-21210":"对象类型不匹配","-21211":"打开国标实时流失败","-21212":"打开国标录像流失败","-21213":"国标不支持单帧播放录像","-21214":"打开AVI文件失败","-21215":"初始化YUVd对象失败","-21216":"yuv对象的画图对象还未初始化","-21217":"传给yuv画图对象的key值已经被占用","-21218":"初始化yuv画图对象失败","-21219":"非不妨布控模式不支持图形元素操作","-21220":"创建事件失败","-21221":"启动线程失败","-21222":"窗口句柄失效","-21223":"窗口太小,不能画图","-21224":"录像文件长度为0","-21225":"还没有得到第一个关键帧,请稍后再试","-21226":"为uuid开的buffer太小","-21227":"pvg file sdk不支持avi转码","-21228":"查找配置文件失败","-21229":"配置文件内容无效","-21230":"硬解码模式下不支持该功能","-21231":"HW开通道失败","-21232":"需要登陆服务器","-21233":"打开流失败","-21234":"下载录像时间间隔过短","-21235":"接收到错误的应答","-21236":"创建文件失败","-21237":"查询失败","-21238":"不支持的编码方式","-21239":"无编码数据回调","-21240":"mp4文件无法打开","-21241":"写文件失败","-21242":"创建TrackID错误","-21243":"rofs open reader错误","-21244":"编码错误","-21245":"20秒无数据","-21246":"非标准码流，转MP4需要强制转码","-49999":"未知错误","-49998":"分配内存错误","-49997":"非法参数","-49996":"连接服务器失败","-49995":"未连接服务器","-49994":"接收失败","-49993":"发送失败","-49992":"接收到错误的应答","-49991":"网络接收超时","-49990":"网络发送超时","-49989":"XXX不存在","-49988":"XXX不存在","-49987":"功能未实现","-49986":"非法指令","-49985":"系统资源错误","-49984":"XXX已存在","-49983":"处理中、稍后再试","-49982":"抓图失败","-49981":"本次设置无效","-49980":"不支持此功能","-49979":"无权限","-49978":"用户放弃选择","-49977":"请求服务超时","-49976":"设备进程已达到极限、且各进程已达到内存限制","-49975":"创建线程失败","-49974":"重复的工具条类型","-49973":"xml配置文件创建失败","-49972":"工具条饱和","-49971":"工具条图片下载失败","-49970":"工具条图片下载版本回退","-49969":"工具条未找到对应的id","-49968":"无法写","-49967":"没有找到设置的类型","-49966":"重复设置类型","-49965":"创建文件夹失败","-49964":"拷贝文件夹失败","-49963":"删除文件夹失败","-49962":"开启进程失败","-49961":"拷贝文件失败","-49960":"删除文件失败","-49959":"抽取失败","-49958":"解压失败","-49957":"关闭进程失败","-49956":"读取文件失败","-49955":"sdk 格式或内容非法","-49954":"打开文件失败","-49953":"获取IP地址","-49952":"没有pva_json文件","-49951":"没有目录","-49950":"写文件失败","-49949":"PFS定位失败","-49948":"PFS文件检测超时","-49947":"不支持的编码类型","-49946":"不支持的编码类型-H265","-49945":"不支持的编码类型-SVAC","-49944":"不支持的编码类型-MPEG4","-104999":"与H5MS连接失败","-105000":"H5MS:内部错误","-105001":"H5MS:暂无客户端连接可用","-105002":"H5MS:参数错误","-105003":"H5MS:设置头域失败","-105004":"H5MS:创建socket失败","-105005":"H5MS:连接socket失败","-105006":"H5MS:socket发送失败","-105007":"H5MS:socke接收失败","-105008":"H5MS:对方socket已关闭"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=i(387),g=i(329),_=i(330);var s=(n(o,[{key:"initializer",value:function(){this.defaultRightMenuConf={},this.rightMenuMouseOverFlag=!1}},{key:"createRightMenu",value:function(e){e.menuList?(this.rightMenuEle=document.createElement("ul"),this.rightMenuEle.className="right-menu-box",e.width&&(this.rightMenuEle.style.width=e.width),this.vOpt.videoC.appendChild(this.rightMenuEle),this._createRightMenuList(e.menuList,this.rightMenuEle),_.EventUtil.addHandler(this.rightMenuEle,"mousedown",function(e){e.stopPropagation()}),_.EventUtil.addHandler(this.rightMenuEle,"mouseup",function(e){e.stopPropagation()})):console.log("传入的参数不正确！")}},{key:"showOrHideRightMenu",value:function(e,t){this.rightMenuEle&&(e?this._setRightMenuPosition(t):this.rightMenuEle.style.display="none")}},{key:"getRightMenuItemById",value:function(e){return e&&this.defaultRightMenuConf[e]?this.defaultRightMenuConf[e]:null}},{key:"_deepTraversal",value:function(e,t){if(e)for(var i=e.children,r=0,n=i.length;r<n;r++)i[r].getAttribute("data-id")===t?this.curOperateNode=i[r]:this._deepTraversal(i[r],t)}},{key:"_getRightMenuEleById",value:function(e){return!e||e&&"string"!=typeof e?null:this.rightMenuEle?(this._deepTraversal(this.rightMenuEle,e),this.curOperateNode):void 0}},{key:"setRightMenuItemAttrsById",value:function(e,t){if(!e||e&&"string"!=typeof e||!t||t&&"object"!=(void 0===t?"undefined":r(t)))return null;this.defaultRightMenuConf[e]&&(this.defaultRightMenuConf[e]=g.Toolkit.deepMerge(this.defaultRightMenuConf[e],t));var i=this._getRightMenuEleById(e);t.hasOwnProperty("checked")&&(t.checked?this._setRightMenuCheckedStyle(i):this._setRightMenuNotCheckedStyle(i)),t.hasOwnProperty("gray")&&(t.gray?this._setRightMenuGrayStyle(i):this._setRightMenuNotGrayStyle(i)),t.hasOwnProperty("text")&&(this.setRightMenuItemText(e,t.text),i.children[1].innerHTML=t.text)}},{key:"_setRightMenuCheckedStyle",value:function(e){e.classList.add("active"),e.classList.remove("not-allowed")}},{key:"_setRightMenuNotCheckedStyle",value:function(e){e.classList.remove("active")}},{key:"setRightMenuItemChecked",value:function(e,t){if(!e||e&&"string"!=typeof e||!0!==t&&!1!==t)return null;this.defaultRightMenuConf[e]&&(this.defaultRightMenuConf[e]=g.Toolkit.deepMerge(this.defaultRightMenuConf[e],{checked:t}));var i=this._getRightMenuEleById(e);t?this._setRightMenuCheckedStyle(i):this._setRightMenuNotCheckedStyle(i)}},{key:"_setRightMenuGrayStyle",value:function(e){e.classList.add("not-allowed"),e.classList.remove("active"),e.setAttribute("isShowChildren",!1)}},{key:"_setRightMenuNotGrayStyle",value:function(e){e.classList.remove("not-allowed"),e.setAttribute("isShowChildren",!0)}},{key:"setRightMenuItemGray",value:function(e,t){if(!e||e&&"string"!=typeof e||!0!==t&&!1!==t)return null;this.defaultRightMenuConf[e]&&(this.defaultRightMenuConf[e]=g.Toolkit.deepMerge(this.defaultRightMenuConf[e],{gray:t}));var i=this._getRightMenuEleById(e);t?this._setRightMenuGrayStyle(i):this._setRightMenuNotGrayStyle(i)}},{key:"setRightMenuItemText",value:function(e,t){if(!e||e&&"string"!=typeof e||t&&"string"!=typeof t)return null;this.defaultRightMenuConf[e]&&(this.defaultRightMenuConf[e]=g.Toolkit.deepMerge(this.defaultRightMenuConf[e],{text:t})),this._getRightMenuEleById(e).children[1].innerHTML=t}},{key:"removeRightMenu",value:function(){this.rightMenuEle&&this.rightMenuEle.parentNode&&this.rightMenuEle.parentNode.removeChild(this.rightMenuEle),this.defaultRightMenuConf={}}},{key:"_createRightMenuSubmenu",value:function(e,t){var i=document.createElement("ul");return i.className="right-menu-box item_"+e,i.style.width=this.rightMenuEle.style.width,t.appendChild(i),i.style.display="none",i}},{key:"_createRightMenuList",value:function(f,p){for(var v=this,e=function(e,t){var i=f[e],n=void 0;if(i.name&&(i.id=i.name),i.id){if(m.defaultRightMenuConf[i.id]){var r=g.Toolkit.deepMerge({},m.defaultRightMenuConf[i.id]);i=g.Toolkit.deepMerge(r,i)}else i.checked||(i.checked=!1),i.gray||(i.gray=!1);i._rightmenu=!0,v.defaultRightMenuConf[i.id]=i}if(1===i.type){(n=document.createElement("li")).className="right-menu-line-box",p.appendChild(n);var a=document.createElement("div");a.className="right-menu-icon-box",n.appendChild(a);var s=document.createElement("div");s.className="right-menu-line",n.appendChild(s)}else{(n=document.createElement("li")).className="right-menu-text-box",p.appendChild(n),i.id&&n.setAttribute("data-id",i.id);var o=document.createElement("div");o.className="right-menu-icon-box",n.appendChild(o);var l=document.createElement("span");l.className="checked-icon",o.appendChild(l),i.checked&&n.classList.add("active");var u=document.createElement("div");u.className="right-menu-text-text",n.appendChild(u),u.innerText=i.text;var h=v;if(_.EventUtil.addHandler(n,"click",function(e){e.stopPropagation(),h.videoCMouseOverFlag=!1,i.menuList||i.gray?h.rightMenuMouseOverFlag=!1:h.rightMenuMouseOverFlag=!0,"videoRatio"===i.originId?h._setRightMenuCheckStyle(i):h._btnClickFunction(i)}),_.EventUtil.addHandler(n,"dblclick",function(e){e.stopPropagation()}),i.menuList){n.classList.add("sub");var d=document.createElement("div");d.className="right-menu-icon-arrow",n.appendChild(d);var c=v._createRightMenuSubmenu(i.id,n);v._createRightMenuList(i.menuList,c),_.EventUtil.addHandler(n,"mousemove",function(e){h.rightMenuMouseOverFlag=!0}),_.EventUtil.addHandler(n,"mouseenter",function(e){if(h.rightMenuMouseOverFlag=!0,"false"!==n.getAttribute("isShowChildren")&&c){if(c.style.display="inline-block",!h.rightMenuEle||!h.vOpt.videoC)return;c.style.top=n.offsetTop+"px",c.style.left=n.offsetWidth+"px";var t=document.documentElement.offsetWidth-c.offsetWidth,i=document.documentElement.offsetHeight-c.offsetHeight,r=_.EventUtil.getEleToParentDistance(c);t<r.offsetLeft&&(c.style.left=-c.clientWidth+"px"),i<r.offsetTop&&(c.style.top=-c.clientHeight+n.offsetTop+n.clientHeight+"px")}}),_.EventUtil.addHandler(n,"mouseleave",function(e){h.rightMenuMouseOverFlag&&c&&(c.style.display="none")})}else i.gray?v._setRightMenuGrayStyle(n):v._setRightMenuNotGrayStyle(n)}},t=0,i=(f=f.filter(function(e){return e})).length;t<i;t++)e(t)}},{key:"_setRightMenuPosition",value:function(e){if(this.rightMenuEle&&this.rightMenuEle.parentNode){var t=e||window.event,i=this.rightMenuEle.parentNode.getBoundingClientRect();this.rightMenuEle.style.display="block",this.rightMenuEle.style.top=t.clientY-i.top+"px",this.rightMenuEle.style.left=t.clientX-i.left+"px";var r=document.documentElement.offsetWidth-this.rightMenuEle.offsetWidth-i.offsetLeft,n=document.documentElement.offsetHeight-this.rightMenuEle.offsetHeight-i.offsetTop;this.rightMenuEle.offsetTop>n&&(this.rightMenuEle.style.top=n+"px"),this.rightMenuEle.offsetLeft>r&&(this.rightMenuEle.style.left=r+"px")}}},{key:"_setRightMenuCheckStyle",value:function(t){switch(t.originId){case"videoRatio":var e=document.querySelector(".item_videoRatio").children;[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(e)).forEach(function(e){e.getAttribute("data-id")===t.id?e.classList.add("active"):e.classList.remove("active")}),this.setRatio(t.value);default:this.rightMenuEle&&(this.rightMenuEle.style.display="none")}}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(330),o=i(329),l=i(391),u=(a=l)&&a.__esModule?a:{default:a};var h=(r(d,[{key:"initializer",value:function(){this.isVideoPtz=!1,this.ptzRangeMode=1,this.top_bottom=20,this.left_right=20,this.ptzDirection=-1,this._bPtzing=!1}},{key:"EnablePTZ",value:function(e){this.vOpt.enablePtzMotion=e}},{key:"SetWindowPTZ",value:function(e){return this.isVideoPtz=e,!0}},{key:"isWindowPTZ",value:function(){return this.isVideoPtz}},{key:"SetWndPtzSpeed",value:function(e){this.vOpt.windowPtzSpeed=e}},{key:"setPTZRange",value:function(e,t,i){o.Toolkit.isPositiveInteger(e)&&(0===e||1===e)&&o.Toolkit.isPositiveInteger(t)&&o.Toolkit.isPositiveInteger(i)&&(0===e?(this.vOpt.ptzRangeMode=e,this.vOpt.top_bottom=t,this.vOpt.left_right=i):1===e&&t<=49&&i<=49&&(this.vOpt.ptzRangeMode=e,this.vOpt.top_bottom=t,this.vOpt.left_right=i))}},{key:"isInPtzRange",value:function(e,t){if(!this.isVideoPtz)return!1;var i=this.ptzPositionFlag(e,t);return-1!==i&&0!==i}},{key:"ptzPositionFlag",value:function(e,t){var i=this.vOpt.videoC.offsetWidth,r=this.vOpt.videoC.offsetHeight,n=void 0,a=void 0;return i<=e+16||r<=t+16?0:(0===this.vOpt.ptzRangeMode?(n=this.vOpt.top_bottom,a=this.vOpt.left_right):1===this.vOpt.ptzRangeMode&&(n=this.vOpt.top_bottom*r/100,a=this.vOpt.left_right*i/100),e<=a?t<=n&&0<=t?1:r-n<t?7:8:i-a<e?t<=n&&0<=t?3:r-n<t?5:4:t<=n&&0<=t?2:r-n<t?6:0)}},{key:"isShowPtzRedArrow",value:function(e,t){if(this.isVideoPtz){if(!e)return this._changeVideoCursor(),void(this.ptzDirection=-1);var i=this._getVidoContainerEventInfo(t),r=i.x,n=i.y;switch(this.ptzPositionFlag(r,n)){case 0:this._changeVideoCursor(),this.ptzDirection=-1;break;case 1:this._changeVideoCursor("ptz-leftup"),this.ptzDirection=3;break;case 2:this._changeVideoCursor("ptz-up"),this.ptzDirection=2;break;case 3:this._changeVideoCursor("ptz-rightup"),this.ptzDirection=1;break;case 4:this._changeVideoCursor("ptz-right"),this.ptzDirection=0;break;case 5:this._changeVideoCursor("ptz-rightdown"),this.ptzDirection=7;break;case 6:this._changeVideoCursor("ptz-down"),this.ptzDirection=6;break;case 7:this._changeVideoCursor("ptz-leftdown"),this.ptzDirection=5;break;case 8:this._changeVideoCursor("ptz-left"),this.ptzDirection=4}}}},{key:"_changeVideoCursor",value:function(e){this.vOpt.videoC.classList.remove("ptz-left","ptz-leftup","ptz-up","ptz-leftdown","ptz-rightup","ptz-right","ptz-rightdown","ptz-down"),e&&this.vOpt.videoC.classList.add(e)}},{key:"_getVidoContainerEventInfo",value:function(e){var t=(e=s.EventUtil.getEvent(e)).target||e.srcElement,i=s.EventUtil.getEleToParentDistance(t,"h5vp-video-container");return{x:e.offsetX+i.offsetLeft,y:e.offsetY+i.offsetTop}}},{key:"mouseEvent",value:function(e){var r=this,n=!1,a=void 0;function t(e){(e=e||window.event).preventDefault(),e.stopPropagation(),e.wheelDelta?(clearTimeout(r.mousewheelTimer),0<e.wheelDelta?r._ptzControlByWin(11,r.vOpt.windowPtzSpeed,5):r._ptzControlByWin(11,0-r.vOpt.windowPtzSpeed,6),i()):e.detail&&(clearTimeout(r.mousewheelTimer),0<e.detail?r._ptzControlByWin(11,r.vOpt.windowPtzSpeed,5):r._ptzControlByWin(11,0-r.vOpt.windowPtzSpeed,6),i())}function i(){r.mousewheelTimer=setTimeout(function(){r._ptzControlByWin(11,0)},500)}e&&(s.EventUtil.addHandler(document,"keydown",function(e){var t=s.EventUtil.getEvent(e),i=t.keyCode||t.which||t.charCode;if(37===i||38===i||39===i||40===i||33===i||34===i||35===i||36===i||45===i||46===i){switch(n=!0,a=r.vOpt.windowPtzSpeed,i){case 33:r.ptzDirection=11;break;case 34:r.ptzDirection=11,a=0-a;break;case 35:r.ptzDirection=12,a=0-a;break;case 36:r.ptzDirection=12;break;case 37:r.ptzDirection=4;break;case 38:r.ptzDirection=2;break;case 39:r.ptzDirection=0;break;case 40:r.ptzDirection=6;break;case 45:r.ptzDirection=10;break;case 46:r.ptzDirection=10,a=0-a}r._ptzControlByWin(r.ptzDirection,a,1,i)}}),document.onkeyup=function(e){var t=s.EventUtil.getEvent(e),i=t.keyCode||t.which||t.charCode;n&&(r._ptzControlByWin(r.ptzDirection,0,2,i),n=!1)},document.addEventListener&&document.addEventListener("DOMMouseScroll",t,!1),s.EventUtil.addHandler(this.vOpt.videoC,"mousewheel",t))}},{key:"_ptzControlByWin",value:function(e,t,i,r){this.isVideoPtz&&(this._bPtzing&&0==t||0!=t)&&(this._emitter.emit(u.default.OnPTZControlEvent,this.vOpt.index,e,t,this.vOpt.enablePtzMotion,i,r),this.vOpt.enablePtzMotion&&this.ptzControl(e,t),this._bPtzing=0!=t)}},{key:"ptzControl",value:function(e,t){return!!this._videoplayer&&this._videoplayer.ptzControl(e,t)}},{key:"ptzControl3d",value:function(e,t,i,r,n){return!!this._videoplayer&&this._videoplayer.ptzControl3D(e,t,i,r,n)}},{key:"ptzLock",value:function(e){return!!this._videoplayer&&this._videoplayer.ptzLock(e)}}]),d);function d(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d)}t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={OnFocusChange:"OnFocusChange",OnWndClick:"OnWndClick",OnWndDClik:"OnWndDClik",OnSwitchWindow:"OnSwitchWindow",OnUnexecutedSwitchWindow:"OnUnexecutedSwitchWindow",OnFullScreen:"OnFullScreen",OnExitFullScreen:"OnExitFullScreen",OnLayoutChange:"OnLayoutChange",OnSizeChange:"OnSizeChange",OnPTZControlEvent:"OnPTZControlEvent",OnPTZControl3DEvent:"OnPTZControl3DEvent",OnMouseEnter:"OnMouseEnter",OnMouseLeave:"OnMouseLeave",OnMouseDown:"OnMouseDown",OnMouseUp:"OnMouseUp",OnMouseMove:"OnMouseMove",OnVideoClose:"OnVideoClose",OnVideoStart:"OnVideoStart",OnTimeaxisLevel:"OnTimeaxisLevel",OnDrawingObject:"OnDrawingObject",OnZoomStatusChange:"OnZoomStatusChange",OnH5msError:"OnH5msError",OnH5msInit:"OnH5msInit"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=i(329);var s=(r(o,[{key:"initializer",value:function(){this.watermkArr=[],this._watermkC=null}},{key:"resetWaterMarkPos",value:function(e,t,i,r){if(e!==i||t!==r){e=parseInt(e),t=parseInt(t),i=parseInt(i),r=parseInt(r);for(var n=null,a=void 0,s=void 0,o=0,l=this.watermkArr.length;o<l;o++)n=document.getElementById(this.watermkArr[o].eleid),a=i/e*parseInt(n.style.left)+"px",s=r/t*parseInt(n.style.top)+"px",this.watermkArr[o].moving&&"static"!==this.watermkArr[o].moving||(this.watermkArr[o].left?0<this.watermkArr[o].left.indexOf("%")&&(a=this.watermkArr[o].left):a=(i-n.clientWidth)/2+"px",this.watermkArr[o].top?0<this.watermkArr[o].top.indexOf("%")&&(s=this.watermkArr[o].top):s=(r-n.clientHeight)/2+"px"),n.style.left=a,n.style.top=s}}},{key:"changeWaterMarkById",value:function(e,t){for(var i=null,r=0,n=this.watermkArr.length;r<n;r++)if(e===this.watermkArr[r].id){if(!(i=document.getElementById(this.watermkArr[r].eleid)))return;for(var a in t)"text"===a?i.innerHTML=t[a]:"icon"===a?i.style.backgroundImage="url("+t[a]+")":i.style[a]=t[a],this.watermkArr[r][a]=t[a];break}}},{key:"delWaterMarkById",value:function(e){if(this._watermkC)if(e){for(var t=0,i=this.watermkArr.length;t<i;t++)if(e===this.watermkArr[t].id){var r=document.getElementById(this.watermkArr[t].eleid);r&&r.parentNode&&r.parentNode.removeChild(r),this.watermkArr[t].watermkInterval&&clearInterval(this.watermkArr[t].watermkInterval),this.watermkArr.splice(t,1);break}0==this.watermkArr.length&&this._watermkC&&(this._watermkC.parentNode.removeChild(this._watermkC),this._watermkC=null)}else this.delAllWaterMark()}},{key:"delAllWaterMark",value:function(){for(var e=0,t=this.watermkArr.length;e<t;e++){var i=document.getElementById(this.watermkArr[e].eleid);i&&i.parentNode&&i.parentNode.removeChild(i),this.watermkArr[e].watermkInterval&&clearInterval(this.watermkArr[e].watermkInterval)}this.watermkArr.splice(0,this.watermkArr.length),this._watermkC&&(this._watermkC.parentNode.removeChild(this._watermkC),this._watermkC=null)}},{key:"getWaterMarkById",value:function(e){if(e){for(var t=null,i=0,r=this.watermkArr.length;i<r;i++)e===this.watermkArr[i].id&&(t=a.Toolkit.deepMerge({},this.watermkArr[i]));return t}return a.Toolkit.deepMerge([],this.watermkArr)}},{key:"addWaterMark",value:function(e){var t=this;e instanceof Array?e.forEach(function(e){e.watermkDiv=null,e.watermkInfo=null,e.watermkInterval=null,t._addSingleWatermark(e)}):(e.watermkDiv=null,e.watermkInfo=null,e.watermkInterval=null,this._addSingleWatermark(e))}},{key:"_generateWatermkRandomTop",value:function(e){var t=this.vOpt.videoC,i=Math.random()*t.offsetHeight,r=t.offsetHeight-e.watermkDiv.clientHeight;e.watermkDiv.style.top=(r<i?r:i)+"px"}},{key:"_generateWatermkRandomLeft",value:function(e){var t=this.vOpt.videoC,i=Math.random()*t.offsetWidth,r=t.offsetWidth-e.watermkDiv.clientWidth;e.watermkDiv.style.left=(r<i?r:i)+"px"}},{key:"_watermkMoving",value:function(e){for(var t=!1,i=0,r=this.watermkArr.length;i<r;i++)e.id===this.watermkArr[i].id&&(t=!0);if(t){var n=this.vOpt.videoC;e.watermkDiv&&("cycle"===e.moving.toLowerCase()?(e.watermkDiv.style.left=parseInt(e.watermkDiv.style.left)-parseInt(e.step)+"px",parseInt(e.watermkDiv.style.left)<0?(e.watermkDiv.style.left=n.offsetWidth-e.watermkDiv.clientWidth+"px",this._generateWatermkRandomTop(e)):parseInt(e.watermkDiv.style.left)>n.offsetWidth-e.watermkDiv.clientWidth&&(e.watermkDiv.style.left=n.offsetWidth-e.watermkDiv.clientWidth+"px",this._generateWatermkRandomTop(e))):"static"!=e.moving.toLowerCase()&&(this._generateWatermkRandomTop(e),this._generateWatermkRandomLeft(e)))}else clearInterval(e.watermkInterval)}},{key:"_addSingleWatermark",value:function(e){this._watermkC||(this._watermkC=document.createElement("div"),this._watermkC.className="watermk-container",this._watermkC.draggable=!0,this._drawVMCvsC?a.Toolkit.insertAfter(this._watermkC,this._drawVMCvsC):a.Toolkit.insertAfter(this._watermkC,this.vOpt.videoEle));var t=Object.assign({moving:"static"},e),i=this.vOpt.videoC;if(t.eleid=t.id+a.Toolkit.getUuid(),t.watermkDiv||(t.watermkDiv=document.createElement("div"),t.watermkDiv.setAttribute("id",t.eleid),t.watermkDiv.className="player-watermk",this._watermkC.appendChild(t.watermkDiv)),"cycle"===t.moving.toLowerCase()&&(t.step="1"),t.icon&&(t.watermkDiv.style.backgroundImage="url("+t.icon+")",t.watermkDiv.style.width=t.width,t.watermkDiv.style.height=t.height),t.text&&(t.watermkDiv.innerHTML=t.text,t.watermkDiv.style.fontSize=t.fontSize,t.watermkDiv.style.fontWeight=t.fontWeight,t.watermkDiv.style.color=t.color),t.watermkDiv.style.opacity=t.opacity,t.watermkDiv.style.webkitTransform=t.transform,t.watermkDiv.style.msTransform=t.transform,t.watermkDiv.style.transform=t.transform,t.watermkDiv.style.marginTop=t.marginTop,t.watermkInterval&&(window.clearInterval(t.watermkInterval),t.watermkInterval=null),"static"===t.moving.toLowerCase())t.watermkDiv.style.top=t.top?t.top:(i.offsetHeight-t.watermkDiv.clientHeight)/2+"px",t.watermkDiv.style.left=t.left?t.left:(i.offsetWidth-t.watermkDiv.clientWidth)/2+"px";else{var r=20;this._generateWatermkRandomTop(t),t.moving&&"cycle"===t.moving.toLowerCase()?t.watermkDiv.style.left=i.offsetWidth-t.watermkDiv.clientWidth+"px":(this._generateWatermkRandomLeft(t),r=1e3),t.watermkInterval=window.setInterval(this._watermkMoving.bind(this,t),r)}this.watermkArr.push(t)}}]),o);function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o)}t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=i(329);var a=(r(s,[{key:"initializer",value:function(){this.VMRealVideoOverlayFlag=!1,this._drawVMCvsC=null,this.drawVMCanvas=null,this._objectinfoBuffer=[],this.RTVOTimeHandler=null,this.lastPts=-1,this.timer=null,this.drawVMCanvasSize={left:0,top:0,width:0,height:0}}},{key:"RTVOInit",value:function(e){this._objectinfoBuffer.push(e),!1===this.VMRealVideoOverlayFlag&&(this.drawVMCanvas&&this.setVMCanvasPosition(this.drawVMCanvasSize),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,this.RTVOTimeHandler=window.requestAnimationFrame(this._VMRealTimeVideoOverlayEx.bind(this)),this.VMRealVideoOverlayFlag=!0,null==this.timer&&(this.timer=window.setInterval(this._VMRealTimeVideoOverlay.bind(this),1e3)))}},{key:"stopRTVO",value:function(){this.VMRealVideoOverlayFlag&&(window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.webkitCancelRequestAnimationFrame,window.cancelAnimationFrame(this.RTVOTimeHandler),this.drawVMCanvas&&this.drawVMCanvas.getContext("2d").clearRect(0,0,this.drawVMCanvas.width,this.drawVMCanvas.height),this._objectinfoBuffer=[],this.timer&&(window.clearInterval(this.timer),this.timer=null),this.VMRealVideoOverlayFlag=!1)}},{key:"_VMRealTimeVideoOverlay",value:function(){if(this._objectinfoBuffer.length)for(;this._objectinfoBuffer.length;){var e=1e3*this._videoplayer.currentTime,t=this._objectinfoBuffer.shift(),i=e-t.pts;if(this.lastPts=t.pts,!(50<i)){if(i<-20){this._objectinfoBuffer.unshift(t);break}this._drawVMFrameCanvas(t);break}}else{var r=1e3*this._videoplayer.currentTime-this.lastPts;-1!==this.lastPts&&100<r&&(this.drawVMCanvas.getContext("2d").clearRect(0,0,this.drawVMCanvas.width,this.drawVMCanvas.height),this.lastPts=-1)}}},{key:"_VMRealTimeVideoOverlayEx",value:function(){this._VMRealTimeVideoOverlay(),this.RTVOTimeHandler=window.requestAnimationFrame(this._VMRealTimeVideoOverlayEx.bind(this))}},{key:"setVMCanvasPosition",value:function(e){this.drawVMCanvas&&(this.drawVMCanvas.style.left=e.left+"px",this.drawVMCanvas.style.top=e.top+"px",this.drawVMCanvas.style.width=e.width+"px",this.drawVMCanvas.style.height=e.height+"px",this.drawVMCanvas.width=e.width,this.drawVMCanvas.height=e.height),this.drawVMCanvasSize=_.Toolkit.deepMerge({},e)}},{key:"enableShowAttribute",value:function(e){this.vOpt.vmShowAttribute=e}},{key:"_getRGBAColor",value:function(e){return-1!==e.indexOf("#")&&(e=_.Toolkit.hexToRgb(e)),_.Toolkit.rgbAndOpacityToRgba(e,.5)}},{key:"_drawVMFrameCanvas",value:function(e){this.drawVMCanvas||(this._drawVMCvsC||(this._drawVMCvsC=document.createElement("div"),this._drawVMCvsC.className="drawvm-container",this._drawVMCvsC.draggable=!0,_.Toolkit.insertAfter(this._drawVMCvsC,this.vOpt.videoEle)),this.drawVMCanvas=document.createElement("canvas"),this.drawVMCanvas.className="VMCanvas",this.drawVMCanvas.draggable=!0,this._drawVMCvsC.appendChild(this.drawVMCanvas),this.setVMCanvasPosition(this.drawVMCanvasSize));var t=this.drawVMCanvas.getContext("2d"),i=null,r=null,n=-1,a="",s="",o=[];t.clearRect(0,0,this.drawVMCanvas.width,this.drawVMCanvas.height);for(var l=0,u=e.objects.length;l<u;l++)if(n=(i=e.objects[l]).type,s=this.vOpt.VMTitleObj[n],(r=i.rect).left=this._calHorSizeByCanvasResolution(r.left),r.right=this._calHorSizeByCanvasResolution(r.right),r.top=this._calVerByCanvasResolution(r.top),r.bottom=this._calVerByCanvasResolution(r.bottom),o=i.attributes,a=this.vOpt.VMStrokeColorObj[n],t.strokeStyle=a,t.lineWidth=1,t.strokeRect(r.left,r.top,r.right-r.left,r.bottom-r.top),t.lineJoin="round",t.lineWidth=3,t.beginPath(),t.moveTo(r.left+8,r.top),t.lineTo(r.left,r.top),t.lineTo(r.left,r.top+8),t.moveTo(r.right-8,r.top),t.lineTo(r.right,r.top),t.lineTo(r.right,r.top+8),t.moveTo(r.right,r.bottom-8),t.lineTo(r.right,r.bottom),t.lineTo(r.right-8,r.bottom),t.moveTo(r.left,r.bottom-8),t.lineTo(r.left,r.bottom),t.lineTo(r.left+8,r.bottom),t.stroke(),t.fillStyle=a,t.font="10px 微软雅黑",r.top-5<8?t.fillText(i.id+"_"+s,r.left-3,r.bottom+15):t.fillText(i.id+"_"+s,r.left-3,r.top-5),this.vOpt.vmShowAttribute&&o&&o.length)for(var h=this._getRGBAColor(a),d=o.length,c=18*d+4*(d-1),f=void 0,p=void 0,v=void 0,m=void 0,g=0;g<d;g++)v=(f=r.right+4+90>this.drawVMCanvas.width?r.left-90-4:r.right+4)+4,m=(p=r.bottom+c-(r.bottom-r.top)>this.drawVMCanvas.height?this.drawVMCanvas.height-18*(d-g)-4*(d-g-1):r.top+18*g+4*g)+13,t.fillStyle=h,t.fillRect(f,p,90,18),t.fillStyle="#FFF",t.fillText(o[g].key+":"+o[g].value,v,m)}},{key:"_calHorSizeByCanvasResolution",value:function(e){var t=this._videoWidth;return this.drawVMCanvas.clientWidth/t*e}},{key:"_calVerByCanvasResolution",value:function(e){var t=this._videoHeight;return this.drawVMCanvas.clientHeight/t*e}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s)}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(330),c=i(329),o=i(391),l=(a=o)&&a.__esModule?a:{default:a};var u=0,h=1,g=2,d=3,f=4,p=5,_=6,v=7,m=8,y=(r(b,[{key:"initializer",value:function(){this.drawSvg=null,this.drawSvgC=null,this.RTDrawInfo={type:"",status:u,ele:null,eleGroup:null,polygonArr:[],pointCount:0,direction:"",adjustIndex:-1,move:{},arrow:0,arrowpos:-1,distance:4,title:null,titleStyle:{}},this._defVideoSize={w:1920,h:1080},this.RTAdjustInfo=c.Toolkit.deepMerge({},this.RTDrawInfo),this.RTDrawResult=[],this.svgLastSize={left:0,top:0,width:0,height:0},this.lastHoverShape=null,this.lastSelectShape=null,this.lastMouseStyle=null,this._resultCB=null}},{key:"deleteDrawingById",value:function(i){if(i){if(this.drawSvg){for(var e=this.drawSvg,t=e.children,r=null,n="",a=-1,s=this,o=0,l=t.length;o<l;o++)if(n=(r=t[o]).children[0].getAttribute("id"),i===n){e.removeChild(r),this.RTDrawResult.every(function(e,t){return i!==e.id||(s.lastHoverShape&&e==s.lastHoverShape&&(s.lastHoverShape=null),s.lastSelectShape&&e==s.lastSelectShape&&(s.lastSelectShape=null),a=t,!1)}),this.RTDrawResult.splice(a,1);break}""==this.RTDrawInfo.type&&0==this.RTDrawResult.length&&this._removeDrawing()}}else this._deleteAllDrawing()}},{key:"addDrawingCallback",value:function(e){"function"==typeof e&&(this._resultCB=e)}},{key:"startDrawing",value:function(e,t,i){e=e||"rect",this.RTDrawInfo.type!=e&&("polygon"==this.RTDrawInfo.type&&this._finishPolygon(!0),this.RTDrawInfo.type=e,this.RTDrawInfo.status=u,this.RTDrawInfo.title=null,this.RTDrawInfo.titleStyle={}),t=c.Toolkit.deepMerge({lineWidth:"2px",lineColor:"#00F",fillOpacity:.1,opacity:.7,dasharray:""},t),this.RTDrawInfo.lineWidth=t.lineWidth,this.RTDrawInfo.lineColor=t.lineColor,this.RTDrawInfo.fillOpacity=t.fillOpacity,this.RTDrawInfo.opacity=t.opacity,this.RTDrawInfo.dasharray=t.dasharray,this.RTDrawInfo.arrow=parseInt(t.arrow)||0,this.RTDrawInfo.distance=parseInt(t.distance)||10,this.RTDrawInfo.arrow&&(this.RTDrawInfo.arrowpos=1,"doubleline"===e&&(this.RTDrawInfo.arrow=1)),"function"==typeof i&&(this._resultCB=i),this.drawSvg||this._initSvg(),this.drawSvgC.draggable=!1}},{key:"stopDrawing",value:function(e){this.drawSvgC&&(this.RTDrawInfo.status=u,this.RTDrawInfo.type="",this.drawSvgC.style.zIndex="auto",this.drawSvgC.draggable=!0,e&&this._deleteAllDrawing(),0==this.RTDrawResult.length&&this._removeDrawing())}},{key:"addDrawingObject",value:function(e,t){"function"==typeof t&&(this._resultCB=t);var i=this;e instanceof Array?e.forEach(function(e){i._addDrawingShape(e)}):this._addDrawingShape(e)}},{key:"getAllDrawingObject",value:function(){return c.Toolkit.deepMerge([],this.RTDrawResult)}},{key:"removeSelectDrawing",value:function(){this.drawSvgC&&this._hideAllGrapthPoint()}},{key:"finishDrawing",value:function(){this._finishPolygon(!0)}},{key:"_addDrawingShape",value:function(e){if(e&&("rect"==e.type||"polygon"==e.type||"line"==e.type||"doubleline"==e.type)&&(this.drawSvg||(this._initSvg(),this.drawSvgC.draggable=!0),this._hideAllGrapthPoint(),"polygon"!=e.type&&2==e.posinfo.length||"polygon"===e.type&&2<e.posinfo.length)){this.RTAdjustInfo.type=e.type,this.RTAdjustInfo.status=d,this.RTAdjustInfo.lineWidth=e.lineWidth?e.lineWidth:"1px",this.RTAdjustInfo.lineColor=e.lineColor?e.lineColor:"#00F",this.RTAdjustInfo.fillOpacity=e.fillOpacity?e.fillOpacity:0,this.RTAdjustInfo.title=e.title,this.RTAdjustInfo.titleStyle=e.titleStyle||{},this.RTAdjustInfo.dasharray=e.dasharray,this.RTAdjustInfo.arrow=parseInt(e.arrow)||0,this.RTAdjustInfo.distance=parseInt(e.distance)||10;var t=parseInt(e.arrowpos)||0;this.RTAdjustInfo.arrow&&(this.RTAdjustInfo.arrowpos=1===t?1:0,"doubleline"===e.type&&(this.RTAdjustInfo.arrow=1));var i=this.svgLastSize.width,r=this.svgLastSize.height,n=e.posinfo,a=[];e.postype&&1==e.postype&&(r=0<this._videoWidth&&0<this._videoHeight?(i=this.svgLastSize.width/this._videoWidth,this.svgLastSize.height/this._videoHeight):(i=this.svgLastSize.width/this._defVideoSize.w,this.svgLastSize.height/this._defVideoSize.h));for(var s=0,o=n.length;s<o;s++)a.push({x:Math.min(parseInt(n[s].x*i),this.svgLastSize.width),y:Math.min(parseInt(n[s].y*r),this.svgLastSize.height)});"rect"===e.type?(this.RTAdjustInfo.polygonArr=c.Toolkit.deepMerge([],a),this._createShape(this.RTAdjustInfo),e.min&&this.RTAdjustInfo.ele.setAttribute("minsize",JSON.stringify(e.min)),e.max&&this.RTAdjustInfo.ele.setAttribute("maxsize",JSON.stringify(e.max)),"string"==typeof e.id&&0<e.id.length&&this.RTAdjustInfo.ele.setAttribute("id",e.id),this._drawRect(this.RTAdjustInfo)):"doubleline"===e.type?(this.RTAdjustInfo.polygonArr=a,this._createShape(this.RTAdjustInfo),this._drawDoubleline(this.RTAdjustInfo)):(this.RTAdjustInfo.polygonArr=a,this._createShape(this.RTAdjustInfo),this._drawPolygonOrLine(this.RTAdjustInfo))}}},{key:"_removeDrawing",value:function(){this.drawSvg&&(this.drawSvgC.parentNode.removeChild(this.drawSvgC),this.drawSvgC=null,this.drawSvg=null)}},{key:"_deleteAllDrawing",value:function(){if(this.drawSvg){this.lastHoverShape=null,this.lastSelectShape=null,this.lastMouseStyle=null;for(var e=this.drawSvg,t=e.children;0<t.length;)e.removeChild(t[0]);this.RTDrawResult.splice(0,this.RTDrawResult.length),""==this.RTDrawInfo.type&&this._removeDrawing()}}},{key:"_createSVGEleTag",value:function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return this._setSvgAttr(i,t),i}},{key:"_setSvgAttr",value:function(e,t){try{for(var i in t)e.setAttribute(i,t[i])}catch(e){}}},{key:"_initSvg",value:function(){this.drawSvg||(this.drawSvgC=document.createElement("div"),this.drawSvgC.className="draw-svg-container",this.drawSvg=this._createSVGEleTag("svg",{xmlns:"http://www.w3.org/2000/svg",class:"draw-svg"}),this.setRTSVGPosition(this.svgLastSize),this.drawSvgC.appendChild(this.drawSvg),this._watermkC?c.Toolkit.insertAfter(this.drawSvgC,this._watermkC):this._drawVMCvsC?c.Toolkit.insertAfter(this.drawSvgC,this._drawVMCvsC):c.Toolkit.insertAfter(this.drawSvgC,this.vOpt.videoEle),this._bindSvgEvent())}},{key:"_modifySVGAllShapeXY",value:function(e,t){if(0!=e&&0!=t&&0!=this.svgLastSize.width&&0!=this.svgLastSize.height){for(var i=this.drawSvg,r=e/this.svgLastSize.width,n=t/this.svgLastSize.height,a=i.children,s=null,o=null,l=[],u="",h=0,d=a.length;h<d;h++)for(var c=0,f=(s=a[h]).children.length;c<f;c++)if("path"===(o=s.children[c]).nodeName){u=o.getAttribute("type");for(var p=0,v=(l=JSON.parse(o.getAttribute("pointArr"))).length;p<v;p++)l[p].x*=r,l[p].y*=n;o===this.RTDrawInfo.ele&&(this.RTDrawInfo.polygonArr=l);var m={type:u,arrow:o.getAttribute("arrow")-"0",arrowpos:o.getAttribute("arrowpos")-"0",distance:o.getAttribute("distance")-"0",ele:o,polygonArr:l};"polygon"===u||"line"===u?(this.RTDrawInfo.status===g&&o===this.RTDrawInfo.ele&&(m.status=g),this._drawPolygonOrLine(m)):"rect"===u?this._drawRect(m):"doubleline"===u&&this._drawDoubleline(m)}this.RTDrawResult.forEach(function(e){e._points=JSON.parse(e._ele.getAttribute("pointArr"))})}}},{key:"setRTSVGPosition",value:function(e){this.drawSvg&&(this.drawSvg.style.left=e.left+"px",this.drawSvg.style.top=e.top+"px",this.drawSvg.style.width=e.width+"px",this.drawSvg.style.height=e.height+"px",this._setSvgAttr(this.drawSvg,{width:e.width,height:e.height}),this._modifySVGAllShapeXY(e.width,e.height)),0==e.width||0==e.height||(this.svgLastSize=c.Toolkit.deepMerge({},e))}},{key:"_drawGraphPoint",value:function(e,t){var i=e.ele.closest("g").getElementsByClassName("rtd-point");if(i.length)for(var r=0,n=t.length;r<n;r++)this._setSvgAttr(i[r],{x:t[r].x-3,y:t[r].y-3});else for(var a=0,s=t.length;a<s;a++){var o=this._createSVGEleTag("rect",{style:"fill:"+e.lineColor+"; stroke-width: 6; stroke-opacity: 0; stroke:"+e.lineColor+";",class:"rtd-point",width:6,height:6,x:t[a].x-3,y:t[a].y-3});e.eleGroup.appendChild(o)}}},{key:"_drawLineArrow",value:function(e){1===e.arrow?this._drawLineArrow1(e):2===e.arrow?this._drawLineArrow2(e):(e.ele.setAttribute("arrow",0),e.ele.setAttribute("arrowpos",-1))}},{key:"_drawLineArrow1",value:function(e){var t=e.ele.closest("g").getElementsByClassName("rtd-arrow"),i=e.polygonArr,r=i[1],n=i[0],a=0===e.arrowpos?0:1,s=i[a],o=parseInt(Math.atan2(r.y-n.y,r.x-n.x)*(180/Math.PI))+90+(1==a?0:180);if(t.length){e.ele.setAttribute("arrowpos",a);for(var l=e.ele.getAttribute("xoffset")-"0",u=e.ele.getAttribute("yoffset")-"0",h=0,d=0,c=t.length;d<c;d++){1==(h=t[d]).getAttribute("index")-"0"?this._setSvgAttr(h,{x:s.x-20+l,y:s.y-20+u}):this._setSvgAttr(h,{x:s.x-20,y:s.y-20});for(var f=0,p=h.children.length;f<p;f++)this._setSvgAttr(h.children[f],{transform:"rotate("+o+" 0 0)"})}}else{e.ele.setAttribute("arrow",e.arrow),e.ele.setAttribute("arrowpos",e.arrowpos);var v=this._createSVGEleTag("svg",{xmlns:"http://www.w3.org/2000/svg",class:"rtd-arrow",x:s.x-20,y:s.y-20,width:60,height:60,viewBox:"-20 -20 60 60",fill:e.lineColor,"fill-opacity":e.fillOpacity,"stroke-width":e.lineWidth,stroke:e.lineColor,index:0}),m=this._createSVGEleTag("polygon",{points:"-10,20 0,0 10,20 0,0 -10,20",transform:"rotate("+o+",0,0)"});if(v.appendChild(m),e.eleGroup.appendChild(v),"doubleline"===e.type){var g=e.ele.getAttribute("xoffset")-"0",_=e.ele.getAttribute("yoffset")-"0",y=this._createSVGEleTag("svg",{xmlns:"http://www.w3.org/2000/svg",class:"rtd-arrow",x:s.x-20+g,y:s.y-20+_,width:60,height:60,viewBox:"-20 -20 60 60",fill:e.lineColor,"fill-opacity":e.fillOpacity,"stroke-width":e.lineWidth,stroke:e.lineColor,index:1}),b=this._createSVGEleTag("polygon",{points:"-10,20 0,0 10,20 0,0 -10,20",transform:"rotate("+o+",0,0)"});y.appendChild(b),e.eleGroup.appendChild(y)}}}},{key:"_drawLineArrow2",value:function(e){var t=e.ele.closest("g").getElementsByClassName("rtd-arrow"),i=e.polygonArr,r=i[1],n=i[0],a=e.arrowpos,s=parseInt(Math.atan2(r.y-n.y,r.x-n.x)*(180/Math.PI)),o=(n.x+r.x)/2,l=(n.y+r.y)/2;if(t.length){e.ele.setAttribute("arrowpos",a);for(var u=0,h=t.length;u<h;u++){var d=0,c=t[u];this._setSvgAttr(c,{x:o-40,y:l-40});for(var f=0,p=c.children.length;f<p;f++)d=c.children[f].getAttribute("index")-"0",this._setSvgAttr(c.children[f],{transform:"rotate("+s+" 0 0)",opacity:d==a||2==a?1:0})}}else{e.ele.setAttribute("arrow",e.arrow),e.ele.setAttribute("arrowpos",e.arrowpos),e.ele.setAttribute("lastarrowpos",1==e.arrowpos?0:1);var v=this._createSVGEleTag("svg",{xmlns:"http://www.w3.org/2000/svg",class:"rtd-arrow",x:o-40,y:l-40,width:80,height:80,viewBox:"-40 -40 80 80",fill:e.lineColor,"fill-opacity":e.fillOpacity,"stroke-width":e.lineWidth,stroke:e.lineColor}),m=this._createSVGEleTag("polygon",{points:"-10,-20 0,-30 10,-20 0,-30 0,-10, 0,-30 -10,-20",transform:"rotate("+s+",0,0)",opacity:0===a?0:1,index:1}),g=this._createSVGEleTag("polygon",{points:"-10,20 0,30 10,20 0,30 0,10, 0,30 -10,20",transform:"rotate("+s+",0,0)",opacity:1===a?0:1,index:0});v.appendChild(m),v.appendChild(g),e.eleGroup.appendChild(v)}}},{key:"_adjustLineArrow",value:function(){var t=this.RTAdjustInfo.arrowpos,e=this.RTAdjustInfo.type;if(1!=this.RTAdjustInfo.arrow||"line"!==e&&"doubleline"!==e){if(2==this.RTAdjustInfo.arrow&&"line"===e){var i=this.RTAdjustInfo.ele;if(0==t)t=2,i.setAttribute("lastarrowpos",0);else if(1==t)t=2,i.setAttribute("lastarrowpos",1);else if(2==t){var r=i.getAttribute("lastarrowpos")-"0";t=1==r?0:1,this.lastMouseStyle.index!=t&&(this.lastMouseStyle.mouse="crosshair",this._addSVGMouseStyle(this.drawSvg,"crosshair"))}}}else t=1===t?0:1,this.lastMouseStyle.mouse="crosshair",this._addSVGMouseStyle(this.drawSvg,"crosshair");this.RTAdjustInfo.arrowpos=t,this._drawLineArrow(this.RTAdjustInfo);var n=this.RTAdjustInfo.ele.getAttribute("id"),a={arrowpos:t};this.RTDrawResult.every(function(e){return n!==e.id||(e.arrowpos=t,e=c.Toolkit.deepMerge(a,e),!1)}),this._resultCB&&this._resultCB(c.Toolkit.deepMerge({index:this.vOpt.index},a)),this._emitter.emit(l.default.OnDrawingObject,c.Toolkit.deepMerge({index:this.vOpt.index},a))}},{key:"_drawPolygonOrLine",value:function(e){for(var t=e.type,i=this.svgLastSize.width,r=this.svgLastSize.height,n=e.polygonArr,a="",s=[],o=0,l=n.length;o<l;o++)a+=n[o].x+","+n[o].y+" ",s.push({x:n[o].x/i,y:n[o].y/r});a="M "+a,"polygon"===t&&e.status!=g?(a+=" Z",this._drawGraphPoint(e,n)):"polygon"!=t&&this._drawGraphPoint(e,n),"line"===t&&this._drawLineArrow(e),this._setSvgAttr(e.ele,{d:a,pointArr:JSON.stringify(n),type:t}),this._changeTextPos(e.ele,[{x:n[0].x,y:n[0].y}]),this._emitEvent(e,s,n)}},{key:"_emitEvent",value:function(e,t,i){if(e.status===d){var r=e.ele.getAttribute("id");r||(r=c.Toolkit.getUuid(),this._setSvgAttr(e.ele,{id:r})),this._setSvgAttr(e.ele,{id:r});var n={id:r,type:e.type,status:e.status,lineColor:e.lineColor,lineWidth:e.lineWidth,opacity:e.opacity,fillOpacity:e.fillOpacity,videoWidth:this._videoWidth,videoHeight:this._videoHeight,title:e.title,posinfo:t,arrow:e.arrow,arrowpos:e.arrowpos,min:JSON.parse(e.ele.getAttribute("minsize")),max:JSON.parse(e.ele.getAttribute("maxsize")),_ele:e.ele,_points:i};this.RTDrawResult.push(n),this.lastSelectShape={id:r,lineWidth:e.lineWidth,_ele:e.ele},this._resultCB&&this._resultCB(c.Toolkit.deepMerge({index:this.vOpt.index},n)),this._emitter.emit(l.default.OnDrawingObject,c.Toolkit.deepMerge({index:this.vOpt.index},n))}else if(e.status===_||e.status===m){var a=e.ele.getAttribute("id"),s={status:e.status,arrowpos:e.arrowpos,posinfo:t,_points:i};this.RTDrawResult.every(function(e){return a!==e.id||(e=c.Toolkit.deepMerge(e,s),s=c.Toolkit.deepMerge(s,e),!1)}),this._resultCB&&this._resultCB(c.Toolkit.deepMerge({index:this.vOpt.index},s)),this._emitter.emit(l.default.OnDrawingObject,c.Toolkit.deepMerge({index:this.vOpt.index},s))}}},{key:"_drawDoubleline",value:function(e){for(var t=e.type,i=this.svgLastSize.width,r=this.svgLastSize.height,n=c.Toolkit.deepMerge([],e.polygonArr),a=c.Toolkit.getLinePoint(n,e.distance),s="",o=[],l=0,u=n.length;l<u;l++)s+=n[l].x+","+n[l].y+" ",o.push({x:n[l].x/i,y:n[l].y/r});s="M "+s+" M";for(var h=0,d=a.length;h<d;h++)s+=a[h].x+","+a[h].y+" ";this._setSvgAttr(e.ele,{d:s,pointArr:JSON.stringify(n),type:t,distance:e.distance,xoffset:a[0].x-n[0].x,yoffset:a[0].y-n[0].y}),a.push.apply(a,n),this._drawGraphPoint(e,a),this._drawLineArrow(e),this._changeTextPos(e.ele,[{x:n[0].x,y:n[0].y}]),this._emitEvent(e,o,n)}},{key:"_changeTextPos",value:function(e,t){var i=e.closest("g").getElementsByTagName("text");if(i&&i.length){var r=parseInt(i[0].style.fontSize),n=i[0].getAttribute("text"),a={x:t[0].x,y:t[0].y},s={};1<t.length&&(t[0].x>t[1].x?(a.x=t[1].x,s.w=t[0].x-t[1].x):(a.x=t[0].x,s.w=t[1].x-t[0].x),t[0].y>t[1].y?(a.y=t[1].y,s.h=t[0].y-t[1].y):(a.y=t[0].y,s.h=t[1].y-t[0].y),s.w+7>=this.svgLastSize.width?s.w=this._videoWidth:s.w=s.w*this._videoWidth/this.svgLastSize.width,s.h+7>=this.svgLastSize.height?s.h=this._videoHeight:s.h=s.h*this._videoHeight/this.svgLastSize.height),this._setSvgAttr(i[0],{x0:a.x,y0:a.y}),a.x=a.x+2,a.y>r+2?a.y=a.y-3:a.y=a.y+r+3,this._setSvgAttr(i[0],{x:a.x,y:a.y}),n&&1<t.length&&(i[0].innerHTML=n+"("+Math.round(s.w)+"X"+Math.round(s.h)+")")}}},{key:"_drawRect",value:function(e){var t=this.svgLastSize.width,i=this.svgLastSize.height,r=e.polygonArr,n=r[0].x,a=r[0].y,s=r[1].x,o=r[1].y,l=[{x:n/t,y:a/i},{x:s/t,y:o/i}],u=[{x:n,y:a},{x:n,y:o},{x:s,y:o},{x:s,y:a},{x:(n+s)/2,y:a},{x:n,y:(a+o)/2},{x:(n+s)/2,y:o},{x:s,y:(a+o)/2}];this._setSvgAttr(e.ele,{d:"M "+n+","+a+" "+n+","+o+" "+s+","+o+" "+s+","+a+" Z",pointArr:JSON.stringify(r),type:"rect"}),this._drawGraphPoint(e,u),this._changeTextPos(e.ele,[{x:n,y:a},{x:s,y:o}]),this._emitEvent(e,l,r)}},{key:"_createShape",value:function(e){if(e.ele=this._createSVGEleTag("path",{style:" fill:"+e.lineColor+"; fill-opacity:"+e.fillOpacity+"; stroke-width: "+e.lineWidth+"; stroke: "+e.lineColor+"; stroke-opacity: "+e.opacity+"; stroke-dasharray: "+e.dasharray}),e.eleGroup=this._createSVGEleTag("g"),e.eleGroup.appendChild(e.ele),this.drawSvg.appendChild(e.eleGroup),e.title){var t=c.Toolkit.deepMerge({fontSize:"15px",color:e.lineColor,fontWeight:"normal"},e.titleStyle),i=this._createSVGEleTag("text",{x:0,y:0,fill:t.color,text:e.title,style:"font-size: "+t.fontSize+"; font-weight: "+t.fontWeight});i.innerHTML=e.title,e.eleGroup.appendChild(i)}}},{key:"_adjustRect",value:function(e,t){var i=this.RTAdjustInfo.polygonArr,r=this.RTAdjustInfo.direction,n=this.RTAdjustInfo.move,a=0<this._videoWidth?this._videoWidth:this._defVideoSize.w,s=0<this._videoHeight?this._videoHeight:this._defVideoSize.h,o=this.svgLastSize.width,l=this.svgLastSize.height,u=JSON.parse(this.RTAdjustInfo.ele.getAttribute("minsize")),h=JSON.parse(this.RTAdjustInfo.ele.getAttribute("maxsize")),d=i[this.RTAdjustInfo.adjustIndex],c=i[0==this.RTAdjustInfo.adjustIndex?1:0];if(this.RTAdjustInfo.status!=_)if("x"===r&&e!=n.x)d.x=d.x+e-n.x;else if("y"===r&&t!=n.y)d.y=d.y+t-n.y;else{if("xy"!==r||e==n.x&&t==n.y)return;d.x=d.x+e-n.x,d.y=d.y+t-n.y}if(u&&0<u.x||h&&0<h.x)if(d.x>c.x){var f=(d.x-c.x)*a/o;u&&0<u.x&&f<u.x?d.x=c.x+u.x*o/a:h&&0<h.x&&f>h.x&&(d.x=c.x+h.x*o/a)}else{var p=(c.x-d.x)*a/o;u&&0<u.x&&p<u.x?d.x=c.x-u.x*o/a:h&&0<h.x&&p>h.x&&(d.x=c.x-h.x*o/a)}if(u&&0<u.y||h&&0<h.y)if(d.y>c.y){var v=(d.y-c.y)*s/l;u&&0<u.y&&v<u.y?d.y=c.y+u.y*l/s:h&&0<h.y&&v>h.y&&(d.y=c.y+h.y*l/s)}else{var m=(c.y-d.y)*s/l;u&&0<u.y&&m<u.y?d.y=c.y-u.y*l/s:h&&0<h.y&&m>h.y&&(d.y=c.y-h.y*l/s)}d.x>o?d.x=o:d.x<0&&(d.x=0),d.y>l?d.y=l:d.y<0&&(d.y=0),this.RTAdjustInfo.move={x:e,y:t},this._drawRect(this.RTAdjustInfo)}},{key:"_adjustPolygonOrLine",value:function(e,t){var i=this.RTAdjustInfo.type,r=this.RTAdjustInfo.polygonArr,n=this.RTAdjustInfo.adjustIndex,a=this.RTAdjustInfo.move,s=this.svgLastSize.width,o=this.svgLastSize.height;e==a.x&&t==a.y&&this.RTAdjustInfo.status!=_||(r[n].x=r[n].x+e-a.x,r[n].y=r[n].y+t-a.y,r[n].x>s?r[n].x=s:r[n].x<0&&(r[n].x=0),r[n].y>o?r[n].y=o:r[n].y<0&&(r[n].y=0),this.RTAdjustInfo.move={x:e,y:t},"polygon"===i||"line"===i?this._drawPolygonOrLine(this.RTAdjustInfo):"doubleline"===i&&this._drawDoubleline(this.RTAdjustInfo))}},{key:"_calMoveGapobj",value:function(e,t,i,r){var n,a,s,o,l,u,h=i-e.move.x,d=r-e.move.y,c=this.svgLastSize.width,f=this.svgLastSize.height;return l=t.map(function(e){return e.x}),n=Math.max.apply(null,l),s=Math.min.apply(null,l),u=t.map(function(e){return e.y}),a=Math.max.apply(null,u),o=Math.min.apply(null,u),c<n+h?h=c-n:s+h<0&&(h=0-s),f<a+d?d=f-a:o+d<0&&(d=0-o),{xGap:h,yGap:d}}},{key:"_moveShape",value:function(e,t){for(var i=this.RTAdjustInfo.type,r=this.RTAdjustInfo.ele,n=JSON.parse(r.getAttribute("pointArr")),a=this._calMoveGapobj(this.RTAdjustInfo,n,e,t),s=a.xGap,o=a.yGap,l=0,u=n.length;l<u;l++)n[l].x+=s,n[l].y+=o;this.RTAdjustInfo.polygonArr=n,"polygon"===i||"line"===i?this._drawPolygonOrLine(this.RTAdjustInfo):"rect"===i?this._drawRect(this.RTAdjustInfo):"doubleline"===i&&this._drawDoubleline(this.RTAdjustInfo),this.RTAdjustInfo.move.x=e,this.RTAdjustInfo.move.y=t}},{key:"_addSVGMouseStyle",value:function(e,t){e.style.cursor=t}},{key:"_onSvgMouseUp",value:function(e){var t=e||window.event,i=t.offsetX,r=t.offsetY;i<0?i=0:i>this.svgLastSize.width&&(i=this.svgLastSize.width),r<0?r=0:r>this.svgLastSize.height&&(r=this.svgLastSize.height);var n=this.RTDrawInfo.type;if(this.RTDrawInfo.status!==h){if(this.RTDrawInfo.status!==g){if(""===n&&(this.drawSvgC.draggable=!0),n=this.RTAdjustInfo.type,this.RTAdjustInfo.status===p)return this.RTAdjustInfo.status=_,void("rect"===n?this._adjustRect(i,r):"polygon"!==n&&"line"!==n&&"doubleline"!==n||this._adjustPolygonOrLine(i,r));if(this.RTAdjustInfo.status!==f)return this.RTAdjustInfo.status===v?(this.RTAdjustInfo.status=m,void this._moveShape(i,r)):void 0;this.RTAdjustInfo.status=d}else if("rect"===n||"line"===n||"doubleline"===n){var a=this.RTDrawInfo.polygonArr,s=a[0].x-i,o=a[0].y-r;5<s||s<-5||5<o||o<-5?(a[1].x=i,a[1].y=r,this.RTDrawInfo.status=d,"rect"===n?this._drawRect(this.RTDrawInfo):"line"===n?this._drawPolygonOrLine(this.RTDrawInfo):this._drawDoubleline(this.RTDrawInfo)):(this.RTDrawInfo.eleGroup&&this.drawSvg.removeChild(this.RTDrawInfo.eleGroup),this.RTDrawInfo.status=u),this.RTDrawInfo.eleGroup=null}}else"rect"!==n&&"line"!==n&&"doubleline"!==n||(this.RTDrawInfo.status=u,this.RTDrawInfo.eleGroup&&this.drawSvg.removeChild(this.RTDrawInfo.eleGroup),this.RTDrawInfo.status=u,this.RTDrawInfo.eleGroup=null)}},{key:"_getAdjustShapePoint",value:function(){var e=this.RTAdjustInfo.ele.closest("g").getElementsByTagName("path")[0],t=JSON.parse(e.getAttribute("pointArr"));if("rect"===this.RTAdjustInfo.type){var i=t[0].x,r=t[0].y,n=t[1].x,a=t[1].y,s=this.lastMouseStyle.index;(0===s||3===s)&&i<n?(t[0].x=n,t[1].x=i):(1===s||2===s)&&n<i&&(t[0].x=n,t[1].x=i),(0===s||1===s)&&r<a?(t[0].y=a,t[1].y=r):(2===s||3===s)&&a<r&&(t[0].y=a,t[1].y=r),this.lastMouseStyle.index=1}this.RTAdjustInfo.polygonArr=t,this.RTAdjustInfo.adjustIndex=this.lastMouseStyle.index,this.RTAdjustInfo.direction=this.lastMouseStyle.direction}},{key:"_checkAdjustShape",value:function(e){if(this.lastHoverShape){var t=this.lastHoverShape._ele;return this._showCurShapePoint(this.lastHoverShape),this.RTAdjustInfo.type=t.getAttribute("type"),this.RTAdjustInfo.arrow=t.getAttribute("arrow")-"0",this.RTAdjustInfo.arrowpos=t.getAttribute("arrowpos")-"0",this.RTAdjustInfo.distance=t.getAttribute("distance")-"0",this.RTAdjustInfo.ele=t,this.lastMouseStyle&&("move"!=this.lastMouseStyle.mouse?(this._getAdjustShapePoint(this.lastHoverShape),"pointer"===this.lastMouseStyle.mouse?(this.RTAdjustInfo.status=_,this._adjustLineArrow()):this.RTAdjustInfo.status=f):this.RTAdjustInfo.status=v),this.RTAdjustInfo.move.x=e.offsetX,this.RTAdjustInfo.move.y=e.offsetY,!0}return!1}},{key:"_finishPolygon",value:function(e,t,i){if("polygon"===this.RTDrawInfo.type&&(this.RTDrawInfo.status==h||this.RTDrawInfo.status==g)){if(this.RTDrawInfo.status=d,this.RTDrawInfo.pointCount=0,e)return this.RTDrawInfo.eleGroup&&this.drawSvg.removeChild(this.RTDrawInfo.eleGroup),!(this.RTDrawInfo.eleGroup=null);var r=this.RTDrawInfo.polygonArr.pop();if(r.x=t,r.y=i,this.RTDrawInfo.polygonArr.push(r),this.RTDrawInfo.polygonArr.length=this.RTDrawInfo.polygonArr.length-2,2<this.RTDrawInfo.polygonArr.length)return this._drawPolygonOrLine(this.RTDrawInfo),!0;if(this.RTDrawInfo.eleGroup&&this.drawSvg.removeChild(this.RTDrawInfo.eleGroup),this.RTDrawInfo.eleGroup=null,2==this.RTDrawInfo.polygonArr.length){var n=this.RTDrawInfo.polygonArr,a=n[0].x-n[1].x,s=n[0].y-n[1].y;if(5<a||a<-5||5<s||s<-5)return!0}}return!1}},{key:"_bindSvgEvent",value:function(){var u=this;s.EventUtil.addHandler(this.drawSvg,"click",function(e){e.stopPropagation(),u._emitter.emit(l.default.OnWndClick,u.vOpt.index)}),s.EventUtil.addHandler(this.drawSvg,"mousedown",function(e){e.stopPropagation(),u._emitter.emit(l.default.OnMouseDown,u.vOpt.index,"drawsvg");var t=e||window.event;if(0===t.button){var i=t.offsetX,r=t.offsetY;if(u.RTDrawInfo.status!=h&&u.RTDrawInfo.status!=g){if(u._checkHoverShape(t,!0),u._checkAdjustShape(t))return void(u.drawSvgC.draggable=!1);""===u.RTDrawInfo.type&&(u.drawSvgC.draggable=!0)}u._hideAllGrapthPoint();var n=u.RTDrawInfo.type;"rect"===n||"line"===n||"doubleline"===n?(u.RTDrawInfo.status=h,u._createShape(u.RTDrawInfo),u.RTDrawInfo.polygonArr=[{x:i,y:r},{x:i,y:r}]):"polygon"===n&&(0===u.RTDrawInfo.pointCount&&(u.RTDrawInfo.status=h,u._createShape(u.RTDrawInfo),u.RTDrawInfo.polygonArr=[{x:i,y:r}]),u.RTDrawInfo.pointCount++,u.RTDrawInfo.polygonArr.push({x:i,y:r}))}else u._finishPolygon(!0)}),s.EventUtil.addHandler(this.drawSvg,"mousemove",function(e){e.stopPropagation();var t=e||window.event,i=t.offsetX,r=t.offsetY,n=u.RTDrawInfo.type;if(u.RTDrawInfo.status!==h&&u.RTDrawInfo.status!==g){if(n=u.RTAdjustInfo.type,u.RTAdjustInfo.status===f||u.RTAdjustInfo.status===p)return u.RTAdjustInfo.status=p,void("rect"===n?u._adjustRect(i,r):"polygon"!==n&&"line"!==n&&"doubleline"!==n||u._adjustPolygonOrLine(i,r));u.RTAdjustInfo.status!==v?u._checkHoverShape(t):u._moveShape(i,r)}else if(u.RTDrawInfo.status=g,"rect"===n||"line"===n||"doubleline"===n){var a=u.RTDrawInfo.polygonArr,s=a[0].x-i,o=a[0].y-r;(5<s||s<-5||5<o||o<-5)&&(a[1].x=i,a[1].y=r,"rect"===n?u._drawRect(u.RTDrawInfo):"line"===n?u._drawPolygonOrLine(u.RTDrawInfo):"doubleline"===n&&u._drawDoubleline(u.RTDrawInfo))}else if("polygon"===n){var l=u.RTDrawInfo.polygonArr.pop();l.x=i,l.y=r,u.RTDrawInfo.polygonArr.push(l),u._drawPolygonOrLine(u.RTDrawInfo)}}),s.EventUtil.addHandler(this.drawSvg,"mouseleave",function(e){u.lastHoverShape&&(u.lastHoverShape._ele.style.strokeWidth=u.lastHoverShape.lineWidth,u.lastHoverShape=null),u._onSvgMouseUp(e)}),s.EventUtil.addHandler(this.drawSvg,"mouseup",function(e){u._onSvgMouseUp(e)}),s.EventUtil.addHandler(this.drawSvg,"dblclick",function(e){e.stopPropagation();var t=e||window.event,i=t.offsetX,r=t.offsetY;u._finishPolygon(!1,i,r)||u._emitter.emit(l.default.OnWndDClik,u.vOpt.index)})}},{key:"_showCurShapePoint",value:function(e){this.lastSelectShape&&this.lastSelectShape.id!=e.id&&this._hideHoverGrapthPoint();for(var t=e._ele.closest("g").getElementsByClassName("rtd-point"),i=0,r=t.length;i<r;i++)t[i].style.opacity=1;this.lastSelectShape={id:e.id,lineWidth:e.lineWidth,_ele:e._ele}}},{key:"_hideHoverGrapthPoint",value:function(){if(this.lastSelectShape){for(var e=this.lastSelectShape._ele.closest("g").getElementsByClassName("rtd-point"),t=0,i=e.length;t<i;t++)e[t].style.opacity=0;this.lastSelectShape=null,this._emitter.emit(l.default.OnDrawingObject,{index:this.vOpt.index})}}},{key:"_hideAllGrapthPoint",value:function(){for(var e=this.drawSvgC.getElementsByClassName("rtd-point"),t=0,i=e.length;t<i;t++)e[t].style.opacity=0;this.lastSelectShape=null}},{key:"_checkHoverShape",value:function(e,t){if(!(!t&&0!=e.buttons||this.svgLastSize.width<=0||this.svgLastSize.height<=0)){var r=null,n={x:e.offsetX,y:e.offsetY},a=-1,s={},o=this;if(this.RTDrawResult.every(function(e){var t={direction:"",mouse:"move",index:0};if("rect"===e.type&&c.Toolkit.isPointInRect(n,e._points,t)||"polygon"===e.type&&c.Toolkit.isPointInPolygon(n,e._points,t)||"line"===e.type&&c.Toolkit.isPointInLine(n,e._points,t,e.arrowpos,e.arrow)||"doubleline"===e.type&&c.Toolkit.isPointInDoubleline(n,e._points,t,e.arrowpos,e.arrow,e._ele.getAttribute("xoffset"),e._ele.getAttribute("yoffset"))){if(o.lastSelectShape&&o.lastSelectShape.id==e.id&&"move"!=t.mouse)return r=e,s=c.Toolkit.deepMerge({},t),!1;var i=c.Toolkit.getShapeDistance(n,e._points);(a<0||i<a)&&(r=e,a=i,s=c.Toolkit.deepMerge({},t))}return!0}),r?this.lastSelectShape&&r&&this.lastSelectShape.id==r.id||(s.mouse="move"):s.mouse=""!=this.RTDrawInfo.type?"crosshair":"Default",this.lastMouseStyle=s,this._addSVGMouseStyle(this.drawSvg,s.mouse),this.lastHoverShape!=r||this.lastHoverShape&&r&&this.lastHoverShape.id!=r.id)if(this.lastHoverShape&&(this.lastHoverShape._ele.style.strokeWidth=this.lastHoverShape.lineWidth),r){var i=parseInt(r.lineWidth)+1;r._ele.style.strokeWidth=i+"px",this.lastHoverShape={id:r.id,lineWidth:r.lineWidth,_ele:r._ele}}else this.lastHoverShape=null}}}]),b);function b(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b)}t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(330),o=(i(329),i(391)),l=(a=o)&&a.__esModule?a:{default:a};var u="h5vp-time",h=[u+"-bg-axis",u+"-bg-axis6",u+"-bg-axis5",u+"-bg-axis2",u+"-bg-axis3",u+"-bg-axis4",u+"-bg-axis3",u+"-bg-axis2",u+"-bg-axis4",u+"-bg-axis5",u+"-bg-axis2",u+"-bg-axis3"],_=[10,60,300,600,1800,3600,10800,21600,86400,432e3,2592e3,90.4*24*3600],d=(r(c,[{key:"initializer",value:function(){this._timeAxisBox=null,this._timeAxisTranslate=null,this._subLabelBox=null,this._axisBtn=null,this._isDragTimeAxis=!1,this._offsetXTimeAxis=0,this._isDragAxisBtn=!1,this._offsetYAxisBtn=0,this._isClickAxisBtn=!0,this._dragStartTime=0,this._defaultLevel=0,this._curremtLevel=0,this._axisLabelContainer=null,this._topTimeLabel=null,this._startTime=0,this._endTime=0,this._rcdtimershaft=null,this._updateTimeAxisChecker=null,this._topAxisPos=0,this._topAxisOffset=0,this._thumbPos=.5}},{key:"resetVariays",value:function(){this._axisBtn=null,this._isDragTimeAxis=!1,this._offsetXTimeAxis=0,this._dragStartTime=0,this._isDragAxisBtn=!1,this._offsetYAxisBtn=0,this._isClickAxisBtn=!0,this._defaultLevel=0,this._curremtLevel=0,this._topTimeLabel=null,this._startTime=0,this._endTime=0,this._rcdtimershaft=null,this._topAxisPos=0,this._topAxisOffset=0,this._thumbPos=.5}},{key:"isShowTimeAxis",value:function(){return!!this._timeAxisBox}},{key:"showTimeAxis",value:function(e){this.resetVariays(),this.closeTimeAxis(),this._rcdtimershaft=e||this.vOpt.rcdtimershaft,this._defaultLevel=this._rcdtimershaft.level||0;var t=this.getVideoRange();t||((t={}).begintime=(new Date).getTime(),t.endtime=t.begintime,this._updateTimeAxisChecker=window.setInterval(this._updateHistoryTimeAxis.bind(this),1e3));var i=t.begintime,r=t.endtime;this._startTime=i,this._endTime=r,this._createTimeAxis(i)}},{key:"updateTimeAxis",value:function(){this._topAxisOffset=this._timeAxisBox.offsetWidth*this._thumbPos-this._topAxisPos,this._updateHistoryTimeAxis(new Date(this._topTimeLabel.innerText).getTime()),this._controlAxisPositon(),this._resizeDeviceName()}},{key:"_createTimeAxis",value:function(e){this._timeAxisBox=document.createElement("div"),this._timeAxisBox.className=u+"-axis",this._timeAxisBox.style.background=this._rcdtimershaft.backcolor,this.vOpt.fatherEle.firstElementChild.appendChild(this._timeAxisBox),this._axisLabelContainer=document.createElement("div"),this._axisLabelContainer.className=u+"-axis-label-container",this._axisLabelContainer.classList.add(""+h[this._defaultLevel]),this._timeAxisBox.appendChild(this._axisLabelContainer);var t=document.createElement("span"),i=document.createElement("p");this._topTimeLabel=i,t.className=u+"-top-axis",this._thumbPos=parseInt(this._rcdtimershaft.thumbpos)/100,t.style.left=parseInt(this._rcdtimershaft.thumbpos)+"%",t.style.background=this._rcdtimershaft.thumbcolor,this._timeAxisBox.appendChild(t);var r=document.createElement("span");r.className=u+"-title",r.style.color=this._rcdtimershaft.captioncolor,r.innerText=this.isVodPlay()?this._videoTitle:"",this._timeAxisBox.appendChild(r),i.innerText="",i.className=u+"-center-label",i.style.left=100*this._thumbPos-50+"%",i.style.color=this._rcdtimershaft.curtimecolor,this._timeAxisBox.appendChild(i),this._axisBtn=document.createElement("div"),this._axisBtn.className=u+"-axis-expand-botton",this._axisBtn.setAttribute("title","按住鼠标拖动"),this._axisBtn.style.background=this._rcdtimershaft.backcolor,this._timeAxisBox.appendChild(this._axisBtn),this._controlAxisPositon(),this._resizeDeviceName();var n=this.getPlayPts();this._timeAxisUpdate(n<e?e:n),this._addEventFn()}},{key:"_controlAxisPositon",value:function(){switch(this.vOpt.fatherEle.firstElementChild.style.height="100%",this._rcdtimershaft.curPositon){case"top":this._timeAxisBox.style.bottom=this.vOpt.fatherEle.firstElementChild.offsetHeight-this._timeAxisBox.offsetHeight+"px",this._timeAxisBox.setAttribute("offset-y",-(this.vOpt.fatherEle.firstElementChild.offsetHeight-this._timeAxisBox.offsetHeight));break;case"bottom":this._timeAxisBox.style.bottom="0px",this._timeAxisBox.setAttribute("offset-y",0);break;case"fix":this.vOpt.fatherEle.firstElementChild.style.height=this.vOpt.fatherEle.firstElementChild.offsetHeight-this._timeAxisBox.offsetHeight+"px",this._timeAxisBox.style.bottom=-this._timeAxisBox.offsetHeight+"px",this._axisBtn&&(this._axisBtn.style.opacity="0");break;default:this._rcdtimershaft.curPositon>=this.vOpt.fatherEle.firstElementChild.offsetHeight-this._timeAxisBox.offsetHeight&&(this._rcdtimershaft.curPositon=this.vOpt.fatherEle.firstElementChild.offsetHeight-this._timeAxisBox.offsetHeight),this._timeAxisBox.style.bottom=1*this._rcdtimershaft.curPositon+"px",this._timeAxisBox.setAttribute("offset-y",1*-this._rcdtimershaft.curPositon)}}},{key:"_timeAxisUpdate",value:function(e){var t=this._timeAxisBox.offsetWidth*this._thumbPos,i=this._timeAxisBox.offsetWidth-t,r=this._getScaleArray(e,this._defaultLevel,t,i,this._startTime);this._subLabelBox?this._updateBottomTime(r):this._createBottomTime(r),this._timeAxisTranslate?this._updateTopTimeAxis(r):this._createTopTimeAxis(r),this._updateCurrentTime(e)}},{key:"_resizeDeviceName",value:function(){var e=this._timeAxisBox.querySelectorAll("."+u+"-title")[0];e.offsetWidth>=this._timeAxisBox.offsetWidth*this._thumbPos-100?e.style.opacity="0":e.style.opacity="1"}},{key:"_updateTopTimeAxis",value:function(e){this._timeAxisTranslate.style.marginLeft=this._topAxisOffset+e.offsetbg+"px",this._axisLabelContainer.style.backgroundPositionX=e.offset+this._timeAxisBox.offsetWidth*this._thumbPos%150+"px"}},{key:"_updateCurrentTime",value:function(e){this._topTimeLabel.innerText=new Date(e).format("yyyy-MM-dd hh:mm:ss")}},{key:"_createBottomTime",value:function(e){var t=document.createElement("div"),i=e.arr;t.className=u+"-sublabel-container",this._subLabelBox=t;for(var r=0;r<i.length;r++){var n=document.createElement("span");n.className=u+"-line-axis-label",n.style.width="100px",n.style.left=this._timeAxisBox.offsetWidth*this._thumbPos+i[r].pos-50+"px",n.innerText=i[r].time,t.appendChild(n)}this._timeAxisBox.appendChild(t)}},{key:"_updateBottomTime",value:function(e){try{var t=e.arr,i=this._timeAxisBox.querySelectorAll("."+u+"-line-axis-label");if(i.length>t.length)for(var r=0;r<i.length-t.length;r++)this._subLabelBox.removeChild(i[t.length]);for(var n=0;n<t.length;n++){var a=i[n];if(a)a.style.left=this._timeAxisBox.offsetWidth*this._thumbPos+t[n].pos-50+"px",a.innerText=t[n].time;else{var s=document.createElement("span");s.className=u+"-line-axis-label",s.style.width="100px",s.style.left=this._timeAxisBox.offsetWidth*this._thumbPos+t[n].pos-50+"px",s.innerText=t[n].time,this._subLabelBox.appendChild(s)}}}catch(e){}}},{key:"_createTopTimeAxis",value:function(e){var t=this._timeAxisBox.offsetWidth;this._axisLabelContainer&&(this._axisLabelContainer.style.backgroundPositionX=e.offset+t*this._thumbPos%150+"px"),this._startTime,this._timeAxisTranslate=document.createElement("div"),this._timeAxisTranslate.style.height="25px",this._timeAxisTranslate.style.marginTop="18px",this._timeAxisTranslate.style.backgroundColor=this._rcdtimershaft.novodcolor,this._timeAxisTranslate.className=u+"-translate-box",this._timeAxisTranslate.style.left=t*this._thumbPos+"px",this._timeAxisTranslate.style.width=Math.ceil(15*(this._endTime-this._startTime)/1e3)/(_[this._defaultLevel]/10)+"px",this._timeAxisTranslate.setAttribute("origin-width",Math.ceil(15*(this._endTime-this._startTime)/1e3)),this._timeAxisBox.insertBefore(this._timeAxisTranslate,this._axisLabelContainer),this._createVideoListDiv(this.getRecordList()),this._topAxisPos=t*this._thumbPos,this._topAxisOffset=0,this._timeAxisTranslate.style.marginLeft=e.offsetbg+"px"}},{key:"_createVideoListDiv",value:function(e){for(var t=this._timeAxisTranslate;t.hasChildNodes();)t.removeChild(t.firstChild);for(var i=this._startTime,r=_[this._defaultLevel]/10,n=0;e&&n<e.length;n++){var a,s,o=document.createElement("div");o.className=u+"-block "+u+"-hasvod",o.style.background=this._rcdtimershaft.vodcolor,a=15*(e[n][1]-e[n][0])/1e3,o.style.width=a/r+"px",s=15*(e[n][0]-i)/1e3,o.style.left=s/r+"px",o.setAttribute("origin-width",a),o.setAttribute("origin-left",s),this._timeAxisTranslate.appendChild(o)}}},{key:"_topBackgroundUpdate",value:function(e){if(this._defaultLevel=this._defaultLevel-e,this._defaultLevel<0)this._defaultLevel=0;else if(this._defaultLevel>h.length-1)this._defaultLevel=h.length-1;else{this._emitter.emit(l.default.OnTimeaxisLevel,this.vOpt.index,this._defaultLevel);for(var t=_[this._defaultLevel]/10,i=document.querySelectorAll("."+u+"-block"),r=0;r<i.length;r++){var n=i[r],a=n.getAttribute("origin-width")/t,s=n.getAttribute("origin-left")/t;n.style.width=a+"px",n.style.left=s+"px"}this._timeAxisTranslate&&(this._timeAxisTranslate.style.width=this._timeAxisTranslate.getAttribute("origin-width")/t+"px"),this._axisLabelContainer.classList.remove(this._axisLabelContainer.classList[1]),this._axisLabelContainer.classList.add(""+h[this._defaultLevel]),this._timeAxisUpdate(new Date(this._topTimeLabel.innerText).getTime())}}},{key:"_addEventFn",value:function(){var n=this;s.EventUtil.addHandler(this._axisLabelContainer,"contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),!1}),s.EventUtil.addHandler(this._axisLabelContainer,"mousedown",function(e){e.preventDefault(),e.stopPropagation();var t=e||window.event;n._isDragTimeAxis=!0,n._offsetXTimeAxis=t.clientX,n._dragStartTime=new Date(n._topTimeLabel.innerText).getTime(),t.clientX,s.EventUtil.addHandler(document,"mousemove",function(e){if(n._isDragTimeAxis){e.stopPropagation(),e.preventDefault();var t=(e||window.event).clientX-n._offsetXTimeAxis;t<2&&-2<t||n._timeAxisUpdate(n._dragStartTime-1e3*_[n._defaultLevel]*t/150)}}),s.EventUtil.addHandler(document,"mouseup",function(e){if(n._isDragTimeAxis){e.stopPropagation(),e.preventDefault();var t=e||window.event;n._isDragTimeAxis=!1;var i=t.clientX-n._offsetXTimeAxis;if(!(i<2&&-2<i)){var r=new Date(n._topTimeLabel.innerText).getTime();2e3<Math.abs(r-n._dragStartTime)&&n.setPlayPts(r)}}})}),s.EventUtil.addHandler(this._axisLabelContainer,"mousewheel",function(e){(e=e||window.event).stopPropagation(),e.preventDefault();var t=e.wheelDelta&&(0<e.wheelDelta?1:-1);n._topBackgroundUpdate(t)}),s.EventUtil.addHandler(this._axisBtn,"mousedown",function(e){(e=e||window.event).preventDefault(),e.stopPropagation(),n._isClickAxisBtn=!0,"fix"!=n._rcdtimershaft.curPositon&&(n._isDragAxisBtn=!0,n._offsetYAxisBtn=e.clientY,s.EventUtil.addHandler(document,"mousemove",function(e){if(n._isDragAxisBtn){(e=e||window.event).stopPropagation(),e.preventDefault();var t=e.clientY-n._offsetYAxisBtn;if(!(Math.abs(t)<=10)){n._isClickAxisBtn=!1;var i=-(t+(1*n._timeAxisBox.getAttribute("offset-y")||0)),r=n.vOpt.fatherEle.firstElementChild.offsetHeight-n._timeAxisBox.offsetHeight;r<i&&(i=r),i<0&&(i=0),n._timeAxisBox.style.bottom=i+"px",n._timeAxisBox.setAttribute("offset-y",-i),n._rcdtimershaft.curPositon=i,n._offsetYAxisBtn=e.clientY}}}),s.EventUtil.addHandler(document,"mouseup",function(e){if(n._isDragAxisBtn){(e=e||window.event).stopPropagation(),e.preventDefault(),n._isDragAxisBtn=!1;var t=n;window.setTimeout(function(){t._isClickAxisBtn=!0}.bind(n),100)}}))}),s.EventUtil.addHandler(this._axisBtn,"click",function(e){n._isClickAxisBtn&&((e=e||window.event).preventDefault(),e.stopPropagation(),n._timeAxisBox.style.transition="all 0.6s ease-in","30px"==n._timeAxisBox.style.width?(n._axisBtn.classList.remove("expand"),n._timeAxisBox.style.width="100%",n._topTimeLabel.style.opacity="1",n._emitter.emit(l.default.OnTimeaxisLevel,n.vOpt.index,n._defaultLevel,!0)):(n._axisBtn.classList.add("expand"),n._timeAxisBox.style.width="30px",n._topTimeLabel.style.opacity="0",n._emitter.emit(l.default.OnTimeaxisLevel,n.vOpt.index,n._defaultLevel,!1)))}),this._rcdtimershaft.shrink||(this._axisBtn.classList.add("expand"),this._topTimeLabel.style.opacity="0",this._timeAxisBox.style.width="30px")}},{key:"_removeEventFn",value:function(){this._timeAxisTranslate&&(s.EventUtil.removeHandler(this._timeAxisTranslate,"mousedown",function(e){e.stopPropagation()}),s.EventUtil.removeHandler(this._timeAxisTranslate,"mouseup",function(e){e.stopPropagation()}))}},{key:"closeTimeAxis",value:function(){return this._removeEventFn(),this._timeAxisTranslate&&(this._timeAxisTranslate.remove(),this._timeAxisTranslate=null),this._subLabelBox&&(this._subLabelBox.remove(),this._subLabelBox=null),this._timeAxisBox&&(this._timeAxisBox.remove(),this._timeAxisBox=null),this._updateTimeAxisChecker&&(window.clearInterval(this._updateTimeAxisChecker),this._updateTimeAxisChecker=null),this._defaultLevel}},{key:"_updateHistoryTimeAxisRecord",value:function(e){this._timeAxisTranslate&&this._createVideoListDiv(e)}},{key:"_updateHistoryTimeAxis",value:function(e){!this._isDragTimeAxis&&this._timeAxisBox&&(null!=e&&0!==e||(e=(new Date).getTime()),this._timeAxisUpdate(e))}},{key:"_getScaleArray",value:function(e,t,i,r,n){var a=[],s=this._getShowTime(t),o=1e3*_[t],l=1e3*[0,0,0,0,0,0,-7200,-7200,-28800,-28800,0,0][t],u=0,h=e;if(10==t){var d=new Date(n),c=new Date(d.getFullYear(),d.getMonth(),1);l=d.getTime()-c.getTime(),u=parseInt(l/o*150),h=c.getTime()}else if(11==t){var f=new Date(n),p=f.getMonth(),v=new Date(f.getFullYear(),p-p%3,1);l=f.getTime()-v.getTime(),u=parseInt(l/o*150),h=v.getTime()}else u=parseInt((e%o-l)/o*150),h=parseInt(e+l-e%o);150<u&&(u-=150,h+=o),i+=37.5,r+=37.5;for(var m=u,g=h;m<=i;m+=150,g-=o)a.unshift({pos:0-m,time:s(g)});for(m=150-u,g=h+o;m<=r;m+=150,g+=o)a.push({pos:m,time:s(g)});return{offset:0-u,arr:a,offsetbg:parseInt((n-e)/o*150)}}},{key:"_getShowTime",value:function(e){return 9<e?function(e){var t=new Date(e),i=t.getMonth()+1;return t.getDate()<15||(i+=1),12<i?t.getFullYear()+1+"-01":1==i?t.getFullYear()+"-01":10<=i?""+i:"0"+i}:7<e?function(e){var t=new Date(e);return 0==t.getMonth()&&1==t.getDate()?t.format("yyyy-MM-dd"):t.format("MM-dd")}:1<e?function(e){var t=new Date(e);return 0==t.getHours()&&0==t.getMinutes()?0==t.getMonth()&&1==t.getDate()?t.format("yyyy-MM-dd hh:mm"):t.format("MM-dd hh:mm"):t.format("hh:mm")}:function(e){var t=new Date(e);return 0==t.getHours()&&0==t.getMinutes()&&0==t.getSeconds()?0==t.getMonth()&&1==t.getDate()?t.format("yyyy-MM-dd hh:mm:ss"):t.format("MM-dd hh:mm:ss"):t.format("hh:mm:ss")}}}]),c);function c(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c)}t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(330),o=i(329),l=i(391),c=(a=l)&&a.__esModule?a:{default:a};var f=0,p=1,v=2,m=3,g=4,_=5,y=7,u="init",h="begin",d="drawing",b="zooming",S="end",E=(r(k,[{key:"initializer",value:function(){this._zmSvg=null,this._zmSvgC=null,this._zmCanvas=null,this._zmTimer=null,this._zmInfo={status:f,ele:null,rect:{},move:{}},this._ptzInfo={status:f,ele:null,rect:{}},this._zmCvsSize={left:0,top:0,width:0,height:0},this._zmSvgSize={left:0,top:0,width:0,height:0},this._zmPos={},this._bPtz=!1,this._bZoom=!1,this._ptzStyle={},this._zmStyle={},this._zmStatus=u}},{key:"startPtz3D",value:function(e){return!(!this._videoplayer&&!this.isFirstCanPlay||(this._ptzStyle=o.Toolkit.deepMerge({lineWidth:"2px",lineColor:"#0F0",fillOpacity:0},e),this._bPtz||(this._ptzInfo.status=f,this._bPtz=!0,this._zmSvg||this._initZmSvg(),this._zmSvg.style.cursor="crosshair"),0))}},{key:"stopPtz3D",value:function(){return this._zmSvgC&&(this._bPtz=!1,this._ptzInfo.status=f,this._ptzInfo.ele=null,this._bPtz||this._bZoom||(this._zmSvgC.parentNode.removeChild(this._zmSvgC),this._zmSvgC=null,this._zmSvg=null)),!0}},{key:"getZoomStatus",value:function(){return this._zmStatus}},{key:"getPtz3DStatus",value:function(){return this._bPtz}},{key:"stopZoomByDblclick",value:function(e){this.vOpt.enableStopZoomByDblclick=e}},{key:"startZoom",value:function(e){return!(!this._videoplayer&&!this.isFirstCanPlay||(this._zmStyle=o.Toolkit.deepMerge({lineWidth:"2px",lineColor:"#F00",fillOpacity:0},e),this._bZoom||(this._zmInfo.status=f,this._bZoom=!0,this._zmSvg||this._initZmSvg(),this._zmSvg.style.cursor="crosshair",this._zmStatus=h,this._emitter.emit(c.default.OnZoomStatusChange,this.vOpt.index,h)),0))}},{key:"stopZoom",value:function(){this._zmSvgC&&(this._bZoom&&(this.setRTSVGPosition(this._zmCvsSize),this.setVMCanvasPosition(this._zmCvsSize)),this._bZoom=!1,this._zmInfo.status=f,this._zmInfo.ele=null,this._zmSvg.style.cursor="crosshair",this._zmTimer&&(window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.webkitCancelRequestAnimationFrame,window.cancelAnimationFrame(this._zmTimer),this._zmTimer=null),this._zmCanvas&&(this._zmCanvas.parentNode.removeChild(this._zmCanvas),this._zmCanvas=null,this.vOpt.videoEle.style.position="",this.vOpt.videoEle.style.left="",this.vOpt.videoEle.style.top="",this.vOpt.videoEle.style.width="",this.vOpt.videoEle.style.height=""),this._bPtz||this._bZoom||(this._zmSvgC.parentNode.removeChild(this._zmSvgC),this._zmSvgC=null,this._zmSvg=null),this._zmStatus=u,this._emitter.emit(c.default.OnZoomStatusChange,this.vOpt.index,S))}},{key:"setZoomFilter",value:function(){var e=this.vOpt.videoEle;this._zmCanvas&&e&&(this._zmCanvas.style.webkitFilter=e.style.webkitFilter,this._zmCanvas.style.filter=e.style.filter)}},{key:"_createZmSVGEleTag",value:function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return this._setZmSvgAttr(i,t),i}},{key:"_setZmSvgAttr",value:function(e,t){for(var i in t)e.setAttribute(i,t[i])}},{key:"_initZmSvg",value:function(){this._zmSvg||(this._zmSvgC=document.createElement("div"),this._zmSvgC.className="zoom-svg-container",this._zmSvgC.draggable=!0,this._zmSvg=this._createZmSVGEleTag("svg",{xmlns:"http://www.w3.org/2000/svg",class:"zoom-svg"}),this.setZoomSVGPosition(this._zmCvsSize),this._zmSvgC.appendChild(this._zmSvg),this.drawSvgC?(o.Toolkit.insertAfter(this._zmSvgC,this.drawSvgC),this.finishDrawing()):this._watermkC?o.Toolkit.insertAfter(this._zmSvgC,this._watermkC):this._drawVMCvsC?o.Toolkit.insertAfter(this._zmSvgC,this._drawVMCvsC):o.Toolkit.insertAfter(this._zmSvgC,this.vOpt.videoEle),this._bindZmSvgEvent())}},{key:"_initZoomCanvas",value:function(){this._zmCanvas||(this._zmCanvas=document.createElement("canvas"),this._zmCanvas.className="ZoomCanvas",this.vOpt.videoC.insertBefore(this._zmCanvas,this.vOpt.videoC.getElementsByTagName("video")[0])),this._zmTimer||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,this._zmTimer=window.requestAnimationFrame(this._drawZoomVideo.bind(this)))}},{key:"_modifyZoomShape",value:function(e,t){if(this._bZoom&&this._zmInfo.status>=v&&this._zmInfo.ele){var i=this._zmInfo.rect,r=e/this._zmSvgSize.width,n=t/this._zmSvgSize.height;i.x1=i.x1*r,i.y1=i.y1*n,i.x2=i.x2*r,i.y2=i.y2*n;var a="M "+i.x1+","+i.y1+" "+i.x1+","+i.y2+" "+i.x2+","+i.y2+" "+i.x2+","+i.y1+" Z";this._zmInfo.ele.setAttribute("d",a)}}},{key:"setZoomSVGPosition",value:function(e){var t=o.Toolkit.deepMerge({},e);if(this._zmCvsSize=o.Toolkit.deepMerge({},t),this._zmSvg){if(this._bZoom&&this._zmStatus==b&&this._zmCanvas){this._zmCanvas.style.left=t.left+"px",this._zmCanvas.style.top=t.top+"px",this._zmCanvas.style.width=t.width+"px",this._zmCanvas.style.height=t.height+"px",this._zmCanvas.width=t.width,this._zmCanvas.height=t.height;var i=Math.round(2*t.width/3),r=Math.round(2*t.height/3);t.left=t.left+i,t.top=t.top+r,t.width=t.width-i,t.height=t.height-r,this.vOpt.videoEle.style.position="absolute",this.vOpt.videoEle.style.left=t.left+"px",this.vOpt.videoEle.style.top=t.top+"px",this.vOpt.videoEle.style.width=t.width+"px",this.vOpt.videoEle.style.height=t.height+"px"}this._zmSvg.style.left=t.left+"px",this._zmSvg.style.top=t.top+"px",this._zmSvg.style.width=t.width+"px",this._zmSvg.style.height=t.height+"px",this._setZmSvgAttr(this._zmSvg,{width:t.width,height:t.height}),this._modifyZoomShape(t.width,t.height),this._zmSvgSize=o.Toolkit.deepMerge({},t)}return o.Toolkit.deepMerge({},t)}},{key:"_drawZmRect",value:function(e,t){var i=e.rect.x1,r=e.rect.y1,n=e.rect.x2,a=e.rect.y2;null==e.ele&&this._createZoomRect(e,t),this._setZmSvgAttr(e.ele,{d:"M "+i+","+r+" "+i+","+a+" "+n+","+a+" "+n+","+r+" Z"})}},{key:"_createZoomRect",value:function(e,t){t=t||{},e.ele=this._createZmSVGEleTag("path",{style:" fill:"+t.lineColor+"; fill-opacity:"+t.fillOpacity+"; stroke-width: "+t.lineWidth+"; stroke: "+t.lineColor}),this._zmSvg.appendChild(e.ele)}},{key:"_adjustZmRect",value:function(e,t){if(this._bZoom&&(this._zmInfo.status==g||this._zmInfo.status==_)){var i=this._zmInfo.rect,r=i.direction,n=this._zmInfo.move;if("x"===r&&e!=n.x)i.x2=i.x2+e-n.x;else if("y"===r&&t!=n.y)i.y2=i.y2+t-n.y;else{if("xy"!==r||e==n.x&&t==n.y)return;i.x2=i.x2+e-n.x,i.y2=i.y2+t-n.y}i.x2>this._zmSvgSize.width?i.x2=this._zmSvgSize.width:i.x2<0&&(i.x2=0),i.y2>this._zmSvgSize.height?i.y2=this._zmSvgSize.height:i.y2<0&&(i.y2=0),this._zmInfo.move={x:e,y:t},this._drawZmRect(this._zmInfo)}}},{key:"_calMoveXY",value:function(e,t,i,r){var n=i-t.x,a=r-t.y,s=this._zmSvgSize.width,o=this._zmSvgSize.height,l=Math.max(e.x1,e.x2),u=Math.max(e.y1,e.y2),h=Math.min(e.x1,e.x2),d=Math.min(e.y1,e.y2);return s<l+n?n=s-l:h+n<0&&(n=0-h),o<u+a?a=o-u:d+a<0&&(a=0-d),{xGap:n,yGap:a}}},{key:"_moveZmRect",value:function(e,t){if(this._bZoom&&this._zmInfo.status==y&&this._zmInfo.ele){var i=this._zmInfo.rect,r=this._calMoveXY(i,this._zmInfo.move,e,t),n=r.xGap,a=r.yGap;this._zmInfo.rect={x1:i.x1+n,y1:i.y1+a,x2:i.x2+n,y2:i.y2+a},this._drawZmRect(this._zmInfo),this._zmInfo.move.x=e,this._zmInfo.move.y=t}}},{key:"_getZoomVideoPos",value:function(e){this._zmPos={};var t=this._videoWidth/this._zmSvgSize.width,i=this._videoHeight/this._zmSvgSize.height;e.x1>e.x2?(this._zmPos.left=e.x2*t,this._zmPos.width=(e.x1-e.x2)*t):(this._zmPos.left=e.x1*t,this._zmPos.width=(e.x2-e.x1)*t),e.y1>e.y2?(this._zmPos.top=e.y2*i,this._zmPos.height=(e.y1-e.y2)*i):(this._zmPos.top=e.y1*i,this._zmPos.height=(e.y2-e.y1)*i)}},{key:"_drawZoomVideo",value:function(){this._zmCanvas&&(this._zmCanvas.getContext("2d").drawImage(this.vOpt.videoEle,this._zmPos.left,this._zmPos.top,this._zmPos.width,this._zmPos.height,0,0,this._zmCvsSize.width,this._zmCvsSize.height),this._zmTimer=window.requestAnimationFrame(this._drawZoomVideo.bind(this)))}},{key:"_beginZoom",value:function(){this._getZoomVideoPos(this._zmInfo.rect),this._initZoomCanvas(),this._zmStatus=b;var e=this.setZoomSVGPosition(this._zmCvsSize);this.setRTSVGPosition(e),this.setVMCanvasPosition(e),this._zmSvgC.draggable=!0,this._emitter.emit(c.default.OnZoomStatusChange,this.vOpt.index,b)}},{key:"_onZmSvgMouseUp",value:function(e){var t=e||window.event,i=t.offsetX,r=t.offsetY,n=this._zmSvgSize.width,a=this._zmSvgSize.height;if(i<0?i=0:n<i&&(i=n),r<0?r=0:a<r&&(r=a),!this._bPtz||this._ptzInfo.status!=p&&this._ptzInfo.status!=v)if(!this._bZoom||this._zmInfo.status!=p&&this._zmInfo.status!=v)this._bZoom&&this._zmInfo.status==y?(this._moveZmRect(i,r),this._getZoomVideoPos(this._zmInfo.rect),this._zmInfo.status=m,this._zmSvgC.draggable=!0):!this._bZoom||this._zmInfo.status!=g&&this._ptzInfo.status!=_||(this._adjustZmRect(i,r),this._getZoomVideoPos(this._zmInfo.rect),this._zmInfo.status=m,this._zmSvgC.draggable=!0);else{if(Math.abs(i-this._zmInfo.rect.x1)<1&&Math.abs(r-this._zmInfo.rect.y1)<1)return void(this._zmInfo.status=f);this._zmInfo.status=m,this._zmInfo.rect.x2=i,this._zmInfo.rect.y2=r,this._drawZmRect(this._zmInfo,this._zmStyle),this._beginZoom()}else{if(0<n&&0<a){var s=this._ptzInfo.rect,o=-1,l=0,u=0,h=0,d=0;d=s.y1>s.y2?(h=s.y2/a,(s.y1-s.y2)/a):(h=s.y1/a,(s.y2-s.y1)/a),s.x1==s.x2&&s.y1==s.y2?(o=2,l=s.x1/n):u=s.x1>s.x2?(o=1,l=s.x2/n,(s.x1-s.x2)/n):(o=0,l=s.x1/n,(s.x2-s.x1)/n),this.vOpt.enablePtzMotion&&this.ptzControl3d(o,l,h,u,d),this._emitter.emit(c.default.OnPTZControl3DEvent,this.vOpt.index,o,l,h,u,d,this.vOpt.enablePtzMotion),this._zmSvgC.draggable=!0}this._ptzInfo.ele&&this._zmSvg.removeChild(this._ptzInfo.ele),this._ptzInfo.ele=null,this._ptzInfo.status=f}}},{key:"_getAdjustRectPoint",value:function(e){var t=this._zmInfo.rect,i=t.x1,r=t.y1,n=t.x2,a=t.y2;this._zmInfo.rect.direction=e.direction,0===e.index||3===e.index?i<n&&(this._zmInfo.rect.x1=n,this._zmInfo.rect.x2=i):1!==e.index&&2!==e.index||n<i&&(this._zmInfo.rect.x1=n,this._zmInfo.rect.x2=i),0===e.index||1===e.index?r<a&&(this._zmInfo.rect.y1=a,this._zmInfo.rect.y2=r):2!==e.index&&3!==e.index||a<r&&(this._zmInfo.rect.y1=a,this._zmInfo.rect.y2=r)}},{key:"_checkZoomStatus",value:function(e,t){if(this._bZoom&&this._zmInfo.status==m){var i={direction:"",mouse:"default",index:0},r={x:e.offsetX,y:e.offsetY},n=this._zmInfo.rect,a=[{x:n.x1,y:n.y1},{x:n.x2,y:n.y2}];o.Toolkit.isPointInRect(r,a,i)&&t&&(this._zmSvgC.draggable=!1,"move"===i.mouse?this._zmInfo.status=y:(this._zmInfo.status=g,this._getAdjustRectPoint(i)),this._zmInfo.move.x=e.offsetX,this._zmInfo.move.y=e.offsetY),this._zmSvg.style.cursor=i.mouse}}},{key:"_bindZmSvgEvent",value:function(){var n=this;s.EventUtil.addHandler(this._zmSvg,"click",function(e){e.stopPropagation(),n._emitter.emit(c.default.OnWndClick,n.vOpt.index)}),s.EventUtil.addHandler(this._zmSvg,"mousedown",function(e){e.stopPropagation(),n._emitter.emit(c.default.OnMouseDown,n.vOpt.index);var t=e||window.event;if(0===t.button){var i=t.offsetX,r=t.offsetY;n._bPtz?(n._zmSvgC&&(n._zmSvgC.draggable=!1),n._ptzInfo.status=p,n._ptzInfo.ele=null,n._ptzInfo.rect={x1:i,y1:r,x2:i,y2:r}):n._bZoom&&(n._zmInfo.status==f?(n._zmSvgC&&(n._zmSvgC.draggable=!1),n._zmInfo.status=p,n._zmInfo.ele=null,n._zmInfo.rect={x1:i,y1:r,x2:i,y2:r},n._zmStatus=d,n._emitter.emit(c.default.OnZoomStatusChange,n.vOpt.index,d)):n._zmInfo.status==m&&n._checkZoomStatus(t,!0))}}),s.EventUtil.addHandler(this._zmSvg,"mousemove",function(e){e.stopPropagation();var t=e||window.event,i=t.offsetX,r=t.offsetY;n._bPtz&&1==t.buttons?n._ptzInfo.status!=p&&n._ptzInfo.status!=v||n._ptzInfo.rect.x1===i&&n._ptzInfo.rect.y1===r||(n._ptzInfo.status=v,n._ptzInfo.rect.x2=i,n._ptzInfo.rect.y2=r,n._drawZmRect(n._ptzInfo,n._ptzStyle)):n._bZoom&&1==t.buttons?n._zmInfo.status==p||n._zmInfo.status==v?(n._zmInfo.status=v,n._zmInfo.rect.x2=i,n._zmInfo.rect.y2=r,n._drawZmRect(n._zmInfo,n._zmStyle)):n._zmInfo.status==g||n._zmInfo.status==_?(n._adjustZmRect(i,r),n._getZoomVideoPos(n._zmInfo.rect)):n._zmInfo.status===y&&(n._moveZmRect(i,r),n._getZoomVideoPos(n._zmInfo.rect)):!n._bPtz&&n._bZoom&&0==t.buttons&&n._checkZoomStatus(t,!1)}),s.EventUtil.addHandler(this._zmSvg,"mouseleave",function(e){n._onZmSvgMouseUp(e)}),s.EventUtil.addHandler(this._zmSvg,"mouseup",function(e){n._onZmSvgMouseUp(e)}),s.EventUtil.addHandler(this._zmSvg,"dblclick",function(e){e.stopPropagation(),n._bZoom&&n.vOpt.enableStopZoomByDblclick&&n._zmStatus==b?n.stopZoom():n._emitter.emit(c.default.OnWndDClik,n.vOpt.index)})}}]),k);function k(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,k)}t.default=E},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(342),o=((a=s)&&a.__esModule,i(398)),l=i(348);var u=(r(h,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket&&window&&(self.WebSocket=window.WebSocket),void 0!==self.WebSocket}catch(e){return!1}}}]),r(h,[{key:"destroy",value:function(){this._ws&&this.abort(),this._status=o.ControllerStatus.kIdle,this._onError=null,this._onComplete=null,this._onCommand=null}},{key:"isWorking",value:function(){return this._status===o.ControllerStatus.kConnecting||this._status===o.ControllerStatus.kBuffering}},{key:"open",value:function(e){e=e||this._url;try{var t=this._ws=new self.WebSocket(e);return t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=o.ControllerStatus.kConnecting,!0}catch(e){this._clearResouse(),this._status=o.ControllerStatus.kError;var i={code:e.code,msg:e.message};if(!this._onError)throw new l.RuntimeException(i.msg);return this._onError(o.ControllerErrors.EXCEPTION,i),!1}}},{key:"_send",value:function(e,t){var i=this._ws;if(i&&1===i.readyState){var r=e;"string"==typeof r&&(r=JSON.parse(r));var n=++this._id;r._innerid="_"+n,this._cmdCallback[r.name+r._innerid]=t,i.send(JSON.stringify(r))}else{"function"==typeof t&&t({error:-1,message:"websocketError"}),this._clearResouse(),this._status=o.ControllerStatus.kError;var a={code:-1,msg:"Unsupported WebSocket readyState while sending"};if(!this._onError)throw new l.RuntimeException(a.msg);this._onError(o.ControllerErrors.EXCEPTION,a)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=o.ControllerStatus.kComplete}},{key:"listObject",value:function(e,t){var i={type:"command",name:"ListObject",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"queryRecord",value:function(e,t){var i={type:"command",name:"QueryRecord",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"startServerRecord",value:function(e,t){var i={type:"command",name:"StartServerRecord",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"stopServerRecord",value:function(e,t){var i={type:"command",name:"StopServerRecord",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"startTalkback",value:function(e,t){var i={type:"command",name:"StartTalkBack",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"stopTalkback",value:function(e,t){var i={type:"command",name:"StopTalkBack",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"getTalkbackMode",value:function(e,t){var i={type:"command",name:"GetTalkBackMode",param:e};return this._status===o.ControllerStatus.kConnecting?this._commandArr.push({cmd:i,onresponse:t}):this._send(i,t),!0}},{key:"_onWebSocketOpen",value:function(e){this._status=o.ControllerStatus.kBuffering;for(var t=this._commandArr.pop();t;)this._send(t.cmd,t.onresponse),t=this._commandArr.pop()}},{key:"_onWebSocketClose",value:function(e){this._clearResouse(),!0!==this._requestAbort?(this._status=o.ControllerStatus.kComplete,this._onComplete&&this._onComplete()):this._requestAbort=!1}},{key:"_onWebSocketMessage",value:function(e){"string"==typeof e.data&&this._onCommandResponse(e.data)}},{key:"_onCommandResponse",value:function(e){var t=JSON.parse(e),i=t.name+t._innerid,r=this._cmdCallback[i];"function"==typeof r&&r(t.param,t.rederved),delete this._cmdCallback[i],this._onCommand&&this._onCommand(t)}},{key:"_onWebSocketError",value:function(e){this._clearResouse(),this._status=o.ControllerStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new l.RuntimeException(t.msg);this._onError(o.ControllerErrors.EXCEPTION,t)}},{key:"_clearResouse",value:function(){for(var e=this._commandArr.pop();e;)"function"==typeof e.onresponse&&e.onresponse({error:-1,message:"websocketError"}),e=this._commandArr.pop();for(var t in this._cmdCallback){var i=this._cmdCallback[t];"function"==typeof i&&i({error:-1,message:"websocketError"})}this._cmdCallback={}}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"onCommand",get:function(){return this._onCommand},set:function(e){this._onCommand=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.TAG="WebSocketController",this._type="websocket-controller",this._status=o.ControllerStatus.kIdle,this._onError=null,this._onComplete=null,this._onCommand=null,this._ws=null,this._requestAbort=!1,this._commandArr=[],this._id=0,this._cmdCallback={},this._url=e}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControllerErrors=t.ControllerStatus=void 0;i(348),t.ControllerStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},t.ControllerErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(342),o=((a=s)&&a.__esModule,i(398)),m=(i(348),i(329));var l=(r(u,[{key:"destroy",value:function(){for(var e in this._status=o.ControllerStatus.kIdle,this._downloadChecker&&(window.clearInterval(this._downloadChecker),this._downloadChecker=null),this._downloadMap)this.stopDownload(e,!0);this._talkbackInfo&&this.stopTalkback(this._talkbackInfo,null)}},{key:"startDownload",value:function(e,i){var r=this,n=e.device,t={},a="";if("pvg67"===n)(t=m.Toolkit.deepMerge(t,e)).filename=this._downloadDir+t.filename,a="StartDownloadRecord";else if("pvgplus"===n)(t=m.Toolkit.deepMerge(t,e)).device="pvg+",t.filename=this._downloadDir+t.filename,a="StartDownloadRecord";else if("pfsup"===n)t=m.Toolkit.deepMerge(t,e),t={info:JSON.stringify(t)},a="StartUploadPFSFile";else if("pfsdown"===n)(t=m.Toolkit.deepMerge(t,e)).downloadpath=this._downloadDir,t={info:JSON.stringify(t)},a="StartDwonloadPFSFile";else{if("http"!==n)return i&&i({error:-1,msg:"cannot find device:"+n}),!1;(t=m.Toolkit.deepMerge(t,e)).downloadpath=this._downloadDir,a="StartDownloadHttpFile"}return this._ajaxjsonp({url:this._url+a,data:t,success:function(e){if(e&&e[a]){if(0===e[a].error){var t=e[a].id;r._downloadMap[t]={funcall:i,device:n,pause:!1,bstoped:!1,process:0,filenameList:[],finishobj:{}},r._downloadChecker||(r._downloadChecker=window.setInterval(r._getLoadingStatus.bind(r),1e3))}i&&i(e[a])}else i&&i({error:-1,msg:"response error"})},error:function(e){i&&i(e)}}),!0}},{key:"stopDownload",value:function(e,t,i){return this._stopDownload(e,t,i,!0)}},{key:"_stopDownload",value:function(i,e,r,n){var a=this;if(void 0===this._downloadMap[i])return r&&r({error:-1,msg:"cannot find taskid:"+i}),!1;if(!0===this._downloadMap[i].bstoped)return delete this._downloadMap[i],r&&r({error:0,msg:""}),!0;var t=this._downloadMap[i].device,s="";if("pvg67"===t)s="StopDownloadRecord";else if("pvgplus"===t)s="StopDownloadRecord";else if("pfsup"===t)s="StopUploadPFSFile";else if("pfsdown"===t)s="StopDownloadPFSFile";else{if("http"!==t)return r&&r({error:-1,msg:"cannot find device:"+t}),!1;s="StopDownloadHttpFile"}return this._ajaxjsonp({url:this._url+s,data:{id:i,del:e?1:0},success:function(e){if(e&&e[s]){if(!e[s].id)return delete a._downloadMap[i],r&&r(e[s]),!0;var t=e[s].id;n?delete a._downloadMap[t]:0===e[s].error&&(a._downloadMap[t].bstoped=!0),r&&r(e[s])}else r&&r({error:-1,msg:"response error"})},error:function(e){r&&r(e)}}),!0}},{key:"pauseDownload",value:function(e,i,r){var n=this;if(void 0===this._downloadMap[e])return r&&r({error:-1,msg:"cannot find taskid:"+e}),!1;var t=this._downloadMap[e].device,a="";if("pvg67"===t)a="PauseDownloadRecord";else if("pvgplus"===t)a="PauseDownloadRecord";else if("pfsup"===t)a="PauseUploadPFSFile";else if("pfsdown"===t)a="PauseDownloadPFSFile";else{if("http"!==t)return r&&r({error:-1,msg:"cannot find device:"+t}),!1;a="PauseDownloadHttpFile"}return!0===this._downloadMap[e].bstoped?i?r&&r({error:-1,msg:"task finished taskid:"+e}):(r&&r({error:0,msg:""}),this._downloadMap[e].funcall&&this._downloadMap[e].funcall(this._downloadMap[e].finishobj)):this._ajaxjsonp({url:this._url+a,data:{id:e,param:i?1:0},success:function(e){if(e&&e[a]){if(0===e[a].error){var t=e[a].id;n._downloadMap[t].pause=i}r&&r(e[a])}else r&&r({error:-1,msg:"response error"})},error:function(e){r&&r(e)}}),!0}},{key:"deletePFSFile",value:function(e,t){return this._sendHttpCmd("DeletePFSFile",{info:JSON.stringify(e)},t),!0}},{key:"getDownloadDir",value:function(){return this._downloadDir}},{key:"setDownloadDir",value:function(t,i){return this.isDirectoryWriteable(t,function(e){0==e.error&&(this._downloadDir=t,this._downloadDir=this._downloadDir.replace(/\\/g,"/"),"/"!==this._downloadDir.charAt(this._downloadDir.length-1)&&(this._downloadDir+="/")),i&&i(e)}.bind(this)),!0}},{key:"isDirectoryWriteable",value:function(e,t){return this._sendHttpCmd("IsDirectoryWriteable",{dir:e},t),!0}},{key:"imageProcess",value:function(e,t){return!0}},{key:"isUpgradeVersion",value:function(e,t){return this._sendHttpCmd("IsUpgradeVersion",{version:"string"==typeof e?e:JSON.stringify(e)},t),!0}},{key:"getOcxVersionInfo",value:function(e){return this._sendHttpCmd("VersionInfo",{},e,"http://127.0.0.1:9120/"),!0}},{key:"startTalkback",value:function(e,t){return this._talkbackInfo=e,this._sendHttpCmd("StartTalkback",e,t),!0}},{key:"stopTalkback",value:function(e,t){return this._sendHttpCmd("StopTalkback",e,t),!0}},{key:"removeFile",value:function(e,t){return this._sendHttpCmd("RemoveFile",{path:e},t),!0}},{key:"getRegistryInfo",value:function(e,t){return this._sendHttpCmd("GetRegistryInfo",{key:e},t),!0}},{key:"getMacString",value:function(e){return this._sendHttpCmd("GetMacString",{},e),!0}},{key:"runProcess",value:function(e,t){return this._sendHttpCmd("RunProcess",e,t),!0}},{key:"openFileDirectory",value:function(e,t){return this._sendHttpCmd("OpenContainsFileDirectory",{filepath:e},t),!0}},{key:"getCpuMemory",value:function(e){return this._sendHttpCmd("GetCpuMemory",{},e),!0}},{key:"getExpandScreenInfo",value:function(e){return this._sendHttpCmd("GetExpandScreenInfo",{},e),!0}},{key:"moveProcessWindow",value:function(e,t){return this._sendHttpCmd("MoveProcessWindow",e,t),!0}},{key:"savePicture",value:function(e,t){var i=e.filename||"",r="";if(4<=i.length)r=i.substr(i.length-4,4).toLowerCase();else if(0===i.length)return t&&t({error:-1,msg:"filename error"}),!1;i=i.substr(0,i.length-4);var n=0,a=0;if(".bmp"===r)a=1;else if("gif"===r)a=2;else if("jpg"===r)a=3;else if("png"===r)a=4;else{if(i=e.filename,"bmp"===e.type)n=1,r=".bmp";else if("gif"===e.type)n=2,r=".gif";else if("jpeg"===e.type)n=3,r=".jpg";else{if("png"!==e.type)return t&&t({error:-1,msg:"type error"}),!1;n=4,r=".png"}a=n}return 0===i.length?(t&&t({error:-1,msg:"filename error"}),!1):(this._sendHttpCmd("SetOptionEx",{opt:"savepicture",dir:this._downloadDir,filename:i,suffix:r,picture:e.picture,type:n,destype:a},t),!0)}},{key:"copyToClipboard",value:function(e,t){return this._sendHttpCmd("CopyToClipboard",{data:e},t,"http://127.0.0.1:9120/"),!0}},{key:"_getDownloadDir",value:function(e){this._sendHttpCmd("GetDefDownloadDir",{},e)}},{key:"_sendHttpCmd",value:function(t,e,i,r){var n=r||this._url;this._ajaxjsonp({url:n+t,data:e,success:function(e){e&&e[t]?i&&i(e[t]):i&&i({error:-1,msg:"response error"})},error:function(e){i&&i(e)}})}},{key:"_getLoadingStatus",value:function(){this._getDownloadStatus("pvg67",this._finishcallback.bind(this))}},{key:"_finishcallback",value:function(e){var t="";if("pvg67"===e)t="pvgplus";else if("pvgplus"===e)t="pfsup";else if("pfsup"===e)t="pfsdown";else{if("pfsdown"!==e)return;t="http"}this._getDownloadStatus(t,this._finishcallback.bind(this))}},{key:"_getDownloadStatus",value:function(e,d){var c=this,f="GetDownloadStatus",p=e||"pvg67",t="";if("pvg67"===p)t="pvg67_download";else if("pvgplus"===p)t="pvg+_download";else if("pfsup"===p)t="pfs_updownload",f="GetUploadPFSFileStatus";else if("pfsdown"===p)t="pfs_updownload",f="GetDownloadPFSFileStatus";else{if("http"!==p)return void(d&&d(p));t="http_download",f="GetDownloadHttpFileStatus"}var v=[];for(var i in this._downloadMap)this._downloadMap[i].device!==p||this._downloadMap[i].bstoped||v.push(i);if(0!=v.length){var r={id:JSON.stringify({device:t,ids:JSON.stringify(v)})};this._ajaxjsonp({url:this._url+f,data:r,success:function(e){if(e&&e[f]){var t=e[f];if("[object Array]"!=toString.apply(t)){for(var i=0;i<v.length;i++){var r=v[i];if(c._downloadMap[r]&&c._downloadMap[r].funcall){var n=c._downloadMap[r].funcall;c._stopDownload(r,!0,null,!1),n({id:r,error:t.error,msg:""})}}return void(d&&d(p))}for(var a=0;a<t.length;a++){t[a].filepath&&(t[a].filepath=t[a].filepath.replace(/\\/g,""))&&(t[a].filepath=t[a].filepath.replace(/\/\//g,"/"));var s=t[a].id;if(void 0!==c._downloadMap[s]){c._downloadMap[s].process=t[a].process;var o=null;if(0!=t[a].error&&1e4===c._downloadMap[s].process);else if(c._downloadMap[s].funcall){if("pvg67"===p||"pvgplus"===p){if(t[a].filenameList){var l=JSON.parse(t[a].filenameList);if(l&&0<l.length)for(var u=0;u<l.length;u++){var h=l[u].filename;0<h.length&&c._downloadMap[s].filenameList.push(h)}}0<c._downloadMap[s].filenameList.length&&(t[a].filenameList=c._downloadMap[s].filenameList)}c._downloadMap[s].pause&&0===t[a].error?1e4===t[a].process&&(c._downloadMap[s].finishobj=m.Toolkit.deepMerge({},t[a])):(t[a].device=p,o=c._downloadMap[s].funcall)}1e4===t[a].process?c._stopDownload(s,!1,null,!1):0!=t[a].error&&c._stopDownload(s,!0,null,!1),o&&o(t[a])}}}console.log(e),d&&d(p)},error:function(e){d&&d(p)}})}else d&&d(p)}},{key:"_ajaxjsonp",value:function(e){function o(){return(new Date).getTime()+""+Math.floor(1e4*Math.random()+500)}(e=e||{}).data=e.data||{},function(t,e){for(var i=o(),r="jsonpcb"+i;"functionsa"==typeof window[r];)console.log("00 rename",r),i=o(),r="jsonpcb"+i;var n=document.getElementsByTagName("head")[0];e&&(t.data._h5vp_uuid=e),t.data.jsonpcallback=r;var a=function(e,t){var i=[];for(var r in e)i.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return i.push("_="+t),i.join("&")}(t.data,i),s=document.createElement("script");n.appendChild(s),window[r]=function(e){n.removeChild(s),clearTimeout(s.timer),window[r]=null,t.success&&t.success(e)},-1===t.url.indexOf("?")?s.src=t.url+"?"+a:s.src=t.url+"&"+a,s.timer=setTimeout(function(){window[r]=null,n.removeChild(s),t.error&&t.error({error:-1,msg:"timeout"})},1e4)}(e,this._uuid)}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.TAG="HttpController",this._type="http-controller",this._uuid=m.Toolkit.getUuid(),this._status=o.ControllerStatus.kIdle,this._downloadMap={},this._downloadChecker=null,this._url="http://127.0.0.1:9120/api/",this._downloadDir="D:/RecordDownloads/",this._talkbackInfo=null,this.isDirectoryWriteable(this._downloadDir,function(e){if(0!=e.error){var t=this;this._getDownloadDir(function(e){0==e.error&&(t._downloadDir=e.dir,t._downloadDir=t._downloadDir.replace(/\\/g,"/"),"/"!==t._downloadDir.charAt(t._downloadDir.length-1)&&(t._downloadDir+="/"))})}}.bind(this))}t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(398),o=i(351),l=(a=o)&&a.__esModule?a:{default:a};var u=(r(h,[{key:"initializer",value:function(e){this._exStatus=s.ControllerStatus.kIdle,this._exWS=null,this._exCommandArr=[],this._exId=0,this._exCmdCallback={},this._exUrl=e,this._processname="",l.default.chrome?this._processname="chrome.exe":l.default.msedge?this._processname="MicroftEdgeCP.exe":l.default.msie&&(this._processname="iexplore.exe")}},{key:"destroy",value:function(){this._exWS&&(this._exAbort(),this._exWS=null),this._exStatus=s.ControllerStatus.kIdle}},{key:"_exOpen",value:function(e){if(this._exWS)return!0;e=e||this._exUrl;try{var t=this._exWS=new window.WebSocket(e);return t.binaryType="arraybuffer",t.onopen=this._onExwsOpen.bind(this),t.onclose=this._onExwsClose.bind(this),t.onmessage=this._onExwsMessage.bind(this),t.onerror=this._onExwsError.bind(this),this._exStatus=s.ControllerStatus.kConnecting,!0}catch(e){return this._exClearResouse(),this._exStatus=s.ControllerStatus.kError,!1}}},{key:"_exSend",value:function(e,t,i){if(i&&!this._exWS&&this._exOpen(),this._exWS&&this._exStatus===s.ControllerStatus.kConnecting)this._exCommandArr.push({cmd:e,onresponse:t});else if(this._exWS&&this._exStatus==s.ControllerStatus.kBuffering){var r=e;"string"==typeof r&&(r=JSON.parse(r));var n=++this._exId;r._innerid="_"+n,this._exCmdCallback[r.name+r._innerid]=t,this._exWS.send(JSON.stringify(r))}else"function"==typeof t&&t({error:-1,message:"websocketError"}),this._exClearResouse(),this._exStatus=s.ControllerStatus.kError}},{key:"_exAbort",value:function(){var e=this._exWS;!e||0!==e.readyState&&1!==e.readyState||e.close(),this._exClearResouse(),this._exStatus=s.ControllerStatus.kComplete}},{key:"_onExwsOpen",value:function(e){this._exStatus=s.ControllerStatus.kBuffering;for(var t=this._exCommandArr.pop();t;)this._exSend(t.cmd,t.onresponse,!1),t=this._exCommandArr.pop()}},{key:"_onExwsClose",value:function(e){this._exClearResouse(),this._exStatus=s.ControllerStatus.kComplete}},{key:"_onExwsMessage",value:function(e){"string"==typeof e.data&&this._onCommandResponseEx(e.data)}},{key:"_onCommandResponseEx",value:function(e){var t=JSON.parse(e),i=t.name+t._innerid,r=this._exCmdCallback[i];"function"==typeof r&&r(t.param,t.rederved),delete this._exCmdCallback[i]}},{key:"_onExwsError",value:function(e){this._exClearResouse(),this._exStatus=s.ControllerStatus.kError}},{key:"_exClearResouse",value:function(){for(var e=this._exCommandArr.pop();e;)"function"==typeof e.onresponse&&e.onresponse({error:-1,message:"websocketError"}),e=this._exCommandArr.pop();for(var t in this._exCmdCallback){var i=this._exCmdCallback[t];"function"==typeof i&&i({error:-1,message:"websocketError"})}this._exCmdCallback={},this._exWS=null}},{key:"setupversion",value:function(e){return this._exSend({type:"command",name:"GetVersion",param:{}},e,!0),!0}},{key:"getMacString",value:function(e){return this._exSend({type:"command",name:"GetMacString",param:{}},e,!0),!0}},{key:"getCpuMemory",value:function(e){return this._exSend({type:"command",name:"GetCpuMemory",param:{}},e,!0),!0}},{key:"getExpandScreenInfo",value:function(e){return this._exSend({type:"command",name:"GetExpandScreenInfo",param:{}},e,!0),!0}},{key:"getRegistryInfo",value:function(e,t){var i={type:"command",name:"GetRegistryInfo",param:{key:e}};return this._exSend(i,t,!0),!0}},{key:"runProcess",value:function(e,t){var i={type:"command",name:"RunProcess",param:e};return this._exSend(i,t,!0),!0}},{key:"openFileDirectory",value:function(e,t){var i={type:"command",name:"OpenFileDirectory",param:{filepath:e}};return this._exSend(i,t,!0),!0}},{key:"moveProcessWindow",value:function(e,t){var i={type:"command",name:"MoveProcessWindow",param:e};return this._exSend(i,t,!0),!0}},{key:"savePicture",value:function(e,t){var i={type:"command",name:"SavePicture",param:e};return this._exSend(i,t,!0),!0}},{key:"copyToClipboard",value:function(e,t){var i={type:"command",name:"CopyToClipboard",param:{context:e}};return this._exSend(i,t,!0),!0}},{key:"isFileExist",value:function(e,t){var i={type:"command",name:"IsFileExist",param:{filepath:e}};return this._exSend(i,t,!0),!0}},{key:"removeFile",value:function(e,t){var i={type:"command",name:"RemoveFile",param:{filepath:e}};return this._exSend(i,t,!0),!0}},{key:"openSaveFileDlg",value:function(e,t){var i=e;Object.assign(i,{processname:this._processname,titlename:document.title});var r={type:"command",name:"OpenSaveFileDlg",param:i};return this._exSend(r,t,!0),!0}},{key:"openLocalSelectFolderDlg",value:function(e,t){var i={type:"command",name:"OpenLocalSelectFolderDlg",param:{defpath:e,processname:this._processname,titlename:document.title}};return this._exSend(i,t,!0),!0}},{key:"isUpdateSetup",value:function(e,t){var i={type:"command",name:"IsUpdate",param:{versioninfo:e}};this._exSend(i,t,!0)}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.initializer(e)}t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a,s=i(365),o=(a=s)&&a.__esModule?a:{default:a},l=i(337);var u=(r(h,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){return o.default.isSupported()}},{key:"supportNetworkStreamIOFlv",value:function(){var e=new o.default({},(0,l.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t}},{key:"getNetworkLoaderTypeName",value:function(){var e=new o.default({},(0,l.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t}},{key:"supportNativeMediaPlayback",value:function(e){null==h.videoElement&&(h.videoElement=window.document.createElement("video"));var t=h.videoElement.canPlayType(e);return"probably"===t||"maybe"==t}},{key:"getFeatureList",value:function(){var e={mseH264Playback:!1,mseLiveH264Playback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return e.mseH264Playback=!!h.supportMSEH264Playback(),e.networkStreamIO=!!h.supportNetworkStreamIO(),e.networkLoaderName=h.getNetworkLoaderTypeName(),e.mseLiveFlvPlayback=e.mseFlvPlayback&&e.supportNetworkStreamIOFlv(),e.mseLiveH264Playback=e.mseH264Playback&&e.networkStreamIO,e.nativeMP4H264Playback=h.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),e.nativeWebmVP8Playback=h.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),e.nativeWebmVP9Playback=h.supportNativeMediaPlayback('video/webm; codecs="vp9"'),e}}]),h);function h(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h)}t.default=u},function(e,t){}]);